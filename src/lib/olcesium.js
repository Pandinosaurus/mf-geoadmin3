!function(){"use strict";var e=0;function St(t){return t.ol_uid||(t.ol_uid=++e)}var t="latest",o=function(i){function t(t){var e="Assertion failed. See https://openlayers.org/en/latest/doc/errors/#"+t+" for details.";i.call(this,e);this.code=t;this.name="AssertionError";this.message=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Error),a={ADD:"add",REMOVE:"remove"},l={PROPERTYCHANGE:"propertychange"},T="function"==typeof Object.assign?Object.assign:function(t,e){var i=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),o=1,n=arguments.length;o<n;++o){var s=i[o];if(null!=s)for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])}return r};function _(t){for(var e in t)delete t[e]}function s(t){var e=[];for(var i in t)e.push(t[i]);return e}function Ct(t){var e;for(e in t)return!1;return!e}function h(r){var t=function(t){var e=r.listener,i=r.bindTo||r.target;r.callOnce&&g(r);return e.call(i,t)};return r.boundListener=t}function u(t,e,i,r){for(var o,n=0,s=t.length;n<s;++n)if((o=t[n]).listener===e&&o.bindTo===i){r&&(o.deleteIndex=n);return o}}function c(t,e){var i=p(t);return i?i[e]:void 0}function p(t,e){var i=t.ol_lm;!i&&e&&(i=t.ol_lm={});return i}function r(t,e){var i=c(t,e);if(i){for(var r=0,o=i.length;r<o;++r){t.removeEventListener(e,i[r].boundListener);_(i[r])}i.length=0;var n=p(t);if(n){delete n[e];0===Object.keys(n).length&&delete t.ol_lm}}}function S(t,e,i,r,o){var n=p(t,!0),s=n[e];s||(s=n[e]=[]);var a=u(s,i,r,!1);if(a)o||(a.callOnce=!1);else{a={bindTo:r,callOnce:!!o,listener:i,target:t,type:e};t.addEventListener(e,h(a));s.push(a)}return a}function n(t,e,i,r){return S(t,e,i,r,!0)}function d(t,e,i,r){var o=c(t,e);if(o){var n=u(o,i,r,!0);n&&g(n)}}function g(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var e=c(t.target,t.type);if(e){var i="deleteIndex"in t?t.deleteIndex:e.indexOf(t);-1!==i&&e.splice(i,1);0===e.length&&r(t.target,t.type)}_(t)}}function f(t){var e=p(t);if(e)for(var i in e)r(t,i)}var i=function(){this.disposed_=!1};i.prototype.dispose=function(){if(!this.disposed_){this.disposed_=!0;this.disposeInternal()}};i.prototype.disposeInternal=function(){};function y(){return!0}function v(){return!1}function L(){}var m=function(t){this.propagationStopped;this.type=t;this.target=null};m.prototype.preventDefault=function(){this.propagationStopped=!0};m.prototype.stopPropagation=function(){this.propagationStopped=!0};function E(t){t.stopPropagation()}var x=function(t){function e(){t.call(this);this.pendingRemovals_={};this.dispatching_={};this.listeners_={}}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.addEventListener=function(t,e){var i=this.listeners_[t];i||(i=this.listeners_[t]=[]);-1===i.indexOf(e)&&i.push(e)};e.prototype.dispatchEvent=function(t){var e,i="string"==typeof t?new m(t):t,r=i.type,o=(i.target=this).listeners_[r];if(o){if(!(r in this.dispatching_)){this.dispatching_[r]=0;this.pendingRemovals_[r]=0}++this.dispatching_[r];for(var n=0,s=o.length;n<s;++n)if(!1===o[n].call(this,i)||i.propagationStopped){e=!1;break}--this.dispatching_[r];if(0===this.dispatching_[r]){var a=this.pendingRemovals_[r];delete this.pendingRemovals_[r];for(;a--;)this.removeEventListener(r,L);delete this.dispatching_[r]}return e}};e.prototype.disposeInternal=function(){f(this)};e.prototype.getListeners=function(t){return this.listeners_[t]};e.prototype.hasListener=function(t){return t?t in this.listeners_:0<Object.keys(this.listeners_).length};e.prototype.removeEventListener=function(t,e){var i=this.listeners_[t];if(i){var r=i.indexOf(e);if(t in this.pendingRemovals_){i[r]=L;++this.pendingRemovals_[t]}else{i.splice(r,1);0===i.length&&delete this.listeners_[t]}}};return e}(i),R={CHANGE:"change",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"},C=function(t){function e(){t.call(this);this.revision_=0}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.changed=function(){++this.revision_;this.dispatchEvent(R.CHANGE)};e.prototype.getRevision=function(){return this.revision_};e.prototype.on=function(t,e){if(Array.isArray(t)){for(var i=t.length,r=new Array(i),o=0;o<i;++o)r[o]=S(this,t[o],e);return r}return S(this,t,e)};e.prototype.once=function(t,e){if(Array.isArray(t)){for(var i=t.length,r=new Array(i),o=0;o<i;++o)r[o]=n(this,t[o],e);return r}return n(this,t,e)};e.prototype.un=function(t,e){if(Array.isArray(t))for(var i=0,r=t.length;i<r;++i)d(this,t[i],e);else d(this,t,e)};return e}(x);var I=function(r){function t(t,e,i){r.call(this,t);this.key=e;this.oldValue=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(m),w=function(e){function t(t){e.call(this);St(this);this.values_={};void 0!==t&&this.setProperties(t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.get=function(t){var e;this.values_.hasOwnProperty(t)&&(e=this.values_[t]);return e};t.prototype.getKeys=function(){return Object.keys(this.values_)};t.prototype.getProperties=function(){return T({},this.values_)};t.prototype.notify=function(t,e){var i;i=P(t);this.dispatchEvent(new I(i,t,e));i=l.PROPERTYCHANGE;this.dispatchEvent(new I(i,t,e))};t.prototype.set=function(t,e,i){if(i)this.values_[t]=e;else{var r=this.values_[t];r!==(this.values_[t]=e)&&this.notify(t,r)}};t.prototype.setProperties=function(t,e){for(var i in t)this.set(i,t[i],e)};t.prototype.unset=function(t,e){if(t in this.values_){var i=this.values_[t];delete this.values_[t];e||this.notify(t,i)}};return t}(C),O={};function P(t){return O.hasOwnProperty(t)?O[t]:O[t]="change:"+t}var b="length",M=function(i){function t(t,e){i.call(this,t);this.element=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(m),F=function(n){function t(t,e){n.call(this);var i=e||{};this.unique_=!!i.unique;this.array_=t||[];if(this.unique_)for(var r=0,o=this.array_.length;r<o;++r)this.assertUnique_(this.array_[r],r);this.updateLength_()}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.clear=function(){for(;0<this.getLength();)this.pop()};t.prototype.extend=function(t){for(var e=0,i=t.length;e<i;++e)this.push(t[e]);return this};t.prototype.forEach=function(t){for(var e=this.array_,i=0,r=e.length;i<r;++i)t(e[i],i,e)};t.prototype.getArray=function(){return this.array_};t.prototype.item=function(t){return this.array_[t]};t.prototype.getLength=function(){return this.get(b)};t.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e);this.array_.splice(t,0,e);this.updateLength_();this.dispatchEvent(new M(a.ADD,e))};t.prototype.pop=function(){return this.removeAt(this.getLength()-1)};t.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();this.insertAt(e,t);return this.getLength()};t.prototype.remove=function(t){for(var e=this.array_,i=0,r=e.length;i<r;++i)if(e[i]===t)return this.removeAt(i)};t.prototype.removeAt=function(t){var e=this.array_[t];this.array_.splice(t,1);this.updateLength_();this.dispatchEvent(new M(a.REMOVE,e));return e};t.prototype.setAt=function(t,e){var i=this.getLength();if(t<i){this.unique_&&this.assertUnique_(e,t);var r=this.array_[t];this.array_[t]=e;this.dispatchEvent(new M(a.REMOVE,r));this.dispatchEvent(new M(a.ADD,e))}else{for(var o=i;o<t;++o)this.insertAt(o,void 0);this.insertAt(t,e)}};t.prototype.updateLength_=function(){this.set(b,this.array_.length)};t.prototype.assertUnique_=function(t,e){for(var i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===t&&i!==e)throw new o(58)};return t}(w);function A(t,e){if(!t)throw new o(e)}var N={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},D={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function G(t){for(var e=X(),i=0,r=t.length;i<r;++i)J(e,t[i]);return e}function k(t,e,i){if(i){i[0]=t[0]-e;i[1]=t[1]-e;i[2]=t[2]+e;i[3]=t[3]+e;return i}return[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function j(t,e){if(e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}return t.slice()}function U(t,e,i){var r,o;return(r=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*r+(o=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0)*o}function Y(t,e){return B(t,e[0],e[1])}function Q(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function B(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function V(t,e){var i=t[0],r=t[1],o=t[2],n=t[3],s=e[0],a=e[1],l=D.UNKNOWN;s<i?l|=D.LEFT:o<s&&(l|=D.RIGHT);a<r?l|=D.BELOW:n<a&&(l|=D.ABOVE);l===D.UNKNOWN&&(l=D.INTERSECTING);return l}function X(){return[1/0,1/0,-1/0,-1/0]}function z(t,e,i,r,o){if(o){o[0]=t;o[1]=e;o[2]=i;o[3]=r;return o}return[t,e,i,r]}function W(t){return z(1/0,1/0,-1/0,-1/0,t)}function H(t,e){var i=t[0],r=t[1];return z(i,r,i,r,e)}function K(t,e){return tt(W(e),t)}function Z(t,e,i,r,o){return et(W(o),t,e,i,r)}function $(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function q(t,e){e[0]<t[0]&&(t[0]=e[0]);e[2]>t[2]&&(t[2]=e[2]);e[1]<t[1]&&(t[1]=e[1]);e[3]>t[3]&&(t[3]=e[3]);return t}function J(t,e){e[0]<t[0]&&(t[0]=e[0]);e[0]>t[2]&&(t[2]=e[0]);e[1]<t[1]&&(t[1]=e[1]);e[1]>t[3]&&(t[3]=e[1])}function tt(t,e){for(var i=0,r=e.length;i<r;++i)J(t,e[i]);return t}function et(t,e,i,r,o){for(;i<r;i+=o)rt(t,e[i],e[i+1]);return t}function it(t,e){for(var i=0,r=e.length;i<r;++i)tt(t,e[i]);return t}function rt(t,e,i){t[0]=Math.min(t[0],e);t[1]=Math.min(t[1],i);t[2]=Math.max(t[2],e);t[3]=Math.max(t[3],i)}function ot(t,e,i){var r;return(r=e.call(i,st(t)))?r:(r=e.call(i,at(t)))?r:(r=e.call(i,ft(t)))?r:(r=e.call(i,dt(t)))||!1}function nt(t){var e=0;gt(t)||(e=_t(t)*ct(t));return e}function st(t){return[t[0],t[1]]}function at(t){return[t[2],t[1]]}function lt(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function ht(t,e){var i;e===N.BOTTOM_LEFT?i=st(t):e===N.BOTTOM_RIGHT?i=at(t):e===N.TOP_LEFT?i=dt(t):e===N.TOP_RIGHT?i=ft(t):A(!1,13);return i}function ut(t,e,i,r,o){var n=e*r[0]/2,s=e*r[1]/2,a=Math.cos(i),l=Math.sin(i),h=n*a,u=n*l,c=s*a,p=s*l,d=t[0],f=t[1],_=d-h+p,g=d-h-p,y=d+h-p,v=d+h+p,m=f-u-c,E=f-u+c,x=f+u+c,T=f+u-c;return z(Math.min(_,g,y,v),Math.min(m,E,x,T),Math.max(_,g,y,v),Math.max(m,E,x,T),o)}function ct(t){return t[3]-t[1]}function pt(t,e,i){var r=i||[1/0,1/0,-1/0,-1/0];if(Rt(t,e)){t[0]>e[0]?r[0]=t[0]:r[0]=e[0];t[1]>e[1]?r[1]=t[1]:r[1]=e[1];t[2]<e[2]?r[2]=t[2]:r[2]=e[2];t[3]<e[3]?r[3]=t[3]:r[3]=e[3]}else W(r);return r}function dt(t){return[t[0],t[3]]}function ft(t){return[t[2],t[3]]}function _t(t){return t[2]-t[0]}function Rt(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function gt(t){return t[2]<t[0]||t[3]<t[1]}function yt(t,e){if(e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}return t}function vt(t,e){var i=(t[2]-t[0])/2*(e-1),r=(t[3]-t[1])/2*(e-1);t[0]-=i;t[2]+=i;t[1]-=r;t[3]+=r}function mt(t,e,i){var r=!1,o=V(t,e),n=V(t,i);if(o===D.INTERSECTING||n===D.INTERSECTING)r=!0;else{var s,a,l=t[0],h=t[1],u=t[2],c=t[3],p=e[0],d=e[1],f=i[0],_=i[1],g=(_-d)/(f-p);n&D.ABOVE&&!(o&D.ABOVE)&&(r=l<=(s=f-(_-c)/g)&&s<=u);r||!(n&D.RIGHT)||o&D.RIGHT||(r=h<=(a=_-(f-u)*g)&&a<=c);r||!(n&D.BELOW)||o&D.BELOW||(r=l<=(s=f-(_-h)/g)&&s<=u);r||!(n&D.LEFT)||o&D.LEFT||(r=h<=(a=_-(f-l)*g)&&a<=c)}return r}function Et(t,e,i){var r,o,n,s=[t[0],t[1],t[0],t[3],t[2],t[1],t[2],t[3]];e(s,s,2);return r=[s[0],s[2],s[4],s[6]],o=[s[1],s[3],s[5],s[7]],n=i,z(Math.min.apply(null,r),Math.min.apply(null,o),Math.max.apply(null,r),Math.max.apply(null,o),n)}function It(t,e,i,r,o,n){for(var s=n||[],a=0,l=e;l<i;l+=r){var h=t[l],u=t[l+1];s[a++]=o[0]*h+o[2]*u+o[4];s[a++]=o[1]*h+o[3]*u+o[5]}n&&s.length!=a&&(s.length=a);return s}function xt(t,e,i,r,o,n,s){for(var a=s||[],l=Math.cos(o),h=Math.sin(o),u=n[0],c=n[1],p=0,d=e;d<i;d+=r){var f=t[d]-u,_=t[d+1]-c;a[p++]=u+f*l-_*h;a[p++]=c+f*h+_*l;for(var g=d+2;g<d+r;++g)a[p++]=t[g]}s&&a.length!=p&&(a.length=p);return a}function Tt(t,e,i,r,o,n,s,a){for(var l=a||[],h=s[0],u=s[1],c=0,p=e;p<i;p+=r){var d=t[p]-h,f=t[p+1]-u;l[c++]=h+o*d;l[c++]=u+n*f;for(var _=p+2;_<p+r;++_)l[c++]=t[_]}a&&l.length!=c&&(l.length=c);return l}function wt(t,e,i,r,o,n,s){for(var a=s||[],l=0,h=e;h<i;h+=r){a[l++]=t[h]+o;a[l++]=t[h+1]+n;for(var u=h+2;u<h+r;++u)a[l++]=t[u]}s&&a.length!=l&&(a.length=l);return a}function Lt(t,e,i){return Math.min(Math.max(t,e),i)}var Ot="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2};function Pt(t){A(0<t,29);return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function bt(t,e,i,r,o,n){var s=o-i,a=n-r;if(0!==s||0!==a){var l=((t-i)*s+(e-r)*a)/(s*s+a*a);if(1<l){i=o;r=n}else if(0<l){i+=s*l;r+=a*l}}return Mt(t,e,i,r)}function Mt(t,e,i,r){var o=i-t,n=r-e;return o*o+n*n}function Ft(t){for(var e=t.length,i=0;i<e;i++){for(var r=i,o=Math.abs(t[i][i]),n=i+1;n<e;n++){var s=Math.abs(t[n][i]);if(o<s){o=s;r=n}}if(0===o)return null;var a=t[r];t[r]=t[i];t[i]=a;for(var l=i+1;l<e;l++)for(var h=-t[l][i]/t[i][i],u=i;u<e+1;u++)i==u?t[l][u]=0:t[l][u]+=h*t[i][u]}for(var c=new Array(e),p=e-1;0<=p;p--){c[p]=t[p][e]/t[p][p];for(var d=p-1;0<=d;d--)t[d][e]-=t[d][p]*c[p]}return c}function At(t){return 180*t/Math.PI}function Nt(t){return t*Math.PI/180}function Dt(t,e){var i=t%e;return i*e<0?i+e:i}function Gt(t,e,i){return t+i*(e-t)}var kt={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},jt=6371008.8;function Ut(t,e,i){var r=i||jt,o=Nt(t[1]),n=Nt(e[1]),s=(n-o)/2,a=Nt(e[0]-t[0])/2,l=Math.sin(s)*Math.sin(s)+Math.sin(a)*Math.sin(a)*Math.cos(o)*Math.cos(n);return 2*r*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}function Yt(t,e){for(var i=0,r=0,o=t.length;r<o-1;++r)i+=Ut(t[r],t[r+1],e);return i}function Bt(t,e){for(var i=0,r=t.length,o=t[r-1][0],n=t[r-1][1],s=0;s<r;s++){var a=t[s][0],l=t[s][1];i+=Nt(a-o)*(2+Math.sin(Nt(n))+Math.sin(Nt(l)));o=a;n=l}return i*e*e/2}function Vt(t,e,i,r){var o=r||jt,n=Nt(t[1]),s=Nt(t[0]),a=e/o,l=Math.asin(Math.sin(n)*Math.cos(a)+Math.cos(n)*Math.sin(a)*Math.cos(i));return[At(s+Math.atan2(Math.sin(i)*Math.sin(a)*Math.cos(n),Math.cos(a)-Math.sin(n)*Math.sin(l))),At(l)]}var Xt={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},zt={};zt[Xt.DEGREES]=2*Math.PI*6370997/360;zt[Xt.FEET]=.3048;zt[Xt.METERS]=1;zt[Xt.USFEET]=1200/3937;var Wt=function(t){this.code_=t.code;this.units_=t.units;this.extent_=void 0!==t.extent?t.extent:null;this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null;this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu";this.global_=void 0!==t.global&&t.global;this.canWrapX_=!(!this.global_||!this.extent_);this.getPointResolutionFunc_=t.getPointResolution;this.defaultTileGrid_=null;this.metersPerUnit_=t.metersPerUnit};Wt.prototype.canWrapX=function(){return this.canWrapX_};Wt.prototype.getCode=function(){return this.code_};Wt.prototype.getExtent=function(){return this.extent_};Wt.prototype.getUnits=function(){return this.units_};Wt.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||zt[this.units_]};Wt.prototype.getWorldExtent=function(){return this.worldExtent_};Wt.prototype.getAxisOrientation=function(){return this.axisOrientation_};Wt.prototype.isGlobal=function(){return this.global_};Wt.prototype.setGlobal=function(t){this.global_=t;this.canWrapX_=!(!t||!this.extent_)};Wt.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_};Wt.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t};Wt.prototype.setExtent=function(t){this.extent_=t;this.canWrapX_=!(!this.global_||!t)};Wt.prototype.setWorldExtent=function(t){this.worldExtent_=t};Wt.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t};Wt.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};var Ht=6378137,Kt=Math.PI*Ht,Zt=[-Kt,-Kt,Kt,Kt],qt=[-180,-85,180,85],Jt=function(e){function t(t){e.call(this,{code:t,units:Xt.METERS,extent:Zt,global:!0,worldExtent:qt,getPointResolution:function(t,e){return t/Ot(e[1]/Ht)}})}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(Wt),Qt=[new Jt("EPSG:3857"),new Jt("EPSG:102100"),new Jt("EPSG:102113"),new Jt("EPSG:900913"),new Jt("urn:ogc:def:crs:EPSG:6.18:3:3857"),new Jt("urn:ogc:def:crs:EPSG::3857"),new Jt("http://www.opengis.net/gml/srs/epsg.xml#3857")];function $t(t,e,i){var r=t.length,o=1<i?i:2,n=e;void 0===n&&(n=2<o?t.slice():new Array(r));for(var s=Kt,a=0;a<r;a+=o){n[a]=s*t[a]/180;var l=Ht*Math.log(Math.tan(Math.PI*(t[a+1]+90)/360));s<l?l=s:l<-s&&(l=-s);n[a+1]=l}return n}function te(t,e,i){var r=t.length,o=1<i?i:2,n=e;void 0===n&&(n=2<o?t.slice():new Array(r));for(var s=0;s<r;s+=o){n[s]=180*t[s]/Kt;n[s+1]=360*Math.atan(Math.exp(t[s+1]/Ht))/Math.PI-90}return n}var ee=[-180,-90,180,90],ie=6378137*Math.PI/180,re=function(i){function t(t,e){i.call(this,{code:t,units:Xt.DEGREES,extent:ee,axisOrientation:e,global:!0,metersPerUnit:ie,worldExtent:ee})}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Wt),oe=[new re("CRS:84"),new re("EPSG:4326","neu"),new re("urn:ogc:def:crs:EPSG::4326","neu"),new re("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new re("urn:ogc:def:crs:OGC:1.3:CRS84"),new re("urn:ogc:def:crs:OGC:2:84"),new re("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new re("urn:x-ogc:def:crs:EPSG:4326","neu")],ne={};function se(){ne={}}function ae(t){return ne[t]||null}function le(t,e){ne[t]=e}var he={};function ue(){he={}}function ce(t,e,i){var r=t.getCode(),o=e.getCode();r in he||(he[r]={});he[r][o]=i}function pe(t,e){var i;t in he&&e in he[t]&&(i=he[t][e]);return i}function de(t,e,i){var r;if(void 0!==e){for(var o=0,n=t.length;o<n;++o)e[o]=t[o];r=e}else r=t.slice();return r}function fe(t,e,i){if(void 0!==e&&t!==e){for(var r=0,o=t.length;r<o;++r)e[r]=t[r];t=e}return t}function _e(t){le(t.getCode(),t);ce(t,t,de)}function ge(t){t.forEach(_e)}function ye(t){return"string"==typeof t?ae(t):t||null}function ve(t,e,i,r){var o,n=(t=ye(t)).getPointResolutionFunc();if(n)o=n(e,i);else{if(t.getUnits()==Xt.DEGREES&&!r||r==Xt.DEGREES)o=e;else{var s=Re(t,ye("EPSG:4326")),a=[i[0]-e/2,i[1],i[0]+e/2,i[1],i[0],i[1]-e/2,i[0],i[1]+e/2];o=(Ut((a=s(a,a,2)).slice(0,2),a.slice(2,4))+Ut(a.slice(4,6),a.slice(6,8)))/2;var l=r?zt[r]:t.getMetersPerUnit();void 0!==l&&(o/=l)}}return o}function me(t){ge(t);t.forEach(function(e){t.forEach(function(t){e!==t&&ce(e,t,de)})})}function Ee(t,i,r,o){t.forEach(function(e){i.forEach(function(t){ce(e,t,r);ce(t,e,o)})})}function xe(t,e){return t?"string"==typeof t?ye(t):t:ye(e)}function Te(h){return function(t,e,i){for(var r=t.length,o=void 0!==i?i:2,n=void 0!==e?e:new Array(r),s=0;s<r;s+=o){var a=h([t[s],t[s+1]]);n[s]=a[0];n[s+1]=a[1];for(var l=o-1;2<=l;--l)n[s+l]=t[s+l]}return n}}function Se(t,e,i,r){var o=ye(t),n=ye(e);ce(o,n,Te(i));ce(n,o,Te(r))}function Ce(t,e){if(t===e)return!0;var i=t.getUnits()===e.getUnits();return t.getCode()===e.getCode()?i:Re(t,e)===de&&i}function Re(t,e){var i=pe(t.getCode(),e.getCode());i||(i=fe);return i}function Ie(t,e){return Re(ye(t),ye(e))}function we(t,e,i){return Ie(e,i)(t,void 0,t.length)}function Le(t,e,i){return Et(t,Ie(e,i))}function Oe(){me(Qt);me(oe);Ee(oe,Qt,$t,te)}Oe();var Pe=new Array(6);function be(){return[1,0,0,1,0,0]}function Me(t){return Ae(t,1,0,0,1,0,0)}function Fe(t,e){var i=t[0],r=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=e[0],h=e[1],u=e[2],c=e[3],p=e[4],d=e[5];t[0]=i*l+o*h;t[1]=r*l+n*h;t[2]=i*u+o*c;t[3]=r*u+n*c;t[4]=i*p+o*d+s;t[5]=r*p+n*d+a;return t}function Ae(t,e,i,r,o,n,s){t[0]=e;t[1]=i;t[2]=r;t[3]=o;t[4]=n;t[5]=s;return t}function Ne(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t}function De(t,e){var i=e[0],r=e[1];e[0]=t[0]*i+t[2]*r+t[4];e[1]=t[1]*i+t[3]*r+t[5];return e}function Ge(t,e){var i=Math.cos(e),r=Math.sin(e);return Fe(t,Ae(Pe,i,r,-r,i,0,0))}function ke(t,e,i){return Fe(t,Ae(Pe,e,0,0,i,0,0))}function je(t,e,i){return Fe(t,Ae(Pe,1,0,0,1,e,i))}function Ue(t,e,i,r,o,n,s,a){var l=Math.sin(n),h=Math.cos(n);t[0]=r*h;t[1]=o*l;t[2]=-r*l;t[3]=o*h;t[4]=s*r*h-a*r*l+e;t[5]=s*o*l+a*o*h+i;return t}function Ye(t){var e=Be(t);A(0!==e,32);var i=t[0],r=t[1],o=t[2],n=t[3],s=t[4],a=t[5];t[0]=n/e;t[1]=-r/e;t[2]=-o/e;t[3]=i/e;t[4]=(o*a-n*s)/e;t[5]=-(i*a-r*s)/e;return t}function Be(t){return t[0]*t[3]-t[1]*t[2]}var Ve=[1,0,0,1,0,0],Xe=function(t){function e(){t.call(this);this.extent_=[1/0,1/0,-1/0,-1/0];this.extentRevision_=-1;this.simplifiedGeometryCache={};this.simplifiedGeometryMaxMinSquaredTolerance=0;this.simplifiedGeometryRevision=0}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.clone=function(){};e.prototype.closestPointXY=function(t,e,i,r){};e.prototype.containsXY=function(t,e){return!1};e.prototype.getClosestPoint=function(t,e){var i=e||[NaN,NaN];this.closestPointXY(t[0],t[1],i,1/0);return i};e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])};e.prototype.computeExtent=function(t){};e.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){this.extent_=this.computeExtent(this.extent_);this.extentRevision_=this.getRevision()}return yt(this.extent_,t)};e.prototype.rotate=function(t,e){};e.prototype.scale=function(t,e,i){};e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)};e.prototype.getSimplifiedGeometry=function(t){};e.prototype.getType=function(){};e.prototype.applyTransform=function(t){};e.prototype.intersectsExtent=function(t){};e.prototype.translate=function(t,e){};e.prototype.transform=function(t,s){var a=ye(t),e=a.getUnits()==Xt.TILE_PIXELS?function(t,e,i){var r=a.getExtent(),o=a.getWorldExtent(),n=ct(o)/ct(r);Ue(Ve,o[0],o[3],n,-n,0,0,0);It(t,0,t.length,i,Ve,e);return Ie(a,s)(t,e,i)}:Ie(a,s);this.applyTransform(e);return this};return e}(w),ze=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,We=/^([a-z]*)$/i;function He(t){return"string"==typeof t?t:$e(t)}var Ke,Ze,qe=(Ke={},Ze=0,function(t){var e;if(Ke.hasOwnProperty(t))e=Ke[t];else{if(1024<=Ze){var i=0;for(var r in Ke)if(0==(3&i++)){delete Ke[r];--Ze}}e=function(t){var e,i,r,o,n;We.exec(t)&&(t=function(t){var e=document.createElement("div");e.style.color=t;if(""===e.style.color)return"";document.body.appendChild(e);var i=getComputedStyle(e).color;document.body.removeChild(e);return i}(t));if(ze.exec(t)){var s,a=t.length-1;s=a<=4?1:2;var l=4===a||8===a;e=parseInt(t.substr(1+0*s,s),16);i=parseInt(t.substr(1+1*s,s),16);r=parseInt(t.substr(1+2*s,s),16);o=l?parseInt(t.substr(1+3*s,s),16):255;if(1==s){e=(e<<4)+e;i=(i<<4)+i;r=(r<<4)+r;l&&(o=(o<<4)+o)}n=[e,i,r,o/255]}else if(0==t.indexOf("rgba("))Qe(n=t.slice(5,-1).split(",").map(Number));else if(0==t.indexOf("rgb(")){(n=t.slice(4,-1).split(",").map(Number)).push(1);Qe(n)}else A(!1,14);return n}(t);Ke[t]=e;++Ze}return e});function Je(t){return Array.isArray(t)?t:qe(t)}function Qe(t){t[0]=Lt(t[0]+.5|0,0,255);t[1]=Lt(t[1]+.5|0,0,255);t[2]=Lt(t[2]+.5|0,0,255);t[3]=Lt(t[3],0,1);return t}function $e(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var i=t[1];i!=(0|i)&&(i=i+.5|0);var r=t[2];r!=(0|r)&&(r=r+.5|0);return"rgba("+e+","+i+","+r+","+(void 0===t[3]?1:t[3])+")"}function ti(t){return ei(t)?t:$e(t)}function ei(t){return"string"==typeof t||t instanceof CanvasPattern||t instanceof CanvasGradient}function ii(t,e){var i=document.createElement("canvas");t&&(i.width=t);e&&(i.height=e);return i.getContext("2d")}function ri(t){var e=t.offsetWidth,i=getComputedStyle(t);return e+=parseInt(i.marginLeft,10)+parseInt(i.marginRight,10)}function oi(t){var e=t.offsetHeight,i=getComputedStyle(t);return e+=parseInt(i.marginTop,10)+parseInt(i.marginBottom,10)}function ni(t,e){var i=e.parentNode;i&&i.replaceChild(t,e)}function si(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}function ai(t){for(;t.lastChild;)t.removeChild(t.lastChild)}var li=34962,hi=5126,ui=6408,ci=9729,pi=10242,di=10243,fi=3553,_i=33071,gi=36160,yi=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function vi(t,e){for(var i=yi.length,r=0;r<i;++r)try{var o=t.getContext(yi[r],e);if(o)return o}catch(t){}return null}var mi,Ei;if("undefined"!=typeof window&&"WebGLRenderingContext"in window)try{var xi=vi(document.createElement("canvas"),{failIfMajorPerformanceCaveat:!0});if(xi){mi=xi.getParameter(xi.MAX_TEXTURE_SIZE);Ei=xi.getSupportedExtensions()}}catch(t){}var Ti,Si,Ci="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",Ri=-1!==Ci.indexOf("firefox"),Ii=-1!==Ci.indexOf("safari")&&-1==Ci.indexOf("chrom"),wi=-1!==Ci.indexOf("webkit")&&-1==Ci.indexOf("edge"),Li=-1!==Ci.indexOf("macintosh"),Oi=window.devicePixelRatio||1,Pi=function(){var t=!1;try{t=!!document.createElement("canvas").getContext("2d").setLineDash}catch(t){}return t}(),bi="geolocation"in navigator,Mi="ontouchstart"in window,Fi="PointerEvent"in window,Ai=!!navigator.msPointerEnabled,Ni={IDLE:0,LOADING:1,LOADED:2,ERROR:3},Di="ol-hidden",Gi="ol-selectable",ki="ol-unselectable",ji="ol-unsupported",Ui="ol-control",Yi="ol-collapsed",Bi=(Si={},function(t){Ti||(Ti=document.createElement("div").style);if(!(t in Si)){Ti.font=t;var e=Ti.fontFamily;Ti.font="";if(!e)return null;Si[t]=e.split(/,\s?/)}return Si[t]}),Vi=function(e){function t(t){e.call(this);this.highWaterMark=void 0!==t?t:2048;this.count_=0;this.entries_={};this.oldest_=null;this.newest_=null}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark};t.prototype.clear=function(){this.count_=0;this.entries_={};this.oldest_=null;this.newest_=null;this.dispatchEvent(R.CLEAR)};t.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)};t.prototype.forEach=function(t,e){for(var i=this.oldest_;i;){t.call(e,i.value_,i.key_,this);i=i.newer}};t.prototype.get=function(t){var e=this.entries_[t];A(void 0!==e,15);if(e===this.newest_)return e.value_;if(e===this.oldest_){this.oldest_=this.oldest_.newer;this.oldest_.older=null}else{e.newer.older=e.older;e.older.newer=e.newer}e.newer=null;e.older=this.newest_;this.newest_.newer=e;return(this.newest_=e).value_};t.prototype.remove=function(t){var e=this.entries_[t];A(void 0!==e,15);if(e===this.newest_){this.newest_=e.older;this.newest_&&(this.newest_.newer=null)}else if(e===this.oldest_){this.oldest_=e.newer;this.oldest_&&(this.oldest_.older=null)}else{e.newer.older=e.older;e.older.newer=e.newer}delete this.entries_[t];--this.count_;return e.value_};t.prototype.getCount=function(){return this.count_};t.prototype.getKeys=function(){var t,e=new Array(this.count_),i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.key_;return e};t.prototype.getValues=function(){var t,e=new Array(this.count_),i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.value_;return e};t.prototype.peekLast=function(){return this.oldest_.value_};t.prototype.peekLastKey=function(){return this.oldest_.key_};t.prototype.peekFirstKey=function(){return this.newest_.key_};t.prototype.pop=function(){var t=this.oldest_;delete this.entries_[t.key_];t.newer&&(t.newer.older=null);this.oldest_=t.newer;this.oldest_||(this.newest_=null);--this.count_;return t.value_};t.prototype.replace=function(t,e){this.get(t);this.entries_[t].value_=e};t.prototype.set=function(t,e){A(!(t in this.entries_),16);var i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i;this.newest_=i;this.entries_[t]=i;++this.count_};t.prototype.setSize=function(t){this.highWaterMark=t};t.prototype.prune=function(){for(;this.canExpireCache();)this.pop()};return t}(x),Xi="10px sans-serif",zi=[0,0,0,1],Wi="round",Hi=[],Ki="round",Zi=[0,0,0,1],qi="center",Ji="middle",Qi=[0,0,0,0],$i=new Vi,tr={},er=null,ir={},rr=function(){var n,l,s=60,a=tr,h="32px ",u=["monospace","serif"],c=u.length,p="wmytzilWMYTZIL@#/&?$%10";function d(t){for(var e=or(),i=100;i<=700;i+=300){for(var r=i+" ",o=!0,n=0;n<c;++n){var s=u[n];e.font=r+h+s;l=e.measureText(p).width;if(t!=s){e.font=r+h+t+","+s;var a=e.measureText(p).width;o=o&&a!=l}}if(o)return!0}return!1}function f(){var t=!0;for(var e in a)if(a[e]<s)if(d(e)){a[e]=s;_(ir);er=null;$i.clear()}else{++a[e];t=!1}if(t){clearInterval(n);n=void 0}}return function(t){var e=Bi(t);if(e)for(var i=0,r=e.length;i<r;++i){var o=e[i];if(!(o in a)){a[o]=s;d(o)||void(a[o]=0)===n&&(n=setInterval(f,32))}}}}();function or(){er||(er=ii(1,1));return er}var nr,sr,ar=(sr=ir,function(t){var e=sr[t];if(null==e){if(!nr){(nr=document.createElement("span")).textContent="M";nr.style.margin=nr.style.padding="0 !important";nr.style.position="absolute !important";nr.style.left="-99999px !important"}nr.style.font=t;document.body.appendChild(nr);e=sr[t]=nr.offsetHeight;document.body.removeChild(nr)}return e});function lr(t,e){var i=or();t!=i.font&&(i.font=t);return i.measureText(e).width}function hr(t,e,i,r){if(0!==e){t.translate(i,r);t.rotate(e);t.translate(-i,-r)}}var ur=[1,0,0,1,0,0];function cr(t,e,i,r,o,n,s,a,l,h,u){var c;if(1!=i){c=t.globalAlpha;t.globalAlpha=c*i}e&&t.setTransform.apply(t,e);t.drawImage(r,o,n,s,a,l,h,s*u,a*u);c&&(t.globalAlpha=c);e&&t.setTransform.apply(t,ur)}var pr=function(t){this.opacity_=t.opacity;this.rotateWithView_=t.rotateWithView;this.rotation_=t.rotation;this.scale_=t.scale};pr.prototype.clone=function(){return new pr({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})};pr.prototype.getOpacity=function(){return this.opacity_};pr.prototype.getRotateWithView=function(){return this.rotateWithView_};pr.prototype.getRotation=function(){return this.rotation_};pr.prototype.getScale=function(){return this.scale_};pr.prototype.getSnapToPixel=function(){return!1};pr.prototype.getAnchor=function(){};pr.prototype.getImage=function(t){};pr.prototype.getHitDetectionImage=function(t){};pr.prototype.getImageState=function(){};pr.prototype.getImageSize=function(){};pr.prototype.getHitDetectionImageSize=function(){};pr.prototype.getOrigin=function(){};pr.prototype.getSize=function(){};pr.prototype.setOpacity=function(t){this.opacity_=t};pr.prototype.setRotateWithView=function(t){this.rotateWithView_=t};pr.prototype.setRotation=function(t){this.rotation_=t};pr.prototype.setScale=function(t){this.scale_=t};pr.prototype.setSnapToPixel=function(t){};pr.prototype.listenImageChange=function(t,e){};pr.prototype.load=function(){};pr.prototype.unlistenImageChange=function(t,e){};var dr=function(i){function e(t){var e=void 0!==t.rotateWithView&&t.rotateWithView;i.call(this,{opacity:1,rotateWithView:e,rotation:void 0!==t.rotation?t.rotation:0,scale:1});this.checksums_=null;this.canvas_=null;this.hitDetectionCanvas_=null;this.fill_=void 0!==t.fill?t.fill:null;this.origin_=[0,0];this.points_=t.points;this.radius_=void 0!==t.radius?t.radius:t.radius1;this.radius2_=t.radius2;this.angle_=void 0!==t.angle?t.angle:0;this.stroke_=void 0!==t.stroke?t.stroke:null;this.anchor_=null;this.size_=null;this.imageSize_=null;this.hitDetectionImageSize_=null;this.atlasManager_=t.atlasManager;this.render_(this.atlasManager_)}i&&(e.__proto__=i);((e.prototype=Object.create(i&&i.prototype)).constructor=e).prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});t.setOpacity(this.getOpacity());t.setScale(this.getScale());return t};e.prototype.getAnchor=function(){return this.anchor_};e.prototype.getAngle=function(){return this.angle_};e.prototype.getFill=function(){return this.fill_};e.prototype.getHitDetectionImage=function(t){return this.hitDetectionCanvas_};e.prototype.getImage=function(t){return this.canvas_};e.prototype.getImageSize=function(){return this.imageSize_};e.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_};e.prototype.getImageState=function(){return Ni.LOADED};e.prototype.getOrigin=function(){return this.origin_};e.prototype.getPoints=function(){return this.points_};e.prototype.getRadius=function(){return this.radius_};e.prototype.getRadius2=function(){return this.radius2_};e.prototype.getSize=function(){return this.size_};e.prototype.getStroke=function(){return this.stroke_};e.prototype.listenImageChange=function(t,e){};e.prototype.load=function(){};e.prototype.unlistenImageChange=function(t,e){};e.prototype.render_=function(t){var e,i,r="",o="",n=0,s=null,a=0,l=0;if(this.stroke_){null===(i=this.stroke_.getColor())&&(i=Zi);i=ti(i);void 0===(l=this.stroke_.getWidth())&&(l=1);s=this.stroke_.getLineDash();a=this.stroke_.getLineDashOffset();if(!Pi){s=null;a=0}void 0===(o=this.stroke_.getLineJoin())&&(o=Ki);void 0===(r=this.stroke_.getLineCap())&&(r=Wi);void 0===(n=this.stroke_.getMiterLimit())&&(n=10)}var h=2*(this.radius_+l)+1,u={strokeStyle:i,strokeWidth:l,size:h,lineCap:r,lineDash:s,lineDashOffset:a,lineJoin:o,miterLimit:n};if(void 0===t){var c=ii(h,h);this.canvas_=c.canvas;e=h=this.canvas_.width;this.draw_(u,c,0,0);this.createHitDetectionCanvas_(u)}else{h=Math.round(h);var p,d=!this.fill_;d&&(p=this.drawHitDetectionCanvas_.bind(this,u));var f=this.getChecksum(),_=t.add(f,h,h,this.draw_.bind(this,u),p);this.canvas_=_.image;this.origin_=[_.offsetX,_.offsetY];e=_.image.width;if(d){this.hitDetectionCanvas_=_.hitImage;this.hitDetectionImageSize_=[_.hitImage.width,_.hitImage.height]}else{this.hitDetectionCanvas_=this.canvas_;this.hitDetectionImageSize_=[e,e]}}this.anchor_=[h/2,h/2];this.size_=[h,h];this.imageSize_=[e,e]};e.prototype.draw_=function(t,e,i,r){var o,n,s;e.setTransform(1,0,0,1,0,0);e.translate(i,r);e.beginPath();var a=this.points_;if(a===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var l=void 0!==this.radius2_?this.radius2_:this.radius_;l!==this.radius_&&(a*=2);for(o=0;o<=a;o++){n=2*o*Math.PI/a-Math.PI/2+this.angle_;s=o%2==0?this.radius_:l;e.lineTo(t.size/2+s*Math.cos(n),t.size/2+s*Math.sin(n))}}if(this.fill_){var h=this.fill_.getColor();null===h&&(h=zi);e.fillStyle=ti(h);e.fill()}if(this.stroke_){e.strokeStyle=t.strokeStyle;e.lineWidth=t.strokeWidth;if(t.lineDash){e.setLineDash(t.lineDash);e.lineDashOffset=t.lineDashOffset}e.lineCap=t.lineCap;e.lineJoin=t.lineJoin;e.miterLimit=t.miterLimit;e.stroke()}e.closePath()};e.prototype.createHitDetectionCanvas_=function(t){this.hitDetectionImageSize_=[t.size,t.size];if(this.fill_)this.hitDetectionCanvas_=this.canvas_;else{var e=ii(t.size,t.size);this.hitDetectionCanvas_=e.canvas;this.drawHitDetectionCanvas_(t,e,0,0)}};e.prototype.drawHitDetectionCanvas_=function(t,e,i,r){e.setTransform(1,0,0,1,0,0);e.translate(i,r);e.beginPath();var o=this.points_;if(o===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var n,s,a,l=void 0!==this.radius2_?this.radius2_:this.radius_;l!==this.radius_&&(o*=2);for(n=0;n<=o;n++){a=2*n*Math.PI/o-Math.PI/2+this.angle_;s=n%2==0?this.radius_:l;e.lineTo(t.size/2+s*Math.cos(a),t.size/2+s*Math.sin(a))}}e.fillStyle=He(zi);e.fill();if(this.stroke_){e.strokeStyle=t.strokeStyle;e.lineWidth=t.strokeWidth;if(t.lineDash){e.setLineDash(t.lineDash);e.lineDashOffset=t.lineDashOffset}e.stroke()}e.closePath()};e.prototype.getChecksum=function(){var t=this.stroke_?this.stroke_.getChecksum():"-",e=this.fill_?this.fill_.getChecksum():"-";if(!this.checksums_||t!=this.checksums_[1]||e!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6]){var i="r"+t+e+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-");this.checksums_=[i,t,e,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]};return e}(pr),fr=function(i){function e(t){var e=t||{};i.call(this,{points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,atlasManager:e.atlasManager})}i&&(e.__proto__=i);((e.prototype=Object.create(i&&i.prototype)).constructor=e).prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),atlasManager:this.atlasManager_});t.setOpacity(this.getOpacity());t.setScale(this.getScale());return t};e.prototype.setRadius=function(t){this.radius_=t;this.render_(this.atlasManager_)};return e}(dr),_r=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null;this.checksum_=void 0};_r.prototype.clone=function(){var t=this.getColor();return new _r({color:Array.isArray(t)?t.slice():t||void 0})};_r.prototype.getColor=function(){return this.color_};_r.prototype.setColor=function(t){this.color_=t;this.checksum_=void 0};_r.prototype.getChecksum=function(){void 0===this.checksum_&&(this.color_ instanceof CanvasPattern||this.color_ instanceof CanvasGradient?this.checksum_=St(this.color_).toString():this.checksum_="f"+(this.color_?He(this.color_):"-"));return this.checksum_};var gr=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null;this.lineCap_=e.lineCap;this.lineDash_=void 0!==e.lineDash?e.lineDash:null;this.lineDashOffset_=e.lineDashOffset;this.lineJoin_=e.lineJoin;this.miterLimit_=e.miterLimit;this.width_=e.width;this.checksum_=void 0};gr.prototype.clone=function(){var t=this.getColor();return new gr({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})};gr.prototype.getColor=function(){return this.color_};gr.prototype.getLineCap=function(){return this.lineCap_};gr.prototype.getLineDash=function(){return this.lineDash_};gr.prototype.getLineDashOffset=function(){return this.lineDashOffset_};gr.prototype.getLineJoin=function(){return this.lineJoin_};gr.prototype.getMiterLimit=function(){return this.miterLimit_};gr.prototype.getWidth=function(){return this.width_};gr.prototype.setColor=function(t){this.color_=t;this.checksum_=void 0};gr.prototype.setLineCap=function(t){this.lineCap_=t;this.checksum_=void 0};gr.prototype.setLineDash=function(t){this.lineDash_=t;this.checksum_=void 0};gr.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t;this.checksum_=void 0};gr.prototype.setLineJoin=function(t){this.lineJoin_=t;this.checksum_=void 0};gr.prototype.setMiterLimit=function(t){this.miterLimit_=t;this.checksum_=void 0};gr.prototype.setWidth=function(t){this.width_=t;this.checksum_=void 0};gr.prototype.getChecksum=function(){if(void 0===this.checksum_){this.checksum_="s";this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=St(this.color_).toString():this.checksum_+="-";this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")}return this.checksum_};var yr=function(t){var e=t||{};this.geometry_=null;this.geometryFunction_=Tr;void 0!==e.geometry&&this.setGeometry(e.geometry);this.fill_=void 0!==e.fill?e.fill:null;this.image_=void 0!==e.image?e.image:null;this.renderer_=void 0!==e.renderer?e.renderer:null;this.stroke_=void 0!==e.stroke?e.stroke:null;this.text_=void 0!==e.text?e.text:null;this.zIndex_=e.zIndex};yr.prototype.clone=function(){var t=this.getGeometry();t instanceof Xe&&(t=t.clone());return new yr({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})};yr.prototype.getRenderer=function(){return this.renderer_};yr.prototype.setRenderer=function(t){this.renderer_=t};yr.prototype.getGeometry=function(){return this.geometry_};yr.prototype.getGeometryFunction=function(){return this.geometryFunction_};yr.prototype.getFill=function(){return this.fill_};yr.prototype.setFill=function(t){this.fill_=t};yr.prototype.getImage=function(){return this.image_};yr.prototype.setImage=function(t){this.image_=t};yr.prototype.getStroke=function(){return this.stroke_};yr.prototype.setStroke=function(t){this.stroke_=t};yr.prototype.getText=function(){return this.text_};yr.prototype.setText=function(t){this.text_=t};yr.prototype.getZIndex=function(){return this.zIndex_};yr.prototype.setGeometry=function(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Tr;this.geometry_=e};yr.prototype.setZIndex=function(t){this.zIndex_=t};function vr(t){var e;if("function"==typeof t)e=t;else{var i;if(Array.isArray(t))i=t;else{A(t instanceof yr,41);i=[t]}e=function(){return i}}return e}var mr=null;function Er(t,e){if(!mr){var i=new _r({color:"rgba(255,255,255,0.4)"}),r=new gr({color:"#3399CC",width:1.25});mr=[new yr({image:new fr({fill:i,stroke:r,radius:5}),fill:i,stroke:r})]}return mr}function xr(){var t={},e=[255,255,255,1],i=[0,153,255,1];t[kt.POLYGON]=[new yr({fill:new _r({color:[255,255,255,.5]})})];t[kt.MULTI_POLYGON]=t[kt.POLYGON];t[kt.LINE_STRING]=[new yr({stroke:new gr({color:e,width:5})}),new yr({stroke:new gr({color:i,width:3})})];t[kt.MULTI_LINE_STRING]=t[kt.LINE_STRING];t[kt.CIRCLE]=t[kt.POLYGON].concat(t[kt.LINE_STRING]);t[kt.POINT]=[new yr({image:new fr({radius:6,fill:new _r({color:i}),stroke:new gr({color:e,width:1.5})}),zIndex:1/0})];t[kt.MULTI_POINT]=t[kt.POINT];t[kt.GEOMETRY_COLLECTION]=t[kt.POLYGON].concat(t[kt.LINE_STRING],t[kt.POINT]);return t}function Tr(t){return t.getGeometry()}var Sr=function(r){function o(t){r.call(this);this.id_=void 0;this.geometryName_="geometry";this.style_=null;this.styleFunction_=void 0;this.geometryChangeKey_=null;S(this,P(this.geometryName_),this.handleGeometryChanged_,this);if(void 0!==t)if(t instanceof Xe){var e=t;this.setGeometry(e)}else{var i=t;this.setProperties(i)}}r&&(o.__proto__=r);((o.prototype=Object.create(r&&r.prototype)).constructor=o).prototype.clone=function(){var t=new o(this.getProperties());t.setGeometryName(this.getGeometryName());var e=this.getGeometry();e&&t.setGeometry(e.clone());var i=this.getStyle();i&&t.setStyle(i);return t};o.prototype.getGeometry=function(){return this.get(this.geometryName_)};o.prototype.getId=function(){return this.id_};o.prototype.getGeometryName=function(){return this.geometryName_};o.prototype.getStyle=function(){return this.style_};o.prototype.getStyleFunction=function(){return this.styleFunction_};o.prototype.handleGeometryChange_=function(){this.changed()};o.prototype.handleGeometryChanged_=function(){if(this.geometryChangeKey_){g(this.geometryChangeKey_);this.geometryChangeKey_=null}var t=this.getGeometry();t&&(this.geometryChangeKey_=S(t,R.CHANGE,this.handleGeometryChange_,this));this.changed()};o.prototype.setGeometry=function(t){this.set(this.geometryName_,t)};o.prototype.setStyle=function(t){this.style_=t;this.styleFunction_=t?Cr(t):void 0;this.changed()};o.prototype.setId=function(t){this.id_=t;this.changed()};o.prototype.setGeometryName=function(t){d(this,P(this.geometryName_),this.handleGeometryChanged_,this);this.geometryName_=t;S(this,P(this.geometryName_),this.handleGeometryChanged_,this);this.handleGeometryChanged_()};return o}(w);function Cr(t){if("function"==typeof t)return t;var e;if(Array.isArray(t))e=t;else{A(t instanceof yr,41);e=[t]}return function(){return e}}var Rr={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"};function Ir(t,e,i){for(var r,o,n=i||wr,s=0,a=t.length,l=!1;s<a;)if((o=+n(t[r=s+(a-s>>1)],e))<0)s=r+1;else{a=r;l=!o}return l?s:~s}function wr(t,e){return e<t?1:t<e?-1:0}function Lr(t,e){return 0<=t.indexOf(e)}function Or(t,e,i){var r,o=t.length;if(t[0]<=e)return 0;if(e<=t[o-1])return o-1;if(0<i){for(r=1;r<o;++r)if(t[r]<e)return r-1}else if(i<0){for(r=1;r<o;++r)if(t[r]<=e)return r}else for(r=1;r<o;++r){if(t[r]==e)return r;if(t[r]<e)return t[r-1]-e<e-t[r]?r-1:r}return o-1}function Pr(t,e,i){for(;e<i;){var r=t[e];t[e]=t[i];t[i]=r;++e;--i}}function br(t,e){for(var i=Array.isArray(e)?e:[e],r=i.length,o=0;o<r;o++)t[t.length]=i[o]}function Mr(t,e){var i=t.indexOf(e),r=-1<i;r&&t.splice(i,1);return r}function Fr(t,e){for(var i,r=t.length>>>0,o=0;o<r;o++)if(e(i=t[o],o,t))return i;return null}function Ar(t,e){var i=t.length;if(i!==e.length)return!1;for(var r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}function Nr(t,i){var e,r=t.length,o=Array(t.length);for(e=0;e<r;e++)o[e]={index:e,value:t[e]};o.sort(function(t,e){return i(t.value,e.value)||t.index-e.index});for(e=0;e<t.length;e++)t[e]=o[e].value}function Dr(i,r){var o;return!i.every(function(t,e){return!r(t,o=e,i)})?o:-1}function Gr(r,t,o){var n=t||wr;return r.every(function(t,e){if(0===e)return!0;var i=n(r[e-1],t);return!(0<i||o&&0===i)})}var kr={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},jr=function(t){function e(){t.call(this);this.layout=kr.XY;this.stride=2;this.flatCoordinates=null}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.computeExtent=function(t){return Z(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)};e.prototype.getCoordinates=function(){};e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)};e.prototype.getFlatCoordinates=function(){return this.flatCoordinates};e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)};e.prototype.getLayout=function(){return this.layout};e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()){_(this.simplifiedGeometryCache);this.simplifiedGeometryMaxMinSquaredTolerance=0;this.simplifiedGeometryRevision=this.getRevision()}if(t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(e))return this.simplifiedGeometryCache[e];var i=this.getSimplifiedGeometryInternal(t);if(i.getFlatCoordinates().length<this.flatCoordinates.length)return this.simplifiedGeometryCache[e]=i;this.simplifiedGeometryMaxMinSquaredTolerance=t;return this};e.prototype.getSimplifiedGeometryInternal=function(t){return this};e.prototype.getStride=function(){return this.stride};e.prototype.setFlatCoordinates=function(t,e){this.stride=Ur(t);this.layout=t;this.flatCoordinates=e};e.prototype.setCoordinates=function(t,e){};e.prototype.setLayout=function(t,e,i){var r;if(t)r=Ur(t);else{for(var o=0;o<i;++o){if(0===e.length){this.layout=kr.XY;this.stride=2;return}e=e[0]}t=function(t){var e;2==t?e=kr.XY:3==t?e=kr.XYZ:4==t&&(e=kr.XYZM);return e}(r=e.length)}this.layout=t;this.stride=r};e.prototype.applyTransform=function(t){if(this.flatCoordinates){t(this.flatCoordinates,this.flatCoordinates,this.stride);this.changed()}};e.prototype.rotate=function(t,e){var i=this.getFlatCoordinates();if(i){var r=this.getStride();xt(i,0,i.length,r,t,e,i);this.changed()}};e.prototype.scale=function(t,e,i){var r=e;void 0===r&&(r=t);var o=i;o||(o=lt(this.getExtent()));var n=this.getFlatCoordinates();if(n){var s=this.getStride();Tt(n,0,n.length,s,t,r,o,n);this.changed()}};e.prototype.translate=function(t,e){var i=this.getFlatCoordinates();if(i){var r=this.getStride();wt(i,0,i.length,r,t,e,i);this.changed()}};return e}(Xe);function Ur(t){var e;t==kr.XY?e=2:t==kr.XYZ||t==kr.XYM?e=3:t==kr.XYZM&&(e=4);return e}function Yr(t,e,i){var r=t.getFlatCoordinates();if(r){var o=t.getStride();return It(r,0,r.length,o,e,i)}return null}function Br(t,e,i,r){for(var o=0,n=t[i-r],s=t[i-r+1];e<i;e+=r){var a=t[e],l=t[e+1];o+=s*a-n*l;n=a;s=l}return o/2}function Vr(t,e,i,r){for(var o=0,n=0,s=i.length;n<s;++n){var a=i[n];o+=Br(t,e,a,r);e=a}return o}function Xr(t,e,i,r){for(var o=0,n=0,s=i.length;n<s;++n){var a=i[n];o+=Vr(t,e,a,r);e=a[a.length-1]}return o}function zr(t,e,i,r,o,n,s){var a,l=t[e],h=t[e+1],u=t[i]-l,c=t[i+1]-h;if(0===u&&0===c)a=e;else{var p=((o-l)*u+(n-h)*c)/(u*u+c*c);if(1<p)a=i;else{if(0<p){for(var d=0;d<r;++d)s[d]=Gt(t[e+d],t[i+d],p);s.length=r;return}a=e}}for(var f=0;f<r;++f)s[f]=t[a+f];s.length=r}function Wr(t,e,i,r,o){var n=t[e],s=t[e+1];for(e+=r;e<i;e+=r){var a=t[e],l=t[e+1],h=Mt(n,s,a,l);o<h&&(o=h);n=a;s=l}return o}function Hr(t,e,i,r,o){for(var n=0,s=i.length;n<s;++n){var a=i[n];o=Wr(t,e,a,r,o);e=a}return o}function Kr(t,e,i,r,o){for(var n=0,s=i.length;n<s;++n){var a=i[n];o=Hr(t,e,a,r,o);e=a[a.length-1]}return o}function Zr(t,e,i,r,o,n,s,a,l,h,u){if(e==i)return h;var c,p;if(0===o){if((p=Mt(s,a,t[e],t[e+1]))<h){for(c=0;c<r;++c)l[c]=t[e+c];l.length=r;return p}return h}for(var d=u||[NaN,NaN],f=e+r;f<i;){zr(t,f-r,f,r,s,a,d);if((p=Mt(s,a,d[0],d[1]))<h){h=p;for(c=0;c<r;++c)l[c]=d[c];f+=l.length=r}else f+=r*Math.max((Math.sqrt(p)-Math.sqrt(h))/o|0,1)}if(n){zr(t,i-r,e,r,s,a,d);if((p=Mt(s,a,d[0],d[1]))<h){h=p;for(c=0;c<r;++c)l[c]=d[c];l.length=r}}return h}function qr(t,e,i,r,o,n,s,a,l,h,u){for(var c=u||[NaN,NaN],p=0,d=i.length;p<d;++p){var f=i[p];h=Zr(t,e,f,r,o,n,s,a,l,h,c);e=f}return h}function Jr(t,e,i,r,o,n,s,a,l,h,u){for(var c=u||[NaN,NaN],p=0,d=i.length;p<d;++p){var f=i[p];h=qr(t,e,f,r,o,n,s,a,l,h,c);e=f[f.length-1]}return h}function Qr(t,e,i,r){for(var o=0,n=i.length;o<n;++o)t[e++]=i[o];return e}function $r(t,e,i,r){for(var o=0,n=i.length;o<n;++o)for(var s=i[o],a=0;a<r;++a)t[e++]=s[a];return e}function to(t,e,i,r,o){for(var n=o||[],s=0,a=0,l=i.length;a<l;++a){var h=$r(t,e,i[a],r);e=n[s++]=h}n.length=s;return n}function eo(t,e,i,r,o){for(var n=o||[],s=0,a=0,l=i.length;a<l;++a){var h=to(t,e,i[a],r,n[s]);e=(n[s++]=h)[h.length-1]}n.length=s;return n}function io(t,e,i,r,o){for(var n=void 0!==o?o:[],s=0,a=e;a<i;a+=r)n[s++]=t.slice(a,a+r);n.length=s;return n}function ro(t,e,i,r,o){for(var n=void 0!==o?o:[],s=0,a=0,l=i.length;a<l;++a){var h=i[a];n[s++]=io(t,e,h,r,n[s]);e=h}n.length=s;return n}function oo(t,e,i,r,o){for(var n=void 0!==o?o:[],s=0,a=0,l=i.length;a<l;++a){var h=i[a];n[s++]=ro(t,e,h,r,n[s]);e=h[h.length-1]}n.length=s;return n}function no(t,e,i,r,o,n,s){var a=(i-e)/r;if(a<3){for(;e<i;e+=r){n[s++]=t[e];n[s++]=t[e+1]}return s}var l=new Array(a);l[0]=1;l[a-1]=1;for(var h=[e,i-r],u=0;0<h.length;){for(var c=h.pop(),p=h.pop(),d=0,f=t[p],_=t[p+1],g=t[c],y=t[c+1],v=p+r;v<c;v+=r){var m=bt(t[v],t[v+1],f,_,g,y);if(d<m){u=v;d=m}}if(o<d){l[(u-e)/r]=1;p+r<u&&h.push(p,u);u+r<c&&h.push(u,c)}}for(var E=0;E<a;++E)if(l[E]){n[s++]=t[e+E*r];n[s++]=t[e+E*r+1]}return s}function so(t,e,i,r,o,n,s,a){for(var l=0,h=i.length;l<h;++l){var u=i[l];s=no(t,e,u,r,o,n,s);a.push(s);e=u}return s}function ao(t,e,i,r,o,n,s){if(i<=e+r){for(;e<i;e+=r){n[s++]=t[e];n[s++]=t[e+1]}return s}var a=t[e],l=t[e+1],h=n[s++]=a,u=n[s++]=l;for(e+=r;e<i;e+=r)if(Mt(a,l,h=t[e],u=t[e+1])>o){a=n[s++]=h;l=n[s++]=u}if(h!=a||u!=l){n[s++]=h;n[s++]=u}return s}function lo(t,e){return e*Math.round(t/e)}function ho(t,e,i,r,o,n,s){if(e==i)return s;var a,l,h=lo(t[e],o),u=lo(t[e+1],o);e+=r;n[s++]=h;n[s++]=u;do{a=lo(t[e],o);l=lo(t[e+1],o);if((e+=r)==i){n[s++]=a;n[s++]=l;return s}}while(a==h&&l==u);for(;e<i;){var c=lo(t[e],o),p=lo(t[e+1],o);e+=r;if(c!=a||p!=l){var d=a-h,f=l-u,_=c-h,g=p-u;if(d*g==f*_&&(d<0&&_<d||d==_||0<d&&d<_)&&(f<0&&g<f||f==g||0<f&&f<g)){a=c;l=p}else{h=n[s++]=a;u=n[s++]=l;a=c;l=p}}}n[s++]=a;n[s++]=l;return s}function uo(t,e,i,r,o,n,s,a){for(var l=0,h=i.length;l<h;++l){var u=i[l];s=ho(t,e,u,r,o,n,s);a.push(s);e=u}return s}function co(t,e,i,r,o,n,s,a){for(var l=0,h=i.length;l<h;++l){var u=i[l],c=[];s=uo(t,e,u,r,o,n,s,c);a.push(c);e=u[u.length-1]}return s}var po=function(i){function r(t,e){i.call(this);this.maxDelta_=-1;this.maxDeltaRevision_=-1;void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}i&&(r.__proto__=i);((r.prototype=Object.create(i&&i.prototype)).constructor=r).prototype.clone=function(){return new r(this.flatCoordinates.slice(),this.layout)};r.prototype.closestPointXY=function(t,e,i,r){if(r<U(this.getExtent(),t,e))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(Wr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return Zr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,r)};r.prototype.getArea=function(){return Br(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};r.prototype.getCoordinates=function(){return io(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};r.prototype.getSimplifiedGeometryInternal=function(t){var e=[];e.length=no(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0);return new r(e,kr.XY)};r.prototype.getType=function(){return kt.LINEAR_RING};r.prototype.intersectsExtent=function(t){};r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=$r(this.flatCoordinates,0,t,this.stride);this.changed()};return r}(jr),fo=function(i){function t(t,e){i.call(this);this.setCoordinates(t,e)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.clone=function(){return new t(this.flatCoordinates.slice(),this.layout)};t.prototype.closestPointXY=function(t,e,i,r){var o=this.flatCoordinates,n=Mt(t,e,o[0],o[1]);if(n<r){for(var s=this.stride,a=0;a<s;++a)i[a]=o[a];i.length=s;return n}return r};t.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]};t.prototype.computeExtent=function(t){return H(this.flatCoordinates,t)};t.prototype.getType=function(){return kt.POINT};t.prototype.intersectsExtent=function(t){return B(t,this.flatCoordinates[0],this.flatCoordinates[1])};t.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=Qr(this.flatCoordinates,0,t,this.stride);this.changed()};return t}(jr);function _o(e,i,r,o,t){return!ot(t,function(t){return!go(e,i,r,o,t[0],t[1])})}function go(t,e,i,r,o,n){for(var s=0,a=t[i-r],l=t[i-r+1];e<i;e+=r){var h=t[e],u=t[e+1];l<=n?n<u&&0<(h-a)*(n-l)-(o-a)*(u-l)&&s++:u<=n&&(h-a)*(n-l)-(o-a)*(u-l)<0&&s--;a=h;l=u}return 0!==s}function yo(t,e,i,r,o,n){if(0===i.length)return!1;if(!go(t,e,i[0],r,o,n))return!1;for(var s=1,a=i.length;s<a;++s)if(go(t,i[s-1],i[s],r,o,n))return!1;return!0}function vo(t,e,i,r,o,n){if(0===i.length)return!1;for(var s=0,a=i.length;s<a;++s){var l=i[s];if(yo(t,e,l,r,o,n))return!0;e=l[l.length-1]}return!1}function mo(t,e,i,r,o,n,s){for(var a,l,h,u,c,p,d,f=o[n+1],_=[],g=0,y=i.length;g<y;++g){var v=i[g];u=t[v-r];p=t[v-r+1];for(a=e;a<v;a+=r){c=t[a];d=t[a+1];if(f<=p&&d<=f||p<=f&&f<=d){h=(f-p)/(d-p)*(c-u)+u;_.push(h)}u=c;p=d}}var m=NaN,E=-1/0;_.sort(wr);u=_[0];for(a=1,l=_.length;a<l;++a){c=_[a];var x=Math.abs(c-u);if(E<x&&yo(t,e,i,r,h=(u+c)/2,f)){m=h;E=x}u=c}isNaN(m)&&(m=o[n]);if(s){s.push(m,f,E);return s}return[m,f,E]}function Eo(t,e,i,r,o){for(var n=[],s=0,a=i.length;s<a;++s){var l=i[s];n=mo(t,e,l,r,o,2*s,n);e=l[l.length-1]}return n}function xo(t,e,i,r,o,n){for(var s,a=[t[e],t[e+1]],l=[];e+r<i;e+=r){l[0]=t[e+r];l[1]=t[e+r+1];if(s=o.call(n,a,l))return s;a[0]=l[0];a[1]=l[1]}return!1}function To(t,e,i,r,o){var n=et([1/0,1/0,-1/0,-1/0],t,e,i,r);return!!Rt(o,n)&&(!!Q(o,n)||(n[0]>=o[0]&&n[2]<=o[2]||(n[1]>=o[1]&&n[3]<=o[3]||xo(t,e,i,r,function(t,e){return mt(o,t,e)}))))}function So(t,e,i,r,o){for(var n=0,s=i.length;n<s;++n){if(To(t,e,i[n],r,o))return!0;e=i[n]}return!1}function Co(t,e,i,r,o){return!!To(t,e,i,r,o)||(!!go(t,e,i,r,o[0],o[1])||(!!go(t,e,i,r,o[0],o[3])||(!!go(t,e,i,r,o[2],o[1])||!!go(t,e,i,r,o[2],o[3]))))}function Ro(t,e,i,r,o){if(!Co(t,e,i[0],r,o))return!1;if(1===i.length)return!0;for(var n=1,s=i.length;n<s;++n)if(_o(t,i[n-1],i[n],r,o))return!1;return!0}function Io(t,e,i,r,o){for(var n=0,s=i.length;n<s;++n){var a=i[n];if(Ro(t,e,a,r,o))return!0;e=a[a.length-1]}return!1}function wo(t,e,i,r){for(;e<i-r;){for(var o=0;o<r;++o){var n=t[e+o];t[e+o]=t[i-r+o];t[i-r+o]=n}e+=r;i-=r}}function Lo(t,e,i,r){for(var o=0,n=t[i-r],s=t[i-r+1];e<i;e+=r){var a=t[e],l=t[e+1];o+=(a-n)*(l+s);n=a;s=l}return 0<o}function Oo(t,e,i,r,o){for(var n=void 0!==o&&o,s=0,a=i.length;s<a;++s){var l=i[s],h=Lo(t,e,l,r);if(0===s){if(n&&h||!n&&!h)return!1}else if(n&&!h||!n&&h)return!1;e=l}return!0}function Po(t,e,i,r,o){for(var n=0,s=i.length;n<s;++n)if(!Oo(t,e,i[n],r,o))return!1;return!0}function bo(t,e,i,r,o){for(var n=void 0!==o&&o,s=0,a=i.length;s<a;++s){var l=i[s],h=Lo(t,e,l,r);(0===s?n&&h||!n&&!h:n&&!h||!n&&h)&&wo(t,e,l,r);e=l}return e}function Mo(t,e,i,r,o){for(var n=0,s=i.length;n<s;++n)e=bo(t,e,i[n],r,o);return e}var Fo=function(r){function o(t,e,i){r.call(this);this.ends_=[];this.flatInteriorPointRevision_=-1;this.flatInteriorPoint_=null;this.maxDelta_=-1;this.maxDeltaRevision_=-1;this.orientedRevision_=-1;this.orientedFlatCoordinates_=null;if(void 0!==e&&i){this.setFlatCoordinates(e,t);this.ends_=i}else this.setCoordinates(t,e)}r&&(o.__proto__=r);((o.prototype=Object.create(r&&r.prototype)).constructor=o).prototype.appendLinearRing=function(t){this.flatCoordinates?br(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice();this.ends_.push(this.flatCoordinates.length);this.changed()};o.prototype.clone=function(){return new o(this.flatCoordinates.slice(),this.layout,this.ends_.slice())};o.prototype.closestPointXY=function(t,e,i,r){if(r<U(this.getExtent(),t,e))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(Hr(this.flatCoordinates,0,this.ends_,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return qr(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,r)};o.prototype.containsXY=function(t,e){return yo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)};o.prototype.getArea=function(){return Vr(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)};o.prototype.getCoordinates=function(t){var e;void 0!==t?bo(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates;return ro(e,0,this.ends_,this.stride)};o.prototype.getEnds=function(){return this.ends_};o.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=lt(this.getExtent());this.flatInteriorPoint_=mo(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0);this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_};o.prototype.getInteriorPoint=function(){return new fo(this.getFlatInteriorPoint(),kr.XYM)};o.prototype.getLinearRingCount=function(){return this.ends_.length};o.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new po(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)};o.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.ends_,r=[],o=0,n=0,s=i.length;n<s;++n){var a=i[n],l=new po(e.slice(o,a),t);r.push(l);o=a}return r};o.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;if(Oo(t,0,this.ends_,this.stride))this.orientedFlatCoordinates_=t;else{this.orientedFlatCoordinates_=t.slice();this.orientedFlatCoordinates_.length=bo(this.orientedFlatCoordinates_,0,this.ends_,this.stride)}this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_};o.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];e.length=uo(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i);return new o(e,kr.XY,i)};o.prototype.getType=function(){return kt.POLYGON};o.prototype.intersectsExtent=function(t){return Ro(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)};o.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2);this.flatCoordinates||(this.flatCoordinates=[]);var i=to(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1];this.changed()};return o}(jr);function Ao(t,e,i,r){for(var o=i||32,n=[],s=0;s<o;++s)br(n,Vt(t,e,2*Math.PI*s/o,r));n.push(n[0],n[1]);return new Fo(n,kr.XY,[n.length])}function No(t){var e=t[0],i=t[1],r=t[2],o=t[3],n=[e,i,e,o,r,o,r,i,e,i];return new Fo(n,kr.XY,[n.length])}function Do(t,e,i){for(var r=e||32,o=t.getStride(),n=t.getLayout(),s=t.getCenter(),a=o*(r+1),l=new Array(a),h=0;h<a;h+=o){l[h]=0;l[h+1]=0;for(var u=2;u<o;u++)l[h+u]=s[u]}var c=[l.length],p=new Fo(l,n,c);Go(p,s,t.getRadius(),i);return p}function Go(t,e,i,r){for(var o=t.getFlatCoordinates(),n=t.getStride(),s=o.length/n-1,a=r||0,l=0;l<=s;++l){var h=l*n,u=a+2*Dt(l,s)*Math.PI/s;o[h]=e[0]+i*Math.cos(u);o[h+1]=e[1]+i*Math.sin(u)}t.changed()}var ko=function(i){function t(t){i.call(this);var e=t||{};this.position_=null;this.transform_=fe;this.watchId_=void 0;S(this,P(Rr.PROJECTION),this.handleProjectionChanged_,this);S(this,P(Rr.TRACKING),this.handleTrackingChanged_,this);void 0!==e.projection&&this.setProjection(e.projection);void 0!==e.trackingOptions&&this.setTrackingOptions(e.trackingOptions);this.setTracking(void 0!==e.tracking&&e.tracking)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.disposeInternal=function(){this.setTracking(!1);i.prototype.disposeInternal.call(this)};t.prototype.handleProjectionChanged_=function(){var t=this.getProjection();if(t){this.transform_=Re(ye("EPSG:4326"),t);this.position_&&this.set(Rr.POSITION,this.transform_(this.position_))}};t.prototype.handleTrackingChanged_=function(){if(bi){var t=this.getTracking();if(t&&void 0===this.watchId_)this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions());else if(!t&&void 0!==this.watchId_){navigator.geolocation.clearWatch(this.watchId_);this.watchId_=void 0}}};t.prototype.positionChange_=function(t){var e=t.coords;this.set(Rr.ACCURACY,e.accuracy);this.set(Rr.ALTITUDE,null===e.altitude?void 0:e.altitude);this.set(Rr.ALTITUDE_ACCURACY,null===e.altitudeAccuracy?void 0:e.altitudeAccuracy);this.set(Rr.HEADING,null===e.heading?void 0:Nt(e.heading));if(this.position_){this.position_[0]=e.longitude;this.position_[1]=e.latitude}else this.position_=[e.longitude,e.latitude];var i=this.transform_(this.position_);this.set(Rr.POSITION,i);this.set(Rr.SPEED,null===e.speed?void 0:e.speed);var r=Ao(this.position_,e.accuracy);r.applyTransform(this.transform_);this.set(Rr.ACCURACY_GEOMETRY,r);this.changed()};t.prototype.positionError_=function(t){var e={type:R.ERROR,target:void 0};this.setTracking(!1);this.dispatchEvent(e)};t.prototype.getAccuracy=function(){return this.get(Rr.ACCURACY)};t.prototype.getAccuracyGeometry=function(){return this.get(Rr.ACCURACY_GEOMETRY)||null};t.prototype.getAltitude=function(){return this.get(Rr.ALTITUDE)};t.prototype.getAltitudeAccuracy=function(){return this.get(Rr.ALTITUDE_ACCURACY)};t.prototype.getHeading=function(){return this.get(Rr.HEADING)};t.prototype.getPosition=function(){return this.get(Rr.POSITION)};t.prototype.getProjection=function(){return this.get(Rr.PROJECTION)};t.prototype.getSpeed=function(){return this.get(Rr.SPEED)};t.prototype.getTracking=function(){return this.get(Rr.TRACKING)};t.prototype.getTrackingOptions=function(){return this.get(Rr.TRACKING_OPTIONS)};t.prototype.setProjection=function(t){this.set(Rr.PROJECTION,ye(t))};t.prototype.setTracking=function(t){this.set(Rr.TRACKING,t)};t.prototype.setTrackingOptions=function(t){this.set(Rr.TRACKING_OPTIONS,t)};return t}(w);function jo(t,e,i){var r=void 0!==i?t.toFixed(i):""+t,o=r.indexOf(".");return e<(o=-1===o?r.length:o)?r:new Array(1+e-o).join("0")+r}function Uo(t,e){for(var i=(""+t).split("."),r=(""+e).split("."),o=0;o<Math.max(i.length,r.length);o++){var n=parseInt(i[o]||"0",10),s=parseInt(r[o]||"0",10);if(s<n)return 1;if(n<s)return-1}return 0}function Yo(t,e){t[0]+=e[0];t[1]+=e[1];return t}function Bo(t,e){var i=e.getRadius(),r=e.getCenter(),o=r[0],n=r[1],s=t[0]-o,a=t[1]-n;0===s&&0===a&&(s=1);var l=Math.sqrt(s*s+a*a);return[o+i*s/l,n+i*a/l]}function Vo(t,e){var i,r,o=t[0],n=t[1],s=e[0],a=e[1],l=s[0],h=s[1],u=a[0],c=a[1],p=u-l,d=c-h,f=0===p&&0===d?0:(p*(o-l)+d*(n-h))/(p*p+d*d||0);if(f<=0){i=l;r=h}else if(1<=f){i=u;r=c}else{i=l+f*p;r=h+f*d}return[i,r]}function Xo(t,e,i){var r=Dt(e+180,360)-180,o=Math.abs(3600*r),n=i||0,s=Math.pow(10,n),a=Math.floor(o/3600),l=Math.floor((o-3600*a)/60),h=o-3600*a-60*l;if(60<=(h=Math.ceil(h*s)/s)){h=0;l+=1}if(60<=l){l=0;a+=1}return a+"° "+jo(l,2)+"′ "+jo(h,2,n)+"″"+(0==r?"":" "+t.charAt(r<0?1:0))}function zo(t,e,i){return t?e.replace("{x}",t[0].toFixed(i)).replace("{y}",t[1].toFixed(i)):""}function Wo(t,e){for(var i=!0,r=t.length-1;0<=r;--r)if(t[r]!=e[r]){i=!1;break}return i}function Ho(t,e){var i=Math.cos(e),r=Math.sin(e),o=t[0]*i-t[1]*r,n=t[1]*i+t[0]*r;t[0]=o;t[1]=n;return t}function Ko(t,e){t[0]*=e;t[1]*=e;return t}function Zo(t,e){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function qo(t,e){return Math.sqrt(Zo(t,e))}function Jo(t,e){return Zo(t,Vo(t,e))}function Qo(t,e){return zo(t,"{x}, {y}",e)}function $o(t,e,i,r,o,n){var s=NaN,a=NaN,l=(i-e)/r;if(1===l){s=t[e];a=t[e+1]}else if(2==l){s=(1-o)*t[e]+o*t[e+r];a=(1-o)*t[e+1]+o*t[e+r+1]}else if(0!==l){for(var h=t[e],u=t[e+1],c=0,p=[0],d=e+r;d<i;d+=r){var f=t[d],_=t[d+1];c+=Math.sqrt((f-h)*(f-h)+(_-u)*(_-u));p.push(c);h=f;u=_}var g=o*c,y=Ir(p,g);if(y<0){var v=(g-p[-y-2])/(p[-y-1]-p[-y-2]),m=e+(-y-2)*r;s=Gt(t[m],t[m+r],v);a=Gt(t[m+1],t[m+r+1],v)}else{s=t[e+y*r];a=t[e+y*r+1]}}if(n){n[0]=s;n[1]=a;return n}return[s,a]}function tn(t,e,i,r,o,n){if(i==e)return null;var s;if(o<t[e+r-1]){if(n){(s=t.slice(e,e+r))[r-1]=o;return s}return null}if(t[i-1]<o){if(n){(s=t.slice(i-r,i))[r-1]=o;return s}return null}if(o==t[e+r-1])return t.slice(e,e+r);for(var a=e/r,l=i/r;a<l;){var h=a+l>>1;o<t[(h+1)*r-1]?l=h:a=h+1}var u=t[a*r-1];if(o==u)return t.slice((a-1)*r,(a-1)*r+r);var c=(o-u)/(t[(a+1)*r-1]-u);s=[];for(var p=0;p<r-1;++p)s.push(Gt(t[(a-1)*r+p],t[a*r+p],c));s.push(o);return s}function en(t,e,i,r,o,n,s){if(s)return tn(t,e,i[i.length-1],r,o,n);var a;if(o<t[r-1]){if(n){(a=t.slice(0,r))[r-1]=o;return a}return null}if(t[t.length-1]<o){if(n){(a=t.slice(t.length-r))[r-1]=o;return a}return null}for(var l=0,h=i.length;l<h;++l){var u=i[l];if(e!=u){if(o<t[e+r-1])return null;if(o<=t[u-1])return tn(t,e,u,r,o,!1);e=u}}return null}function rn(t,e,i,r){for(var o=t[e],n=t[e+1],s=0,a=e+r;a<i;a+=r){var l=t[a],h=t[a+1];s+=Math.sqrt((l-o)*(l-o)+(h-n)*(h-n));o=l;n=h}return s}var on=function(i){function r(t,e){i.call(this);this.flatMidpoint_=null;this.flatMidpointRevision_=-1;this.maxDelta_=-1;this.maxDeltaRevision_=-1;void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}i&&(r.__proto__=i);((r.prototype=Object.create(i&&i.prototype)).constructor=r).prototype.appendCoordinate=function(t){this.flatCoordinates?br(this.flatCoordinates,t):this.flatCoordinates=t.slice();this.changed()};r.prototype.clone=function(){return new r(this.flatCoordinates.slice(),this.layout)};r.prototype.closestPointXY=function(t,e,i,r){if(r<U(this.getExtent(),t,e))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(Wr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return Zr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,r)};r.prototype.forEachSegment=function(t){return xo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)};r.prototype.getCoordinateAtM=function(t,e){if(this.layout!=kr.XYM&&this.layout!=kr.XYZM)return null;var i=void 0!==e&&e;return tn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i)};r.prototype.getCoordinates=function(){return io(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};r.prototype.getCoordinateAt=function(t,e){return $o(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e)};r.prototype.getLength=function(){return rn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};r.prototype.getFlatMidpoint=function(){if(this.flatMidpointRevision_!=this.getRevision()){this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_);this.flatMidpointRevision_=this.getRevision()}return this.flatMidpoint_};r.prototype.getSimplifiedGeometryInternal=function(t){var e=[];e.length=no(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0);return new r(e,kr.XY)};r.prototype.getType=function(){return kt.LINE_STRING};r.prototype.intersectsExtent=function(t){return To(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)};r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=$r(this.flatCoordinates,0,t,this.stride);this.changed()};return r}(jr);function nn(t,e,i){for(var r,o,n,s,a,l,h=[],u=t(0),c=t(1),p=e(u),d=e(c),f=[c,u],_=[d,p],g=[1,0],y={},v=1e5;0<--v&&0<g.length;){n=g.pop();u=f.pop();p=_.pop();if(!((l=n.toString())in y)){h.push(p[0],p[1]);y[l]=!0}s=g.pop();c=f.pop();d=_.pop();if(bt((o=e(r=t(a=(n+s)/2)))[0],o[1],p[0],p[1],d[0],d[1])<i){h.push(d[0],d[1]);y[l=s.toString()]=!0}else{g.push(s,a,a,n);_.push(d,o,o,p);f.push(c,r,r,u)}}return h}function sn(e,i,r,t,o){return nn(function(t){return[e,i+(r-i)*t]},Ie(ye("EPSG:4326"),t),o)}function an(e,i,r,t,o){return nn(function(t){return[i+(r-i)*t,e]},Ie(ye("EPSG:4326"),t),o)}var ln={POSTCOMPOSE:"postcompose",PRECOMPOSE:"precompose",RENDER:"render",RENDERCOMPLETE:"rendercomplete"},hn={POINT:"point",LINE:"line"},un=function(t){var e=t||{};this.font_=e.font;this.rotation_=e.rotation;this.rotateWithView_=e.rotateWithView;this.scale_=e.scale;this.text_=e.text;this.textAlign_=e.textAlign;this.textBaseline_=e.textBaseline;this.fill_=void 0!==e.fill?e.fill:new _r({color:"#333"});this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4;this.placement_=void 0!==e.placement?e.placement:hn.POINT;this.overflow_=!!e.overflow;this.stroke_=void 0!==e.stroke?e.stroke:null;this.offsetX_=void 0!==e.offsetX?e.offsetX:0;this.offsetY_=void 0!==e.offsetY?e.offsetY:0;this.backgroundFill_=e.backgroundFill?e.backgroundFill:null;this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null;this.padding_=void 0===e.padding?null:e.padding};un.prototype.clone=function(){return new un({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0})};un.prototype.getOverflow=function(){return this.overflow_};un.prototype.getFont=function(){return this.font_};un.prototype.getMaxAngle=function(){return this.maxAngle_};un.prototype.getPlacement=function(){return this.placement_};un.prototype.getOffsetX=function(){return this.offsetX_};un.prototype.getOffsetY=function(){return this.offsetY_};un.prototype.getFill=function(){return this.fill_};un.prototype.getRotateWithView=function(){return this.rotateWithView_};un.prototype.getRotation=function(){return this.rotation_};un.prototype.getScale=function(){return this.scale_};un.prototype.getStroke=function(){return this.stroke_};un.prototype.getText=function(){return this.text_};un.prototype.getTextAlign=function(){return this.textAlign_};un.prototype.getTextBaseline=function(){return this.textBaseline_};un.prototype.getBackgroundFill=function(){return this.backgroundFill_};un.prototype.getBackgroundStroke=function(){return this.backgroundStroke_};un.prototype.getPadding=function(){return this.padding_};un.prototype.setOverflow=function(t){this.overflow_=t};un.prototype.setFont=function(t){this.font_=t};un.prototype.setMaxAngle=function(t){this.maxAngle_=t};un.prototype.setOffsetX=function(t){this.offsetX_=t};un.prototype.setOffsetY=function(t){this.offsetY_=t};un.prototype.setPlacement=function(t){this.placement_=t};un.prototype.setFill=function(t){this.fill_=t};un.prototype.setRotation=function(t){this.rotation_=t};un.prototype.setScale=function(t){this.scale_=t};un.prototype.setStroke=function(t){this.stroke_=t};un.prototype.setText=function(t){this.text_=t};un.prototype.setTextAlign=function(t){this.textAlign_=t};un.prototype.setTextBaseline=function(t){this.textBaseline_=t};un.prototype.setBackgroundFill=function(t){this.backgroundFill_=t};un.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t};un.prototype.setPadding=function(t){this.padding_=t};var cn=new gr({color:"rgba(0,0,0,0.2)"}),pn=[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],dn=function(t){var e=t||{};this.map_=null;this.postcomposeListenerKey_=null;this.projection_=null;this.maxLat_=1/0;this.maxLon_=1/0;this.minLat_=-1/0;this.minLon_=-1/0;this.maxLatP_=1/0;this.maxLonP_=1/0;this.minLatP_=-1/0;this.minLonP_=-1/0;this.targetSize_=void 0!==e.targetSize?e.targetSize:100;this.maxLines_=void 0!==e.maxLines?e.maxLines:100;this.meridians_=[];this.parallels_=[];this.strokeStyle_=void 0!==e.strokeStyle?e.strokeStyle:cn;this.fromLonLatTransform_=void 0;this.toLonLatTransform_=void 0;this.projectionCenterLonLat_=null;this.meridiansLabels_=null;this.parallelsLabels_=null;if(1==e.showLabels){this.lonLabelFormatter_=null==e.lonLabelFormatter?Xo.bind(this,"EW"):e.lonLabelFormatter;this.latLabelFormatter_=null==e.latLabelFormatter?Xo.bind(this,"NS"):e.latLabelFormatter;this.lonLabelPosition_=null==e.lonLabelPosition?0:e.lonLabelPosition;this.latLabelPosition_=null==e.latLabelPosition?1:e.latLabelPosition;this.lonLabelStyle_=void 0!==e.lonLabelStyle?e.lonLabelStyle:new un({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new _r({color:"rgba(0,0,0,1)"}),stroke:new gr({color:"rgba(255,255,255,1)",width:3})});this.latLabelStyle_=void 0!==e.latLabelStyle?e.latLabelStyle:new un({font:"12px Calibri,sans-serif",textAlign:"end",fill:new _r({color:"rgba(0,0,0,1)"}),stroke:new gr({color:"rgba(255,255,255,1)",width:3})});this.meridiansLabels_=[];this.parallelsLabels_=[]}this.setMap(void 0!==e.map?e.map:null)};dn.prototype.addMeridian_=function(t,e,i,r,o,n){var s=this.getMeridian_(t,e,i,r,n);if(Rt(s.getExtent(),o)){if(this.meridiansLabels_){var a=this.getMeridianPoint_(s,o,n);this.meridiansLabels_[n]={geom:a,text:this.lonLabelFormatter_(t)}}this.meridians_[n++]=s}return n};dn.prototype.getMeridianPoint_=function(t,e,i){var r,o=t.getFlatCoordinates(),n=Math.max(e[1],o[1]),s=Math.min(e[3],o[o.length-1]),a=Lt(e[1]+Math.abs(e[1]-e[3])*this.lonLabelPosition_,n,s),l=[o[0],a];i in this.meridiansLabels_?(r=this.meridiansLabels_[i].geom).setCoordinates(l):r=new fo(l);return r};dn.prototype.addParallel_=function(t,e,i,r,o,n){var s=this.getParallel_(t,e,i,r,n);if(Rt(s.getExtent(),o)){if(this.parallelsLabels_){var a=this.getParallelPoint_(s,o,n);this.parallelsLabels_[n]={geom:a,text:this.latLabelFormatter_(t)}}this.parallels_[n++]=s}return n};dn.prototype.getParallelPoint_=function(t,e,i){var r,o=t.getFlatCoordinates(),n=Math.max(e[0],o[0]),s=Math.min(e[2],o[o.length-2]),a=[Lt(e[0]+Math.abs(e[0]-e[2])*this.latLabelPosition_,n,s),o[1]];i in this.parallelsLabels_?(r=this.parallelsLabels_[i].geom).setCoordinates(a):r=new fo(a);return r};dn.prototype.createGraticule_=function(t,e,i,r){var o=this.getInterval_(i);if(-1!=o){var n,s,a,l,h=this.toLonLatTransform_(e),u=h[0],c=h[1],p=this.maxLines_,d=[Math.max(t[0],this.minLonP_),Math.max(t[1],this.minLatP_),Math.min(t[2],this.maxLonP_),Math.min(t[3],this.maxLatP_)],f=(d=Le(d,this.projection_,"EPSG:4326"))[3],_=d[2],g=d[1],y=d[0];l=Lt(u=Math.floor(u/o)*o,this.minLon_,this.maxLon_);s=this.addMeridian_(l,g,f,r,t,0);n=0;for(;l!=this.minLon_&&n++<p;){l=Math.max(l-o,this.minLon_);s=this.addMeridian_(l,g,f,r,t,s)}l=Lt(u,this.minLon_,this.maxLon_);n=0;for(;l!=this.maxLon_&&n++<p;){l=Math.min(l+o,this.maxLon_);s=this.addMeridian_(l,g,f,r,t,s)}this.meridians_.length=s;this.meridiansLabels_&&(this.meridiansLabels_.length=s);a=Lt(c=Math.floor(c/o)*o,this.minLat_,this.maxLat_);s=this.addParallel_(a,y,_,r,t,0);n=0;for(;a!=this.minLat_&&n++<p;){a=Math.max(a-o,this.minLat_);s=this.addParallel_(a,y,_,r,t,s)}a=Lt(c,this.minLat_,this.maxLat_);n=0;for(;a!=this.maxLat_&&n++<p;){a=Math.min(a+o,this.maxLat_);s=this.addParallel_(a,y,_,r,t,s)}this.parallels_.length=s;this.parallelsLabels_&&(this.parallelsLabels_.length=s)}else{this.meridians_.length=this.parallels_.length=0;this.meridiansLabels_&&(this.meridiansLabels_.length=0);this.parallelsLabels_&&(this.parallelsLabels_.length=0)}};dn.prototype.getInterval_=function(t){for(var e=this.projectionCenterLonLat_[0],i=this.projectionCenterLonLat_[1],r=-1,o=Math.pow(this.targetSize_*t,2),n=[],s=[],a=0,l=pn.length;a<l;++a){var h=pn[a]/2;n[0]=e-h;n[1]=i-h;s[0]=e+h;s[1]=i+h;this.fromLonLatTransform_(n,n);this.fromLonLatTransform_(s,s);if(Math.pow(s[0]-n[0],2)+Math.pow(s[1]-n[1],2)<=o)break;r=pn[a]}return r};dn.prototype.getMap=function(){return this.map_};dn.prototype.getMeridian_=function(t,e,i,r,o){var n=sn(t,e,i,this.projection_,r),s=this.meridians_[o];if(s){s.setFlatCoordinates(kr.XY,n);s.changed()}else s=this.meridians_[o]=new on(n,kr.XY);return s};dn.prototype.getMeridians=function(){return this.meridians_};dn.prototype.getParallel_=function(t,e,i,r,o){var n=an(t,e,i,this.projection_,r),s=this.parallels_[o];if(s){s.setFlatCoordinates(kr.XY,n);s.changed()}else s=new on(n,kr.XY);return s};dn.prototype.getParallels=function(){return this.parallels_};dn.prototype.handlePostCompose_=function(t){var e,i,r,o,n=t.vectorContext,s=t.frameState,a=s.extent,l=s.viewState,h=l.center,u=l.projection,c=l.resolution,p=s.pixelRatio,d=c*c/(4*p*p);(!this.projection_||!Ce(this.projection_,u))&&this.updateProjectionInfo_(u);this.createGraticule_(a,h,c,d);n.setFillStrokeStyle(null,this.strokeStyle_);for(e=0,i=this.meridians_.length;e<i;++e){r=this.meridians_[e];n.drawGeometry(r)}for(e=0,i=this.parallels_.length;e<i;++e){r=this.parallels_[e];n.drawGeometry(r)}if(this.meridiansLabels_)for(e=0,i=this.meridiansLabels_.length;e<i;++e){o=this.meridiansLabels_[e];this.lonLabelStyle_.setText(o.text);n.setTextStyle(this.lonLabelStyle_);n.drawGeometry(o.geom)}if(this.parallelsLabels_)for(e=0,i=this.parallelsLabels_.length;e<i;++e){o=this.parallelsLabels_[e];this.latLabelStyle_.setText(o.text);n.setTextStyle(this.latLabelStyle_);n.drawGeometry(o.geom)}};dn.prototype.updateProjectionInfo_=function(t){var e=ye("EPSG:4326"),i=t.getWorldExtent(),r=Le(i,e,t);this.maxLat_=i[3];this.maxLon_=i[2];this.minLat_=i[1];this.minLon_=i[0];this.maxLatP_=r[3];this.maxLonP_=r[2];this.minLatP_=r[1];this.minLonP_=r[0];this.fromLonLatTransform_=Ie(e,t);this.toLonLatTransform_=Ie(t,e);this.projectionCenterLonLat_=this.toLonLatTransform_(lt(t.getExtent()));this.projection_=t};dn.prototype.setMap=function(t){if(this.map_){g(this.postcomposeListenerKey_);this.postcomposeListenerKey_=null;this.map_.render()}if(t){this.postcomposeListenerKey_=S(t,ln.POSTCOMPOSE,this.handlePostCompose_,this);t.render()}this.map_=t};var fn=function(o){function t(t,e,i,r){o.call(this);this.extent=t;this.pixelRatio_=i;this.resolution=e;this.state=r}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.changed=function(){this.dispatchEvent(R.CHANGE)};t.prototype.getExtent=function(){return this.extent};t.prototype.getImage=function(){};t.prototype.getPixelRatio=function(){return this.pixelRatio_};t.prototype.getResolution=function(){return this.resolution};t.prototype.getState=function(){return this.state};t.prototype.load=function(){};return t}(x),_n=function(s){function t(t,e,i,r,o,n){s.call(this,t,e,i,Ni.IDLE);this.src_=r;this.image_=new Image;null!==o&&(this.image_.crossOrigin=o);this.imageListenerKeys_=null;this.state=Ni.IDLE;this.imageLoadFunction_=n}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.getImage=function(){return this.image_};t.prototype.handleImageError_=function(){this.state=Ni.ERROR;this.unlistenImage_();this.changed()};t.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=ct(this.extent)/this.image_.height);this.state=Ni.LOADED;this.unlistenImage_();this.changed()};t.prototype.load=function(){if(this.state==Ni.IDLE||this.state==Ni.ERROR){this.state=Ni.LOADING;this.changed();this.imageListenerKeys_=[n(this.image_,R.ERROR,this.handleImageError_,this),n(this.image_,R.LOAD,this.handleImageLoad_,this)];this.imageLoadFunction_(this,this.src_)}};t.prototype.setImage=function(t){this.image_=t};t.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(g);this.imageListenerKeys_=null};return t}(fn),gn=function(s){function t(t,e,i,r,o){var n=void 0!==o?Ni.IDLE:Ni.LOADED;s.call(this,t,e,i,n);this.loader_=void 0!==o?o:null;this.canvas_=r;this.error_=null}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.getError=function(){return this.error_};t.prototype.handleLoad_=function(t){if(t){this.error_=t;this.state=Ni.ERROR}else this.state=Ni.LOADED;this.changed()};t.prototype.load=function(){if(this.state==Ni.IDLE){this.state=Ni.LOADING;this.changed();this.loader_(this.handleLoad_.bind(this))}};t.prototype.getImage=function(){return this.canvas_};return t}(fn),yn={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};function vn(t){return Math.pow(t,3)}function mn(t){return 1-vn(1-t)}function En(t){return 3*t*t-2*t*t*t}function xn(t){return t}var Tn=function(o){function t(t,e,i){o.call(this);var r=i||{};this.tileCoord=t;this.state=e;this.interimTile=null;this.key="";this.transition_=void 0===r.transition?250:r.transition;this.transitionStarts_={}}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.changed=function(){this.dispatchEvent(R.CHANGE)};t.prototype.getKey=function(){return this.key+"/"+this.tileCoord};t.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==yn.LOADED)return t;t=t.interimTile}while(t);return this};t.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==yn.LOADED){t.interimTile=null;break}t.getState()==yn.LOADING?e=t:t.getState()==yn.IDLE?e.interimTile=t.interimTile:e=t;t=e.interimTile}while(t)}};t.prototype.getTileCoord=function(){return this.tileCoord};t.prototype.getState=function(){return this.state};t.prototype.setState=function(t){this.state=t;this.changed()};t.prototype.load=function(){};t.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else{i=e;this.transitionStarts_[t]=i}var r=e-i+1e3/60;return r>=this.transition_?1:vn(r/this.transition_)};t.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]};t.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)};return t}(x),Sn=function(s){function t(t,e,i,r,o,n){s.call(this,t,e,n);this.crossOrigin_=r;this.src_=i;this.image_=new Image;null!==r&&(this.image_.crossOrigin=r);this.imageListenerKeys_=null;this.tileLoadFunction_=o}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.disposeInternal=function(){if(this.state==yn.LOADING){this.unlistenImage_();this.image_=Cn()}this.interimTile&&this.interimTile.dispose();this.state=yn.ABORT;this.changed();s.prototype.disposeInternal.call(this)};t.prototype.getImage=function(){return this.image_};t.prototype.getKey=function(){return this.src_};t.prototype.handleImageError_=function(){this.state=yn.ERROR;this.unlistenImage_();this.image_=Cn();this.changed()};t.prototype.handleImageLoad_=function(){this.image_ instanceof HTMLImageElement&&this.image_.naturalWidth&&this.image_.naturalHeight?this.state=yn.LOADED:this.state=yn.EMPTY;this.unlistenImage_();this.changed()};t.prototype.load=function(){if(this.state==yn.ERROR){this.state=yn.IDLE;this.image_=new Image;null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}if(this.state==yn.IDLE){this.state=yn.LOADING;this.changed();this.imageListenerKeys_=[n(this.image_,R.ERROR,this.handleImageError_,this),n(this.image_,R.LOAD,this.handleImageLoad_,this)];this.tileLoadFunction_(this,this.src_)}};t.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(g);this.imageListenerKeys_=null};return t}(Tn);function Cn(){var t=ii(1,1);t.fillStyle="rgba(0,0,0,0)";t.fillRect(0,0,1,1);return t.canvas}var Rn=function(t,e,i){this.decay_=t;this.minVelocity_=e;this.delay_=i;this.points_=[];this.angle_=0;this.initialVelocity_=0};Rn.prototype.begin=function(){this.points_.length=0;this.angle_=0;this.initialVelocity_=0};Rn.prototype.update=function(t,e){this.points_.push(t,e,Date.now())};Rn.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var i=e-3;0<i&&this.points_[i+2]>t;)i-=3;var r=this.points_[e+2]-this.points_[i+2];if(r<1e3/60)return!1;var o=this.points_[e]-this.points_[i],n=this.points_[e+1]-this.points_[i+1];this.angle_=Math.atan2(n,o);this.initialVelocity_=Math.sqrt(o*o+n*n)/r;return this.initialVelocity_>this.minVelocity_};Rn.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_};Rn.prototype.getAngle=function(){return this.angle_};var In={IMAGE:"IMAGE",TILE:"TILE",VECTOR_TILE:"VECTOR_TILE",VECTOR:"VECTOR"},wn=function(r){function t(t,e,i){r.call(this,t);this.map=e;this.frameState=void 0!==i?i:null}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(m),Ln=function(n){function t(t,e,i,r,o){n.call(this,t,e,o);this.originalEvent=i;this.pixel=e.getEventPixel(i);this.coordinate=e.getCoordinateFromPixel(this.pixel);this.dragging=void 0!==r&&r}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.preventDefault=function(){n.prototype.preventDefault.call(this);this.originalEvent.preventDefault()};t.prototype.stopPropagation=function(){n.prototype.stopPropagation.call(this);this.originalEvent.stopPropagation()};return t}(wn),On={SINGLECLICK:"singleclick",CLICK:R.CLICK,DBLCLICK:R.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Pn=function(n){function t(t,e,i,r,o){n.call(this,t,e,i.originalEvent,r,o);this.pointerEvent=i}n&&(t.__proto__=n);return(t.prototype=Object.create(n&&n.prototype)).constructor=t}(Ln),bn={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Mn=function(t,e){this.dispatcher=t;this.mapping_=e};Mn.prototype.getEvents=function(){return Object.keys(this.mapping_)};Mn.prototype.getHandlerForEvent=function(t){return this.mapping_[t]};var Fn=1,An="mouse";function Nn(t){if(!this.isEventSimulatedFromTouch_(t)){Fn.toString()in this.pointerMap&&this.cancel(t);var e=Yn(t,this.dispatcher);this.pointerMap[Fn.toString()]=t;this.dispatcher.down(e,t)}}function Dn(t){if(!this.isEventSimulatedFromTouch_(t)){var e=Yn(t,this.dispatcher);this.dispatcher.move(e,t)}}function Gn(t){if(!this.isEventSimulatedFromTouch_(t)){var e=this.pointerMap[Fn.toString()];if(e&&e.button===t.button){var i=Yn(t,this.dispatcher);this.dispatcher.up(i,t);this.cleanupMouse()}}}function kn(t){if(!this.isEventSimulatedFromTouch_(t)){var e=Yn(t,this.dispatcher);this.dispatcher.enterOver(e,t)}}function jn(t){if(!this.isEventSimulatedFromTouch_(t)){var e=Yn(t,this.dispatcher);this.dispatcher.leaveOut(e,t)}}var Un=function(i){function t(t){var e={mousedown:Nn,mousemove:Dn,mouseup:Gn,mouseover:kn,mouseout:jn};i.call(this,t,e);this.pointerMap=t.pointerMap;this.lastTouches=[]}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.isEventSimulatedFromTouch_=function(t){for(var e=this.lastTouches,i=t.clientX,r=t.clientY,o=0,n=e.length,s=void 0;o<n&&(s=e[o]);o++){var a=Math.abs(i-s[0]),l=Math.abs(r-s[1]);if(a<=25&&l<=25)return!0}return!1};t.prototype.cancel=function(t){var e=Yn(t,this.dispatcher);this.dispatcher.cancel(e,t);this.cleanupMouse()};t.prototype.cleanupMouse=function(){delete this.pointerMap[Fn.toString()]};return t}(Mn);function Yn(t,e){var i=e.cloneEvent(t,t),r=i.preventDefault;i.preventDefault=function(){t.preventDefault();r()};i.pointerId=Fn;i.isPrimary=!0;i.pointerType=An;return i}var Bn=["","unavailable","touch","pen","mouse"];function Vn(t){this.pointerMap[t.pointerId.toString()]=t;var e=this.prepareEvent_(t);this.dispatcher.down(e,t)}function Xn(t){var e=this.prepareEvent_(t);this.dispatcher.move(e,t)}function zn(t){var e=this.prepareEvent_(t);this.dispatcher.up(e,t);this.cleanup(t.pointerId)}function Wn(t){var e=this.prepareEvent_(t);this.dispatcher.leaveOut(e,t)}function Hn(t){var e=this.prepareEvent_(t);this.dispatcher.enterOver(e,t)}function Kn(t){var e=this.prepareEvent_(t);this.dispatcher.cancel(e,t);this.cleanup(t.pointerId)}function Zn(t){var e=this.dispatcher.makeEvent("lostpointercapture",t,t);this.dispatcher.dispatchEvent(e)}function qn(t){var e=this.dispatcher.makeEvent("gotpointercapture",t,t);this.dispatcher.dispatchEvent(e)}var Jn=function(i){function t(t){var e={MSPointerDown:Vn,MSPointerMove:Xn,MSPointerUp:zn,MSPointerOut:Wn,MSPointerOver:Hn,MSPointerCancel:Kn,MSGotPointerCapture:qn,MSLostPointerCapture:Zn};i.call(this,t,e);this.pointerMap=t.pointerMap}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.prepareEvent_=function(t){var e=t;"number"==typeof t.pointerType&&((e=this.dispatcher.cloneEvent(t,t)).pointerType=Bn[t.pointerType]);return e};t.prototype.cleanup=function(t){delete this.pointerMap[t.toString()]};return t}(Mn);function Qn(t){this.dispatcher.fireNativeEvent(t)}function $n(t){this.dispatcher.fireNativeEvent(t)}function ts(t){this.dispatcher.fireNativeEvent(t)}function es(t){this.dispatcher.fireNativeEvent(t)}function is(t){this.dispatcher.fireNativeEvent(t)}function rs(t){this.dispatcher.fireNativeEvent(t)}function os(t){this.dispatcher.fireNativeEvent(t)}function ns(t){this.dispatcher.fireNativeEvent(t)}var ss=function(i){function t(t){var e={pointerdown:Qn,pointermove:$n,pointerup:ts,pointerout:es,pointerover:is,pointercancel:rs,gotpointercapture:ns,lostpointercapture:os};i.call(this,t,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Mn),as=!1,ls=function(o){function t(t,e,i){o.call(this,t);this.originalEvent=e;var r=i||{};this.buttons=this.getButtons_(r);this.pressure=this.getPressure_(r,this.buttons);this.bubbles="bubbles"in r&&r.bubbles;this.cancelable="cancelable"in r&&r.cancelable;this.view="view"in r?r.view:null;this.detail="detail"in r?r.detail:null;this.screenX="screenX"in r?r.screenX:0;this.screenY="screenY"in r?r.screenY:0;this.clientX="clientX"in r?r.clientX:0;this.clientY="clientY"in r?r.clientY:0;this.ctrlKey="ctrlKey"in r&&r.ctrlKey;this.altKey="altKey"in r&&r.altKey;this.shiftKey="shiftKey"in r&&r.shiftKey;this.metaKey="metaKey"in r&&r.metaKey;this.button="button"in r?r.button:0;this.relatedTarget="relatedTarget"in r?r.relatedTarget:null;this.pointerId="pointerId"in r?r.pointerId:0;this.width="width"in r?r.width:0;this.height="height"in r?r.height:0;this.tiltX="tiltX"in r?r.tiltX:0;this.tiltY="tiltY"in r?r.tiltY:0;this.pointerType="pointerType"in r?r.pointerType:"";this.hwTimestamp="hwTimestamp"in r?r.hwTimestamp:0;this.isPrimary="isPrimary"in r&&r.isPrimary;e.preventDefault&&(this.preventDefault=function(){e.preventDefault()})}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.getButtons_=function(t){var e;if(t.buttons||as)e=t.buttons;else switch(t.which){case 1:e=1;break;case 2:e=4;break;case 3:e=2;break;default:e=0}return e};t.prototype.getPressure_=function(t,e){return t.pressure?t.pressure:e?.5:0};return t}(m);!function(){try{var t=new MouseEvent("click",{buttons:1});as=1===t.buttons}catch(t){}}();function hs(t){this.vacuumTouches_(t);this.setPrimaryTouch_(t.changedTouches[0]);this.dedupSynthMouse_(t);this.clickCount_++;this.processTouches_(t,this.overDown_)}function us(t){this.processTouches_(t,this.moveOverOut_)}function cs(t){this.dedupSynthMouse_(t);this.processTouches_(t,this.upOut_)}function ps(t){this.processTouches_(t,this.cancelOut_)}var ds=function(r){function t(t,e){var i={touchstart:hs,touchmove:us,touchend:cs,touchcancel:ps};r.call(this,t,i);this.pointerMap=t.pointerMap;this.mouseSource=e;this.firstTouchId_=void 0;this.clickCount_=0;this.resetId_=void 0;this.dedupTimeout_=2500}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.isPrimaryTouch_=function(t){return this.firstTouchId_===t.identifier};t.prototype.setPrimaryTouch_=function(t){var e=Object.keys(this.pointerMap).length;if(0===e||1===e&&Fn.toString()in this.pointerMap){this.firstTouchId_=t.identifier;this.cancelResetClickCount_()}};t.prototype.removePrimaryPointer_=function(t){if(t.isPrimary){this.firstTouchId_=void 0;this.resetClickCount_()}};t.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),200)};t.prototype.resetClickCountHandler_=function(){this.clickCount_=0;this.resetId_=void 0};t.prototype.cancelResetClickCount_=function(){void 0!==this.resetId_&&clearTimeout(this.resetId_)};t.prototype.touchToPointer_=function(t,e){var i=this.dispatcher.cloneEvent(t,e);i.pointerId=e.identifier+2;i.bubbles=!0;i.cancelable=!0;i.detail=this.clickCount_;i.button=0;i.buttons=1;i.width=e.radiusX||0;i.height=e.radiusY||0;i.pressure=e.force||.5;i.isPrimary=this.isPrimaryTouch_(e);i.pointerType="touch";i.clientX=e.clientX;i.clientY=e.clientY;i.screenX=e.screenX;i.screenY=e.screenY;return i};t.prototype.processTouches_=function(t,e){var i=Array.prototype.slice.call(t.changedTouches),r=i.length;function o(){t.preventDefault()}for(var n=0;n<r;++n){var s=this.touchToPointer_(t,i[n]);s.preventDefault=o;e.call(this,t,s)}};t.prototype.findTouch_=function(t,e){for(var i=t.length,r=0;r<i;r++){if(t[r].identifier===e)return!0}return!1};t.prototype.vacuumTouches_=function(t){var e=t.touches,i=Object.keys(this.pointerMap),r=i.length;if(r>=e.length){for(var o=[],n=0;n<r;++n){var s=i[n],a=this.pointerMap[s];s==Fn||this.findTouch_(e,s-2)||o.push(a.out)}for(var l=0;l<o.length;++l)this.cancelOut_(t,o[l])}};t.prototype.overDown_=function(t,e){this.pointerMap[e.pointerId]={target:e.target,out:e,outTarget:e.target};this.dispatcher.over(e,t);this.dispatcher.enter(e,t);this.dispatcher.down(e,t)};t.prototype.moveOverOut_=function(t,e){var i=e,r=this.pointerMap[i.pointerId];if(r){var o=r.out,n=r.outTarget;this.dispatcher.move(i,t);if(o&&n!==i.target){o.relatedTarget=i.target;i.relatedTarget=n;o.target=n;if(i.target){this.dispatcher.leaveOut(o,t);this.dispatcher.enterOver(i,t)}else{i.target=n;i.relatedTarget=null;this.cancelOut_(t,i)}}r.out=i;r.outTarget=i.target}};t.prototype.upOut_=function(t,e){this.dispatcher.up(e,t);this.dispatcher.out(e,t);this.dispatcher.leave(e,t);this.cleanUpPointer_(e)};t.prototype.cancelOut_=function(t,e){this.dispatcher.cancel(e,t);this.dispatcher.out(e,t);this.dispatcher.leave(e,t);this.cleanUpPointer_(e)};t.prototype.cleanUpPointer_=function(t){delete this.pointerMap[t.pointerId];this.removePrimaryPointer_(t)};t.prototype.dedupSynthMouse_=function(t){var e=this.mouseSource.lastTouches,i=t.changedTouches[0];if(this.isPrimaryTouch_(i)){var r=[i.clientX,i.clientY];e.push(r);setTimeout(function(){Mr(e,r)},this.dedupTimeout_)}};return t}(Mn),fs=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]],_s=function(e){function t(t){e.call(this);this.element_=t;this.pointerMap={};this.eventMap_={};this.eventSourceList_=[];this.registerSources()}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.registerSources=function(){if(Fi)this.registerSource("native",new ss(this));else if(Ai)this.registerSource("ms",new Jn(this));else{var t=new Un(this);this.registerSource("mouse",t);Mi&&this.registerSource("touch",new ds(this,t))}this.register_()};t.prototype.registerSource=function(t,e){var i=e,r=i.getEvents();if(r){r.forEach(function(t){var e=i.getHandlerForEvent(t);e&&(this.eventMap_[t]=e.bind(i))}.bind(this));this.eventSourceList_.push(i)}};t.prototype.register_=function(){for(var t=this.eventSourceList_.length,e=0;e<t;e++){var i=this.eventSourceList_[e];this.addEvents_(i.getEvents())}};t.prototype.unregister_=function(){for(var t=this.eventSourceList_.length,e=0;e<t;e++){var i=this.eventSourceList_[e];this.removeEvents_(i.getEvents())}};t.prototype.eventHandler_=function(t){var e=t.type,i=this.eventMap_[e];i&&i(t)};t.prototype.addEvents_=function(t){t.forEach(function(t){S(this.element_,t,this.eventHandler_,this)}.bind(this))};t.prototype.removeEvents_=function(t){t.forEach(function(t){d(this.element_,t,this.eventHandler_,this)}.bind(this))};t.prototype.cloneEvent=function(t,e){for(var i={},r=0,o=fs.length;r<o;r++){var n=fs[r][0];i[n]=t[n]||e[n]||fs[r][1]}return i};t.prototype.down=function(t,e){this.fireEvent(bn.POINTERDOWN,t,e)};t.prototype.move=function(t,e){this.fireEvent(bn.POINTERMOVE,t,e)};t.prototype.up=function(t,e){this.fireEvent(bn.POINTERUP,t,e)};t.prototype.enter=function(t,e){t.bubbles=!1;this.fireEvent(bn.POINTERENTER,t,e)};t.prototype.leave=function(t,e){t.bubbles=!1;this.fireEvent(bn.POINTERLEAVE,t,e)};t.prototype.over=function(t,e){t.bubbles=!0;this.fireEvent(bn.POINTEROVER,t,e)};t.prototype.out=function(t,e){t.bubbles=!0;this.fireEvent(bn.POINTEROUT,t,e)};t.prototype.cancel=function(t,e){this.fireEvent(bn.POINTERCANCEL,t,e)};t.prototype.leaveOut=function(t,e){this.out(t,e);this.contains_(t.target,t.relatedTarget)||this.leave(t,e)};t.prototype.enterOver=function(t,e){this.over(t,e);this.contains_(t.target,t.relatedTarget)||this.enter(t,e)};t.prototype.contains_=function(t,e){return!(!t||!e)&&t.contains(e)};t.prototype.makeEvent=function(t,e,i){return new ls(t,i,e)};t.prototype.fireEvent=function(t,e,i){var r=this.makeEvent(t,e,i);this.dispatchEvent(r)};t.prototype.fireNativeEvent=function(t){var e=this.makeEvent(t.type,t,t);this.dispatchEvent(e)};t.prototype.wrapMouseEvent=function(t,e){return this.makeEvent(t,Un.prepareEvent(e,this),e)};t.prototype.disposeInternal=function(){this.unregister_();e.prototype.disposeInternal.call(this)};return t}(x),gs=function(r){function t(t,e){r.call(this);this.map_=t;this.clickTimeoutId_=0;this.dragging_=!1;this.dragListenerKeys_=[];this.moveTolerance_=e?e*Oi:Oi;this.down_=null;var i=this.map_.getViewport();this.activePointers_=0;this.trackedTouches_={};this.pointerEventHandler_=new _s(i);this.documentPointerEventHandler_=null;this.pointerdownListenerKey_=S(this.pointerEventHandler_,bn.POINTERDOWN,this.handlePointerDown_,this);this.relayedListenerKey_=S(this.pointerEventHandler_,bn.POINTERMOVE,this.relayEvent_,this)}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.emulateClick_=function(e){var t=new Pn(On.CLICK,this.map_,e);this.dispatchEvent(t);if(0!==this.clickTimeoutId_){clearTimeout(this.clickTimeoutId_);this.clickTimeoutId_=0;t=new Pn(On.DBLCLICK,this.map_,e);this.dispatchEvent(t)}else this.clickTimeoutId_=window.setTimeout(function(){this.clickTimeoutId_=0;var t=new Pn(On.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}.bind(this),250)};t.prototype.updateActivePointers_=function(t){var e=t;e.type==On.POINTERUP||e.type==On.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==On.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0);this.activePointers_=Object.keys(this.trackedTouches_).length};t.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new Pn(On.POINTERUP,this.map_,t);this.dispatchEvent(e);e.propagationStopped||this.dragging_||!this.isMouseActionButton_(t)||this.emulateClick_(this.down_);if(0===this.activePointers_){this.dragListenerKeys_.forEach(g);this.dragListenerKeys_.length=0;this.dragging_=!1;this.down_=null;this.documentPointerEventHandler_.dispose();this.documentPointerEventHandler_=null}};t.prototype.isMouseActionButton_=function(t){return 0===t.button};t.prototype.handlePointerDown_=function(t){this.updateActivePointers_(t);var e=new Pn(On.POINTERDOWN,this.map_,t);this.dispatchEvent(e);this.down_=t;if(0===this.dragListenerKeys_.length){this.documentPointerEventHandler_=new _s(document);this.dragListenerKeys_.push(S(this.documentPointerEventHandler_,On.POINTERMOVE,this.handlePointerMove_,this),S(this.documentPointerEventHandler_,On.POINTERUP,this.handlePointerUp_,this),S(this.pointerEventHandler_,On.POINTERCANCEL,this.handlePointerUp_,this))}};t.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var e=new Pn(On.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}t.preventDefault()};t.prototype.relayEvent_=function(t){var e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new Pn(t.type,this.map_,t,e))};t.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_};t.prototype.disposeInternal=function(){if(this.relayedListenerKey_){g(this.relayedListenerKey_);this.relayedListenerKey_=null}if(this.pointerdownListenerKey_){g(this.pointerdownListenerKey_);this.pointerdownListenerKey_=null}this.dragListenerKeys_.forEach(g);this.dragListenerKeys_.length=0;if(this.documentPointerEventHandler_){this.documentPointerEventHandler_.dispose();this.documentPointerEventHandler_=null}if(this.pointerEventHandler_){this.pointerEventHandler_.dispose();this.pointerEventHandler_=null}r.prototype.disposeInternal.call(this)};return t}(x),ys={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},vs={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},ms=function(t,e){this.priorityFunction_=t;this.keyFunction_=e;this.elements_=[];this.priorities_=[];this.queuedElements_={}};ms.prototype.clear=function(){this.elements_.length=0;this.priorities_.length=0;_(this.queuedElements_)};ms.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,i=t[0];if(1==t.length){t.length=0;e.length=0}else{t[0]=t.pop();e[0]=e.pop();this.siftUp_(0)}var r=this.keyFunction_(i);delete this.queuedElements_[r];return i};ms.prototype.enqueue=function(t){A(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);if(e==1/0)return!1;this.elements_.push(t);this.priorities_.push(e);this.queuedElements_[this.keyFunction_(t)]=!0;this.siftDown_(0,this.elements_.length-1);return!0};ms.prototype.getCount=function(){return this.elements_.length};ms.prototype.getLeftChildIndex_=function(t){return 2*t+1};ms.prototype.getRightChildIndex_=function(t){return 2*t+2};ms.prototype.getParentIndex_=function(t){return t-1>>1};ms.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;0<=t;t--)this.siftUp_(t)};ms.prototype.isEmpty=function(){return 0===this.elements_.length};ms.prototype.isKeyQueued=function(t){return t in this.queuedElements_};ms.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))};ms.prototype.siftUp_=function(t){for(var e=this.elements_,i=this.priorities_,r=e.length,o=e[t],n=i[t],s=t;t<r>>1;){var a=this.getLeftChildIndex_(t),l=this.getRightChildIndex_(t),h=l<r&&i[l]<i[a]?l:a;e[t]=e[h];i[t]=i[h];t=h}e[t]=o;i[t]=n;this.siftDown_(s,t)};ms.prototype.siftDown_=function(t,e){for(var i=this.elements_,r=this.priorities_,o=i[e],n=r[e];t<e;){var s=this.getParentIndex_(e);if(!(r[s]>n))break;i[e]=i[s];r[e]=r[s];e=s}i[e]=o;r[e]=n};ms.prototype.reprioritize=function(){var t,e,i,r=this.priorityFunction_,o=this.elements_,n=this.priorities_,s=0,a=o.length;for(e=0;e<a;++e)if((i=r(t=o[e]))==1/0)delete this.queuedElements_[this.keyFunction_(t)];else{n[s]=i;o[s++]=t}o.length=s;n.length=s;this.heapify_()};var Es=function(i){function t(e,t){i.call(this,function(t){return e.apply(null,t)},function(t){return t[0].getKey()});this.tileChangeCallback_=t;this.tilesLoading_=0;this.tilesLoadingKeys_={}}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.enqueue=function(t){var e=i.prototype.enqueue.call(this,t);if(e){S(t[0],R.CHANGE,this.handleTileChange,this)}return e};t.prototype.getTilesLoading=function(){return this.tilesLoading_};t.prototype.handleTileChange=function(t){var e=t.target,i=e.getState();if(i===yn.LOADED||i===yn.ERROR||i===yn.EMPTY||i===yn.ABORT){d(e,R.CHANGE,this.handleTileChange,this);var r=e.getKey();if(r in this.tilesLoadingKeys_){delete this.tilesLoadingKeys_[r];--this.tilesLoading_}this.tileChangeCallback_()}};t.prototype.loadMoreTiles=function(t,e){for(var i,r,o,n=0,s=!1;this.tilesLoading_<t&&n<e&&0<this.getCount();){o=(r=this.dequeue()[0]).getKey();if((i=r.getState())===yn.ABORT)s=!0;else if(i===yn.IDLE&&!(o in this.tilesLoadingKeys_)){this.tilesLoadingKeys_[o]=!0;++this.tilesLoading_;++n;r.load()}}0===n&&s&&this.tileChangeCallback_()};return t}(ms),xs=42,Ts=256;function Ss(e){return function(t){return t?[Lt(t[0],e[0],e[2]),Lt(t[1],e[1],e[3])]:void 0}}function Cs(t){return t}function Rs(s){return function(t,e,i){if(void 0!==t){var r=Or(s,t,i);r=Lt(r+e,0,s.length-1);var o=Math.floor(r);if(r!=o&&o<s.length-1){var n=s[o]/s[o+1];return s[o]/Math.pow(n,r-o)}return s[o]}}}function Is(s,a,l){return function(t,e,i){if(void 0!==t){var r=-i/2+.5,o=Math.floor(Math.log(a/t)/Math.log(s)+r),n=Math.max(o+e,0);void 0!==l&&(n=Math.min(n,l));return a/Math.pow(s,n)}}}function ws(t,e){return void 0!==t?0:void 0}function Ls(t,e){return void 0!==t?t+e:void 0}function Os(t){var i=2*Math.PI/t;return function(t,e){return void 0!==t?t=Math.floor((t+e)/i+.5)*i:void 0}}function Ps(t){var i=t||Nt(5);return function(t,e){return void 0!==t?Math.abs(t+e)<=i?0:t+e:void 0}}var bs={ANIMATING:0,INTERACTING:1},Ms={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},Fs=function(i){function t(t){i.call(this);var e=T({},t);this.hints_=[0,0];this.animations_=[];this.updateAnimationKey_;this.updateAnimations_=this.updateAnimations_.bind(this);this.projection_=xe(e.projection,"EPSG:3857");this.applyOptions_(e)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.applyOptions_=function(t){var e={};e[Ms.CENTER]=void 0!==t.center?t.center:null;var i=Ds(t);this.maxResolution_=i.maxResolution;this.minResolution_=i.minResolution;this.zoomFactor_=i.zoomFactor;this.resolutions_=t.resolutions;this.minZoom_=i.minZoom;var r=Ns(t),o=i.constraint,n=Gs(t);this.constraints_={center:r,resolution:o,rotation:n};if(void 0!==t.resolution)e[Ms.RESOLUTION]=t.resolution;else if(void 0!==t.zoom){e[Ms.RESOLUTION]=this.constrainResolution(this.maxResolution_,t.zoom-this.minZoom_);this.resolutions_&&(e[Ms.RESOLUTION]=Lt(Number(this.getResolution()||e[Ms.RESOLUTION]),this.minResolution_,this.maxResolution_))}e[Ms.ROTATION]=void 0!==t.rotation?t.rotation:0;this.setProperties(e);this.options_=t};t.prototype.getUpdatedOptions_=function(t){var e=T({},this.options_);void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom();e.center=this.getCenter();e.rotation=this.getRotation();return T({},e,t)};t.prototype.animate=function(t){var e,i=arguments,r=arguments.length;if(1<r&&"function"==typeof arguments[r-1]){e=arguments[r-1];--r}if(this.isDef()){for(var o=Date.now(),n=this.getCenter().slice(),s=this.getResolution(),a=this.getRotation(),l=[],h=0;h<r;++h){var u=i[h],c={start:o,complete:!1,anchor:u.anchor,duration:void 0!==u.duration?u.duration:1e3,easing:u.easing||En};if(u.center){c.sourceCenter=n;c.targetCenter=u.center;n=c.targetCenter}if(void 0!==u.zoom){c.sourceResolution=s;c.targetResolution=this.constrainResolution(this.maxResolution_,u.zoom-this.minZoom_,0);s=c.targetResolution}else if(u.resolution){c.sourceResolution=s;c.targetResolution=u.resolution;s=c.targetResolution}if(void 0!==u.rotation){c.sourceRotation=a;var p=Dt(u.rotation-a+Math.PI,2*Math.PI)-Math.PI;c.targetRotation=a+p;a=c.targetRotation}c.callback=e;ks(c)?c.complete=!0:o+=c.duration;l.push(c)}this.animations_.push(l);this.setHint(bs.ANIMATING,1);this.updateAnimations_()}else{var d=arguments[r-1];d.center&&this.setCenter(d.center);void 0!==d.zoom&&this.setZoom(d.zoom);void 0!==d.rotation&&this.setRotation(d.rotation);e&&As(e,!0)}};t.prototype.getAnimating=function(){return 0<this.hints_[bs.ANIMATING]};t.prototype.getInteracting=function(){return 0<this.hints_[bs.INTERACTING]};t.prototype.cancelAnimations=function(){this.setHint(bs.ANIMATING,-this.hints_[bs.ANIMATING]);for(var t=0,e=this.animations_.length;t<e;++t){var i=this.animations_[t];i[0].callback&&As(i[0].callback,!1)}this.animations_.length=0};t.prototype.updateAnimations_=function(){var t=this;if(void 0!==this.updateAnimationKey_){cancelAnimationFrame(this.updateAnimationKey_);this.updateAnimationKey_=void 0}if(this.getAnimating()){for(var e=Date.now(),i=!1,r=this.animations_.length-1;0<=r;--r){for(var o=t.animations_[r],n=!0,s=0,a=o.length;s<a;++s){var l=o[s];if(!l.complete){var h=e-l.start,u=0<l.duration?h/l.duration:1;if(1<=u){l.complete=!0;u=1}else n=!1;var c=l.easing(u);if(l.sourceCenter){var p=l.sourceCenter[0],d=l.sourceCenter[1],f=p+c*(l.targetCenter[0]-p),_=d+c*(l.targetCenter[1]-d);t.set(Ms.CENTER,[f,_])}if(l.sourceResolution&&l.targetResolution){var g=1===c?l.targetResolution:l.sourceResolution+c*(l.targetResolution-l.sourceResolution);l.anchor&&t.set(Ms.CENTER,t.calculateCenterZoom(g,l.anchor));t.set(Ms.RESOLUTION,g)}if(void 0!==l.sourceRotation&&void 0!==l.targetRotation){var y=1===c?Dt(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+c*(l.targetRotation-l.sourceRotation);l.anchor&&t.set(Ms.CENTER,t.calculateCenterRotate(y,l.anchor));t.set(Ms.ROTATION,y)}i=!0;if(!l.complete)break}}if(n){t.animations_[r]=null;t.setHint(bs.ANIMATING,-1);var v=o[0].callback;v&&As(v,!0)}}this.animations_=this.animations_.filter(Boolean);i&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}};t.prototype.calculateCenterRotate=function(t,e){var i,r=this.getCenter();if(void 0!==r){Ho(i=[r[0]-e[0],r[1]-e[1]],t-this.getRotation());Yo(i,e)}return i};t.prototype.calculateCenterZoom=function(t,e){var i,r=this.getCenter(),o=this.getResolution();if(void 0!==r&&void 0!==o){i=[e[0]-t*(e[0]-r[0])/o,e[1]-t*(e[1]-r[1])/o]}return i};t.prototype.getSizeFromViewport_=function(){var t=[100,100],e='.ol-viewport[data-view="'+St(this)+'"]',i=document.querySelector(e);if(i){var r=getComputedStyle(i);t[0]=parseInt(r.width,10);t[1]=parseInt(r.height,10)}return t};t.prototype.constrainCenter=function(t){return this.constraints_.center(t)};t.prototype.constrainResolution=function(t,e,i){var r=e||0,o=i||0;return this.constraints_.resolution(t,r,o)};t.prototype.constrainRotation=function(t,e){var i=e||0;return this.constraints_.rotation(t,i)};t.prototype.getCenter=function(){return this.get(Ms.CENTER)};t.prototype.getConstraints=function(){return this.constraints_};t.prototype.getHints=function(t){if(void 0===t)return this.hints_.slice();t[0]=this.hints_[0];t[1]=this.hints_[1];return t};t.prototype.calculateExtent=function(t){var e=t||this.getSizeFromViewport_(),i=this.getCenter();A(i,1);var r=this.getResolution();A(void 0!==r,2);var o=this.getRotation();A(void 0!==o,3);return ut(i,r,o,e)};t.prototype.getMaxResolution=function(){return this.maxResolution_};t.prototype.getMinResolution=function(){return this.minResolution_};t.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)};t.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))};t.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)};t.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))};t.prototype.getProjection=function(){return this.projection_};t.prototype.getResolution=function(){return this.get(Ms.RESOLUTION)};t.prototype.getResolutions=function(){return this.resolutions_};t.prototype.getResolutionForExtent=function(t,e){var i=e||this.getSizeFromViewport_(),r=_t(t)/i[0],o=ct(t)/i[1];return Math.max(r,o)};t.prototype.getResolutionForValueFunction=function(t){var e=t||2,i=this.maxResolution_,r=this.minResolution_,o=Math.log(i/r)/Math.log(e);return function(t){return i/Math.pow(e,t*o)}};t.prototype.getRotation=function(){return this.get(Ms.ROTATION)};t.prototype.getValueForResolutionFunction=function(t){var e=t||2,i=this.maxResolution_,r=this.minResolution_,o=Math.log(i/r)/Math.log(e);return function(t){return Math.log(i/t)/Math.log(e)/o}};t.prototype.getState=function(t){var e=this.getCenter(),i=this.getProjection(),r=this.getResolution(),o=r/t,n=this.getRotation();return{center:[Math.round(e[0]/o)*o,Math.round(e[1]/o)*o],projection:void 0!==i?i:null,resolution:r,rotation:n,zoom:this.getZoom()}};t.prototype.getZoom=function(){var t,e=this.getResolution();void 0!==e&&(t=this.getZoomForResolution(e));return t};t.prototype.getZoomForResolution=function(t){var e,i,r=this.minZoom_||0;if(this.resolutions_){var o=Or(this.resolutions_,t,1);r=o;e=this.resolutions_[o];i=o==this.resolutions_.length-1?2:e/this.resolutions_[o+1]}else{e=this.maxResolution_;i=this.zoomFactor_}return r+Math.log(e/t)/Math.log(i)};t.prototype.getResolutionForZoom=function(t){return this.constrainResolution(this.maxResolution_,t-this.minZoom_,0)};t.prototype.fit=function(t,e){var i,r=e||{},o=r.size;o||(o=this.getSizeFromViewport_());if(t instanceof jr)t.getType()===kt.CIRCLE?(i=No(t=t.getExtent())).rotate(this.getRotation(),lt(t)):i=t;else{A(Array.isArray(t),24);A(!gt(t),25);i=No(t)}var n,s=void 0!==r.padding?r.padding:[0,0,0,0],a=void 0===r.constrainResolution||r.constrainResolution,l=void 0!==r.nearest&&r.nearest;n=void 0!==r.minResolution?r.minResolution:void 0!==r.maxZoom?this.constrainResolution(this.maxResolution_,r.maxZoom-this.minZoom_,0):0;for(var h=i.getFlatCoordinates(),u=this.getRotation(),c=Math.cos(-u),p=Math.sin(-u),d=1/0,f=1/0,_=-1/0,g=-1/0,y=i.getStride(),v=0,m=h.length;v<m;v+=y){var E=h[v]*c-h[v+1]*p,x=h[v]*p+h[v+1]*c;d=Math.min(d,E);f=Math.min(f,x);_=Math.max(_,E);g=Math.max(g,x)}var T=this.getResolutionForExtent([d,f,_,g],[o[0]-s[1]-s[3],o[1]-s[0]-s[2]]);T=isNaN(T)?n:Math.max(T,n);if(a){var S=this.constrainResolution(T,0,0);!l&&S<T&&(S=this.constrainResolution(S,-1,0));T=S}p=-p;var C=(d+_)/2,R=(f+g)/2,I=[(C+=(s[1]-s[3])/2*T)*c-(R+=(s[0]-s[2])/2*T)*p,R*c+C*p],w=r.callback?r.callback:L;if(void 0!==r.duration)this.animate({resolution:T,center:I,duration:r.duration,easing:r.easing},w);else{this.setResolution(T);this.setCenter(I);As(w,!0)}};t.prototype.centerOn=function(t,e,i){var r=this.getRotation(),o=Math.cos(-r),n=Math.sin(-r),s=t[0]*o-t[1]*n,a=t[1]*o+t[0]*n,l=this.getResolution(),h=(s+=(e[0]/2-i[0])*l)*o-(a+=(i[1]-e[1]/2)*l)*(n=-n),u=a*o+s*n;this.setCenter([h,u])};t.prototype.isDef=function(){return!!this.getCenter()&&void 0!==this.getResolution()};t.prototype.rotate=function(t,e){if(void 0!==e){var i=this.calculateCenterRotate(t,e);this.setCenter(i)}this.setRotation(t)};t.prototype.setCenter=function(t){this.set(Ms.CENTER,t);this.getAnimating()&&this.cancelAnimations()};t.prototype.setHint=function(t,e){this.hints_[t]+=e;this.changed();return this.hints_[t]};t.prototype.setResolution=function(t){this.set(Ms.RESOLUTION,t);this.getAnimating()&&this.cancelAnimations()};t.prototype.setRotation=function(t){this.set(Ms.ROTATION,t);this.getAnimating()&&this.cancelAnimations()};t.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))};return t}(w);function As(t,e){setTimeout(function(){t(e)},0)}function Ns(t){return void 0!==t.extent?Ss(t.extent):Cs}function Ds(t){var e,i,r,o=void 0!==t.minZoom?t.minZoom:0,n=void 0!==t.maxZoom?t.maxZoom:28,s=void 0!==t.zoomFactor?t.zoomFactor:2;if(void 0!==t.resolutions){var a=t.resolutions;i=a[o];r=void 0!==a[n]?a[n]:a[a.length-1];e=Rs(a)}else{var l=xe(t.projection,"EPSG:3857"),h=l.getExtent(),u=(h?Math.max(_t(h),ct(h)):360*zt[Xt.DEGREES]/l.getMetersPerUnit())/Ts/Math.pow(2,0),c=u/Math.pow(2,28);void 0!==(i=t.maxResolution)?o=0:i=u/Math.pow(s,o);void 0===(r=t.minResolution)&&(r=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(s,n):u/Math.pow(s,n):c);n=o+Math.floor(Math.log(i/r)/Math.log(s));r=i/Math.pow(s,n-o);e=Is(s,i,n-o)}return{constraint:e,maxResolution:i,minResolution:r,minZoom:o,zoomFactor:s}}function Gs(t){if(void 0===t.enableRotation||t.enableRotation){var e=t.constrainRotation;return void 0===e||!0===e?Ps():!1===e?Ls:"number"==typeof e?Os(e):Ls}return ws}function ks(t){return!(t.sourceCenter&&t.targetCenter&&!Wo(t.sourceCenter,t.targetCenter))&&(t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation)}var js={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",SOURCE:"source"},Us=function(i){function t(t){i.call(this);var e=T({},t);e[js.OPACITY]=void 0!==t.opacity?t.opacity:1;e[js.VISIBLE]=void 0===t.visible||t.visible;e[js.Z_INDEX]=t.zIndex;e[js.MAX_RESOLUTION]=void 0!==t.maxResolution?t.maxResolution:1/0;e[js.MIN_RESOLUTION]=void 0!==t.minResolution?t.minResolution:0;this.setProperties(e);this.state_={layer:this,managed:!0};this.type}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getType=function(){return this.type};t.prototype.getLayerState=function(){this.state_.opacity=Lt(this.getOpacity(),0,1);this.state_.sourceState=this.getSourceState();this.state_.visible=this.getVisible();this.state_.extent=this.getExtent();this.state_.zIndex=this.getZIndex()||0;this.state_.maxResolution=this.getMaxResolution();this.state_.minResolution=Math.max(this.getMinResolution(),0);return this.state_};t.prototype.getLayersArray=function(t){};t.prototype.getLayerStatesArray=function(t){};t.prototype.getExtent=function(){return this.get(js.EXTENT)};t.prototype.getMaxResolution=function(){return this.get(js.MAX_RESOLUTION)};t.prototype.getMinResolution=function(){return this.get(js.MIN_RESOLUTION)};t.prototype.getOpacity=function(){return this.get(js.OPACITY)};t.prototype.getSourceState=function(){};t.prototype.getVisible=function(){return this.get(js.VISIBLE)};t.prototype.getZIndex=function(){return this.get(js.Z_INDEX)};t.prototype.setExtent=function(t){this.set(js.EXTENT,t)};t.prototype.setMaxResolution=function(t){this.set(js.MAX_RESOLUTION,t)};t.prototype.setMinResolution=function(t){this.set(js.MIN_RESOLUTION,t)};t.prototype.setOpacity=function(t){this.set(js.OPACITY,t)};t.prototype.setVisible=function(t){this.set(js.VISIBLE,t)};t.prototype.setZIndex=function(t){this.set(js.Z_INDEX,t)};return t}(w),Ys={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},Bs="layers",Vs=function(o){function t(t){var e=t||{},i=T({},e);delete i.layers;var r=e.layers;o.call(this,i);this.layersListenerKeys_=[];this.listenerKeys_={};S(this,P(Bs),this.handleLayersChanged_,this);if(r)if(Array.isArray(r))r=new F(r.slice(),{unique:!0});else{A(r instanceof F,43);r=r}else r=new F(void 0,{unique:!0});this.setLayers(r)}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.handleLayerChange_=function(){this.changed()};t.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(g);this.layersListenerKeys_.length=0;var t=this.getLayers();this.layersListenerKeys_.push(S(t,a.ADD,this.handleLayersAdd_,this),S(t,a.REMOVE,this.handleLayersRemove_,this));for(var e in this.listenerKeys_)this.listenerKeys_[e].forEach(g);_(this.listenerKeys_);for(var i=t.getArray(),r=0,o=i.length;r<o;r++){var n=i[r];this.listenerKeys_[St(n).toString()]=[S(n,l.PROPERTYCHANGE,this.handleLayerChange_,this),S(n,R.CHANGE,this.handleLayerChange_,this)]}this.changed()};t.prototype.handleLayersAdd_=function(t){var e=t.element,i=St(e).toString();this.listenerKeys_[i]=[S(e,l.PROPERTYCHANGE,this.handleLayerChange_,this),S(e,R.CHANGE,this.handleLayerChange_,this)];this.changed()};t.prototype.handleLayersRemove_=function(t){var e=St(t.element).toString();this.listenerKeys_[e].forEach(g);delete this.listenerKeys_[e];this.changed()};t.prototype.getLayers=function(){return this.get(Bs)};t.prototype.setLayers=function(t){this.set(Bs,t)};t.prototype.getLayersArray=function(t){var e=void 0!==t?t:[];this.getLayers().forEach(function(t){t.getLayersArray(e)});return e};t.prototype.getLayerStatesArray=function(t){var e=void 0!==t?t:[],i=e.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(e)});for(var r=this.getLayerState(),o=i,n=e.length;o<n;o++){var s=e[o];s.opacity*=r.opacity;s.visible=s.visible&&r.visible;s.maxResolution=Math.min(s.maxResolution,r.maxResolution);s.minResolution=Math.max(s.minResolution,r.minResolution);void 0!==r.extent&&(void 0!==s.extent?s.extent=pt(s.extent,r.extent):s.extent=r.extent)}return e};t.prototype.getSourceState=function(){return Ys.READY};return t}(Us);function Xs(t,e,i){void 0===i&&(i=[0,0]);i[0]=t[0]+2*e;i[1]=t[1]+2*e;return i}function zs(t){return 0<t[0]&&0<t[1]}function Ws(t,e,i){void 0===i&&(i=[0,0]);i[0]=t[0]*e+.5|0;i[1]=t[1]*e+.5|0;return i}function Hs(t,e){if(Array.isArray(t))return t;void 0===e?e=[t,t]:e[0]=e[1]=t;return e}var Ks=function(s){function t(t){s.call(this);var e=function(t){var e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);var i,r,o,n={},s=t.layers instanceof Vs?t.layers:new Vs({layers:t.layers});n[vs.LAYERGROUP]=s;n[vs.TARGET]=t.target;n[vs.VIEW]=void 0!==t.view?t.view:new Fs;if(void 0!==t.controls)if(Array.isArray(t.controls))i=new F(t.controls.slice());else{A(t.controls instanceof F,47);i=t.controls}if(void 0!==t.interactions)if(Array.isArray(t.interactions))r=new F(t.interactions.slice());else{A(t.interactions instanceof F,48);r=t.interactions}if(void 0!==t.overlays)if(Array.isArray(t.overlays))o=new F(t.overlays.slice());else{A(t.overlays instanceof F,49);o=t.overlays}else o=new F;return{controls:i,interactions:r,keyboardEventTarget:e,overlays:o,values:n}}(t);this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16;this.loadTilesWhileAnimating_=void 0!==t.loadTilesWhileAnimating&&t.loadTilesWhileAnimating;this.loadTilesWhileInteracting_=void 0!==t.loadTilesWhileInteracting&&t.loadTilesWhileInteracting;this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:Oi;this.animationDelayKey_;this.animationDelay_=function(){this.animationDelayKey_=void 0;this.renderFrame_.call(this,Date.now())}.bind(this);this.coordinateToPixelTransform_=[1,0,0,1,0,0];this.pixelToCoordinateTransform_=[1,0,0,1,0,0];this.frameIndex_=0;this.frameState_=null;this.previousExtent_=null;this.viewPropertyListenerKey_=null;this.viewChangeListenerKey_=null;this.layerGroupPropertyListenerKeys_=null;this.viewport_=document.createElement("div");this.viewport_.className="ol-viewport"+(Mi?" ol-touch":"");this.viewport_.style.position="relative";this.viewport_.style.overflow="hidden";this.viewport_.style.width="100%";this.viewport_.style.height="100%";this.viewport_.style.msTouchAction="none";this.viewport_.style.touchAction="none";this.overlayContainer_=document.createElement("div");this.overlayContainer_.className="ol-overlaycontainer";this.viewport_.appendChild(this.overlayContainer_);this.overlayContainerStopEvent_=document.createElement("div");this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var i=[R.CLICK,R.DBLCLICK,R.MOUSEDOWN,R.TOUCHSTART,R.MSPOINTERDOWN,On.POINTERDOWN,R.MOUSEWHEEL,R.WHEEL],r=0,o=i.length;r<o;++r)S(this.overlayContainerStopEvent_,i[r],E);this.viewport_.appendChild(this.overlayContainerStopEvent_);this.mapBrowserEventHandler_=new gs(this,t.moveTolerance);for(var n in On)S(this.mapBrowserEventHandler_,On[n],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=e.keyboardEventTarget;this.keyHandlerKeys_=null;S(this.viewport_,R.CONTEXTMENU,this.handleBrowserEvent,this);S(this.viewport_,R.WHEEL,this.handleBrowserEvent,this);S(this.viewport_,R.MOUSEWHEEL,this.handleBrowserEvent,this);this.controls=e.controls||new F;this.interactions=e.interactions||new F;this.overlays_=e.overlays;this.overlayIdIndex_={};this.renderer_=this.createRenderer();this.handleResize_;this.focus_=null;this.postRenderFunctions_=[];this.tileQueue_=new Es(this.getTilePriority.bind(this),this.handleTileChange_.bind(this));this.skippedFeatureUids_={};S(this,P(vs.LAYERGROUP),this.handleLayerGroupChanged_,this);S(this,P(vs.VIEW),this.handleViewChanged_,this);S(this,P(vs.SIZE),this.handleSizeChanged_,this);S(this,P(vs.TARGET),this.handleTargetChanged_,this);this.setProperties(e.values);this.controls.forEach(function(t){t.setMap(this)}.bind(this));S(this.controls,a.ADD,function(t){t.element.setMap(this)},this);S(this.controls,a.REMOVE,function(t){t.element.setMap(null)},this);this.interactions.forEach(function(t){t.setMap(this)}.bind(this));S(this.interactions,a.ADD,function(t){t.element.setMap(this)},this);S(this.interactions,a.REMOVE,function(t){t.element.setMap(null)},this);this.overlays_.forEach(this.addOverlayInternal_.bind(this));S(this.overlays_,a.ADD,function(t){this.addOverlayInternal_(t.element)},this);S(this.overlays_,a.REMOVE,function(t){var e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()];t.element.setMap(null)},this)}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")};t.prototype.addControl=function(t){this.getControls().push(t)};t.prototype.addInteraction=function(t){this.getInteractions().push(t)};t.prototype.addLayer=function(t){this.getLayerGroup().getLayers().push(t)};t.prototype.addOverlay=function(t){this.getOverlays().push(t)};t.prototype.addOverlayInternal_=function(t){var e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t);t.setMap(this)};t.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose();d(this.viewport_,R.CONTEXTMENU,this.handleBrowserEvent,this);d(this.viewport_,R.WHEEL,this.handleBrowserEvent,this);d(this.viewport_,R.MOUSEWHEEL,this.handleBrowserEvent,this);if(void 0!==this.handleResize_){removeEventListener(R.RESIZE,this.handleResize_,!1);this.handleResize_=void 0}if(this.animationDelayKey_){cancelAnimationFrame(this.animationDelayKey_);this.animationDelayKey_=void 0}this.setTarget(null);s.prototype.disposeInternal.call(this)};t.prototype.forEachFeatureAtPixel=function(t,e,i){if(this.frameState_){var r=this.getCoordinateFromPixel(t),o=void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance*this.frameState_.pixelRatio:0,n=void 0!==i.layerFilter?i.layerFilter:y;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,o,e,null,n,null)}};t.prototype.getFeaturesAtPixel=function(t,e){var i=null;this.forEachFeatureAtPixel(t,function(t){i||(i=[]);i.push(t)},e);return i};t.prototype.forEachLayerAtPixel=function(t,e,i){if(this.frameState_){var r=i||{},o=void 0!==r.hitTolerance?i.hitTolerance*this.frameState_.pixelRatio:0,n=r.layerFilter||y;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,o,e,null,n,null)}};t.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_)return!1;var i=this.getCoordinateFromPixel(t),r=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:y,o=void 0!==e.hitTolerance?e.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,o,r,null)};t.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))};t.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),i=t.changedTouches?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]};t.prototype.getTarget=function(){return this.get(vs.TARGET)};t.prototype.getTargetElement=function(){var t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null};t.prototype.getCoordinateFromPixel=function(t){var e=this.frameState_;return e?De(e.pixelToCoordinateTransform,t.slice()):null};t.prototype.getControls=function(){return this.controls};t.prototype.getOverlays=function(){return this.overlays_};t.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null};t.prototype.getInteractions=function(){return this.interactions};t.prototype.getLayerGroup=function(){return this.get(vs.LAYERGROUP)};t.prototype.getLayers=function(){return this.getLayerGroup().getLayers()};t.prototype.getPixelFromCoordinate=function(t){var e=this.frameState_;return e?De(e.coordinateToPixelTransform,t.slice(0,2)):null};t.prototype.getRenderer=function(){return this.renderer_};t.prototype.getSize=function(){return this.get(vs.SIZE)};t.prototype.getView=function(){return this.get(vs.VIEW)};t.prototype.getViewport=function(){return this.viewport_};t.prototype.getOverlayContainer=function(){return this.overlayContainer_};t.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_};t.prototype.getTilePriority=function(t,e,i,r){var o=this.frameState_;if(!(o&&e in o.wantedTiles))return 1/0;if(!o.wantedTiles[e][t.getKey()])return 1/0;var n=i[0]-o.focus[0],s=i[1]-o.focus[1];return 65536*Math.log(r)+Math.sqrt(n*n+s*s)/r};t.prototype.handleBrowserEvent=function(t,e){var i=e||t.type,r=new Ln(i,this,t);this.handleMapBrowserEvent(r)};t.prototype.handleMapBrowserEvent=function(t){if(this.frameState_){this.focus_=t.coordinate;t.frameState=this.frameState_;var e=this.getInteractions().getArray();if(!1!==this.dispatchEvent(t))for(var i=e.length-1;0<=i;i--){var r=e[i];if(r.getActive()){if(!r.handleEvent(t))break}}}};t.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var i=this.maxTilesLoading_,r=i;if(t){var o=t.viewHints;if(o[bs.ANIMATING]){i=this.loadTilesWhileAnimating_?8:0;r=2}if(o[bs.INTERACTING]){i=this.loadTilesWhileInteracting_?8:0;r=2}}if(e.getTilesLoading()<i){e.reprioritize();e.loadMoreTiles(i,r)}}!t||!this.hasListener(ln.RENDERCOMPLETE)||t.animate||this.tileQueue_.getTilesLoading()||function t(e){for(var i=0,r=e.length;i<r;++i){var o=e[i];if(o instanceof Vs)return t(o.getLayers().getArray());var n=e[i].getSource();if(n&&n.loading)return!0}return!1}(this.getLayers().getArray())||this.renderer_.dispatchRenderEvent(ln.RENDERCOMPLETE,t);for(var n=this.postRenderFunctions_,s=0,a=n.length;s<a;++s)n[s](this,t);n.length=0};t.prototype.handleSizeChanged_=function(){this.render()};t.prototype.handleTargetChanged_=function(){var t;this.getTarget()&&(t=this.getTargetElement());if(this.keyHandlerKeys_){for(var e=0,i=this.keyHandlerKeys_.length;e<i;++e)g(this.keyHandlerKeys_[e]);this.keyHandlerKeys_=null}if(t){t.appendChild(this.viewport_);var r=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.keyHandlerKeys_=[S(r,R.KEYDOWN,this.handleBrowserEvent,this),S(r,R.KEYPRESS,this.handleBrowserEvent,this)];if(!this.handleResize_){this.handleResize_=this.updateSize.bind(this);addEventListener(R.RESIZE,this.handleResize_,!1)}}else{this.renderer_.removeLayerRenderers();si(this.viewport_);if(void 0!==this.handleResize_){removeEventListener(R.RESIZE,this.handleResize_,!1);this.handleResize_=void 0}}this.updateSize()};t.prototype.handleTileChange_=function(){this.render()};t.prototype.handleViewPropertyChanged_=function(){this.render()};t.prototype.handleViewChanged_=function(){if(this.viewPropertyListenerKey_){g(this.viewPropertyListenerKey_);this.viewPropertyListenerKey_=null}if(this.viewChangeListenerKey_){g(this.viewChangeListenerKey_);this.viewChangeListenerKey_=null}var t=this.getView();if(t){this.viewport_.setAttribute("data-view",St(t));this.viewPropertyListenerKey_=S(t,l.PROPERTYCHANGE,this.handleViewPropertyChanged_,this);this.viewChangeListenerKey_=S(t,R.CHANGE,this.handleViewPropertyChanged_,this)}this.render()};t.prototype.handleLayerGroupChanged_=function(){if(this.layerGroupPropertyListenerKeys_){this.layerGroupPropertyListenerKeys_.forEach(g);this.layerGroupPropertyListenerKeys_=null}var t=this.getLayerGroup();t&&(this.layerGroupPropertyListenerKeys_=[S(t,l.PROPERTYCHANGE,this.render,this),S(t,R.CHANGE,this.render,this)]);this.render()};t.prototype.isRendered=function(){return!!this.frameState_};t.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_);this.animationDelay_()};t.prototype.render=function(){void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))};t.prototype.removeControl=function(t){return this.getControls().remove(t)};t.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)};t.prototype.removeLayer=function(t){return this.getLayerGroup().getLayers().remove(t)};t.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)};t.prototype.renderFrame_=function(t){var e,i=this.getSize(),r=this.getView(),o=[1/0,1/0,-1/0,-1/0],n=this.frameState_,s=null;if(void 0!==i&&zs(i)&&r&&r.isDef()){for(var a=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=this.getLayerGroup().getLayerStatesArray(),h={},u=0,c=l.length;u<c;++u)h[St(l[u].layer)]=l[u];e=r.getState(this.pixelRatio_);s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:o,focus:this.focus_?this.focus_:e.center,index:this.frameIndex_++,layerStates:h,layerStatesArray:l,pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:e,viewHints:a,wantedTiles:{}}}s&&(s.extent=ut(e.center,e.resolution,e.rotation,s.size,o));this.frameState_=s;this.renderer_.renderFrame(s);if(s){s.animate&&this.render();Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions);if(n){if(!this.previousExtent_||!gt(this.previousExtent_)&&!$(s.extent,this.previousExtent_)){this.dispatchEvent(new wn(ys.MOVESTART,this,n));this.previousExtent_=W(this.previousExtent_)}}if(this.previousExtent_&&!s.viewHints[bs.ANIMATING]&&!s.viewHints[bs.INTERACTING]&&!$(s.extent,this.previousExtent_)){this.dispatchEvent(new wn(ys.MOVEEND,this,s));j(s.extent,this.previousExtent_)}}this.dispatchEvent(new wn(ys.POSTRENDER,this,s));setTimeout(this.handlePostRender.bind(this),0)};t.prototype.setLayerGroup=function(t){this.set(vs.LAYERGROUP,t)};t.prototype.setSize=function(t){this.set(vs.SIZE,t)};t.prototype.setTarget=function(t){this.set(vs.TARGET,t)};t.prototype.setView=function(t){this.set(vs.VIEW,t)};t.prototype.skipFeature=function(t){var e=St(t).toString();this.skippedFeatureUids_[e]=!0;this.render()};t.prototype.updateSize=function(){var t=this.getTargetElement();if(t){var e=getComputedStyle(t);this.setSize([t.offsetWidth-parseFloat(e.borderLeftWidth)-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)-parseFloat(e.borderRightWidth),t.offsetHeight-parseFloat(e.borderTopWidth)-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom)-parseFloat(e.borderBottomWidth)])}else this.setSize(void 0)};t.prototype.unskipFeature=function(t){var e=St(t).toString();delete this.skippedFeatureUids_[e];this.render()};return t}(w);var Zs=function(e){function t(t){e.call(this);this.element=t.element?t.element:null;this.target_=null;this.map_=null;this.listenerKeys=[];this.render=t.render?t.render:L;t.target&&this.setTarget(t.target)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.disposeInternal=function(){si(this.element);e.prototype.disposeInternal.call(this)};t.prototype.getMap=function(){return this.map_};t.prototype.setMap=function(t){this.map_&&si(this.element);for(var e=0,i=this.listenerKeys.length;e<i;++e)g(this.listenerKeys[e]);this.listenerKeys.length=0;this.map_=t;if(this.map_){(this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element);this.render!==L&&this.listenerKeys.push(S(t,ys.POSTRENDER,this.render,this));t.render()}};t.prototype.setTarget=function(t){this.target_="string"==typeof t?document.getElementById(t):t};return t}(w),qs=function(r){function t(t){var e=T({},t);delete e.source;r.call(this,e);this.mapPrecomposeKey_=null;this.mapRenderKey_=null;this.sourceChangeKey_=null;t.map&&this.setMap(t.map);S(this,P(js.SOURCE),this.handleSourcePropertyChange_,this);var i=t.source?t.source:null;this.setSource(i)}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getLayersArray=function(t){var e=t||[];e.push(this);return e};t.prototype.getLayerStatesArray=function(t){var e=t||[];e.push(this.getLayerState());return e};t.prototype.getSource=function(){return this.get(js.SOURCE)||null};t.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():Ys.UNDEFINED};t.prototype.handleSourceChange_=function(){this.changed()};t.prototype.handleSourcePropertyChange_=function(){if(this.sourceChangeKey_){g(this.sourceChangeKey_);this.sourceChangeKey_=null}var t=this.getSource();t&&(this.sourceChangeKey_=S(t,R.CHANGE,this.handleSourceChange_,this));this.changed()};t.prototype.setMap=function(t){if(this.mapPrecomposeKey_){g(this.mapPrecomposeKey_);this.mapPrecomposeKey_=null}t||this.changed();if(this.mapRenderKey_){g(this.mapRenderKey_);this.mapRenderKey_=null}if(t){this.mapPrecomposeKey_=S(t,ln.PRECOMPOSE,function(t){var e=this.getLayerState();e.managed=!1;void 0===this.getZIndex()&&(e.zIndex=1/0);t.frameState.layerStatesArray.push(e);t.frameState.layerStates[St(this)]=e},this);this.mapRenderKey_=S(this,R.CHANGE,t.render,t);this.changed()}};t.prototype.setSource=function(t){this.set(js.SOURCE,t)};return t}(Us);function Js(t,e){return t.visible&&e>=t.minResolution&&e<t.maxResolution}var Qs=function(u){function t(t){var e=t||{};u.call(this,{element:document.createElement("div"),render:e.render||$s,target:e.target});this.ulElement_=document.createElement("ul");this.collapsed_=void 0===e.collapsed||e.collapsed;this.collapsible_=void 0===e.collapsible||e.collapsible;this.collapsible_||(this.collapsed_=!1);var i=void 0!==e.className?e.className:"ol-attribution",r=void 0!==e.tipLabel?e.tipLabel:"Attributions",o=void 0!==e.collapseLabel?e.collapseLabel:"»";if("string"==typeof o){this.collapseLabel_=document.createElement("span");this.collapseLabel_.textContent=o}else this.collapseLabel_=o;var n=void 0!==e.label?e.label:"i";if("string"==typeof n){this.label_=document.createElement("span");this.label_.textContent=n}else this.label_=n;var s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button");a.title=r;a.appendChild(s);S(a,R.CLICK,this.handleClick_,this);var l=i+" "+ki+" "+Ui+(this.collapsed_&&this.collapsible_?" "+Yi:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=l;h.appendChild(this.ulElement_);h.appendChild(a);this.renderedAttributions_=[];this.renderedVisible_=!0}u&&(t.__proto__=u);((t.prototype=Object.create(u&&u.prototype)).constructor=t).prototype.getSourceAttributions_=function(t){for(var e={},i=[],r=t.layerStatesArray,o=t.viewState.resolution,n=0,s=r.length;n<s;++n){var a=r[n];if(Js(a,o)){var l=a.layer.getSource();if(l){var h=l.getAttributions();if(h){var u=h(t);if(u)if(Array.isArray(u)){for(var c=0,p=u.length;c<p;++c)if(!(u[c]in e)){i.push(u[c]);e[u[c]]=!0}}else if(!(u in e)){i.push(u);e[u]=!0}}}}}return i};t.prototype.updateElement_=function(t){if(t){var e=this.getSourceAttributions_(t),i=0<e.length;if(this.renderedVisible_!=i){this.element.style.display=i?"":"none";this.renderedVisible_=i}if(!Ar(e,this.renderedAttributions_)){ai(this.ulElement_);for(var r=0,o=e.length;r<o;++r){var n=document.createElement("li");n.innerHTML=e[r];this.ulElement_.appendChild(n)}this.renderedAttributions_=e}}else if(this.renderedVisible_){this.element.style.display="none";this.renderedVisible_=!1}};t.prototype.handleClick_=function(t){t.preventDefault();this.handleToggle_()};t.prototype.handleToggle_=function(){this.element.classList.toggle(Yi);this.collapsed_?ni(this.collapseLabel_,this.label_):ni(this.label_,this.collapseLabel_);this.collapsed_=!this.collapsed_};t.prototype.getCollapsible=function(){return this.collapsible_};t.prototype.setCollapsible=function(t){if(this.collapsible_!==t){this.collapsible_=t;this.element.classList.toggle("ol-uncollapsible");!t&&this.collapsed_&&this.handleToggle_()}};t.prototype.setCollapsed=function(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()};t.prototype.getCollapsed=function(){return this.collapsed_};return t}(Zs);function $s(t){this.updateElement_(t.frameState)}var ta=function(l){function t(t){var e=t||{};l.call(this,{element:document.createElement("div"),render:e.render||ea,target:e.target});var i=void 0!==e.className?e.className:"ol-rotate",r=void 0!==e.label?e.label:"⇧";this.label_=null;if("string"==typeof r){this.label_=document.createElement("span");this.label_.className="ol-compass";this.label_.textContent=r}else{this.label_=r;this.label_.classList.add("ol-compass")}var o=e.tipLabel?e.tipLabel:"Reset rotation",n=document.createElement("button");n.className=i+"-reset";n.setAttribute("type","button");n.title=o;n.appendChild(this.label_);S(n,R.CLICK,this.handleClick_,this);var s=i+" "+ki+" "+Ui,a=this.element;a.className=s;a.appendChild(n);this.callResetNorth_=e.resetNorth?e.resetNorth:void 0;this.duration_=void 0!==e.duration?e.duration:250;this.autoHide_=void 0===e.autoHide||e.autoHide;this.rotation_=void 0;this.autoHide_&&this.element.classList.add(Di)}l&&(t.__proto__=l);((t.prototype=Object.create(l&&l.prototype)).constructor=t).prototype.handleClick_=function(t){t.preventDefault();void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()};t.prototype.resetNorth_=function(){var t=this.getMap().getView();t&&void 0!==t.getRotation()&&(0<this.duration_?t.animate({rotation:0,duration:this.duration_,easing:mn}):t.setRotation(0))};return t}(Zs);function ea(t){var e=t.frameState;if(e){var i=e.viewState.rotation;if(i!=this.rotation_){var r="rotate("+i+"rad)";if(this.autoHide_){var o=this.element.classList.contains(Di);o||0!==i?o&&0!==i&&this.element.classList.remove(Di):this.element.classList.add(Di)}this.label_.style.msTransform=r;this.label_.style.webkitTransform=r;this.label_.style.transform=r}this.rotation_=i}}var ia=function(p){function t(t){var e=t||{};p.call(this,{element:document.createElement("div"),target:e.target});var i=void 0!==e.className?e.className:"ol-zoom",r=void 0!==e.delta?e.delta:1,o=void 0!==e.zoomInLabel?e.zoomInLabel:"+",n=void 0!==e.zoomOutLabel?e.zoomOutLabel:"−",s=void 0!==e.zoomInTipLabel?e.zoomInTipLabel:"Zoom in",a=void 0!==e.zoomOutTipLabel?e.zoomOutTipLabel:"Zoom out",l=document.createElement("button");l.className=i+"-in";l.setAttribute("type","button");l.title=s;l.appendChild("string"==typeof o?document.createTextNode(o):o);S(l,R.CLICK,this.handleClick_.bind(this,r));var h=document.createElement("button");h.className=i+"-out";h.setAttribute("type","button");h.title=a;h.appendChild("string"==typeof n?document.createTextNode(n):n);S(h,R.CLICK,this.handleClick_.bind(this,-r));var u=i+" "+ki+" "+Ui,c=this.element;c.className=u;c.appendChild(l);c.appendChild(h);this.duration_=void 0!==e.duration?e.duration:250}p&&(t.__proto__=p);((t.prototype=Object.create(p&&p.prototype)).constructor=t).prototype.handleClick_=function(t,e){e.preventDefault();this.zoomByDelta_(t)};t.prototype.zoomByDelta_=function(t){var e=this.getMap().getView();if(e){var i=e.getResolution();if(i){var r=e.constrainResolution(i,t);if(0<this.duration_){e.getAnimating()&&e.cancelAnimations();e.animate({resolution:r,duration:this.duration_,easing:mn})}else e.setResolution(r)}}};return t}(Zs);function ra(t){var e=t||{},i=new F;(void 0===e.zoom||e.zoom)&&i.push(new ia(e.zoomOptions));(void 0===e.rotate||e.rotate)&&i.push(new ta(e.rotateOptions));(void 0===e.attribution||e.attribution)&&i.push(new Qs(e.attributionOptions));return i}var oa={ACTIVE:"active"},na=function(e){function t(t){e.call(this);this.map_=null;this.setActive(!0);this.handleEvent=t.handleEvent}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getActive=function(){return this.get(oa.ACTIVE)};t.prototype.getMap=function(){return this.map_};t.prototype.setActive=function(t){this.set(oa.ACTIVE,t)};t.prototype.setMap=function(t){this.map_=t};return t}(w);function sa(t,e,i){var r=t.getCenter();if(r){var o=t.constrainCenter([r[0]+e[0],r[1]+e[1]]);i?t.animate({duration:i,easing:xn,center:o}):t.setCenter(o)}}function aa(t,e,i,r){la(t,e=t.constrainRotation(e,0),i,r)}function la(t,e,i,r){if(void 0!==e){var o=t.getRotation(),n=t.getCenter();void 0!==o&&n&&0<r?t.animate({rotation:e,anchor:i,duration:r,easing:mn}):t.rotate(e,i)}}function ha(t,e,i,r,o){ca(t,e=t.constrainResolution(e,0,o),i,r)}function ua(t,e,i,r){var o=t.getResolution(),n=t.constrainResolution(o,e,0);if(void 0!==n){var s=t.getResolutions();n=Lt(n,t.getMinResolution()||s[s.length-1],t.getMaxResolution()||s[0])}if(i&&void 0!==n&&n!==o){var a=t.getCenter(),l=t.calculateCenterZoom(n,i);l=t.constrainCenter(l);i=[(n*a[0]-o*l[0])/(n-o),(n*a[1]-o*l[1])/(n-o)]}ca(t,n,i,r)}function ca(t,e,i,r){if(e){var o=t.getResolution(),n=t.getCenter();if(void 0!==o&&n&&e!==o&&r)t.animate({resolution:e,anchor:i,duration:r,easing:mn});else{if(i){var s=t.calculateCenterZoom(e,i);t.setCenter(s)}t.setResolution(e)}}}var pa=function(i){function t(t){i.call(this,{handleEvent:da});var e=t||{};this.delta_=e.delta?e.delta:1;this.duration_=void 0!==e.duration?e.duration:250}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(na);function da(t){var e=!1;if(t.type==On.DBLCLICK){var i=t.originalEvent,r=t.map,o=t.coordinate,n=i.shiftKey?-this.delta_:this.delta_;ua(r.getView(),n,o,this.duration_);t.preventDefault();e=!0}return!e}var fa=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},_a=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},ga=function(t){return t.target.getTargetElement()===document.activeElement},ya=y,va=function(t){var e=t.originalEvent;return 0==e.button&&!(wi&&Li&&e.ctrlKey)},ma=v,Ea=function(t){return"pointermove"==t.type},xa=function(t){return t.type==On.SINGLECLICK},Ta=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Sa=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Ca=function(t){var e=t.originalEvent.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e},Ra=function(t){A(t.pointerEvent,56);return"mouse"==t.pointerEvent.pointerType},Ia=function(t){var e=t.pointerEvent;return e.isPrimary&&0===e.button},wa=L,La=v,Oa=v,Pa=L,ba=function(i){function t(t){var e=t||{};i.call(this,{handleEvent:e.handleEvent||Fa});this.handleDownEvent_=e.handleDownEvent?e.handleDownEvent:Oa;this.handleDragEvent_=e.handleDragEvent?e.handleDragEvent:wa;this.handleMoveEvent_=e.handleMoveEvent?e.handleMoveEvent:Pa;this.handleUpEvent_=e.handleUpEvent?e.handleUpEvent:La;this.handlingDownUpSequence=!1;this.stopDown=e.stopDown?e.stopDown:Aa;this.trackedPointers_={};this.targetPointers=[]}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.updateTrackedPointers_=function(t){if((r=t.type)===On.POINTERDOWN||r===On.POINTERDRAG||r===On.POINTERUP){var e=t.pointerEvent,i=e.pointerId.toString();t.type==On.POINTERUP?delete this.trackedPointers_[i]:t.type==On.POINTERDOWN?this.trackedPointers_[i]=e:i in this.trackedPointers_&&(this.trackedPointers_[i]=e);this.targetPointers=s(this.trackedPointers_)}var r};return t}(na);function Ma(t){for(var e=t.length,i=0,r=0,o=0;o<e;o++){i+=t[o].clientX;r+=t[o].clientY}return[i/e,r/e]}function Fa(t){if(!(t instanceof Pn))return!0;var e=!1;this.updateTrackedPointers_(t);if(this.handlingDownUpSequence){if(t.type==On.POINTERDRAG)this.handleDragEvent_(t);else if(t.type==On.POINTERUP){var i=this.handleUpEvent_(t);this.handlingDownUpSequence=i&&0<this.targetPointers.length}}else if(t.type==On.POINTERDOWN){var r=this.handleDownEvent_(t);r&&t.preventDefault();this.handlingDownUpSequence=r;e=this.stopDown(r)}else t.type==On.POINTERMOVE&&this.handleMoveEvent_(t);return!e}function Aa(t){return t}var Na=function(i){function t(t){i.call(this,{handleDownEvent:ka,handleDragEvent:Da,handleUpEvent:Ga,stopDown:v});var e=t||{};this.kinetic_=e.kinetic;this.lastCentroid=null;this.lastPointersCount_;this.panning_=!1;this.condition_=e.condition?e.condition:Ta;this.noKinetic_=!1}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(ba);function Da(t){if(!this.panning_){this.panning_=!0;this.getMap().getView().setHint(bs.INTERACTING,1)}var e=this.targetPointers,i=Ma(e);if(e.length==this.lastPointersCount_){this.kinetic_&&this.kinetic_.update(i[0],i[1]);if(this.lastCentroid){var r=this.lastCentroid[0]-i[0],o=i[1]-this.lastCentroid[1],n=t.map.getView(),s=[r,o];Ko(s,n.getResolution());Ho(s,n.getRotation());Yo(s,n.getCenter());s=n.constrainCenter(s);n.setCenter(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i;this.lastPointersCount_=e.length}function Ga(t){var e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var r=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),n=i.getCenter(),s=e.getPixelFromCoordinate(n),a=e.getCoordinateFromPixel([s[0]-r*Math.cos(o),s[1]-r*Math.sin(o)]);i.animate({center:i.constrainCenter(a),duration:500,easing:mn})}if(this.panning_){this.panning_=!1;i.setHint(bs.INTERACTING,-1)}return!1}this.kinetic_&&this.kinetic_.begin();return!(this.lastCentroid=null)}function ka(t){if(0<this.targetPointers.length&&this.condition_(t)){var e=t.map.getView();this.lastCentroid=null;e.getAnimating()&&e.setCenter(t.frameState.viewState.center);this.kinetic_&&this.kinetic_.begin();this.noKinetic_=1<this.targetPointers.length;return!0}return!1}var ja=function(i){function t(t){var e=t||{};i.call(this,{handleDownEvent:Ba,handleDragEvent:Ua,handleUpEvent:Ya,stopDown:v});this.condition_=e.condition?e.condition:_a;this.lastAngle_=void 0;this.duration_=void 0!==e.duration?e.duration:250}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(ba);function Ua(t){if(Ra(t)){var e=t.map,i=e.getView();if(i.getConstraints().rotation!==ws){var r=e.getSize(),o=t.pixel,n=Math.atan2(r[1]/2-o[1],o[0]-r[0]/2);if(void 0!==this.lastAngle_){var s=n-this.lastAngle_;la(i,i.getRotation()-s)}this.lastAngle_=n}}}function Ya(t){if(!Ra(t))return!0;var e=t.map.getView();e.setHint(bs.INTERACTING,-1);aa(e,e.getRotation(),void 0,this.duration_);return!1}function Ba(t){if(!Ra(t))return!1;if(va(t)&&this.condition_(t)){t.map.getView().setHint(bs.INTERACTING,1);return!(this.lastAngle_=void 0)}return!1}var Va=function(e){function t(t){e.call(this);this.geometry_=null;this.element_=document.createElement("div");this.element_.style.position="absolute";this.element_.className="ol-box "+t;this.map_=null;this.startPixel_=null;this.endPixel_=null}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.disposeInternal=function(){this.setMap(null)};t.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,i=this.element_.style;i.left=Math.min(t[0],e[0])+"px";i.top=Math.min(t[1],e[1])+"px";i.width=Math.abs(e[0]-t[0])+"px";i.height=Math.abs(e[1]-t[1])+"px"};t.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left=e.top=e.width=e.height="inherit"}this.map_=t;this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)};t.prototype.setPixels=function(t,e){this.startPixel_=t;this.endPixel_=e;this.createOrUpdateGeometry();this.render_()};t.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixel,this.map_);i[4]=i[0].slice();this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new Fo([i])};t.prototype.getGeometry=function(){return this.geometry_};return t}(i),Xa={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"},za=function(r){function t(t,e,i){r.call(this,t);this.coordinate=e;this.mapBrowserEvent=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(m),Wa=function(i){function t(t){i.call(this,{handleDownEvent:qa,handleDragEvent:Ka,handleUpEvent:Za});var e=t||{};this.box_=new Va(e.className||"ol-dragbox");this.minArea_=void 0!==e.minArea?e.minArea:64;this.onBoxEnd_=e.onBoxEnd?e.onBoxEnd:L;this.startPixel_=null;this.condition_=e.condition?e.condition:ya;this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:Ha}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getGeometry=function(){return this.box_.getGeometry()};return t}(ba);function Ha(t,e,i){var r=i[0]-e[0],o=i[1]-e[1];return r*r+o*o>=this.minArea_}function Ka(t){if(Ra(t)){this.box_.setPixels(this.startPixel_,t.pixel);this.dispatchEvent(new za(Xa.BOXDRAG,t.coordinate,t))}}function Za(t){if(!Ra(t))return!0;this.box_.setMap(null);if(this.boxEndCondition_(t,this.startPixel_,t.pixel)){this.onBoxEnd_(t);this.dispatchEvent(new za(Xa.BOXEND,t.coordinate,t))}return!1}function qa(t){if(!Ra(t))return!1;if(va(t)&&this.condition_(t)){this.startPixel_=t.pixel;this.box_.setMap(t.map);this.box_.setPixels(this.startPixel_,this.startPixel_);this.dispatchEvent(new za(Xa.BOXSTART,t.coordinate,t));return!0}return!1}var Ja=function(r){function t(t){var e=t||{},i=e.condition?e.condition:Sa;r.call(this,{condition:i,className:e.className||"ol-dragzoom",onBoxEnd:Qa});this.duration_=void 0!==e.duration?e.duration:200;this.out_=void 0!==e.out&&e.out}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(Wa);function Qa(){var t=this.getMap(),e=t.getView(),i=t.getSize(),r=this.getGeometry().getExtent();if(this.out_){var o=e.calculateExtent(i),n=K([t.getPixelFromCoordinate(st(r)),t.getPixelFromCoordinate(ft(r))]);vt(o,1/e.getResolutionForExtent(n,i));r=o}var s=e.constrainResolution(e.getResolutionForExtent(r,i)),a=lt(r);a=e.constrainCenter(a);e.animate({resolution:s,center:a,duration:this.duration_,easing:mn})}var $a={LEFT:37,UP:38,RIGHT:39,DOWN:40},tl=function(i){function t(t){i.call(this,{handleEvent:el});var e=t||{};this.defaultCondition_=function(t){return Ta(t)&&Ca(t)};this.condition_=void 0!==e.condition?e.condition:this.defaultCondition_;this.duration_=void 0!==e.duration?e.duration:100;this.pixelDelta_=void 0!==e.pixelDelta?e.pixelDelta:128}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(na);function el(t){var e=!1;if(t.type==R.KEYDOWN){var i=t.originalEvent.keyCode;if(this.condition_(t)&&(i==$a.DOWN||i==$a.LEFT||i==$a.RIGHT||i==$a.UP)){var r=t.map.getView(),o=r.getResolution()*this.pixelDelta_,n=0,s=0;i==$a.DOWN?s=-o:i==$a.LEFT?n=-o:i==$a.RIGHT?n=o:s=o;var a=[n,s];Ho(a,r.getRotation());sa(r,a,this.duration_);t.preventDefault();e=!0}}return!e}var il=function(i){function t(t){i.call(this,{handleEvent:rl});var e=t||{};this.condition_=e.condition?e.condition:Ca;this.delta_=e.delta?e.delta:1;this.duration_=void 0!==e.duration?e.duration:100}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(na);function rl(t){var e=!1;if(t.type==R.KEYDOWN||t.type==R.KEYPRESS){var i=t.originalEvent.charCode;if(this.condition_(t)&&(i=="+".charCodeAt(0)||i=="-".charCodeAt(0))){var r=t.map,o=i=="+".charCodeAt(0)?this.delta_:-this.delta_;ua(r.getView(),o,void 0,this.duration_);t.preventDefault();e=!0}}return!e}var nl={TRACKPAD:"trackpad",WHEEL:"wheel"},sl=function(i){function t(t){i.call(this,{handleEvent:al});var e=t||{};this.delta_=0;this.duration_=void 0!==e.duration?e.duration:250;this.timeout_=void 0!==e.timeout?e.timeout:80;this.useAnchor_=void 0===e.useAnchor||e.useAnchor;this.constrainResolution_=e.constrainResolution||!1;this.condition_=e.condition?e.condition:ya;this.lastAnchor_=null;this.startTime_=void 0;this.timeoutId_=void 0;this.mode_=void 0;this.trackpadEventGap_=400;this.trackpadTimeoutId_=void 0;this.trackpadDeltaPerZoom_=300;this.trackpadZoomBuffer_=1.5}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0;this.getMap().getView().setHint(bs.INTERACTING,-1)};t.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();ua(e,-Lt(this.delta_,-1,1),this.lastAnchor_,this.duration_);this.mode_=void 0;this.delta_=0;this.lastAnchor_=null;this.startTime_=void 0;this.timeoutId_=void 0};t.prototype.setMouseAnchor=function(t){(this.useAnchor_=t)||(this.lastAnchor_=null)};return t}(na);function al(t){if(!this.condition_(t))return!0;var e=t.type;if(e!==R.WHEEL&&e!==R.MOUSEWHEEL)return!0;t.preventDefault();var i,r=t.map,o=t.originalEvent;this.useAnchor_&&(this.lastAnchor_=t.coordinate);if(t.type==R.WHEEL){i=o.deltaY;Ri&&o.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(i/=Oi);o.deltaMode===WheelEvent.DOM_DELTA_LINE&&(i*=40)}else if(t.type==R.MOUSEWHEEL){i=-o.wheelDeltaY;Ii&&(i/=3)}if(0===i)return!1;var n=Date.now();void 0===this.startTime_&&(this.startTime_=n);(!this.mode_||n-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(i)<4?nl.TRACKPAD:nl.WHEEL);if(this.mode_===nl.TRACKPAD){var s=r.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):s.setHint(bs.INTERACTING,1);this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);var a=s.getResolution()*Math.pow(2,i/this.trackpadDeltaPerZoom_),l=s.getMinResolution(),h=s.getMaxResolution(),u=0;if(a<l){a=Math.max(a,l/this.trackpadZoomBuffer_);u=1}else if(h<a){a=Math.min(a,h*this.trackpadZoomBuffer_);u=-1}if(this.lastAnchor_){var c=s.calculateCenterZoom(a,this.lastAnchor_);s.setCenter(s.constrainCenter(c))}s.setResolution(a);0===u&&this.constrainResolution_&&s.animate({resolution:s.constrainResolution(a,0<i?-1:1),easing:mn,anchor:this.lastAnchor_,duration:this.duration_});0<u?s.animate({resolution:l,easing:mn,anchor:this.lastAnchor_,duration:500}):u<0&&s.animate({resolution:h,easing:mn,anchor:this.lastAnchor_,duration:500});this.startTime_=n;return!1}this.delta_+=i;var p=Math.max(this.timeout_-(n-this.startTime_),0);clearTimeout(this.timeoutId_);this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),p);return!1}var ll=function(i){function t(t){i.call(this,{handleDownEvent:cl,handleDragEvent:hl,handleUpEvent:ul,stopDown:v});var e=t||{};this.anchor_=null;this.lastAngle_=void 0;this.rotating_=!1;this.rotationDelta_=0;this.threshold_=void 0!==e.threshold?e.threshold:.3;this.duration_=void 0!==e.duration?e.duration:250}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(ba);function hl(t){var e=0,i=this.targetPointers[0],r=this.targetPointers[1],o=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(void 0!==this.lastAngle_){var n=o-this.lastAngle_;this.rotationDelta_+=n;!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0);e=n}this.lastAngle_=o;var s=t.map,a=s.getView();if(a.getConstraints().rotation!==ws){var l=s.getViewport().getBoundingClientRect(),h=Ma(this.targetPointers);h[0]-=l.left;h[1]-=l.top;this.anchor_=s.getCoordinateFromPixel(h);if(this.rotating_){var u=a.getRotation();s.render();la(a,u+e,this.anchor_)}}}function ul(t){if(this.targetPointers.length<2){var e=t.map.getView();e.setHint(bs.INTERACTING,-1);if(this.rotating_){aa(e,e.getRotation(),this.anchor_,this.duration_)}return!1}return!0}function cl(t){if(2<=this.targetPointers.length){var e=t.map;this.anchor_=null;this.lastAngle_=void 0;this.rotating_=!1;this.rotationDelta_=0;this.handlingDownUpSequence||e.getView().setHint(bs.INTERACTING,1);return!0}return!1}var pl=function(i){function t(t){i.call(this,{handleDownEvent:_l,handleDragEvent:dl,handleUpEvent:fl,stopDown:v});var e=t||{};this.constrainResolution_=e.constrainResolution||!1;this.anchor_=null;this.duration_=void 0!==e.duration?e.duration:400;this.lastDistance_=void 0;this.lastScaleDelta_=1}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(ba);function dl(t){var e=1,i=this.targetPointers[0],r=this.targetPointers[1],o=i.clientX-r.clientX,n=i.clientY-r.clientY,s=Math.sqrt(o*o+n*n);void 0!==this.lastDistance_&&(e=this.lastDistance_/s);this.lastDistance_=s;var a=t.map,l=a.getView(),h=l.getResolution(),u=l.getMaxResolution(),c=l.getMinResolution(),p=h*e;if(u<p){e=u/h;p=u}else if(p<c){e=c/h;p=c}1!=e&&(this.lastScaleDelta_=e);var d=a.getViewport().getBoundingClientRect(),f=Ma(this.targetPointers);f[0]-=d.left;f[1]-=d.top;this.anchor_=a.getCoordinateFromPixel(f);a.render();ca(l,p,this.anchor_)}function fl(t){if(this.targetPointers.length<2){var e=t.map.getView();e.setHint(bs.INTERACTING,-1);var i=e.getResolution();if(this.constrainResolution_||i<e.getMinResolution()||i>e.getMaxResolution()){var r=this.lastScaleDelta_-1;ha(e,i,this.anchor_,this.duration_,r)}return!1}return!0}function _l(t){if(2<=this.targetPointers.length){var e=t.map;this.anchor_=null;this.lastDistance_=void 0;this.lastScaleDelta_=1;this.handlingDownUpSequence||e.getView().setHint(bs.INTERACTING,1);return!0}return!1}var gl="addfeatures",yl=function(o){function t(t,e,i,r){o.call(this,t);this.features=i;this.file=e;this.projection=r}o&&(t.__proto__=o);return(t.prototype=Object.create(o&&o.prototype)).constructor=t}(m),vl=function(i){function t(t){var e=t||{};i.call(this,{handleEvent:y});this.formatConstructors_=e.formatConstructors?e.formatConstructors:[];this.projection_=e.projection?ye(e.projection):null;this.dropListenKeys_=null;this.source_=e.source||null;this.target=e.target?e.target:null}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.handleResult_=function(t,e){var i=e.target.result,r=this.getMap(),o=this.projection_;if(!o){o=r.getView().getProjection()}for(var n=this.formatConstructors_,s=[],a=0,l=n.length;a<l;++a){var h=new n[a];if((s=this.tryReadFeatures_(h,i,{featureProjection:o}))&&0<s.length)break}if(this.source_){this.source_.clear();this.source_.addFeatures(s)}this.dispatchEvent(new yl(gl,t,s,o))};t.prototype.registerListeners_=function(){var t=this.getMap();if(t){var e=this.target?this.target:t.getViewport();this.dropListenKeys_=[S(e,R.DROP,ml,this),S(e,R.DRAGENTER,El,this),S(e,R.DRAGOVER,El,this),S(e,R.DROP,El,this)]}};t.prototype.setActive=function(t){i.prototype.setActive.call(this,t);t?this.registerListeners_():this.unregisterListeners_()};t.prototype.setMap=function(t){this.unregisterListeners_();i.prototype.setMap.call(this,t);this.getActive()&&this.registerListeners_()};t.prototype.tryReadFeatures_=function(t,e,i){try{return t.readFeatures(e,i)}catch(t){return null}};t.prototype.unregisterListeners_=function(){if(this.dropListenKeys_){this.dropListenKeys_.forEach(g);this.dropListenKeys_=null}};return t}(na);function ml(t){for(var e=t.dataTransfer.files,i=0,r=e.length;i<r;++i){var o=e.item(i),n=new FileReader;n.addEventListener(R.LOAD,this.handleResult_.bind(this,o));n.readAsText(o)}}function El(t){t.stopPropagation();t.preventDefault();t.dataTransfer.dropEffect="copy"}var xl=function(i){function t(t){var e=t||{};i.call(this,{handleDownEvent:Cl,handleDragEvent:Tl,handleUpEvent:Sl});this.condition_=e.condition?e.condition:Sa;this.lastAngle_=void 0;this.lastMagnitude_=void 0;this.lastScaleDelta_=0;this.duration_=void 0!==e.duration?e.duration:400}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(ba);function Tl(t){if(Ra(t)){var e=t.map,i=e.getSize(),r=t.pixel,o=r[0]-i[0]/2,n=i[1]/2-r[1],s=Math.atan2(n,o),a=Math.sqrt(o*o+n*n),l=e.getView();if(l.getConstraints().rotation!==ws&&void 0!==this.lastAngle_){var h=s-this.lastAngle_;la(l,l.getRotation()-h)}this.lastAngle_=s;if(void 0!==this.lastMagnitude_){ca(l,this.lastMagnitude_*(l.getResolution()/a))}void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/a);this.lastMagnitude_=a}}function Sl(t){if(!Ra(t))return!0;var e=t.map.getView();e.setHint(bs.INTERACTING,-1);var i=this.lastScaleDelta_-1;aa(e,e.getRotation());ha(e,e.getResolution(),void 0,this.duration_,i);this.lastScaleDelta_=0;return!1}function Cl(t){if(!Ra(t))return!1;if(this.condition_(t)){t.map.getView().setHint(bs.INTERACTING,1);this.lastAngle_=void 0;return!(this.lastMagnitude_=void 0)}return!1}var Rl=function(o){function t(t,e,i){o.call(this);if(void 0!==i&&void 0===e)this.setFlatCoordinates(i,t);else{var r=e||0;this.setCenterAndRadius(t,r,i)}}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.clone=function(){return new t(this.flatCoordinates.slice(),void 0,this.layout)};t.prototype.closestPointXY=function(t,e,i,r){var o=this.flatCoordinates,n=t-o[0],s=e-o[1],a=n*n+s*s;if(a<r){if(0===a)for(var l=0;l<this.stride;++l)i[l]=o[l];else{var h=this.getRadius()/Math.sqrt(a);i[0]=o[0]+h*n;i[1]=o[1]+h*s;for(var u=2;u<this.stride;++u)i[u]=o[u]}i.length=this.stride;return a}return r};t.prototype.containsXY=function(t,e){var i=this.flatCoordinates,r=t-i[0],o=e-i[1];return r*r+o*o<=this.getRadiusSquared_()};t.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)};t.prototype.computeExtent=function(t){var e=this.flatCoordinates,i=e[this.stride]-e[0];return z(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)};t.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())};t.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e};t.prototype.getType=function(){return kt.CIRCLE};t.prototype.intersectsExtent=function(t){if(Rt(t,this.getExtent())){var e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||(t[1]<=e[1]&&t[3]>=e[1]||ot(t,this.intersectsCoordinate,this))}return!1};t.prototype.setCenter=function(t){var e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],r=t.slice();r[e]=r[0]+i;for(var o=1;o<e;++o)r[e+o]=t[o];this.setFlatCoordinates(this.layout,r);this.changed()};t.prototype.setCenterAndRadius=function(t,e,i){this.setLayout(i,t,0);this.flatCoordinates||(this.flatCoordinates=[]);var r=this.flatCoordinates,o=Qr(r,0,t,this.stride);r[o++]=r[0]+e;for(var n=1,s=this.stride;n<s;++n)r[o++]=r[n];r.length=o;this.changed()};t.prototype.getCoordinates=function(){};t.prototype.setCoordinates=function(t,e){};t.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t;this.changed()};return t}(jr);Rl.prototype.transform;var Il=function(h){function r(t,e,i){h.call(this);this.ends_=[];this.maxDelta_=-1;this.maxDeltaRevision_=-1;if(Array.isArray(t[0]))this.setCoordinates(t,e);else if(void 0!==e&&i){this.setFlatCoordinates(e,t);this.ends_=i}else{for(var r=this.getLayout(),o=[],n=[],s=0,a=t.length;s<a;++s){var l=t[s];0===s&&(r=l.getLayout());br(o,l.getFlatCoordinates());n.push(o.length)}this.setFlatCoordinates(r,o);this.ends_=n}}h&&(r.__proto__=h);((r.prototype=Object.create(h&&h.prototype)).constructor=r).prototype.appendLineString=function(t){this.flatCoordinates?br(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice();this.ends_.push(this.flatCoordinates.length);this.changed()};r.prototype.clone=function(){return new r(this.flatCoordinates.slice(),this.layout,this.ends_.slice())};r.prototype.closestPointXY=function(t,e,i,r){if(r<U(this.getExtent(),t,e))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(Hr(this.flatCoordinates,0,this.ends_,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return qr(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,r)};r.prototype.getCoordinateAtM=function(t,e,i){if(this.layout!=kr.XYM&&this.layout!=kr.XYZM||0===this.flatCoordinates.length)return null;var r=void 0!==e&&e,o=void 0!==i&&i;return en(this.flatCoordinates,0,this.ends_,this.stride,t,r,o)};r.prototype.getCoordinates=function(){return ro(this.flatCoordinates,0,this.ends_,this.stride)};r.prototype.getEnds=function(){return this.ends_};r.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new on(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)};r.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,i=this.layout,r=[],o=0,n=0,s=e.length;n<s;++n){var a=e[n],l=new on(t.slice(o,a),i);r.push(l);o=a}return r};r.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,i=0,r=this.ends_,o=this.stride,n=0,s=r.length;n<s;++n){var a=r[n];br(t,$o(e,i,a,o,.5));i=a}return t};r.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];e.length=so(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i);return new r(e,kr.XY,i)};r.prototype.getType=function(){return kt.MULTI_LINE_STRING};r.prototype.intersectsExtent=function(t){return So(this.flatCoordinates,0,this.ends_,this.stride,t)};r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2);this.flatCoordinates||(this.flatCoordinates=[]);var i=to(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1];this.changed()};return r}(jr),wl=function(i){function t(t,e){i.call(this);e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.appendPoint=function(t){this.flatCoordinates?br(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice();this.changed()};t.prototype.clone=function(){return new t(this.flatCoordinates.slice(),this.layout)};t.prototype.closestPointXY=function(t,e,i,r){if(r<U(this.getExtent(),t,e))return r;for(var o=this.flatCoordinates,n=this.stride,s=0,a=o.length;s<a;s+=n){var l=Mt(t,e,o[s],o[s+1]);if(l<r){r=l;for(var h=0;h<n;++h)i[h]=o[s+h];i.length=n}}return r};t.prototype.getCoordinates=function(){return io(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};t.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new fo(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)};t.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,i=this.stride,r=[],o=0,n=t.length;o<n;o+=i){var s=new fo(t.slice(o,o+i),e);r.push(s)}return r};t.prototype.getType=function(){return kt.MULTI_POINT};t.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,i=this.stride,r=0,o=e.length;r<o;r+=i){if(B(t,e[r],e[r+1]))return!0}return!1};t.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=$r(this.flatCoordinates,0,t,this.stride);this.changed()};return t}(jr);function Ll(t,e,i,r){for(var o=[],n=[1/0,1/0,-1/0,-1/0],s=0,a=i.length;s<a;++s){var l=i[s];n=Z(t,e,l[0],r);o.push((n[0]+n[2])/2,(n[1]+n[3])/2);e=l[l.length-1]}return o}var Ol=function(d){function r(t,e,i){d.call(this);this.endss_=[];this.flatInteriorPointsRevision_=-1;this.flatInteriorPoints_=null;this.maxDelta_=-1;this.maxDeltaRevision_=-1;this.orientedRevision_=-1;this.orientedFlatCoordinates_=null;if(!i&&!Array.isArray(t[0])){for(var r=this.getLayout(),o=[],n=[],s=0,a=t.length;s<a;++s){var l=t[s];0===s&&(r=l.getLayout());for(var h=o.length,u=l.getEnds(),c=0,p=u.length;c<p;++c)u[c]+=h;br(o,l.getFlatCoordinates());n.push(u)}e=r;t=o;i=n}if(void 0!==e&&i){this.setFlatCoordinates(e,t);this.endss_=i}else this.setCoordinates(t,e)}d&&(r.__proto__=d);((r.prototype=Object.create(d&&d.prototype)).constructor=r).prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var i=this.flatCoordinates.length;br(this.flatCoordinates,t.getFlatCoordinates());for(var r=0,o=(e=t.getEnds().slice()).length;r<o;++r)e[r]+=i}else{this.flatCoordinates=t.getFlatCoordinates().slice();e=t.getEnds().slice();this.endss_.push()}this.endss_.push(e);this.changed()};r.prototype.clone=function(){for(var t=this.endss_.length,e=new Array(t),i=0;i<t;++i)e[i]=this.endss_[i].slice();return new r(this.flatCoordinates.slice(),this.layout,e)};r.prototype.closestPointXY=function(t,e,i,r){if(r<U(this.getExtent(),t,e))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(Kr(this.flatCoordinates,0,this.endss_,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return Jr(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,r)};r.prototype.containsXY=function(t,e){return vo(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)};r.prototype.getArea=function(){return Xr(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)};r.prototype.getCoordinates=function(t){var e;void 0!==t?Mo(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates;return oo(e,0,this.endss_,this.stride)};r.prototype.getEndss=function(){return this.endss_};r.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=Ll(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Eo(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t);this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_};r.prototype.getInteriorPoints=function(){return new wl(this.getFlatInteriorPoints().slice(),kr.XYM)};r.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;if(Po(t,0,this.endss_,this.stride))this.orientedFlatCoordinates_=t;else{this.orientedFlatCoordinates_=t.slice();this.orientedFlatCoordinates_.length=Mo(this.orientedFlatCoordinates_,0,this.endss_,this.stride)}this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_};r.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];e.length=co(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i);return new r(e,kr.XY,i)};r.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var i=this.endss_[t-1];e=i[i.length-1]}var r=this.endss_[t].slice(),o=r[r.length-1];if(0!==e)for(var n=0,s=r.length;n<s;++n)r[n]-=e;return new Fo(this.flatCoordinates.slice(e,o),this.layout,r)};r.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.endss_,r=[],o=0,n=0,s=i.length;n<s;++n){var a=i[n].slice(),l=a[a.length-1];if(0!==o)for(var h=0,u=a.length;h<u;++h)a[h]-=o;var c=new Fo(e.slice(o,l),t,a);r.push(c);o=l}return r};r.prototype.getType=function(){return kt.MULTI_POLYGON};r.prototype.intersectsExtent=function(t){return Io(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)};r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3);this.flatCoordinates||(this.flatCoordinates=[]);var i=eo(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{var r=i[i.length-1];this.flatCoordinates.length=0===r.length?0:r[r.length-1]}this.changed()};return r}(jr),Pl={IMAGE:"image",VECTOR:"vector"},bl="renderOrder",Ml=function(r){function t(t){var e=t||{},i=T({},e);delete i.style;delete i.renderBuffer;delete i.updateWhileAnimating;delete i.updateWhileInteracting;r.call(this,i);this.declutter_=void 0!==e.declutter&&e.declutter;this.renderBuffer_=void 0!==e.renderBuffer?e.renderBuffer:100;this.style_=null;this.styleFunction_=void 0;this.setStyle(e.style);this.updateWhileAnimating_=void 0!==e.updateWhileAnimating&&e.updateWhileAnimating;this.updateWhileInteracting_=void 0!==e.updateWhileInteracting&&e.updateWhileInteracting;this.renderMode_=e.renderMode||Pl.VECTOR;this.type=In.VECTOR}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getDeclutter=function(){return this.declutter_};t.prototype.setDeclutter=function(t){this.declutter_=t};t.prototype.getRenderBuffer=function(){return this.renderBuffer_};t.prototype.getRenderOrder=function(){return this.get(bl)};t.prototype.getStyle=function(){return this.style_};t.prototype.getStyleFunction=function(){return this.styleFunction_};t.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_};t.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_};t.prototype.setRenderOrder=function(t){this.set(bl,t)};t.prototype.setStyle=function(t){this.style_=void 0!==t?t:Er;this.styleFunction_=null===t?void 0:vr(this.style_);this.changed()};t.prototype.getRenderMode=function(){return this.renderMode_};return t}(qs);Ml.prototype.getSource;var Fl={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};function Al(i,n,s,a){return function(t,e,r){var o=new XMLHttpRequest;o.open("GET","function"==typeof i?i(t,e,r):i,!0);n.getType()==Fl.ARRAY_BUFFER&&(o.responseType="arraybuffer");o.onload=function(t){if(!o.status||200<=o.status&&o.status<300){var e,i=n.getType();i==Fl.JSON||i==Fl.TEXT?e=o.responseText:i==Fl.XML?(e=o.responseXML)||(e=(new DOMParser).parseFromString(o.responseText,"application/xml")):i==Fl.ARRAY_BUFFER&&(e=o.response);e?s.call(this,n.readFeatures(e,{featureProjection:r}),n.readProjection(e),n.getLastExtent()):a.call(this)}else a.call(this)}.bind(this);o.onerror=function(){a.call(this)}.bind(this);o.send()}}function Nl(t,e){return Al(t,e,function(t,e){this instanceof oh&&this.addFeatures(t)},L)}function Dl(t,e){return[[-1/0,-1/0,1/0,1/0]]}var Gl=function(e){function t(t){e.call(this);this.projection_=ye(t.projection);this.attributions_=this.adaptAttributions_(t.attributions);this.loading=!1;this.state_=void 0!==t.state?t.state:Ys.READY;this.wrapX_=void 0!==t.wrapX&&t.wrapX}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.adaptAttributions_=function(e){return e?Array.isArray(e)?function(t){return e}:"function"==typeof e?e:function(t){return[e]}:null};t.prototype.getAttributions=function(){return this.attributions_};t.prototype.getProjection=function(){return this.projection_};t.prototype.getResolutions=function(){};t.prototype.getState=function(){return this.state_};t.prototype.getWrapX=function(){return this.wrapX_};t.prototype.refresh=function(){this.changed()};t.prototype.setAttributions=function(t){this.attributions_=this.adaptAttributions_(t);this.changed()};t.prototype.setState=function(t){this.state_=t;this.changed()};return t}(w);Gl.prototype.forEachFeatureAtCoordinate=L;var kl={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"};"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var jl,Ul=(function(t,e){t.exports=function(){function _(t,e,i,r,o){for(;i<r;){if(600<r-i){var n=r-i+1,s=e-i+1,a=Math.log(n),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(n-l)/n)*(s-n/2<0?-1:1),u=Math.max(i,Math.floor(e-s*l/n+h)),c=Math.min(r,Math.floor(e+(n-s)*l/n+h));_(t,e,u,c,o)}var p=t[e],d=i,f=r;g(t,i,e);0<o(t[r],p)&&g(t,i,r);for(;d<f;){g(t,d,f);d++;f--;for(;o(t[d],p)<0;)d++;for(;0<o(t[f],p);)f--}0===o(t[i],p)?g(t,i,f):g(t,++f,r);f<=e&&(i=f+1);e<=f&&(r=f-1)}}function g(t,e,i){var r=t[e];t[e]=t[i];t[i]=r}function n(t,e){return t<e?-1:e<t?1:0}return function(t,e,i,r,o){_(t,e,i||0,r||t.length-1,o||n)}}()}(jl={exports:{}},jl.exports),jl.exports),Yl=Vl,Bl=Vl;function Vl(t,e){if(!(this instanceof Vl))return new Vl(t,e);this._maxEntries=Math.max(4,t||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));e&&this._initFormat(e);this.clear()}Vl.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!$l(t,e))return i;for(var o,n,s,a,l=[];e;){for(o=0,n=e.children.length;o<n;o++){s=e.children[o];$l(t,a=e.leaf?r(s):s)&&(e.leaf?i.push(s):Ql(t,a)?this._all(s,i):l.push(s))}e=l.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!$l(t,e))return!1;for(var r,o,n,s,a=[];e;){for(r=0,o=e.children.length;r<o;r++){n=e.children[r];if($l(t,s=e.leaf?i(n):n)){if(e.leaf||Ql(t,s))return!0;a.push(n)}}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var o=this.data;this.data=r;r=o}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){t&&this._insert(t,this.data.height-1);return this},clear:function(){this.data=th([]);return this},remove:function(t,e){if(!t)return this;for(var i,r,o,n,s=this.data,a=this.toBBox(t),l=[],h=[];s||l.length;){if(!s){s=l.pop();r=l[l.length-1];i=h.pop();n=!0}if(s.leaf&&-1!==(o=Xl(t,s.children,e))){s.children.splice(o,1);l.push(s);this._condense(l);return this}if(n||s.leaf||!Ql(s,a))if(r){i++;s=r.children[i];n=!1}else s=null;else{l.push(s);h.push(i);i=0;s=(r=s).children[0]}}return this},toBBox:function(t){return t},compareMinX:Kl,compareMinY:Zl,toJSON:function(){return this.data},fromJSON:function(t){this.data=t;return this},_all:function(t,e){for(var i=[];t;){t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children);t=i.pop()}return e},_build:function(t,e,i,r){var o,n=i-e+1,s=this._maxEntries;if(n<=s){zl(o=th(t.slice(e,i+1)),this.toBBox);return o}if(!r){r=Math.ceil(Math.log(n)/Math.log(s));s=Math.ceil(n/Math.pow(s,r-1))}(o=th([])).leaf=!1;o.height=r;var a,l,h,u,c=Math.ceil(n/s),p=c*Math.ceil(Math.sqrt(s));eh(t,e,i,p,this.compareMinX);for(a=e;a<=i;a+=p){eh(t,a,h=Math.min(a+p-1,i),c,this.compareMinY);for(l=a;l<=h;l+=c){u=Math.min(l+c-1,h);o.children.push(this._build(t,l,u,r-1))}}zl(o,this.toBBox);return o},_chooseSubtree:function(t,e,i,r){for(var o,n,s,a,l,h,u,c,p,d;;){r.push(e);if(e.leaf||r.length-1===i)break;u=c=1/0;for(o=0,n=e.children.length;o<n;o++){l=ql(s=e.children[o]);if((h=(p=t,d=s,(Math.max(d.maxX,p.maxX)-Math.min(d.minX,p.minX))*(Math.max(d.maxY,p.maxY)-Math.min(d.minY,p.minY)))-l)<c){c=h;u=l<u?l:u;a=s}else if(h===c&&l<u){u=l;a=s}}e=a||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,o=i?t:r(t),n=[],s=this._chooseSubtree(o,this.data,e,n);s.children.push(t);Hl(s,o);for(;0<=e&&n[e].children.length>this._maxEntries;){this._split(n,e);e--}this._adjustParentBBoxes(o,n,e)},_split:function(t,e){var i=t[e],r=i.children.length,o=this._minEntries;this._chooseSplitAxis(i,o,r);var n=this._chooseSplitIndex(i,o,r),s=th(i.children.splice(n,i.children.length-n));s.height=i.height;s.leaf=i.leaf;zl(i,this.toBBox);zl(s,this.toBBox);e?t[e-1].children.push(s):this._splitRoot(i,s)},_splitRoot:function(t,e){this.data=th([t,e]);this.data.height=t.height+1;this.data.leaf=!1;zl(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,o,n,s,a,l,h,u,c,p,d,f,_,g;l=h=1/0;for(r=e;r<=i-e;r++){o=Wl(t,0,r,this.toBBox);n=Wl(t,r,i,this.toBBox);s=(c=o,p=n,void 0,d=Math.max(c.minX,p.minX),f=Math.max(c.minY,p.minY),_=Math.min(c.maxX,p.maxX),g=Math.min(c.maxY,p.maxY),Math.max(0,_-d)*Math.max(0,g-f));a=ql(o)+ql(n);if(s<l){l=s;u=r;h=a<h?a:h}else if(s===l&&a<h){h=a;u=r}}return u},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:Kl,o=t.leaf?this.compareMinY:Zl;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,o)&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var o,n,s=this.toBBox,a=Wl(t,0,e,s),l=Wl(t,i-e,i,s),h=Jl(a)+Jl(l);for(o=e;o<i-e;o++){n=t.children[o];Hl(a,t.leaf?s(n):n);h+=Jl(a)}for(o=i-e-1;e<=o;o--){n=t.children[o];Hl(l,t.leaf?s(n):n);h+=Jl(l)}return h},_adjustParentBBoxes:function(t,e,i){for(var r=i;0<=r;r--)Hl(e[r],t)},_condense:function(t){for(var e,i=t.length-1;0<=i;i--)0===t[i].children.length?0<i?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():zl(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0]));this.compareMinY=new Function("a","b",e.join(t[1]));this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function Xl(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function zl(t,e){Wl(t,0,t.children.length,e,t)}function Wl(t,e,i,r,o){o||(o=th(null));o.minX=1/0;o.minY=1/0;o.maxX=-1/0;o.maxY=-1/0;for(var n,s=e;s<i;s++){n=t.children[s];Hl(o,t.leaf?r(n):n)}return o}function Hl(t,e){t.minX=Math.min(t.minX,e.minX);t.minY=Math.min(t.minY,e.minY);t.maxX=Math.max(t.maxX,e.maxX);t.maxY=Math.max(t.maxY,e.maxY);return t}function Kl(t,e){return t.minX-e.minX}function Zl(t,e){return t.minY-e.minY}function ql(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Jl(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Ql(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function $l(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function th(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function eh(t,e,i,r,o){for(var n,s=[e,i];s.length;)if(!((i=s.pop())-(e=s.pop())<=r)){n=e+Math.ceil((i-e)/r/2)*r;Ul(t,n,e,i,o);s.push(e,n,n,i)}}Yl.default=Bl;var ih=function(t){this.rbush_=Yl(t,void 0);this.items_={}};ih.prototype.insert=function(t,e){var i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i);this.items_[St(e)]=i};ih.prototype.load=function(t,e){for(var i=new Array(e.length),r=0,o=e.length;r<o;r++){var n=t[r],s=e[r],a={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3],value:s};i[r]=a;this.items_[St(s)]=a}this.rbush_.load(i)};ih.prototype.remove=function(t){var e=St(t),i=this.items_[e];delete this.items_[e];return null!==this.rbush_.remove(i)};ih.prototype.update=function(t,e){var i=this.items_[St(e)];if(!$([i.minX,i.minY,i.maxX,i.maxY],t)){this.remove(e);this.insert(t,e)}};ih.prototype.getAll=function(){return this.rbush_.all().map(function(t){return t.value})};ih.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(t){return t.value})};ih.prototype.forEach=function(t,e){return this.forEach_(this.getAll(),t,e)};ih.prototype.forEachInExtent=function(t,e,i){return this.forEach_(this.getInExtent(t),e,i)};ih.prototype.forEach_=function(t,e,i){for(var r,o=0,n=t.length;o<n;o++)if(r=e.call(i,t[o]))return r;return r};ih.prototype.isEmpty=function(){return Ct(this.items_)};ih.prototype.clear=function(){this.rbush_.clear();this.items_={}};ih.prototype.getExtent=function(t){var e=this.rbush_.data;return z(e.minX,e.minY,e.maxX,e.maxY,t)};ih.prototype.concat=function(t){this.rbush_.load(t.rbush_.all());for(var e in t.items_)this.items_[e]=t.items_[e]};var rh=function(i){function t(t,e){i.call(this,t);this.feature=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(m),oh=function(n){function t(t){var e=t||{};n.call(this,{attributions:e.attributions,projection:void 0,state:Ys.READY,wrapX:void 0===e.wrapX||e.wrapX});this.loader_=L;this.format_=e.format;this.overlaps_=null==e.overlaps||e.overlaps;this.url_=e.url;if(void 0!==e.loader)this.loader_=e.loader;else if(void 0!==this.url_){A(this.format_,7);this.loader_=Nl(this.url_,this.format_)}this.strategy_=void 0!==e.strategy?e.strategy:Dl;var i,r,o=void 0===e.useSpatialIndex||e.useSpatialIndex;this.featuresRtree_=o?new ih:null;this.loadedExtentsRtree_=new ih;this.nullGeometryFeatures_={};this.idIndex_={};this.undefIdIndex_={};this.featureChangeKeys_={};this.featuresCollection_=null;e.features instanceof F?r=(i=e.features).getArray():Array.isArray(e.features)&&(r=e.features);o||void 0!==i||(i=new F(r));void 0!==r&&this.addFeaturesInternal(r);void 0!==i&&this.bindFeaturesCollection_(i)}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.addFeature=function(t){this.addFeatureInternal(t);this.changed()};t.prototype.addFeatureInternal=function(t){var e=St(t).toString();if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var i=t.getGeometry();if(i){var r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new rh(kl.ADDFEATURE,t))}};t.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[S(e,R.CHANGE,this.handleFeatureChange_,this),S(e,l.PROPERTYCHANGE,this.handleFeatureChange_,this)]};t.prototype.addToIndex_=function(t,e){var i=!0,r=e.getId();if(void 0!==r)r.toString()in this.idIndex_?i=!1:this.idIndex_[r.toString()]=e;else{A(!(t in this.undefIdIndex_),30);this.undefIdIndex_[t]=e}return i};t.prototype.addFeatures=function(t){this.addFeaturesInternal(t);this.changed()};t.prototype.addFeaturesInternal=function(t){for(var e=[],i=[],r=[],o=0,n=t.length;o<n;o++){var s=t[o],a=St(s).toString();this.addToIndex_(a,s)&&i.push(s)}for(var l=0,h=i.length;l<h;l++){var u=i[l],c=St(u).toString();this.setupChangeEvents_(c,u);var p=u.getGeometry();if(p){var d=p.getExtent();e.push(d);r.push(u)}else this.nullGeometryFeatures_[c]=u}this.featuresRtree_&&this.featuresRtree_.load(e,r);for(var f=0,_=i.length;f<_;f++)this.dispatchEvent(new rh(kl.ADDFEATURE,i[f]))};t.prototype.bindFeaturesCollection_=function(e){var i=!1;S(this,kl.ADDFEATURE,function(t){if(!i){i=!0;e.push(t.feature);i=!1}});S(this,kl.REMOVEFEATURE,function(t){if(!i){i=!0;e.remove(t.feature);i=!1}});S(e,a.ADD,function(t){if(!i){i=!0;this.addFeature(t.element);i=!1}},this);S(e,a.REMOVE,function(t){if(!i){i=!0;this.removeFeature(t.element);i=!1}},this);this.featuresCollection_=e};t.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_){this.featureChangeKeys_[e].forEach(g)}if(!this.featuresCollection_){this.featureChangeKeys_={};this.idIndex_={};this.undefIdIndex_={}}}else if(this.featuresRtree_){this.featuresRtree_.forEach(this.removeFeatureInternal,this);for(var i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear();this.featuresRtree_&&this.featuresRtree_.clear();this.loadedExtentsRtree_.clear();this.nullGeometryFeatures_={};var r=new rh(kl.CLEAR);this.dispatchEvent(r);this.changed()};t.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)};t.prototype.forEachFeatureAtCoordinateDirect=function(e,i){var t=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(t,function(t){return t.getGeometry().intersectsCoordinate(e)?i(t):void 0})};t.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)};t.prototype.forEachFeatureIntersectingExtent=function(i,r){return this.forEachFeatureInExtent(i,function(t){if(t.getGeometry().intersectsExtent(i)){var e=r(t);if(e)return e}})};t.prototype.getFeaturesCollection=function(){return this.featuresCollection_};t.prototype.getFeatures=function(){var t;if(this.featuresCollection_)t=this.featuresCollection_.getArray();else if(this.featuresRtree_){t=this.featuresRtree_.getAll();Ct(this.nullGeometryFeatures_)||br(t,s(this.nullGeometryFeatures_))}return t};t.prototype.getFeaturesAtCoordinate=function(t){var e=[];this.forEachFeatureAtCoordinateDirect(t,function(t){e.push(t)});return e};t.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_.getInExtent(t)};t.prototype.getClosestFeatureToCoordinate=function(t,e){var o=t[0],n=t[1],s=null,a=[NaN,NaN],l=1/0,h=[-1/0,-1/0,1/0,1/0],u=e||y;this.featuresRtree_.forEachInExtent(h,function(t){if(u(t)){var e=t.getGeometry(),i=l;if((l=e.closestPointXY(o,n,a,l))<i){s=t;var r=Math.sqrt(l);h[0]=o-r;h[1]=n-r;h[2]=o+r;h[3]=n+r}}});return s};t.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)};t.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null};t.prototype.getFormat=function(){return this.format_};t.prototype.getOverlaps=function(){return this.overlaps_};t.prototype.getResolutions=function(){};t.prototype.getUrl=function(){return this.url_};t.prototype.handleFeatureChange_=function(t){var e=t.target,i=St(e).toString(),r=e.getGeometry();if(r){var o=r.getExtent();if(i in this.nullGeometryFeatures_){delete this.nullGeometryFeatures_[i];this.featuresRtree_&&this.featuresRtree_.insert(o,e)}else this.featuresRtree_&&this.featuresRtree_.update(o,e)}else if(!(i in this.nullGeometryFeatures_)){this.featuresRtree_&&this.featuresRtree_.remove(e);this.nullGeometryFeatures_[i]=e}var n=e.getId();if(void 0!==n){var s=n.toString();if(i in this.undefIdIndex_){delete this.undefIdIndex_[i];this.idIndex_[s]=e}else if(this.idIndex_[s]!==e){this.removeFromIdIndex_(e);this.idIndex_[s]=e}}else if(!(i in this.undefIdIndex_)){this.removeFromIdIndex_(e);this.undefIdIndex_[i]=e}this.changed();this.dispatchEvent(new rh(kl.CHANGEFEATURE,e))};t.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:St(t).toString()in this.undefIdIndex_};t.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&Ct(this.nullGeometryFeatures_)};t.prototype.loadFeatures=function(t,r,o){var n=this,s=this.loadedExtentsRtree_,a=this.strategy_(t,r);this.loading=!1;for(var e=function(t,e){var i=a[t];if(!s.forEachInExtent(i,function(t){return Q(t.extent,i)})){n.loader_.call(n,i,r,o);s.insert(i,{extent:i.slice()});n.loading=!0}},i=0,l=a.length;i<l;++i)e(i)};t.prototype.removeLoadedExtent=function(e){var i,t=this.loadedExtentsRtree_;t.forEachInExtent(e,function(t){if($(t.extent,e)){i=t;return!0}});i&&t.remove(i)};t.prototype.removeFeature=function(t){var e=St(t).toString();e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);this.removeFeatureInternal(t);this.changed()};t.prototype.removeFeatureInternal=function(t){var e=St(t).toString();this.featureChangeKeys_[e].forEach(g);delete this.featureChangeKeys_[e];var i=t.getId();void 0!==i?delete this.idIndex_[i.toString()]:delete this.undefIdIndex_[e];this.dispatchEvent(new rh(kl.REMOVEFEATURE,t))};t.prototype.removeFromIdIndex_=function(t){var e=!1;for(var i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i];e=!0;break}return e};t.prototype.setLoader=function(t){this.loader_=t};return t}(Gl),nh={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},sh="drawstart",ah="drawend",lh=function(i){function t(t,e){i.call(this,t);this.feature=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(m),hh=function(n){function t(t){n.call(this,{handleDownEvent:ch,handleEvent:uh,handleUpEvent:ph,stopDown:v});this.shouldHandle_=!1;this.downPx_=null;this.downTimeout_;this.lastDragTime_;this.freehand_=!1;this.source_=t.source?t.source:null;this.features_=t.features?t.features:null;this.snapTolerance_=t.snapTolerance?t.snapTolerance:12;this.type_=t.type;this.mode_=function(t){var e;t===kt.POINT||t===kt.MULTI_POINT?e=nh.POINT:t===kt.LINE_STRING||t===kt.MULTI_LINE_STRING?e=nh.LINE_STRING:t===kt.POLYGON||t===kt.MULTI_POLYGON?e=nh.POLYGON:t===kt.CIRCLE&&(e=nh.CIRCLE);return e}(this.type_);this.stopClick_=!!t.stopClick;this.minPoints_=t.minPoints?t.minPoints:this.mode_===nh.POLYGON?3:2;this.maxPoints_=t.maxPoints?t.maxPoints:1/0;this.finishCondition_=t.finishCondition?t.finishCondition:y;var i,e=t.geometryFunction;if(!e)if(this.type_===kt.CIRCLE)e=function(t,e){var i=e||new Rl([NaN,NaN]),r=Zo(t[0],t[1]);i.setCenterAndRadius(t[0],Math.sqrt(r));return i};else{var r,o=this.mode_;o===nh.POINT?r=fo:o===nh.LINE_STRING?r=on:o===nh.POLYGON&&(r=Fo);e=function(t,e){var i=e;i?o===nh.POLYGON?t[0].length?i.setCoordinates([t[0].concat([t[0][0]])]):i.setCoordinates([]):i.setCoordinates(t):i=new r(t);return i}}this.geometryFunction_=e;this.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500;this.finishCoordinate_=null;this.sketchFeature_=null;this.sketchPoint_=null;this.sketchCoords_=null;this.sketchLine_=null;this.sketchLineCoords_=null;this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36;this.overlay_=new Ml({source:new oh({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:(i=xr(),function(t,e){return i[t.getGeometry().getType()]}),updateWhileInteracting:!0});this.geometryName_=t.geometryName;this.condition_=t.condition?t.condition:Ta;this.freehandCondition_;t.freehand?this.freehandCondition_=ya:this.freehandCondition_=t.freehandCondition?t.freehandCondition:Sa;S(this,P(oa.ACTIVE),this.updateState_,this)}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.setMap=function(t){n.prototype.setMap.call(this,t);this.updateState_()};t.prototype.getOverlay=function(){return this.overlay_};t.prototype.handlePointerMove_=function(t){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,i=t.pixel,r=e[0]-i[0],o=e[1]-i[1],n=r*r+o*o;this.shouldHandle_=this.freehand_?n>this.squaredClickTolerance_:n<=this.squaredClickTolerance_;if(!this.shouldHandle_)return!0}this.finishCoordinate_?this.modifyDrawing_(t):this.createOrUpdateSketchPoint_(t);return!0};t.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var i=!1,r=[this.finishCoordinate_];if(this.mode_===nh.LINE_STRING)i=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===nh.POLYGON){i=this.sketchCoords_[0].length>this.minPoints_;r=[this.sketchCoords_[0][0],this.sketchCoords_[0][this.sketchCoords_[0].length-2]]}if(i)for(var o=t.map,n=0,s=r.length;n<s;n++){var a=r[n],l=o.getPixelFromCoordinate(a),h=t.pixel,u=h[0]-l[0],c=h[1]-l[1],p=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(u*u+c*c)<=p){this.finishCoordinate_=a;break}}}return e};t.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();if(this.sketchPoint_){this.sketchPoint_.getGeometry().setCoordinates(e)}else{this.sketchPoint_=new Sr(new fo(e));this.updateSketchFeatures_()}};t.prototype.startDrawing_=function(t){var e=t.coordinate;this.finishCoordinate_=e;if(this.mode_===nh.POINT)this.sketchCoords_=e.slice();else if(this.mode_===nh.POLYGON){this.sketchCoords_=[[e.slice(),e.slice()]];this.sketchLineCoords_=this.sketchCoords_[0]}else this.sketchCoords_=[e.slice(),e.slice()];this.sketchLineCoords_&&(this.sketchLine_=new Sr(new on(this.sketchLineCoords_)));var i=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new Sr;this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_);this.sketchFeature_.setGeometry(i);this.updateSketchFeatures_();this.dispatchEvent(new lh(sh,this.sketchFeature_))};t.prototype.modifyDrawing_=function(t){var e,i,r,o=t.coordinate,n=this.sketchFeature_.getGeometry();if(this.mode_===nh.POINT)i=this.sketchCoords_;else if(this.mode_===nh.POLYGON){i=(e=this.sketchCoords_[0])[e.length-1];this.atFinish_(t)&&(o=this.finishCoordinate_.slice())}else i=(e=this.sketchCoords_)[e.length-1];i[0]=o[0];i[1]=o[1];this.geometryFunction_(this.sketchCoords_,n);if(this.sketchPoint_){this.sketchPoint_.getGeometry().setCoordinates(o)}if(n instanceof Fo&&this.mode_!==nh.POLYGON){this.sketchLine_||(this.sketchLine_=new Sr);var s=n.getLinearRing(0);if(r=this.sketchLine_.getGeometry()){r.setFlatCoordinates(s.getLayout(),s.getFlatCoordinates());r.changed()}else{r=new on(s.getFlatCoordinates(),s.getLayout());this.sketchLine_.setGeometry(r)}}else this.sketchLineCoords_&&(r=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()};t.prototype.addToDrawing_=function(t){var e,i,r=t.coordinate,o=this.sketchFeature_.getGeometry();if(this.mode_===nh.LINE_STRING){this.finishCoordinate_=r.slice();(i=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0);i.push(r.slice());this.geometryFunction_(i,o)}else if(this.mode_===nh.POLYGON){(i=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0);i.push(r.slice());e&&(this.finishCoordinate_=i[0]);this.geometryFunction_(this.sketchCoords_,o)}this.updateSketchFeatures_();e&&this.finishDrawing()};t.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry();if(this.mode_===nh.LINE_STRING){(t=this.sketchCoords_).splice(-2,1);this.geometryFunction_(t,e);2<=t.length&&(this.finishCoordinate_=t[t.length-2].slice())}else if(this.mode_===nh.POLYGON){(t=this.sketchCoords_[0]).splice(-2,1);this.sketchLine_.getGeometry().setCoordinates(t);this.geometryFunction_(this.sketchCoords_,e)}0===t.length&&(this.finishCoordinate_=null);this.updateSketchFeatures_()}};t.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,i=t.getGeometry();if(this.mode_===nh.LINE_STRING){e.pop();this.geometryFunction_(e,i)}else if(this.mode_===nh.POLYGON){e[0].pop();this.geometryFunction_(e,i);e=i.getCoordinates()}this.type_===kt.MULTI_POINT?t.setGeometry(new wl([e])):this.type_===kt.MULTI_LINE_STRING?t.setGeometry(new Il([e])):this.type_===kt.MULTI_POLYGON&&t.setGeometry(new Ol([e]));this.dispatchEvent(new lh(ah,t));this.features_&&this.features_.push(t);this.source_&&this.source_.addFeature(t)}};t.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;if(t){this.sketchFeature_=null;this.sketchPoint_=null;this.sketchLine_=null;this.overlay_.getSource().clear(!0)}return t};t.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t;this.sketchCoords_=e.getCoordinates();var i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice();this.sketchCoords_.push(i.slice());this.updateSketchFeatures_();this.dispatchEvent(new lh(sh,this.sketchFeature_))};t.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_);this.sketchLine_&&t.push(this.sketchLine_);this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0);e.addFeatures(t)};t.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing_();this.overlay_.setMap(e?t:null)};return t}(ba);function uh(t){t.originalEvent.type===R.CONTEXTMENU&&t.preventDefault();this.freehand_=this.mode_!==nh.POINT&&this.freehandCondition_(t);var e=t.type===On.POINTERMOVE,i=!0;if(!this.freehand_&&this.lastDragTime_&&t.type===On.POINTERDRAG){if(Date.now()-this.lastDragTime_>=this.dragVertexDelay_){this.downPx_=t.pixel;this.shouldHandle_=!this.freehand_;e=!0}else this.lastDragTime_=void 0;if(this.shouldHandle_&&this.downTimeout_){clearTimeout(this.downTimeout_);this.downTimeout_=void 0}}if(this.freehand_&&t.type===On.POINTERDRAG&&null!==this.sketchFeature_){this.addToDrawing_(t);i=!1}else this.freehand_&&t.type===On.POINTERDOWN?i=!1:e?(i=t.type===On.POINTERMOVE)&&this.freehand_?i=this.handlePointerMove_(t):(t.pointerEvent.pointerType==An||t.type===On.POINTERDRAG&&!this.downTimeout_)&&this.handlePointerMove_(t):t.type===On.DBLCLICK&&(i=!1);return Fa.call(this,t)&&i}function ch(t){this.shouldHandle_=!this.freehand_;if(this.freehand_){this.downPx_=t.pixel;this.finishCoordinate_||this.startDrawing_(t);return!0}if(this.condition_(t)){this.lastDragTime_=Date.now();this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new Pn(On.POINTERMOVE,t.map,t.pointerEvent,t.frameState))}.bind(this),this.dragVertexDelay_);this.downPx_=t.pixel;return!0}return!1}function ph(t){var e=!0;if(this.downTimeout_){clearTimeout(this.downTimeout_);this.downTimeout_=void 0}this.handlePointerMove_(t);var i=this.mode_===nh.CIRCLE;if(this.shouldHandle_){if(this.finishCoordinate_)this.freehand_||i?this.finishDrawing():this.atFinish_(t)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t);else{this.startDrawing_(t);this.mode_===nh.POINT&&this.finishDrawing()}e=!1}else if(this.freehand_){this.finishCoordinate_=null;this.abortDrawing_()}!e&&this.stopClick_&&t.stopPropagation();return e}var dh="extentchanged",fh=function(e){function t(t){e.call(this,dh);this.extent=t}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(m),_h=function(o){function t(t){o.call(this,{handleDownEvent:yh,handleDragEvent:vh,handleEvent:gh,handleUpEvent:mh});var i,r,e=t||{};this.extent_=null;this.pointerHandler_=null;this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10;this.snappedToVertex_=!1;this.extentFeature_=null;this.vertexFeature_=null;t||(t={});this.extentOverlay_=new Ml({source:new oh({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.boxStyle?t.boxStyle:(i=xr(),function(t,e){return i[kt.POLYGON]}),updateWhileAnimating:!0,updateWhileInteracting:!0});this.vertexOverlay_=new Ml({source:new oh({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.pointerStyle?t.pointerStyle:(r=xr(),function(t,e){return r[kt.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0});t.extent&&this.setExtent(t.extent)}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.snapToVertex_=function(t,e){var i,r=e.getCoordinateFromPixel(t),o=this.getExtent();if(o){var n=[[[(i=o)[0],i[1]],[i[0],i[3]]],[[i[0],i[3]],[i[2],i[3]]],[[i[2],i[3]],[i[2],i[1]]],[[i[2],i[1]],[i[0],i[1]]]];n.sort(function(t,e){return Jo(r,t)-Jo(r,e)});var s=n[0],a=Vo(r,s),l=e.getPixelFromCoordinate(a);if(qo(t,l)<=this.pixelTolerance_){var h=e.getPixelFromCoordinate(s[0]),u=e.getPixelFromCoordinate(s[1]),c=Zo(l,h),p=Zo(l,u),d=Math.sqrt(Math.min(c,p));this.snappedToVertex_=d<=this.pixelTolerance_;this.snappedToVertex_&&(a=p<c?s[1]:s[0]);return a}}return null};t.prototype.handlePointerMove_=function(t){var e=t.pixel,i=t.map,r=this.snapToVertex_(e,i);r||(r=i.getCoordinateFromPixel(e));this.createOrUpdatePointerFeature_(r)};t.prototype.createOrUpdateExtentFeature_=function(t){var e=this.extentFeature_;if(e)t?e.setGeometry(No(t)):e.setGeometry(void 0);else{e=new Sr(t?No(t):{});this.extentFeature_=e;this.extentOverlay_.getSource().addFeature(e)}return e};t.prototype.createOrUpdatePointerFeature_=function(t){var e=this.vertexFeature_;if(e){e.getGeometry().setCoordinates(t)}else{e=new Sr(new fo(t));this.vertexFeature_=e;this.vertexOverlay_.getSource().addFeature(e)}return e};t.prototype.setMap=function(t){this.extentOverlay_.setMap(t);this.vertexOverlay_.setMap(t);o.prototype.setMap.call(this,t)};t.prototype.getExtent=function(){return this.extent_};t.prototype.setExtent=function(t){this.extent_=t||null;this.createOrUpdateExtentFeature_(t);this.dispatchEvent(new fh(this.extent_))};return t}(ba);function gh(t){if(!(t instanceof Pn))return!0;t.type!=On.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t);Fa.call(this,t);return!1}function yh(t){var e=t.pixel,i=t.map,r=this.getExtent(),o=this.snapToVertex_(e,i),n=function(t){var e=null,i=null;t[0]==r[0]?e=r[2]:t[0]==r[2]&&(e=r[0]);t[1]==r[1]?i=r[3]:t[1]==r[3]&&(i=r[1]);return null!==e&&null!==i?[e,i]:null};if(o&&r){var s=o[0]==r[0]||o[0]==r[2]?o[0]:null,a=o[1]==r[1]||o[1]==r[3]?o[1]:null;null!==s&&null!==a?this.pointerHandler_=Eh(n(o)):null!==s?this.pointerHandler_=xh(n([s,r[1]]),n([s,r[3]])):null!==a&&(this.pointerHandler_=xh(n([r[0],a]),n([r[2],a])))}else{o=i.getCoordinateFromPixel(e);this.setExtent([o[0],o[1],o[0],o[1]]);this.pointerHandler_=Eh(o)}return!0}function vh(t){if(this.pointerHandler_){var e=t.coordinate;this.setExtent(this.pointerHandler_(e));this.createOrUpdatePointerFeature_(e)}return!0}function mh(t){this.pointerHandler_=null;var e=this.getExtent();e&&0!==nt(e)||this.setExtent(null);return!1}function Eh(e){return function(t){return G([e,t])}}function xh(e,i){return e[0]==i[0]?function(t){return G([e,[t[0],i[1]]])}:e[1]==i[1]?function(t){return G([e,[i[0],t[1]]])}:null}var Th=0,Sh=1,Ch={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"},Rh=function(r){function t(t,e,i){r.call(this,t);this.features=e;this.mapBrowserEvent=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(m),Ih=function(r){function t(t){r.call(this,{handleDownEvent:Lh,handleDragEvent:Oh,handleEvent:bh,handleUpEvent:Ph});this.condition_=t.condition?t.condition:Ia;this.defaultDeleteCondition_=function(t){return fa(t)&&xa(t)};this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_;this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:ya;this.vertexFeature_=null;this.vertexSegments_=null;this.lastPixel_=[0,0];this.ignoreNextSingleClick_=!1;this.modified_=!1;this.rBush_=new ih;this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10;this.snappedToVertex_=!1;this.changingFeature_=!1;this.dragSegments_=[];this.overlay_=new Ml({source:new oh({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:(i=xr(),function(t,e){return i[kt.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0});var i,e;this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_};this.source_=null;if(t.source){this.source_=t.source;e=new F(this.source_.getFeatures());S(this.source_,kl.ADDFEATURE,this.handleSourceAdd_,this);S(this.source_,kl.REMOVEFEATURE,this.handleSourceRemove_,this)}else e=t.features;if(!e)throw new Error("The modify interaction requires features or a source");this.features_=e;this.features_.forEach(this.addFeature_.bind(this));S(this.features_,a.ADD,this.handleFeatureAdd_,this);S(this.features_,a.REMOVE,this.handleFeatureRemove_,this);this.lastPointerEvent_=null}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.addFeature_=function(t){var e=t.getGeometry();e&&e.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[e.getType()].call(this,t,e);var i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i);S(t,R.CHANGE,this.handleFeatureChange_,this)};t.prototype.willModifyFeatures_=function(t){if(!this.modified_){this.modified_=!0;this.dispatchEvent(new Rh(Ch.MODIFYSTART,this.features_,t))}};t.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t);if(this.vertexFeature_&&0===this.features_.getLength()){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}d(t,R.CHANGE,this.handleFeatureChange_,this)};t.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,i=[];t.forEach(function(t){e===t.feature&&i.push(t)});for(var r=i.length-1;0<=r;--r)t.remove(i[r])};t.prototype.setActive=function(t){if(this.vertexFeature_&&!t){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}r.prototype.setActive.call(this,t)};t.prototype.setMap=function(t){this.overlay_.setMap(t);r.prototype.setMap.call(this,t)};t.prototype.getOverlay=function(){return this.overlay_};t.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)};t.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)};t.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)};t.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e);this.addFeature_(e)}};t.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)};t.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),r={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)};t.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,o=i.length;r<o;++r){var n=i[r],s={feature:t,geometry:e,depth:[r],index:r,segment:[n,n]};this.rBush_.insert(e.getExtent(),s)}};t.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,o=i.length-1;r<o;++r){var n=i.slice(r,r+2),s={feature:t,geometry:e,index:r,segment:n};this.rBush_.insert(G(n),s)}};t.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,o=i.length;r<o;++r)for(var n=i[r],s=0,a=n.length-1;s<a;++s){var l=n.slice(s,s+2),h={feature:t,geometry:e,depth:[r],index:s,segment:l};this.rBush_.insert(G(l),h)}};t.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,o=i.length;r<o;++r)for(var n=i[r],s=0,a=n.length-1;s<a;++s){var l=n.slice(s,s+2),h={feature:t,geometry:e,depth:[r],index:s,segment:l};this.rBush_.insert(G(l),h)}};t.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,o=i.length;r<o;++r)for(var n=i[r],s=0,a=n.length;s<a;++s)for(var l=n[s],h=0,u=l.length-1;h<u;++h){var c=l.slice(h,h+2),p={feature:t,geometry:e,depth:[s,r],index:h,segment:c};this.rBush_.insert(G(c),p)}};t.prototype.writeCircleGeometry_=function(t,e){var i=e.getCenter(),r={feature:t,geometry:e,index:Th,segment:[i,i]},o={feature:t,geometry:e,index:Sh,segment:[i,i]},n=[r,o];r.featureSegments=o.featureSegments=n;this.rBush_.insert(H(i),r);this.rBush_.insert(e.getExtent(),o)};t.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),r=0;r<i.length;++r)this.SEGMENT_WRITERS_[i[r].getType()].call(this,t,i[r])};t.prototype.createOrUpdateVertexFeature_=function(t){var e=this.vertexFeature_;if(e){e.getGeometry().setCoordinates(t)}else{e=new Sr(new fo(t));this.vertexFeature_=e;this.overlay_.getSource().addFeature(e)}return e};t.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel;this.handlePointerAtPixel_(t.pixel,t.map)};t.prototype.handlePointerAtPixel_=function(t,e){var i=e.getCoordinateFromPixel(t),r=k(H(i),e.getView().getResolution()*this.pixelTolerance_),o=this.rBush_.getInExtent(r);if(0<o.length){o.sort(function(t,e){return Mh(i,t)-Mh(i,e)});var n=o[0],s=n.segment,a=Fh(i,n),l=e.getPixelFromCoordinate(a),h=qo(t,l);if(h<=this.pixelTolerance_){var u={};if(n.geometry.getType()===kt.CIRCLE&&n.index===Sh){this.snappedToVertex_=!0;this.createOrUpdateVertexFeature_(a)}else{var c=e.getPixelFromCoordinate(s[0]),p=e.getPixelFromCoordinate(s[1]),d=Zo(l,c),f=Zo(l,p);h=Math.sqrt(Math.min(d,f));this.snappedToVertex_=h<=this.pixelTolerance_;this.snappedToVertex_&&(a=f<d?s[1]:s[0]);this.createOrUpdateVertexFeature_(a);for(var _=1,g=o.length;_<g;++_){var y=o[_].segment;if(!(Wo(s[0],y[0])&&Wo(s[1],y[1])||Wo(s[0],y[1])&&Wo(s[1],y[0])))break;u[St(y)]=!0}}u[St(s)]=!0;this.vertexSegments_=u;return}}if(this.vertexFeature_){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}};t.prototype.insertVertex_=function(t,e){for(var i,r=t.segment,o=t.feature,n=t.geometry,s=t.depth,a=t.index;e.length<n.getStride();)e.push(0);switch(n.getType()){case kt.MULTI_LINE_STRING:case kt.POLYGON:(i=n.getCoordinates())[s[0]].splice(a+1,0,e);break;case kt.MULTI_POLYGON:(i=n.getCoordinates())[s[1]][s[0]].splice(a+1,0,e);break;case kt.LINE_STRING:(i=n.getCoordinates()).splice(a+1,0,e);break;default:return}this.setGeometryCoordinates_(n,i);var l=this.rBush_;l.remove(t);this.updateSegmentIndices_(n,a,s,1);var h={segment:[r[0],e],feature:o,geometry:n,depth:s,index:a};l.insert(G(h.segment),h);this.dragSegments_.push([h,1]);var u={segment:[e,r[1]],feature:o,geometry:n,depth:s,index:a+1};l.insert(G(u.segment),u);this.dragSegments_.push([u,0]);this.ignoreNextSingleClick_=!0};t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=On.POINTERDRAG){var t=this.lastPointerEvent_;this.willModifyFeatures_(t);this.removeVertex_();this.dispatchEvent(new Rh(Ch.MODIFYEND,this.features_,t));return!(this.modified_=!1)}return!1};t.prototype.removeVertex_=function(){var t,e,i,r,o,n,s,a,l,h,u,c=this.dragSegments_,p={},d=!1;for(o=c.length-1;0<=o;--o){u=St((h=(i=c[o])[0]).feature);h.depth&&(u+="-"+h.depth.join("-"));u in p||(p[u]={});if(0===i[1]){p[u].right=h;p[u].index=h.index}else if(1==i[1]){p[u].left=h;p[u].index=h.index+1}}for(u in p){l=p[u].right;s=p[u].left;(a=(n=p[u].index)-1)<0&&(a=0);t=e=(r=(h=void 0!==s?s:l).geometry).getCoordinates();d=!1;switch(r.getType()){case kt.MULTI_LINE_STRING:if(2<e[h.depth[0]].length){e[h.depth[0]].splice(n,1);d=!0}break;case kt.LINE_STRING:if(2<e.length){e.splice(n,1);d=!0}break;case kt.MULTI_POLYGON:t=t[h.depth[1]];case kt.POLYGON:if(4<(t=t[h.depth[0]]).length){n==t.length-1&&(n=0);t.splice(n,1);d=!0;if(0===n){t.pop();t.push(t[0]);a=t.length-1}}}if(d){this.setGeometryCoordinates_(r,e);var f=[];if(void 0!==s){this.rBush_.remove(s);f.push(s.segment[0])}if(void 0!==l){this.rBush_.remove(l);f.push(l.segment[1])}if(void 0!==s&&void 0!==l){var _={depth:h.depth,feature:h.feature,geometry:h.geometry,index:a,segment:f};this.rBush_.insert(G(_.segment),_)}this.updateSegmentIndices_(r,n,h.depth,-1);if(this.vertexFeature_){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}c.length=0}}return d};t.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0;t.setCoordinates(e);this.changingFeature_=!1};t.prototype.updateSegmentIndices_=function(e,i,r,o){this.rBush_.forEachInExtent(e.getExtent(),function(t){t.geometry===e&&(void 0===r||void 0===t.depth||Ar(t.depth,r))&&t.index>i&&(t.index+=o)})};return t}(ba);function wh(t,e){return t.index-e.index}function Lh(t){if(!this.condition_(t))return!1;this.handlePointerAtPixel_(t.pixel,t.map);var e=t.map.getCoordinateFromPixel(t.pixel);this.dragSegments_.length=0;this.modified_=!1;var i=this.vertexFeature_;if(i){var r=[],o=i.getGeometry().getCoordinates(),n=G([o]),s=this.rBush_.getInExtent(n),a={};s.sort(wh);for(var l=0,h=s.length;l<h;++l){var u=s[l],c=u.segment,p=St(u.feature),d=u.depth;d&&(p+="-"+d.join("-"));a[p]||(a[p]=new Array(2));if(u.geometry.getType()===kt.CIRCLE&&u.index===Sh){if(Wo(Fh(e,u),o)&&!a[p][0]){this.dragSegments_.push([u,0]);a[p][0]=u}}else if(Wo(c[0],o)&&!a[p][0]){this.dragSegments_.push([u,0]);a[p][0]=u}else if(Wo(c[1],o)&&!a[p][1]){if((u.geometry.getType()===kt.LINE_STRING||u.geometry.getType()===kt.MULTI_LINE_STRING)&&a[p][0]&&0===a[p][0].index)continue;this.dragSegments_.push([u,1]);a[p][1]=u}else this.insertVertexCondition_(t)&&St(c)in this.vertexSegments_&&!a[p][0]&&!a[p][1]&&r.push([u,o])}r.length&&this.willModifyFeatures_(t);for(var f=r.length-1;0<=f;--f)this.insertVertex_.apply(this,r[f])}return!!this.vertexFeature_}function Oh(t){this.ignoreNextSingleClick_=!1;this.willModifyFeatures_(t);for(var e=t.coordinate,i=0,r=this.dragSegments_.length;i<r;++i){for(var o=this.dragSegments_[i],n=o[0],s=n.depth,a=n.geometry,l=void 0,h=n.segment,u=o[1];e.length<a.getStride();)e.push(h[u][e.length]);switch(a.getType()){case kt.POINT:l=e;h[0]=h[1]=e;break;case kt.MULTI_POINT:(l=a.getCoordinates())[n.index]=e;h[0]=h[1]=e;break;case kt.LINE_STRING:(l=a.getCoordinates())[n.index+u]=e;h[u]=e;break;case kt.MULTI_LINE_STRING:case kt.POLYGON:(l=a.getCoordinates())[s[0]][n.index+u]=e;h[u]=e;break;case kt.MULTI_POLYGON:(l=a.getCoordinates())[s[1]][s[0]][n.index+u]=e;h[u]=e;break;case kt.CIRCLE:h[0]=h[1]=e;if(n.index===Th){this.changingFeature_=!0;a.setCenter(e);this.changingFeature_=!1}else{this.changingFeature_=!0;a.setRadius(qo(a.getCenter(),e));this.changingFeature_=!1}}l&&this.setGeometryCoordinates_(a,l)}this.createOrUpdateVertexFeature_(e)}function Ph(t){for(var e=this.dragSegments_.length-1;0<=e;--e){var i=this.dragSegments_[e][0],r=i.geometry;if(r.getType()===kt.CIRCLE){var o=r.getCenter(),n=i.featureSegments[0],s=i.featureSegments[1];n.segment[0]=n.segment[1]=o;s.segment[0]=s.segment[1]=o;this.rBush_.update(H(o),n);this.rBush_.update(r.getExtent(),s)}else this.rBush_.update(G(i.segment),i)}if(this.modified_){this.dispatchEvent(new Rh(Ch.MODIFYEND,this.features_,t));this.modified_=!1}return!1}function bh(t){if(!(t instanceof Pn))return!0;var e;(this.lastPointerEvent_=t).map.getView().getInteracting()||t.type!=On.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t);this.vertexFeature_&&this.deleteCondition_(t)&&(e=!(t.type!=On.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint());t.type==On.SINGLECLICK&&(this.ignoreNextSingleClick_=!1);return Fa.call(this,t)&&!e}function Mh(t,e){var i=e.geometry;if(i.getType()===kt.CIRCLE){var r=i;if(e.index===Sh){var o=Zo(r.getCenter(),t),n=Math.sqrt(o)-r.getRadius();return n*n}}return Jo(t,e.segment)}function Fh(t,e){var i=e.geometry;return i.getType()===kt.CIRCLE&&e.index===Sh?i.getClosestPoint(t):Vo(t,e.segment)}var Ah={SELECT:"select"},Nh=function(o){function t(t,e,i,r){o.call(this,t);this.selected=e;this.deselected=i;this.mapBrowserEvent=r}o&&(t.__proto__=o);return(t.prototype=Object.create(o&&o.prototype)).constructor=t}(m),Dh=function(s){function t(t){s.call(this,{handleEvent:Gh});var e=t||{};this.condition_=e.condition?e.condition:xa;this.addCondition_=e.addCondition?e.addCondition:ma;this.removeCondition_=e.removeCondition?e.removeCondition:ma;this.toggleCondition_=e.toggleCondition?e.toggleCondition:Sa;this.multi_=!!e.multi&&e.multi;this.filter_=e.filter?e.filter:y;this.hitTolerance_=e.hitTolerance?e.hitTolerance:0;var i,r=new Ml({source:new oh({useSpatialIndex:!1,features:e.features,wrapX:e.wrapX}),style:e.style?e.style:function(){var i=xr();br(i[kt.POLYGON],i[kt.LINE_STRING]);br(i[kt.GEOMETRY_COLLECTION],i[kt.LINE_STRING]);return function(t,e){return t.getGeometry()?i[t.getGeometry().getType()]:null}}(),updateWhileAnimating:!0,updateWhileInteracting:!0});this.featureOverlay_=r;if(e.layers)if("function"==typeof e.layers)i=e.layers;else{var o=e.layers;i=function(t){return Lr(o,t)}}else i=y;this.layerFilter_=i;this.featureLayerAssociation_={};var n=this.featureOverlay_.getSource().getFeaturesCollection();S(n,a.ADD,this.addFeature_,this);S(n,a.REMOVE,this.removeFeature_,this)}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.addFeatureLayerAssociation_=function(t,e){var i=St(t);this.featureLayerAssociation_[i]=e};t.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()};t.prototype.getHitTolerance=function(){return this.hitTolerance_};t.prototype.getLayer=function(t){var e=St(t);return this.featureLayerAssociation_[e]};t.prototype.getOverlay=function(){return this.featureOverlay_};t.prototype.setHitTolerance=function(t){this.hitTolerance_=t};t.prototype.setMap=function(t){var e=this.getMap(),i=this.featureOverlay_.getSource().getFeaturesCollection();e&&i.forEach(e.unskipFeature.bind(e));s.prototype.setMap.call(this,t);this.featureOverlay_.setMap(t);t&&i.forEach(t.skipFeature.bind(t))};t.prototype.addFeature_=function(t){var e=this.getMap();e&&e.skipFeature(t.element)};t.prototype.removeFeature_=function(t){var e=this.getMap();e&&e.unskipFeature(t.element)};t.prototype.removeFeatureLayerAssociation_=function(t){var e=St(t);delete this.featureLayerAssociation_[e]};return t}(na);function Gh(t){if(!this.condition_(t))return!0;var i=this.addCondition_(t),r=this.removeCondition_(t),o=this.toggleCondition_(t),e=!i&&!r&&!o,n=t.map,s=this.featureOverlay_.getSource().getFeaturesCollection(),a=[],l=[];if(e){_(this.featureLayerAssociation_);n.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e)){l.push(t);this.addFeatureLayerAssociation_(t,e);return!this.multi_}}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var h=s.getLength()-1;0<=h;--h){var u=s.item(h),c=l.indexOf(u);if(-1<c)l.splice(c,1);else{s.remove(u);a.push(u)}}0!==l.length&&s.extend(l)}else{n.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e)){if(!i&&!o||Lr(s.getArray(),t)){if((r||o)&&Lr(s.getArray(),t)){a.push(t);this.removeFeatureLayerAssociation_(t)}}else{l.push(t);this.addFeatureLayerAssociation_(t,e)}return!this.multi_}}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var p=a.length-1;0<=p;--p)s.remove(a[p]);s.extend(l)}(0<l.length||0<a.length)&&this.dispatchEvent(new Nh(Ah.SELECT,l,a,t));return Ea(t)}var kh=function(o){function t(t){o.call(this,{handleEvent:jh,handleDownEvent:y,handleUpEvent:Uh,stopDown:v});var e=t||{};this.source_=e.source?e.source:null;this.vertex_=void 0===e.vertex||e.vertex;this.edge_=void 0===e.edge||e.edge;this.features_=e.features?e.features:null;this.featuresListenerKeys_=[];this.featureChangeListenerKeys_={};this.indexedFeaturesExtents_={};this.pendingFeatures_={};this.pixelCoordinate_=null;this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10;this.sortByDistance_=function(t,e){var i=Jo(this.pixelCoordinate_,t.segment),r=Jo(this.pixelCoordinate_,e.segment);return i-r}.bind(this);this.rBush_=new ih;this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.addFeature=function(t,e){var i=void 0===e||e,r=St(t),o=t.getGeometry();if(o){var n=this.SEGMENT_WRITERS_[o.getType()];if(n){this.indexedFeaturesExtents_[r]=o.getExtent([1/0,1/0,-1/0,-1/0]);n.call(this,t,o)}}i&&(this.featureChangeListenerKeys_[r]=S(t,R.CHANGE,this.handleFeatureChange_,this))};t.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)};t.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)};t.prototype.getFeatures_=function(){var t;this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures());return t};t.prototype.handleFeatureAdd_=function(t){var e;t instanceof rh?e=t.feature:t instanceof M&&(e=t.element);this.addFeature(e)};t.prototype.handleFeatureRemove_=function(t){var e;t instanceof rh?e=t.feature:t instanceof M&&(e=t.element);this.removeFeature(e)};t.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var i=St(e);i in this.pendingFeatures_||(this.pendingFeatures_[i]=e)}else this.updateFeature_(e)};t.prototype.removeFeature=function(e,t){var i=void 0===t||t,r=St(e),o=this.indexedFeaturesExtents_[r];if(o){var n=this.rBush_,s=[];n.forEachInExtent(o,function(t){e===t.feature&&s.push(t)});for(var a=s.length-1;0<=a;--a)n.remove(s[a])}if(i){g(this.featureChangeListenerKeys_[r]);delete this.featureChangeListenerKeys_[r]}};t.prototype.setMap=function(t){var e=this.getMap(),i=this.featuresListenerKeys_,r=this.getFeatures_();if(e){i.forEach(g);i.length=0;r.forEach(this.forEachFeatureRemove_.bind(this))}o.prototype.setMap.call(this,t);if(t){this.features_?i.push(S(this.features_,a.ADD,this.handleFeatureAdd_,this),S(this.features_,a.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push(S(this.source_,kl.ADDFEATURE,this.handleFeatureAdd_,this),S(this.source_,kl.REMOVEFEATURE,this.handleFeatureRemove_,this));r.forEach(this.forEachFeatureAdd_.bind(this))}};t.prototype.snapTo=function(t,e,i){var r=G([i.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),i.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_])]),o=this.rBush_.getInExtent(r);this.vertex_&&!this.edge_&&(o=o.filter(function(t){return t.feature.getGeometry().getType()!==kt.CIRCLE}));var n,s,a,l,h=!1,u=null,c=null;if(0<o.length){this.pixelCoordinate_=e;o.sort(this.sortByDistance_);var p=o[0].segment,d=o[0].feature.getGeometry().getType()===kt.CIRCLE;if(this.vertex_&&!this.edge_){n=i.getPixelFromCoordinate(p[0]);s=i.getPixelFromCoordinate(p[1]);a=Zo(t,n);l=Zo(t,s);if(Math.sqrt(Math.min(a,l))<=this.pixelTolerance_){h=!0;u=l<a?p[1]:p[0];c=i.getPixelFromCoordinate(u)}}else if(this.edge_){u=d?Bo(e,o[0].feature.getGeometry()):Vo(e,p);if(qo(t,c=i.getPixelFromCoordinate(u))<=this.pixelTolerance_){h=!0;if(this.vertex_&&!d){n=i.getPixelFromCoordinate(p[0]);s=i.getPixelFromCoordinate(p[1]);a=Zo(c,n);l=Zo(c,s);if(Math.sqrt(Math.min(a,l))<=this.pixelTolerance_){u=l<a?p[1]:p[0];c=i.getPixelFromCoordinate(u)}}}}h&&(c=[Math.round(c[0]),Math.round(c[1])])}return{snapped:h,vertex:u,vertexPixel:c}};t.prototype.updateFeature_=function(t){this.removeFeature(t,!1);this.addFeature(t,!1)};t.prototype.writeCircleGeometry_=function(t,e){for(var i=Do(e).getCoordinates()[0],r=0,o=i.length-1;r<o;++r){var n=i.slice(r,r+2),s={feature:t,segment:n};this.rBush_.insert(G(n),s)}};t.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),r=0;r<i.length;++r){var o=this.SEGMENT_WRITERS_[i[r].getType()];o&&o.call(this,t,i[r])}};t.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,o=i.length-1;r<o;++r){var n=i.slice(r,r+2),s={feature:t,segment:n};this.rBush_.insert(G(n),s)}};t.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,o=i.length;r<o;++r)for(var n=i[r],s=0,a=n.length-1;s<a;++s){var l=n.slice(s,s+2),h={feature:t,segment:l};this.rBush_.insert(G(l),h)}};t.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,o=i.length;r<o;++r){var n=i[r],s={feature:t,segment:[n,n]};this.rBush_.insert(e.getExtent(),s)}};t.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,o=i.length;r<o;++r)for(var n=i[r],s=0,a=n.length;s<a;++s)for(var l=n[s],h=0,u=l.length-1;h<u;++h){var c=l.slice(h,h+2),p={feature:t,segment:c};this.rBush_.insert(G(c),p)}};t.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),r={feature:t,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)};t.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,o=i.length;r<o;++r)for(var n=i[r],s=0,a=n.length-1;s<a;++s){var l=n.slice(s,s+2),h={feature:t,segment:l};this.rBush_.insert(G(l),h)}};return t}(ba);function jh(t){var e=this.snapTo(t.pixel,t.coordinate,t.map);if(e.snapped){t.coordinate=e.vertex.slice(0,2);t.pixel=e.vertexPixel}return Fa.call(this,t)}function Uh(t){var e=s(this.pendingFeatures_);if(e.length){e.forEach(this.updateFeature_.bind(this));this.pendingFeatures_={}}return!1}var Yh={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"},Bh=function(r){function t(t,e,i){r.call(this,t);this.features=e;this.coordinate=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(m),Vh=function(o){function t(t){o.call(this,{handleDownEvent:Xh,handleDragEvent:Wh,handleMoveEvent:Hh,handleUpEvent:zh});var e,i=t||{};this.lastCoordinate_=null;this.features_=void 0!==i.features?i.features:null;if(i.layers)if("function"==typeof i.layers)e=i.layers;else{var r=i.layers;e=function(t){return Lr(r,t)}}else e=y;this.layerFilter_=e;this.hitTolerance_=i.hitTolerance?i.hitTolerance:0;this.lastFeature_=null;S(this,P(oa.ACTIVE),this.handleActiveChanged_,this)}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.featuresAtPixel_=function(t,e){return e.forEachFeatureAtPixel(t,function(t){if(!this.features_||Lr(this.features_.getArray(),t))return t}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})};t.prototype.getHitTolerance=function(){return this.hitTolerance_};t.prototype.setHitTolerance=function(t){this.hitTolerance_=t};t.prototype.setMap=function(t){var e=this.getMap();o.prototype.setMap.call(this,t);this.updateState_(e)};t.prototype.handleActiveChanged_=function(){this.updateState_(null)};t.prototype.updateState_=function(t){var e=this.getMap(),i=this.getActive();if((!e||!i)&&(e=e||t)){e.getViewport().classList.remove("ol-grab","ol-grabbing")}};return t}(ba);function Xh(t){this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map);if(this.lastCoordinate_||!this.lastFeature_)return!1;this.lastCoordinate_=t.coordinate;Hh.call(this,t);var e=this.features_||new F([this.lastFeature_]);this.dispatchEvent(new Bh(Yh.TRANSLATESTART,e,t.coordinate));return!0}function zh(t){if(this.lastCoordinate_){this.lastCoordinate_=null;Hh.call(this,t);var e=this.features_||new F([this.lastFeature_]);this.dispatchEvent(new Bh(Yh.TRANSLATEEND,e,t.coordinate));return!0}return!1}function Wh(t){if(this.lastCoordinate_){var e=t.coordinate,i=e[0]-this.lastCoordinate_[0],r=e[1]-this.lastCoordinate_[1],o=this.features_||new F([this.lastFeature_]);o.forEach(function(t){var e=t.getGeometry();e.translate(i,r);t.setGeometry(e)});this.lastCoordinate_=e;this.dispatchEvent(new Bh(Yh.TRANSLATING,o,e))}}function Hh(t){var e=t.map.getViewport();if(this.featuresAtPixel_(t.pixel,t.map)){e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing");e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")}else e.classList.remove("ol-grab","ol-grabbing")}function Kh(t){var e=t||{},i=new F,r=new Rn(-.005,.05,100);(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&i.push(new ja);(void 0===e.doubleClickZoom||e.doubleClickZoom)&&i.push(new pa({delta:e.zoomDelta,duration:e.zoomDuration}));(void 0===e.dragPan||e.dragPan)&&i.push(new Na({condition:e.onFocusOnly?ga:void 0,kinetic:r}));(void 0===e.pinchRotate||e.pinchRotate)&&i.push(new ll);(void 0===e.pinchZoom||e.pinchZoom)&&i.push(new pl({constrainResolution:e.constrainResolution,duration:e.zoomDuration}));if(void 0===e.keyboard||e.keyboard){i.push(new tl);i.push(new il({delta:e.zoomDelta,duration:e.zoomDuration}))}(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&i.push(new sl({condition:e.onFocusOnly?ga:void 0,constrainResolution:e.constrainResolution,duration:e.zoomDuration}));(void 0===e.shiftDragZoom||e.shiftDragZoom)&&i.push(new Ja({duration:e.zoomDuration}));return i}var Zh=function(n){function t(t,e,i,r,o){n.call(this,t);this.vectorContext=e;this.frameState=i;this.context=r;this.glContext=o}n&&(t.__proto__=n);return(t.prototype=Object.create(n&&n.prototype)).constructor=t}(m),qh=function(){};qh.prototype.drawCustom=function(t,e,i){};qh.prototype.drawGeometry=function(t){};qh.prototype.setStyle=function(t){};qh.prototype.drawCircle=function(t,e){};qh.prototype.drawFeature=function(t,e){};qh.prototype.drawGeometryCollection=function(t,e){};qh.prototype.drawLineString=function(t,e){};qh.prototype.drawMultiLineString=function(t,e){};qh.prototype.drawMultiPoint=function(t,e){};qh.prototype.drawMultiPolygon=function(t,e){};qh.prototype.drawPoint=function(t,e){};qh.prototype.drawPolygon=function(t,e){};qh.prototype.drawText=function(t,e){};qh.prototype.setFillStrokeStyle=function(t,e){};qh.prototype.setImageStyle=function(t,e){};qh.prototype.setTextStyle=function(t,e){};var Jh=function(n){function t(t,e,i,r,o){n.call(this);this.context_=t;this.pixelRatio_=e;this.extent_=i;this.transform_=r;this.viewRotation_=o;this.contextFillState_=null;this.contextStrokeState_=null;this.contextTextState_=null;this.fillState_=null;this.strokeState_=null;this.image_=null;this.imageAnchorX_=0;this.imageAnchorY_=0;this.imageHeight_=0;this.imageOpacity_=0;this.imageOriginX_=0;this.imageOriginY_=0;this.imageRotateWithView_=!1;this.imageRotation_=0;this.imageScale_=0;this.imageWidth_=0;this.text_="";this.textOffsetX_=0;this.textOffsetY_=0;this.textRotateWithView_=!1;this.textRotation_=0;this.textScale_=0;this.textFillState_=null;this.textStrokeState_=null;this.textState_=null;this.pixelCoordinates_=[];this.tmpLocalTransform_=[1,0,0,1,0,0]}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.drawImages_=function(t,e,i,r){var o=this;if(this.image_){var n=It(t,e,i,2,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.tmpLocalTransform_,l=s.globalAlpha;1!=this.imageOpacity_&&(s.globalAlpha=l*this.imageOpacity_);var h=this.imageRotation_;this.imageRotateWithView_&&(h+=this.viewRotation_);for(var u=0,c=n.length;u<c;u+=2){var p=n[u]-o.imageAnchorX_,d=n[u+1]-o.imageAnchorY_;if(0!==h||1!=o.imageScale_){var f=p+o.imageAnchorX_,_=d+o.imageAnchorY_;Ue(a,f,_,o.imageScale_,o.imageScale_,h,-f,-_);s.setTransform.apply(s,a)}s.drawImage(o.image_,o.imageOriginX_,o.imageOriginY_,o.imageWidth_,o.imageHeight_,p,d,o.imageWidth_,o.imageHeight_)}0===h&&1==this.imageScale_||s.setTransform(1,0,0,1,0,0);1!=this.imageOpacity_&&(s.globalAlpha=l)}};t.prototype.drawText_=function(t,e,i,r){var o=this;if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_);this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_);this.setContextTextState_(this.textState_);var n=It(t,e,i,r,this.transform_,this.pixelCoordinates_),s=this.context_,a=this.textRotation_;this.textRotateWithView_&&(a+=this.viewRotation_);for(;e<i;e+=r){var l=n[e]+o.textOffsetX_,h=n[e+1]+o.textOffsetY_;if(0!==a||1!=o.textScale_){var u=Ue(o.tmpLocalTransform_,l,h,o.textScale_,o.textScale_,a,-l,-h);s.setTransform.apply(s,u)}o.textStrokeState_&&s.strokeText(o.text_,l,h);o.textFillState_&&s.fillText(o.text_,l,h)}0===a&&1==this.textScale_||s.setTransform(1,0,0,1,0,0)}};t.prototype.moveToLineTo_=function(t,e,i,r,o){var n=this.context_,s=It(t,e,i,r,this.transform_,this.pixelCoordinates_);n.moveTo(s[0],s[1]);var a=s.length;o&&(a-=2);for(var l=2;l<a;l+=2)n.lineTo(s[l],s[l+1]);o&&n.closePath();return i};t.prototype.drawRings_=function(t,e,i,r){for(var o=0,n=i.length;o<n;++o)e=this.moveToLineTo_(t,e,i[o],r,!0);return e};t.prototype.drawCircle=function(t){if(Rt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=Yr(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],r=e[3]-e[1],o=Math.sqrt(i*i+r*r),n=this.context_;n.beginPath();n.arc(e[0],e[1],o,0,2*Math.PI);this.fillState_&&n.fill();this.strokeState_&&n.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}};t.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke());this.setImageStyle(t.getImage());this.setTextStyle(t.getText())};t.prototype.drawGeometry=function(t){switch(t.getType()){case kt.POINT:this.drawPoint(t);break;case kt.LINE_STRING:this.drawLineString(t);break;case kt.POLYGON:this.drawPolygon(t);break;case kt.MULTI_POINT:this.drawMultiPoint(t);break;case kt.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case kt.MULTI_POLYGON:this.drawMultiPolygon(t);break;case kt.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case kt.CIRCLE:this.drawCircle(t)}};t.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);if(i&&Rt(this.extent_,i.getExtent())){this.setStyle(e);this.drawGeometry(i)}};t.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),i=0,r=e.length;i<r;++i)this.drawGeometry(e[i])};t.prototype.drawPoint=function(t){var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i);""!==this.text_&&this.drawText_(e,0,e.length,i)};t.prototype.drawMultiPoint=function(t){var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i);""!==this.text_&&this.drawText_(e,0,e.length,i)};t.prototype.drawLineString=function(t){if(Rt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath();this.moveToLineTo_(i,0,i.length,t.getStride(),!1);e.stroke()}if(""!==this.text_){var r=t.getFlatMidpoint();this.drawText_(r,0,2,2)}}};t.prototype.drawMultiLineString=function(t){var e=t.getExtent();if(Rt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,r=t.getFlatCoordinates(),o=0,n=t.getEnds(),s=t.getStride();i.beginPath();for(var a=0,l=n.length;a<l;++a)o=this.moveToLineTo_(r,o,n[a],s,!1);i.stroke()}if(""!==this.text_){var h=t.getFlatMidpoints();this.drawText_(h,0,h.length,2)}}};t.prototype.drawPolygon=function(t){if(Rt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath();this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride());this.fillState_&&e.fill();this.strokeState_&&e.stroke()}if(""!==this.text_){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}};t.prototype.drawMultiPolygon=function(t){if(Rt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),r=0,o=t.getEndss(),n=t.getStride();e.beginPath();for(var s=0,a=o.length;s<a;++s){var l=o[s];r=this.drawRings_(i,r,l,n)}this.fillState_&&e.fill();this.strokeState_&&e.stroke()}if(""!==this.text_){var h=t.getFlatInteriorPoints();this.drawText_(h,0,h.length,2)}}};t.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;if(i)i.fillStyle!=t.fillStyle&&(i.fillStyle=e.fillStyle=t.fillStyle);else{e.fillStyle=t.fillStyle;this.contextFillState_={fillStyle:t.fillStyle}}};t.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;if(i){i.lineCap!=t.lineCap&&(i.lineCap=e.lineCap=t.lineCap);if(Pi){Ar(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash);i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset=t.lineDashOffset)}i.lineJoin!=t.lineJoin&&(i.lineJoin=e.lineJoin=t.lineJoin);i.lineWidth!=t.lineWidth&&(i.lineWidth=e.lineWidth=t.lineWidth);i.miterLimit!=t.miterLimit&&(i.miterLimit=e.miterLimit=t.miterLimit);i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=e.strokeStyle=t.strokeStyle)}else{e.lineCap=t.lineCap;if(Pi){e.setLineDash(t.lineDash);e.lineDashOffset=t.lineDashOffset}e.lineJoin=t.lineJoin;e.lineWidth=t.lineWidth;e.miterLimit=t.miterLimit;e.strokeStyle=t.strokeStyle;this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle}}};t.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,r=t.textAlign?t.textAlign:qi;if(i){i.font!=t.font&&(i.font=e.font=t.font);i.textAlign!=r&&(i.textAlign=e.textAlign=r);i.textBaseline!=t.textBaseline&&(i.textBaseline=e.textBaseline=t.textBaseline)}else{e.font=t.font;e.textAlign=r;e.textBaseline=t.textBaseline;this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline}}};t.prototype.setFillStrokeStyle=function(t,e){if(t){var i=t.getColor();this.fillState_={fillStyle:ti(i||zi)}}else this.fillState_=null;if(e){var r=e.getColor(),o=e.getLineCap(),n=e.getLineDash(),s=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit();this.strokeState_={lineCap:void 0!==o?o:Wi,lineDash:n||Hi,lineDashOffset:s||0,lineJoin:void 0!==a?a:Ki,lineWidth:this.pixelRatio_*(void 0!==l?l:1),miterLimit:void 0!==h?h:10,strokeStyle:ti(r||Zi)}}else this.strokeState_=null};t.prototype.setImageStyle=function(t){if(t){var e=t.getAnchor(),i=t.getImage(1),r=t.getOrigin(),o=t.getSize();this.imageAnchorX_=e[0];this.imageAnchorY_=e[1];this.imageHeight_=o[1];this.image_=i;this.imageOpacity_=t.getOpacity();this.imageOriginX_=r[0];this.imageOriginY_=r[1];this.imageRotateWithView_=t.getRotateWithView();this.imageRotation_=t.getRotation();this.imageScale_=t.getScale()*this.pixelRatio_;this.imageWidth_=o[0]}else this.image_=null};t.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var i=e.getColor();this.textFillState_={fillStyle:ti(i||zi)}}else this.textFillState_=null;var r=t.getStroke();if(r){var o=r.getColor(),n=r.getLineCap(),s=r.getLineDash(),a=r.getLineDashOffset(),l=r.getLineJoin(),h=r.getWidth(),u=r.getMiterLimit();this.textStrokeState_={lineCap:void 0!==n?n:Wi,lineDash:s||Hi,lineDashOffset:a||0,lineJoin:void 0!==l?l:Ki,lineWidth:void 0!==h?h:1,miterLimit:void 0!==u?u:10,strokeStyle:ti(o||Zi)}}else this.textStrokeState_=null;var c=t.getFont(),p=t.getOffsetX(),d=t.getOffsetY(),f=t.getRotateWithView(),_=t.getRotation(),g=t.getScale(),y=t.getText(),v=t.getTextAlign(),m=t.getTextBaseline();this.textState_={font:void 0!==c?c:Xi,textAlign:void 0!==v?v:qi,textBaseline:void 0!==m?m:Ji};this.text_=void 0!==y?y:"";this.textOffsetX_=void 0!==p?this.pixelRatio_*p:0;this.textOffsetY_=void 0!==d?this.pixelRatio_*d:0;this.textRotateWithView_=void 0!==f&&f;this.textRotation_=void 0!==_?_:0;this.textScale_=this.pixelRatio_*(void 0!==g?g:1)}else this.text_=""};return t}(qh),Qh=function(){this.cache_={};this.cacheSize_=0;this.maxCacheSize_=32};Qh.prototype.clear=function(){this.cache_={};this.cacheSize_=0};Qh.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var t=0;for(var e in this.cache_){var i=this.cache_[e];if(0==(3&t++)&&!i.hasListener()){delete this.cache_[e];--this.cacheSize_}}}};Qh.prototype.get=function(t,e,i){var r=$h(t,e,i);return r in this.cache_?this.cache_[r]:null};Qh.prototype.set=function(t,e,i,r){var o=$h(t,e,i);this.cache_[o]=r;++this.cacheSize_};Qh.prototype.setSize=function(t){this.maxCacheSize_=t;this.expire()};function $h(t,e,i){return e+":"+t+":"+(i?He(i):"null")}var tu=new Qh,eu=function(e){function t(t){e.call(this);this.map_=t;this.layerRenderers_={};this.layerRendererListeners_={};this.layerRendererConstructors_=[]}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.dispatchRenderEvent=function(t,e){};t.prototype.registerLayerRenderers=function(t){this.layerRendererConstructors_.push.apply(this.layerRendererConstructors_,t)};t.prototype.calculateMatrices2D=function(t){var e=t.viewState,i=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;Ue(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]);Ye(Ne(r,i))};t.prototype.removeLayerRenderers=function(){for(var t in this.layerRenderers_)this.removeLayerRendererByKey_(t).dispose()};t.prototype.forEachFeatureAtCoordinate=function(t,o,e,n,s,i,r){var a,l=o.viewState,h=l.resolution;function u(t,e){var i=St(t).toString(),r=o.layerStates[St(e)].managed;if(!(i in o.skippedFeatureUids)||r)return n.call(s,t,r?e:null)}var c=l.projection,p=t;if(c.canWrapX()){var d=c.getExtent(),f=_t(d),_=t[0];if(_<d[0]||_>d[2]){p=[_+f*Math.ceil((d[0]-_)/f),t[1]]}}var g,y=o.layerStatesArray;for(g=y.length-1;0<=g;--g){var v=y[g],m=v.layer;if(Js(v,h)&&i.call(r,m)){var E=this.getLayerRenderer(m);m.getSource()&&(a=E.forEachFeatureAtCoordinate(m.getSource().getWrapX()?p:t,o,e,u,s));if(a)return a}}};t.prototype.forEachLayerAtPixel=function(t,e,i,r,o,n,s){};t.prototype.hasFeatureAtCoordinate=function(t,e,i,r,o){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,y,this,r,o)};t.prototype.getLayerRenderer=function(t){var e=St(t).toString();if(e in this.layerRenderers_)return this.layerRenderers_[e];for(var i,r=0,o=this.layerRendererConstructors_.length;r<o;++r){var n=this.layerRendererConstructors_[r];if(n.handles(t)){i=n.create(this,t);break}}if(!i)throw new Error("Unable to create renderer for layer: "+t.getType());this.layerRenderers_[e]=i;this.layerRendererListeners_[e]=S(i,R.CHANGE,this.handleLayerRendererChange_,this);return i};t.prototype.getLayerRendererByKey=function(t){return this.layerRenderers_[t]};t.prototype.getLayerRenderers=function(){return this.layerRenderers_};t.prototype.getMap=function(){return this.map_};t.prototype.handleLayerRendererChange_=function(){this.map_.render()};t.prototype.removeLayerRendererByKey_=function(t){var e=this.layerRenderers_[t];delete this.layerRenderers_[t];g(this.layerRendererListeners_[t]);delete this.layerRendererListeners_[t];return e};t.prototype.removeUnusedLayerRenderers_=function(t,e){for(var i in this.layerRenderers_)e&&i in e.layerStates||this.removeLayerRendererByKey_(i).dispose()};t.prototype.renderFrame=function(t){};t.prototype.scheduleExpireIconCache=function(t){t.postRenderFunctions.push(iu)};t.prototype.scheduleRemoveUnusedLayerRenderers=function(t){for(var e in this.layerRenderers_)if(!(e in t.layerStates)){t.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this));return}};return t}(i);function iu(t,e){tu.expire()}function ru(t,e){return t.zIndex-e.zIndex}var ou=[],nu=function(o){function t(t){o.call(this,t);var e=t.getViewport();this.context_=ii();this.canvas_=this.context_.canvas;this.canvas_.style.width="100%";this.canvas_.style.height="100%";this.canvas_.style.display="block";this.canvas_.className=ki;e.insertBefore(this.canvas_,e.childNodes[0]||null);this.renderedVisible_=!0;this.transform_=[1,0,0,1,0,0]}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.dispatchRenderEvent=function(t,e){var i=this.getMap(),r=this.context_;if(i.hasListener(t)){var o=e.extent,n=e.pixelRatio,s=e.viewState.rotation,a=this.getTransform(e),l=new Jh(r,n,o,a,s),h=new Zh(t,l,e,r,null);i.dispatchEvent(h)}};t.prototype.getTransform=function(t){var e=t.viewState,i=this.canvas_.width/2,r=this.canvas_.height/2,o=t.pixelRatio/e.resolution,n=-o,s=-e.rotation,a=-e.center[0],l=-e.center[1];return Ue(this.transform_,i,r,o,n,s,a,l)};t.prototype.renderFrame=function(t){if(t){var e=this.context_,i=t.pixelRatio,r=Math.round(t.size[0]*i),o=Math.round(t.size[1]*i);if(this.canvas_.width!=r||this.canvas_.height!=o){this.canvas_.width=r;this.canvas_.height=o}else e.clearRect(0,0,r,o);var n=t.viewState.rotation;this.calculateMatrices2D(t);this.dispatchRenderEvent(ln.PRECOMPOSE,t);var s=t.layerStatesArray;Nr(s,ru);if(n){e.save();hr(e,n,r/2,o/2)}var a,l,h,u,c,p=t.viewState.resolution;for(a=0,l=s.length;a<l;++a){h=(c=s[a]).layer;u=this.getLayerRenderer(h);Js(c,p)&&c.sourceState==Ys.READY&&(u.prepareFrame(t,c)&&u.composeFrame(t,c,e))}n&&e.restore();this.dispatchRenderEvent(ln.POSTCOMPOSE,t);if(!this.renderedVisible_){this.canvas_.style.display="";this.renderedVisible_=!0}this.scheduleRemoveUnusedLayerRenderers(t);this.scheduleExpireIconCache(t)}else if(this.renderedVisible_){this.canvas_.style.display="none";this.renderedVisible_=!1}};t.prototype.forEachLayerAtPixel=function(t,e,i,r,o,n,s){var a,l,h=e.viewState.resolution,u=e.layerStatesArray,c=u.length,p=De(e.pixelToCoordinateTransform,t.slice());for(l=c-1;0<=l;--l){var d=u[l],f=d.layer;if(Js(d,h)&&n.call(s,f)){if(a=this.getLayerRenderer(f).forEachLayerAtCoordinate(p,e,i,r,o))return a}}};t.prototype.registerLayerRenderers=function(t){o.prototype.registerLayerRenderers.call(this,t);for(var e=0,i=t.length;e<i;++e){var r=t[e];Lr(ou,r)||ou.push(r)}};return t}(eu),su=function(e){function t(t){e.call(this);this.layer_=t}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.createLoadedTileFinder=function(i,r,o){return function(e,t){return i.forEachLoadedTile(r,e,t,function(t){o[e]||(o[e]={});o[e][t.tileCoord.toString()]=t})}};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r){};t.prototype.getLayer=function(){return this.layer_};t.prototype.handleImageChange_=function(t){t.target.getState()===Ni.LOADED&&this.renderIfReadyAndVisible()};t.prototype.hasFeatureAtCoordinate=function(t,e){return!1};t.prototype.loadImage=function(t){var e=t.getState();e!=Ni.LOADED&&e!=Ni.ERROR&&S(t,R.CHANGE,this.handleImageChange_,this);if(e==Ni.IDLE){t.load();e=t.getState()}return e==Ni.LOADED};t.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==Ys.READY&&this.changed()};t.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var i=function(t,e,i){var r=St(t).toString();r in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[r])}.bind(null,e);t.postRenderFunctions.push(i)}};t.prototype.updateUsedTiles=function(t,e,i,r){var o=St(e).toString(),n=i.toString();if(o in t)n in t[o]?t[o][n].extend(r):t[o][n]=r;else{t[o]={};t[o][n]=r}};t.prototype.manageTilePyramid=function(t,e,i,r,o,n,s,a,l,h){var u=St(e).toString();u in t.wantedTiles||(t.wantedTiles[u]={});var c,p,d,f,_,g,y=t.wantedTiles[u],v=t.tileQueue;for(g=i.getMinZoom();g<=s;++g){p=i.getTileRangeForExtentAndZ(n,g,p);d=i.getResolution(g);for(f=p.minX;f<=p.maxX;++f)for(_=p.minY;_<=p.maxY;++_)if(s-g<=a){if((c=e.getTile(g,f,_,r,o)).getState()==yn.IDLE){y[c.getKey()]=!0;v.isKeyQueued(c.getKey())||v.enqueue([c,u,i.getTileCoordCenter(c.tileCoord),d])}void 0!==l&&l.call(h,c)}else e.useTile(g,f,_,o)}};return t}(C),au=function(e){function t(t){e.call(this,t);this.renderedResolution;this.transform_=[1,0,0,1,0,0]}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.clip=function(t,e,i){var r=e.pixelRatio,o=e.size[0]*r,n=e.size[1]*r,s=e.viewState.rotation,a=dt(i),l=ft(i),h=at(i),u=st(i);De(e.coordinateToPixelTransform,a);De(e.coordinateToPixelTransform,l);De(e.coordinateToPixelTransform,h);De(e.coordinateToPixelTransform,u);t.save();hr(t,-s,o/2,n/2);t.beginPath();t.moveTo(a[0]*r,a[1]*r);t.lineTo(l[0]*r,l[1]*r);t.lineTo(h[0]*r,h[1]*r);t.lineTo(u[0]*r,u[1]*r);t.clip();hr(t,s,o/2,n/2)};t.prototype.dispatchComposeEvent_=function(t,e,i,r){var o=this.getLayer();if(o.hasListener(t)){var n=i.size[0]*i.pixelRatio,s=i.size[1]*i.pixelRatio,a=i.viewState.rotation;hr(e,-a,n/2,s/2);var l=void 0!==r?r:this.getTransform(i,0),h=new Jh(e,i.pixelRatio,i.extent,l,i.viewState.rotation),u=new Zh(t,h,i,e,null);o.dispatchEvent(u);hr(e,a,n/2,s/2)}};t.prototype.forEachLayerAtCoordinate=function(t,e,i,r,o){return this.forEachFeatureAtCoordinate(t,e,i,y,this)?r.call(o,this.getLayer(),null):void 0};t.prototype.postCompose=function(t,e,i,r){this.dispatchComposeEvent_(ln.POSTCOMPOSE,t,e,r)};t.prototype.preCompose=function(t,e,i){this.dispatchComposeEvent_(ln.PRECOMPOSE,t,e,i)};t.prototype.dispatchRenderEvent=function(t,e,i){this.dispatchComposeEvent_(ln.RENDER,t,e,i)};t.prototype.getTransform=function(t,e){var i=t.viewState,r=t.pixelRatio,o=r*t.size[0]/2,n=r*t.size[1]/2,s=r/i.resolution,a=-s,l=-i.rotation,h=-i.center[0]+e,u=-i.center[1];return Ue(this.transform_,o,n,s,a,l,h,u)};t.prototype.composeFrame=function(t,e,i){};t.prototype.prepareFrame=function(t,e){};return t}(su),lu=function(a){function t(t){a.call(this,t);this.coordinateToCanvasPixelTransform=[1,0,0,1,0,0];this.hitCanvasContext_=null}a&&(t.__proto__=a);((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.composeFrame=function(t,e,i){this.preCompose(i,t);var r=this.getImage();if(r){var o=e.extent,n=void 0!==o&&!Q(o,t.extent)&&Rt(o,t.extent);n&&this.clip(i,t,o);var s=this.getImageTransform(),a=i.globalAlpha;i.globalAlpha=e.opacity;var l=s[4],h=s[5],u=r.width*s[0],c=r.height*s[3];i.drawImage(r,0,0,+r.width,+r.height,Math.round(l),Math.round(h),Math.round(u),Math.round(c));i.globalAlpha=a;n&&i.restore()}this.postCompose(i,t,e)};t.prototype.getImage=function(){};t.prototype.getImageTransform=function(){};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,o){var n=this.getLayer(),s=n.getSource(),a=e.viewState.resolution,l=e.viewState.rotation,h=e.skippedFeatureUids;return s.forEachFeatureAtCoordinate(t,a,l,i,h,function(t){return r.call(o,t,n)})};t.prototype.forEachLayerAtCoordinate=function(t,e,i,r,o){if(this.getImage()){if(this.getLayer().getSource().forEachFeatureAtCoordinate!==L)return a.prototype.forEachLayerAtCoordinate.call(this,arguments);var n=De(this.coordinateToCanvasPixelTransform,t.slice());Ko(n,e.viewState.resolution/this.renderedResolution);this.hitCanvasContext_||(this.hitCanvasContext_=ii(1,1));this.hitCanvasContext_.clearRect(0,0,1,1);this.hitCanvasContext_.drawImage(this.getImage(),n[0],n[1],1,1,0,0,1,1);var s=this.hitCanvasContext_.getImageData(0,0,1,1).data;return 0<s[3]?r.call(o,this.getLayer(),s):void 0}};return t}(au),hu=function(n){function o(t){n.call(this,t);this.image_=null;this.imageTransform_=[1,0,0,1,0,0];this.skippedFeatures_=[];this.vectorRenderer_=null;if(t.getType()===In.VECTOR)for(var e=0,i=ou.length;e<i;++e){var r=ou[e];if(r!==o&&r.handles(t)){this.vectorRenderer_=new r(t);break}}}n&&(o.__proto__=n);((o.prototype=Object.create(n&&n.prototype)).constructor=o).prototype.disposeInternal=function(){this.vectorRenderer_&&this.vectorRenderer_.dispose();n.prototype.disposeInternal.call(this)};o.prototype.getImage=function(){return this.image_?this.image_.getImage():null};o.prototype.getImageTransform=function(){return this.imageTransform_};o.prototype.prepareFrame=function(t,e){var i,r=t.pixelRatio,o=t.size,n=t.viewState,s=n.center,a=n.resolution,l=this.getLayer().getSource(),h=t.viewHints,u=this.vectorRenderer_,c=t.extent;u||void 0===e.extent||(c=pt(c,e.extent));if(!h[bs.ANIMATING]&&!h[bs.INTERACTING]&&!gt(c)){var p=n.projection,d=this.skippedFeatures_;if(u){var f=u.context,_=T({},t,{size:[_t(c)/a,ct(c)/a],viewState:T({},t.viewState,{rotation:0})}),g=Object.keys(_.skippedFeatureUids).sort();i=new gn(c,a,r,f.canvas,function(t){if(u.prepareFrame(_,e)&&(u.replayGroupChanged||!Ar(d,g))){f.canvas.width=_.size[0]*r;f.canvas.height=_.size[1]*r;u.compose(f,_,e);d=g;t()}})}else i=l.getImage(c,a,r,p);if(i&&this.loadImage(i)){this.image_=i;this.skippedFeatures_=d}}if(this.image_){var y=(i=this.image_).getExtent(),v=i.getResolution(),m=i.getPixelRatio(),E=r*v/(a*m),x=Ue(this.imageTransform_,r*o[0]/2,r*o[1]/2,E,E,0,m*(y[0]-s[0])/v,m*(s[1]-y[3])/v);Ue(this.coordinateToCanvasPixelTransform,r*o[0]/2-x[4],r*o[1]/2-x[5],r/a,-r/a,0,-s[0],-s[1]);this.renderedResolution=v*r/m}return!!this.image_};o.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,o){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,e,i,r,o):n.prototype.forEachFeatureAtCoordinate.call(this,t,e,i,r,o)};return o}(lu);hu.handles=function(t){return t.getType()===In.IMAGE||t.getType()===In.VECTOR&&t.getRenderMode()===Pl.IMAGE};hu.create=function(t,e){return new hu(e)};var uu=function(t,e,i,r){this.minX=t;this.maxX=e;this.minY=i;this.maxY=r};uu.prototype.contains=function(t){return this.containsXY(t[1],t[2])};uu.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY};uu.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY};uu.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY};uu.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX);t.maxX>this.maxX&&(this.maxX=t.maxX);t.minY<this.minY&&(this.minY=t.minY);t.maxY>this.maxY&&(this.maxY=t.maxY)};uu.prototype.getHeight=function(){return this.maxY-this.minY+1};uu.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]};uu.prototype.getWidth=function(){return this.maxX-this.minX+1};uu.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY};function cu(t,e,i,r,o){if(void 0===o)return new uu(t,e,i,r);o.minX=t;o.maxX=e;o.minY=i;o.maxY=r;return o}var pu=function(i){function t(t,e){i.call(this,t);this.context=e?null:ii();this.oversampling_;this.renderedExtent_=null;this.renderedRevision;this.renderedTiles=[];this.newTiles_=!1;this.tmpExtent=[1/0,1/0,-1/0,-1/0];this.tmpTileRange_=new uu(0,0,0,0);this.imageTransform_=[1,0,0,1,0,0];this.zDirection=0}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.isDrawableTile_=function(t){var e=t.getState(),i=this.getLayer().getUseInterimTilesOnError();return e==yn.LOADED||e==yn.EMPTY||e==yn.ERROR&&!i};t.prototype.getTile=function(t,e,i,r,o){var n=this.getLayer(),s=n.getSource().getTile(t,e,i,r,o);s.getState()==yn.ERROR&&(n.getUseInterimTilesOnError()?0<n.getPreload()&&(this.newTiles_=!0):s.setState(yn.LOADED));this.isDrawableTile_(s)||(s=s.getInterimTile());return s};t.prototype.prepareFrame=function(t,e){var i=t.pixelRatio,r=t.size,o=t.viewState,n=o.projection,s=o.resolution,a=o.center,l=this.getLayer(),h=l.getSource(),u=h.getRevision(),c=h.getTileGridForProjection(n),p=c.getZForResolution(s,this.zDirection),d=c.getResolution(p),f=Math.round(s/d)||1,_=t.extent;void 0!==e.extent&&(_=pt(_,e.extent));if(gt(_))return!1;var g=c.getTileRangeForExtentAndZ(_,p),y=c.getTileRangeExtent(p,g),v=h.getTilePixelRatio(i),m={};m[p]={};var E,x,T,S=this.createLoadedTileFinder(h,n,m),C=t.viewHints,R=C[bs.ANIMATING]||C[bs.INTERACTING],I=this.tmpExtent,w=this.tmpTileRange_;this.newTiles_=!1;for(x=g.minX;x<=g.maxX;++x)for(T=g.minY;T<=g.maxY;++T)if(!(16<Date.now()-t.time&&R)){E=this.getTile(p,x,T,i,n);if(this.isDrawableTile_(E)){var L=St(this);if(E.getState()==yn.LOADED){var O=(m[p][E.tileCoord.toString()]=E).inTransition(L);this.newTiles_||!O&&-1!==this.renderedTiles.indexOf(E)||(this.newTiles_=!0)}if(1===E.getAlpha(L,t.time))continue}var P=c.getTileCoordChildTileRange(E.tileCoord,w,I),b=!1;P&&(b=S(p+1,P));b||c.forEachTileCoordParentTileRange(E.tileCoord,S,null,w,I)}var M=d*i/v*f;if(!(this.renderedResolution&&16<Date.now()-t.time&&R)&&(this.newTiles_||!this.renderedExtent_||!Q(this.renderedExtent_,_)||this.renderedRevision!=u||f!=this.oversampling_||!R&&M!=this.renderedResolution)){var F=this.context;if(F){var A=h.getTilePixelSize(p,i,n),N=Math.round(g.getWidth()*A[0]/f),D=Math.round(g.getHeight()*A[1]/f),G=F.canvas;if(G.width!=N||G.height!=D){this.oversampling_=f;G.width=N;G.height=D}else{this.renderedExtent_&&!$(y,this.renderedExtent_)&&F.clearRect(0,0,N,D);f=this.oversampling_}}this.renderedTiles.length=0;var k,j,U,Y,B,V,X,z,W,H,K=Object.keys(m).map(Number);K.sort(function(t,e){return t===p?1:e===p?-1:e<t?1:t<e?-1:0});for(Y=0,B=K.length;Y<B;++Y){U=K[Y];j=h.getTilePixelSize(U,i,n);k=c.getResolution(U)/d;X=v*h.getGutterForProjection(n);z=m[U];for(var Z in z){E=z[Z];x=((V=c.getTileCoordExtent(E.getTileCoord(),I))[0]-y[0])/d*v/f;T=(y[3]-V[3])/d*v/f;W=j[0]*k/f;H=j[1]*k/f;this.drawTileImage(E,t,e,x,T,W,H,X,p===U);this.renderedTiles.push(E)}}this.renderedRevision=u;this.renderedResolution=d*i/v*f;this.renderedExtent_=y}var q=this.renderedResolution/s,J=Ue(this.imageTransform_,i*r[0]/2,i*r[1]/2,q,q,0,(this.renderedExtent_[0]-a[0])/this.renderedResolution*i,(a[1]-this.renderedExtent_[3])/this.renderedResolution*i);Ue(this.coordinateToCanvasPixelTransform,i*r[0]/2-J[4],i*r[1]/2-J[5],i/s,-i/s,0,-a[0],-a[1]);this.updateUsedTiles(t.usedTiles,h,p,g);this.manageTilePyramid(t,h,c,i,n,_,p,l.getPreload());this.scheduleExpireCache(t,h);return 0<this.renderedTiles.length};t.prototype.drawTileImage=function(t,e,i,r,o,n,s,a,l){var h=t.getImage(this.getLayer());if(h){var u=St(this),c=l?t.getAlpha(u,e.time):1;1!==c||this.getLayer().getSource().getOpaque(e.viewState.projection)||this.context.clearRect(r,o,n,s);var p=c!==this.context.globalAlpha;if(p){this.context.save();this.context.globalAlpha=c}this.context.drawImage(h,a,a,h.width-2*a,h.height-2*a,r,o,n,s);p&&this.context.restore();1!==c?e.animate=!0:l&&t.endTransition(u)}};t.prototype.getImage=function(){var t=this.context;return t?t.canvas:null};t.prototype.getImageTransform=function(){return this.imageTransform_};return t}(lu);pu.handles=function(t){return t.getType()===In.TILE};pu.create=function(t,e){return new pu(e)};pu.prototype.getLayer;var du=function(){};du.prototype.getReplay=function(t,e){};du.prototype.isEmpty=function(){};var fu={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function _u(t,e,i,r,o,n,s,a){for(var l,h,u,c=[],p=t[e]>t[i-r],d=o.length,f=t[e],_=t[e+1],g=t[e+=r],y=t[e+1],v=0,m=Math.sqrt(Math.pow(g-f,2)+Math.pow(y-_,2)),E="",x=0,T=0;T<d;++T){h=p?d-T-1:T;var S=o.charAt(h),C=n(E=p?S+E:E+S)-x;x+=C;for(var R=s+C/2;e<i-r&&v+m<R;){f=g;_=y;g=t[e+=r];y=t[e+1];v+=m;m=Math.sqrt(Math.pow(g-f,2)+Math.pow(y-_,2))}var I=R-v,w=Math.atan2(y-_,g-f);p&&(w+=0<w?-Math.PI:Math.PI);if(void 0!==u){var L=w-u;L+=L>Math.PI?-2*Math.PI:L<-Math.PI?2*Math.PI:0;if(Math.abs(L)>a)return null}var O=I/m,P=Gt(f,g,O),b=Gt(_,y,O);if(u==w){if(p){l[0]=P;l[1]=b;l[2]=C/2}l[4]=E}else{l=[P,b,(x=C)/2,w,E=S];p?c.unshift(l):c.push(l);u=w}s+=C}return c}var gu={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},yu=[gu.FILL],vu=[gu.STROKE],mu=[gu.BEGIN_PATH],Eu=[gu.CLOSE_PATH],xu=[fu.POLYGON,fu.CIRCLE,fu.LINE_STRING,fu.IMAGE,fu.TEXT,fu.DEFAULT],Tu={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Su=[1/0,1/0,-1/0,-1/0],Cu=[1,0,0,1,0,0],Ru=function(s){function t(t,e,i,r,o,n){s.call(this);this.declutterTree=n;this.tolerance=t;this.maxExtent=e;this.overlaps=o;this.pixelRatio=r;this.maxLineWidth=0;this.resolution=i;this.alignFill_;this.beginGeometryInstruction1_=null;this.beginGeometryInstruction2_=null;this.bufferedMaxExtent_=null;this.instructions=[];this.coordinates=[];this.coordinateCache_={};this.renderedTransform_=[1,0,0,1,0,0];this.hitDetectionInstructions=[];this.pixelCoordinates_=null;this.state={};this.viewRotation_=0}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.replayTextBackground_=function(t,e,i,r,o,n,s){t.beginPath();t.moveTo.apply(t,e);t.lineTo.apply(t,i);t.lineTo.apply(t,r);t.lineTo.apply(t,o);t.lineTo.apply(t,e);if(n){this.alignFill_=n[2];this.fill_(t)}if(s){this.setStrokeStyle_(t,s);t.stroke()}};t.prototype.replayImage_=function(t,e,i,r,o,n,s,a,l,h,u,c,p,d,f,_,g,y){var v=g||y;e-=o*=p;i-=n*=p;var m,E,x,T,S=f+h>r.width?r.width-h:f,C=a+u>r.height?r.height-u:a,R=_[3]+S*p+_[1],I=_[0]+C*p+_[2],w=e-_[3],L=i-_[0];if(v||0!==c){m=[w,L];E=[w+R,L];x=[w+R,L+I];T=[w,L+I]}var O=null;if(0!==c){var P=e+o,b=i+n;O=Ue(Cu,P,b,1,1,c,-P,-b);W(Su);J(Su,De(Cu,m));J(Su,De(Cu,E));J(Su,De(Cu,x));J(Su,De(Cu,T))}else z(w,L,w+R,L+I,Su);var M=t.canvas,F=y?y[2]*p/2:0,A=Su[0]-F<=M.width&&0<=Su[2]+F&&Su[1]-F<=M.height&&0<=Su[3]+F;if(d){e=Math.round(e);i=Math.round(i)}if(s){if(!A&&1==s[4])return;q(s,Su);var N=A?[t,O?O.slice(0):null,l,r,h,u,S,C,e,i,p]:null;N&&v&&N.push(g,y,m,E,x,T);s.push(N)}else if(A){v&&this.replayTextBackground_(t,m,E,x,T,g,y);cr(t,O,l,r,h,u,S,C,e,i,p)}};t.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})};t.prototype.appendFlatCoordinates=function(t,e,i,r,o,n){var s=this.coordinates.length,a=this.getBufferedMaxExtent();n&&(e+=r);var l,h,u,c=[t[e],t[e+1]],p=[NaN,NaN],d=!0;for(l=e+r;l<i;l+=r){p[0]=t[l];p[1]=t[l+1];if((u=V(a,p))!==h){if(d){this.coordinates[s++]=c[0];this.coordinates[s++]=c[1]}this.coordinates[s++]=p[0];this.coordinates[s++]=p[1];d=!1}else if(u===D.INTERSECTING){this.coordinates[s++]=p[0];this.coordinates[s++]=p[1];d=!1}else d=!0;c[0]=p[0];c[1]=p[1];h=u}if(o&&d||l===e+r){this.coordinates[s++]=c[0];this.coordinates[s++]=c[1]}return s};t.prototype.drawCustomCoordinates_=function(t,e,i,r,o){for(var n=0,s=i.length;n<s;++n){var a=i[n],l=this.appendFlatCoordinates(t,e,a,r,!1,!1);o.push(l);e=a}return e};t.prototype.drawCustom=function(t,e,i){this.beginGeometry(t,e);var r,o,n,s,a,l=t.getType(),h=t.getStride(),u=this.coordinates.length;if(l==kt.MULTI_POLYGON){r=(t=t).getOrientedFlatCoordinates();s=[];for(var c=t.getEndss(),p=a=0,d=c.length;p<d;++p){var f=[];a=this.drawCustomCoordinates_(r,a,c[p],h,f);s.push(f)}this.instructions.push([gu.CUSTOM,u,s,t,i,oo])}else if(l==kt.POLYGON||l==kt.MULTI_LINE_STRING){n=[];r=l==kt.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates();a=this.drawCustomCoordinates_(r,0,t.getEnds(),h,n);this.instructions.push([gu.CUSTOM,u,n,t,i,ro])}else if(l==kt.LINE_STRING||l==kt.MULTI_POINT){r=t.getFlatCoordinates();o=this.appendFlatCoordinates(r,0,r.length,h,!1,!1);this.instructions.push([gu.CUSTOM,u,o,t,i,io])}else if(l==kt.POINT){r=t.getFlatCoordinates();this.coordinates.push(r[0],r[1]);o=this.coordinates.length;this.instructions.push([gu.CUSTOM,u,o,t,i])}this.endGeometry(t,e)};t.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[gu.BEGIN_GEOMETRY,e,0];this.instructions.push(this.beginGeometryInstruction1_);this.beginGeometryInstruction2_=[gu.BEGIN_GEOMETRY,e,0];this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)};t.prototype.finish=function(){};t.prototype.fill_=function(t){if(this.alignFill_){var e=De(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.translate(e[0]%i,e[1]%i);t.rotate(this.viewRotation_)}t.fill();this.alignFill_&&t.setTransform.apply(t,ur)};t.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1];t.lineWidth=e[2];t.lineCap=e[3];t.lineJoin=e[4];t.miterLimit=e[5];if(Pi){t.lineDashOffset=e[7];t.setLineDash(e[6])}};t.prototype.renderDeclutter_=function(t,e){if(t&&5<t.length){var i=t[4];if(1==i||i==t.length-5){var r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};if(!this.declutterTree.collides(r)){this.declutterTree.insert(r);for(var o=5,n=t.length;o<n;++o){var s=t[o];if(s){11<s.length&&this.replayTextBackground_(s[0],s[13],s[14],s[15],s[16],s[11],s[12]);cr.apply(void 0,s)}}}t.length=5;W(t)}}};t.prototype.replay_=function(t,e,i,r,o,n,s){var a,l=this;if(this.pixelCoordinates_&&Ar(e,this.renderedTransform_))a=this.pixelCoordinates_;else{this.pixelCoordinates_||(this.pixelCoordinates_=[]);a=It(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_);Ne(this.renderedTransform_,e)}for(var h,u,c,p,d,f,_,g,y,v,m,E,x=!Ct(i),T=0,S=r.length,C=0,R=0,I=0,w=null,L=null,O=this.coordinateCache_,P=this.viewRotation_,b={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:P},M=this.instructions!=r||this.overlaps?0:200;T<S;){var F=r[T];switch(F[0]){case gu.BEGIN_GEOMETRY:v=F[1];x&&i[St(v).toString()]||!v.getGeometry()?T=F[2]:void 0===s||Rt(s,v.getGeometry().getExtent())?++T:T=F[2]+1;break;case gu.BEGIN_PATH:if(M<R){l.fill_(t);R=0}if(M<I){t.stroke();I=0}if(!R&&!I){t.beginPath();p=d=NaN}++T;break;case gu.CIRCLE:var A=a[C=F[1]],N=a[C+1],D=a[C+2]-A,G=a[C+3]-N,k=Math.sqrt(D*D+G*G);t.moveTo(A+k,N);t.arc(A,N,k,0,2*Math.PI,!0);++T;break;case gu.CLOSE_PATH:t.closePath();++T;break;case gu.CUSTOM:C=F[1];h=F[2];var j=F[3],U=F[4],Y=6==F.length?F[5]:void 0;b.geometry=j;b.feature=v;T in O||(O[T]=[]);var B=O[T];if(Y)Y(a,C,h,2,B);else{B[0]=a[C];B[1]=a[C+1];B.length=2}U(B,b);++T;break;case gu.DRAW_IMAGE:C=F[1];h=F[2];y=F[3];u=F[4];c=F[5];g=n?null:F[6];var V=F[7],X=F[8],z=F[9],W=F[10],H=F[11],K=F[12],Z=F[13],q=F[14],J=void 0,Q=void 0,$=void 0;if(16<F.length){J=F[15];Q=F[16];$=F[17]}else{J=Qi;Q=$=!1}H&&(K+=P);for(;C<h;C+=2)l.replayImage_(t,a[C],a[C+1],y,u,c,g,V,X,z,W,K,Z,o,q,J,Q?w:null,$?L:null);l.renderDeclutter_(g,v);++T;break;case gu.DRAW_CHARS:var tt=F[1],et=F[2],it=F[3];g=n?null:F[4];var rt=F[5],ot=F[6],nt=F[7],st=F[8],at=F[9],lt=F[10],ht=F[11],ut=F[12],ct=F[13],pt=F[14],dt=rn(a,tt,et,2),ft=st(ut);if(rt||ft<=dt){var _t=l.textStates[ct].textAlign,gt=_u(a,tt,et,2,ut,st,(dt-ft)*Tu[_t],nt);if(gt){var yt=void 0,vt=void 0,mt=void 0,Et=void 0,xt=void 0;if(lt)for(yt=0,vt=gt.length;yt<vt;++yt){mt=(xt=gt[yt])[4];Et=l.getImage(mt,ct,"",lt);u=xt[2]+ht;c=it*Et.height+2*(.5-it)*ht-at;l.replayImage_(t,xt[0],xt[1],Et,u,c,g,Et.height,1,0,0,xt[3],pt,!1,Et.width,Qi,null,null)}if(ot)for(yt=0,vt=gt.length;yt<vt;++yt){mt=(xt=gt[yt])[4];Et=l.getImage(mt,ct,ot,"");u=xt[2];c=it*Et.height-at;l.replayImage_(t,xt[0],xt[1],Et,u,c,g,Et.height,1,0,0,xt[3],pt,!1,Et.width,Qi,null,null)}}}l.renderDeclutter_(g,v);++T;break;case gu.END_GEOMETRY:if(void 0!==n){var Tt=n(v=F[1]);if(Tt)return Tt}++T;break;case gu.FILL:M?R++:l.fill_(t);++T;break;case gu.MOVE_TO_LINE_TO:C=F[1];h=F[2];m=a[C];_=(E=a[C+1])+.5|0;if((f=m+.5|0)!==p||_!==d){t.moveTo(m,E);p=f;d=_}for(C+=2;C<h;C+=2){f=(m=a[C])+.5|0;_=(E=a[C+1])+.5|0;if(C==h-2||f!==p||_!==d){t.lineTo(m,E);p=f;d=_}}++T;break;case gu.SET_FILL_STYLE:w=F;l.alignFill_=F[2];if(R){l.fill_(t);R=0;if(I){t.stroke();I=0}}t.fillStyle=F[1];++T;break;case gu.SET_STROKE_STYLE:L=F;if(I){t.stroke();I=0}l.setStrokeStyle_(t,F);++T;break;case gu.STROKE:M?I++:t.stroke();++T;break;default:++T}}R&&this.fill_(t);I&&t.stroke()};t.prototype.replay=function(t,e,i,r,o){this.viewRotation_=i;this.replay_(t,e,r,this.instructions,o,void 0,void 0)};t.prototype.replayHitDetection=function(t,e,i,r,o,n){this.viewRotation_=i;return this.replay_(t,e,r,this.hitDetectionInstructions,!0,o,n)};t.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var i,r,o=e.length,n=-1;for(t=0;t<o;++t)if((r=(i=e[t])[0])==gu.END_GEOMETRY)n=t;else if(r==gu.BEGIN_GEOMETRY){i[2]=t;Pr(this.hitDetectionInstructions,n,t);n=-1}};t.prototype.setFillStrokeStyle=function(t,e){var i=this.state;if(t){var r=t.getColor();i.fillStyle=ti(r||zi)}else i.fillStyle=void 0;if(e){var o=e.getColor();i.strokeStyle=ti(o||Zi);var n=e.getLineCap();i.lineCap=void 0!==n?n:Wi;var s=e.getLineDash();i.lineDash=s?s.slice():Hi;var a=e.getLineDashOffset();i.lineDashOffset=a||0;var l=e.getLineJoin();i.lineJoin=void 0!==l?l:Ki;var h=e.getWidth();i.lineWidth=void 0!==h?h:1;var u=e.getMiterLimit();i.miterLimit=void 0!==u?u:10;if(i.lineWidth>this.maxLineWidth){this.maxLineWidth=i.lineWidth;this.bufferedMaxExtent_=null}}else{i.strokeStyle=void 0;i.lineCap=void 0;i.lineDash=null;i.lineDashOffset=void 0;i.lineJoin=void 0;i.lineWidth=void 0;i.miterLimit=void 0}};t.prototype.createFill=function(t,e){var i=t.fillStyle,r=[gu.SET_FILL_STYLE,i];"string"!=typeof i&&r.push(!0);return r};t.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))};t.prototype.createStroke=function(t){return[gu.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]};t.prototype.updateFillStyle=function(t,e,i){var r=t.fillStyle;if("string"!=typeof r||t.currentFillStyle!=r){void 0!==r&&this.instructions.push(e.call(this,t,i));t.currentFillStyle=r}};t.prototype.updateStrokeStyle=function(t,e){var i=t.strokeStyle,r=t.lineCap,o=t.lineDash,n=t.lineDashOffset,s=t.lineJoin,a=t.lineWidth,l=t.miterLimit;if(t.currentStrokeStyle!=i||t.currentLineCap!=r||o!=t.currentLineDash&&!Ar(t.currentLineDash,o)||t.currentLineDashOffset!=n||t.currentLineJoin!=s||t.currentLineWidth!=a||t.currentMiterLimit!=l){void 0!==i&&e.call(this,t);t.currentStrokeStyle=i;t.currentLineCap=r;t.currentLineDash=o;t.currentLineDashOffset=n;t.currentLineJoin=s;t.currentLineWidth=a;t.currentMiterLimit=l}};t.prototype.endGeometry=function(t,e){this.beginGeometryInstruction1_[2]=this.instructions.length;this.beginGeometryInstruction1_=null;this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length;this.beginGeometryInstruction2_=null;var i=[gu.END_GEOMETRY,e];this.instructions.push(i);this.hitDetectionInstructions.push(i)};t.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_){this.bufferedMaxExtent_=j(this.maxExtent);if(0<this.maxLineWidth){var t=this.resolution*(this.maxLineWidth+1)/2;k(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}}return this.bufferedMaxExtent_};return t}(qh),Iu=function(s){function t(t,e,i,r,o,n){s.call(this,t,e,i,r,o,n);this.declutterGroup_=null;this.hitDetectionImage_=null;this.image_=null;this.anchorX_=void 0;this.anchorY_=void 0;this.height_=void 0;this.opacity_=void 0;this.originX_=void 0;this.originY_=void 0;this.rotateWithView_=void 0;this.rotation_=void 0;this.scale_=void 0;this.width_=void 0}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.drawCoordinates_=function(t,e,i,r){return this.appendFlatCoordinates(t,e,i,r,!1,!1)};t.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),r=t.getStride(),o=this.coordinates.length,n=this.drawCoordinates_(i,0,i.length,r);this.instructions.push([gu.DRAW_IMAGE,o,n,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]);this.hitDetectionInstructions.push([gu.DRAW_IMAGE,o,n,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]);this.endGeometry(t,e)}};t.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),r=t.getStride(),o=this.coordinates.length,n=this.drawCoordinates_(i,0,i.length,r);this.instructions.push([gu.DRAW_IMAGE,o,n,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]);this.hitDetectionInstructions.push([gu.DRAW_IMAGE,o,n,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]);this.endGeometry(t,e)}};t.prototype.finish=function(){this.reverseHitDetectionInstructions();this.anchorX_=void 0;this.anchorY_=void 0;this.hitDetectionImage_=null;this.image_=null;this.height_=void 0;this.scale_=void 0;this.opacity_=void 0;this.originX_=void 0;this.originY_=void 0;this.rotateWithView_=void 0;this.rotation_=void 0;this.width_=void 0};t.prototype.setImageStyle=function(t,e){var i=t.getAnchor(),r=t.getSize(),o=t.getHitDetectionImage(1),n=t.getImage(1),s=t.getOrigin();this.anchorX_=i[0];this.anchorY_=i[1];this.declutterGroup_=e;this.hitDetectionImage_=o;this.image_=n;this.height_=r[1];this.opacity_=t.getOpacity();this.originX_=s[0];this.originY_=s[1];this.rotateWithView_=t.getRotateWithView();this.rotation_=t.getRotation();this.scale_=t.getScale();this.width_=r[0]};return t}(Ru),wu=function(s){function t(t,e,i,r,o,n){s.call(this,t,e,i,r,o,n)}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.drawFlatCoordinates_=function(t,e,i,r){var o=this.coordinates.length,n=this.appendFlatCoordinates(t,e,i,r,!1,!1),s=[gu.MOVE_TO_LINE_TO,o,n];this.instructions.push(s);this.hitDetectionInstructions.push(s);return i};t.prototype.drawLineString=function(t,e){var i=this.state,r=i.strokeStyle,o=i.lineWidth;if(void 0!==r&&void 0!==o){this.updateStrokeStyle(i,this.applyStroke);this.beginGeometry(t,e);this.hitDetectionInstructions.push([gu.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],mu);var n=t.getFlatCoordinates(),s=t.getStride();this.drawFlatCoordinates_(n,0,n.length,s);this.hitDetectionInstructions.push(vu);this.endGeometry(t,e)}};t.prototype.drawMultiLineString=function(t,e){var i=this.state,r=i.strokeStyle,o=i.lineWidth;if(void 0!==r&&void 0!==o){this.updateStrokeStyle(i,this.applyStroke);this.beginGeometry(t,e);this.hitDetectionInstructions.push([gu.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],mu);for(var n=t.getEnds(),s=t.getFlatCoordinates(),a=t.getStride(),l=0,h=0,u=n.length;h<u;++h)l=this.drawFlatCoordinates_(s,l,n[h],a);this.hitDetectionInstructions.push(vu);this.endGeometry(t,e)}};t.prototype.finish=function(){var t=this.state;null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(vu);this.reverseHitDetectionInstructions();this.state=null};t.prototype.applyStroke=function(t){if(null!=t.lastStroke&&t.lastStroke!=this.coordinates.length){this.instructions.push(vu);t.lastStroke=this.coordinates.length}t.lastStroke=0;s.prototype.applyStroke.call(this,t);this.instructions.push(mu)};return t}(Ru),Lu=function(s){function t(t,e,i,r,o,n){s.call(this,t,e,i,r,o,n)}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.drawFlatCoordinatess_=function(t,e,i,r){var o=this.state,n=void 0!==o.fillStyle,s=null!=o.strokeStyle,a=i.length;this.instructions.push(mu);this.hitDetectionInstructions.push(mu);for(var l=0;l<a;++l){var h=i[l],u=this.coordinates.length,c=this.appendFlatCoordinates(t,e,h,r,!0,!s),p=[gu.MOVE_TO_LINE_TO,u,c];this.instructions.push(p);this.hitDetectionInstructions.push(p);if(s){this.instructions.push(Eu);this.hitDetectionInstructions.push(Eu)}e=h}if(n){this.instructions.push(yu);this.hitDetectionInstructions.push(yu)}if(s){this.instructions.push(vu);this.hitDetectionInstructions.push(vu)}return e};t.prototype.drawCircle=function(t,e){var i=this.state,r=i.fillStyle,o=i.strokeStyle;if(void 0!==r||void 0!==o){this.setFillStrokeStyles_(t);this.beginGeometry(t,e);void 0!==i.fillStyle&&this.hitDetectionInstructions.push([gu.SET_FILL_STYLE,He(zi)]);void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([gu.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var n=t.getFlatCoordinates(),s=t.getStride(),a=this.coordinates.length;this.appendFlatCoordinates(n,0,n.length,s,!1,!1);var l=[gu.CIRCLE,a];this.instructions.push(mu,l);this.hitDetectionInstructions.push(mu,l);this.hitDetectionInstructions.push(yu);void 0!==i.fillStyle&&this.instructions.push(yu);if(void 0!==i.strokeStyle){this.instructions.push(vu);this.hitDetectionInstructions.push(vu)}this.endGeometry(t,e)}};t.prototype.drawPolygon=function(t,e){var i=this.state,r=i.fillStyle,o=i.strokeStyle;if(void 0!==r||void 0!==o){this.setFillStrokeStyles_(t);this.beginGeometry(t,e);void 0!==i.fillStyle&&this.hitDetectionInstructions.push([gu.SET_FILL_STYLE,He(zi)]);void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([gu.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var n=t.getEnds(),s=t.getOrientedFlatCoordinates(),a=t.getStride();this.drawFlatCoordinatess_(s,0,n,a);this.endGeometry(t,e)}};t.prototype.drawMultiPolygon=function(t,e){var i=this.state,r=i.fillStyle,o=i.strokeStyle;if(void 0!==r||void 0!==o){this.setFillStrokeStyles_(t);this.beginGeometry(t,e);void 0!==i.fillStyle&&this.hitDetectionInstructions.push([gu.SET_FILL_STYLE,He(zi)]);void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([gu.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);for(var n=t.getEndss(),s=t.getOrientedFlatCoordinates(),a=t.getStride(),l=0,h=0,u=n.length;h<u;++h)l=this.drawFlatCoordinatess_(s,l,n[h],a);this.endGeometry(t,e)}};t.prototype.finish=function(){this.reverseHitDetectionInstructions();this.state=null;var t=this.tolerance;if(0!==t)for(var e=this.coordinates,i=0,r=e.length;i<r;++i)e[i]=lo(e[i],t)};t.prototype.setFillStrokeStyles_=function(t){var e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.createFill,t);void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)};return t}(Ru);function Ou(t,e,i,r,o){var n,s,a,l,h,u,c,p,d,f=i,_=i,g=0,y=0,v=i;for(n=i;n<r;n+=o){var m=e[n],E=e[n+1];if(void 0!==l){p=m-l;d=E-h;a=Math.sqrt(p*p+d*d);if(void 0!==u){y+=s;if(t<Math.acos((u*p+c*d)/(s*a))){if(g<y){g=y;f=v;_=n}y=0;v=n-o}}s=a;u=p;c=d}l=m;h=E}return g<(y+=a)?[v,n]:[f,_]}var Pu=function(s){function t(t,e,i,r,o,n){s.call(this,t,e,i,r,o,n);this.declutterGroup_;this.labels_=null;this.text_="";this.textOffsetX_=0;this.textOffsetY_=0;this.textRotateWithView_=void 0;this.textRotation_=0;this.textFillState_=null;this.fillStates={};this.textStrokeState_=null;this.strokeStates={};this.textState_={};this.textStates={};this.textKey_="";this.fillKey_="";this.strokeKey_="";this.widths_={};$i.prune()}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.drawText=function(t,e){var i=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(""!==this.text_&&o&&(i||r)){var n,s,a=this.coordinates.length,l=t.getType(),h=null,u=2,c=2;if(o.placement===hn.LINE){if(!Rt(this.getBufferedMaxExtent(),t.getExtent()))return;var p;h=t.getFlatCoordinates();c=t.getStride();if(l==kt.LINE_STRING)p=[h.length];else if(l==kt.MULTI_LINE_STRING)p=t.getEnds();else if(l==kt.POLYGON)p=t.getEnds().slice(0,1);else if(l==kt.MULTI_POLYGON){var d=t.getEndss();p=[];for(n=0,s=d.length;n<s;++n)p.push(d[n][0])}this.beginGeometry(t,e);for(var f,_=o.textAlign,g=0,y=0,v=p.length;y<v;++y){if(null==_){var m=Ou(o.maxAngle,h,g,p[y],c);g=m[0];f=m[1]}else f=p[y];for(n=g;n<f;n+=c)this.coordinates.push(h[n],h[n+1]);u=this.coordinates.length;g=p[y];this.drawChars_(a,u,this.declutterGroup_);a=u}this.endGeometry(t,e)}else{var E=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),x=E.width/this.pixelRatio;switch(l){case kt.POINT:case kt.MULTI_POINT:u=(h=t.getFlatCoordinates()).length;break;case kt.LINE_STRING:h=t.getFlatMidpoint();break;case kt.CIRCLE:h=t.getCenter();break;case kt.MULTI_LINE_STRING:u=(h=t.getFlatMidpoints()).length;break;case kt.POLYGON:h=t.getFlatInteriorPoint();if(!o.overflow&&h[2]/this.resolution<x)return;c=3;break;case kt.MULTI_POLYGON:var T=t.getFlatInteriorPoints();h=[];for(n=0,s=T.length;n<s;n+=3)(o.overflow||T[n+2]/this.resolution>=x)&&h.push(T[n],T[n+1]);if(0==(u=h.length))return}u=this.appendFlatCoordinates(h,0,u,c,!1,!1);if(o.backgroundFill||o.backgroundStroke){this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke);if(o.backgroundFill){this.updateFillStyle(this.state,this.createFill,t);this.hitDetectionInstructions.push(this.createFill(this.state,t))}if(o.backgroundStroke){this.updateStrokeStyle(this.state,this.applyStroke);this.hitDetectionInstructions.push(this.createStroke(this.state))}}this.beginGeometry(t,e);this.drawTextImage_(E,a,u);this.endGeometry(t,e)}}};t.prototype.getImage=function(t,e,i,r){var o,n=r+e+t+i+this.pixelRatio;if(!$i.containsKey(n)){var s=r?this.strokeStates[r]||this.textStrokeState_:null,a=i?this.fillStates[i]||this.textFillState_:null,l=this.textStates[e]||this.textState_,h=this.pixelRatio,u=l.scale*h,c=Tu[l.textAlign||qi],p=r&&s.lineWidth?s.lineWidth:0,d=t.split("\n"),f=d.length,_=[],g=bu(l.font,d,_),y=ar(l.font),v=y*f,m=g+p,E=ii(Math.ceil(m*u),Math.ceil((v+p)*u));o=E.canvas;$i.set(n,o);1!=u&&E.scale(u,u);E.font=l.font;if(r){E.strokeStyle=s.strokeStyle;E.lineWidth=p;E.lineCap=s.lineCap;E.lineJoin=s.lineJoin;E.miterLimit=s.miterLimit;if(Pi&&s.lineDash.length){E.setLineDash(s.lineDash);E.lineDashOffset=s.lineDashOffset}}i&&(E.fillStyle=a.fillStyle);E.textBaseline="middle";E.textAlign="center";var x,T=.5-c,S=c*o.width/u+T*p;if(r)for(x=0;x<f;++x)E.strokeText(d[x],S+T*_[x],.5*(p+y)+x*y);if(i)for(x=0;x<f;++x)E.fillText(d[x],S+T*_[x],.5*(p+y)+x*y)}return $i.get(n)};t.prototype.drawTextImage_=function(t,e,i){var r=this.textState_,o=this.textStrokeState_,n=this.pixelRatio,s=Tu[r.textAlign||qi],a=Tu[r.textBaseline],l=o&&o.lineWidth?o.lineWidth:0,h=s*t.width/n+2*(.5-s)*l,u=a*t.height/n+2*(.5-a)*l;this.instructions.push([gu.DRAW_IMAGE,e,i,t,(h-this.textOffsetX_)*n,(u-this.textOffsetY_)*n,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,t.width,r.padding==Qi?Qi:r.padding.map(function(t){return t*n}),!!r.backgroundFill,!!r.backgroundStroke]);this.hitDetectionInstructions.push([gu.DRAW_IMAGE,e,i,t,(h-this.textOffsetX_)*n,(u-this.textOffsetY_)*n,this.declutterGroup_,t.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/n,t.width,r.padding,!!r.backgroundFill,!!r.backgroundStroke])};t.prototype.drawChars_=function(t,e,i){var r=this.textStrokeState_,o=this.textState_,n=this.textFillState_,s=this.strokeKey_;r&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:r.strokeStyle,lineCap:r.lineCap,lineDashOffset:r.lineDashOffset,lineWidth:r.lineWidth,lineJoin:r.lineJoin,miterLimit:r.miterLimit,lineDash:r.lineDash}));var a=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:o.font,textAlign:o.textAlign||qi,scale:o.scale});var l=this.fillKey_;n&&(l in this.fillStates||(this.fillStates[l]={fillStyle:n.fillStyle}));var h=this.pixelRatio,u=Tu[o.textBaseline],c=this.textOffsetY_*h,p=this.text_,d=o.font,f=o.scale,_=r?r.lineWidth*f/2:0,g=this.widths_[d];g||(this.widths_[d]=g={});this.instructions.push([gu.DRAW_CHARS,t,e,u,i,o.overflow,l,o.maxAngle,function(t){var e=g[t];e||(e=g[t]=lr(d,t));return e*f*h},c,s,_*h,p,a,1]);this.hitDetectionInstructions.push([gu.DRAW_CHARS,t,e,u,i,o.overflow,l,o.maxAngle,function(t){var e=g[t];e||(e=g[t]=lr(d,t));return e*f},c,s,_,p,a,1/h])};t.prototype.setTextStyle=function(t,e){var i,r,o;if(t){this.declutterGroup_=e;var n=t.getFill();if(n){(r=this.textFillState_)||(r=this.textFillState_={});r.fillStyle=ti(n.getColor()||zi)}else r=this.textFillState_=null;var s=t.getStroke();if(s){(o=this.textStrokeState_)||(o=this.textStrokeState_={});var a=s.getLineDash(),l=s.getLineDashOffset(),h=s.getWidth(),u=s.getMiterLimit();o.lineCap=s.getLineCap()||Wi;o.lineDash=a?a.slice():Hi;o.lineDashOffset=void 0===l?0:l;o.lineJoin=s.getLineJoin()||Ki;o.lineWidth=void 0===h?1:h;o.miterLimit=void 0===u?10:u;o.strokeStyle=ti(s.getColor()||Zi)}else o=this.textStrokeState_=null;i=this.textState_;var c=t.getFont()||Xi;rr(c);var p=t.getScale();i.overflow=t.getOverflow();i.font=c;i.maxAngle=t.getMaxAngle();i.placement=t.getPlacement();i.textAlign=t.getTextAlign();i.textBaseline=t.getTextBaseline()||Ji;i.backgroundFill=t.getBackgroundFill();i.backgroundStroke=t.getBackgroundStroke();i.padding=t.getPadding()||Qi;i.scale=void 0===p?1:p;var d=t.getOffsetX(),f=t.getOffsetY(),_=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"";this.textOffsetX_=void 0===d?0:d;this.textOffsetY_=void 0===f?0:f;this.textRotateWithView_=void 0!==_&&_;this.textRotation_=void 0===g?0:g;this.strokeKey_=o?("string"==typeof o.strokeStyle?o.strokeStyle:St(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"";this.textKey_=i.font+i.scale+(i.textAlign||"?");this.fillKey_=r?"string"==typeof r.fillStyle?r.fillStyle:"|"+St(r.fillStyle):""}else this.text_=""};return t}(Ru);function bu(t,e,i){for(var r=e.length,o=0,n=0;n<r;++n){var s=lr(t,e[n]);o=Math.max(o,s);i.push(s)}return o}var Mu={Circle:Lu,Default:Ru,Image:Iu,LineString:wu,Polygon:Lu,Text:Pu},Fu=function(a){function t(t,e,i,r,o,n,s){a.call(this);this.declutterTree_=n;this.declutterGroup_=null;this.tolerance_=t;this.maxExtent_=e;this.overlaps_=o;this.pixelRatio_=r;this.resolution_=i;this.renderBuffer_=s;this.replaysByZIndex_={};this.hitDetectionContext_=ii(1,1);this.hitDetectionTransform_=[1,0,0,1,0,0]}a&&(t.__proto__=a);((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.addDeclutter=function(t){var e=null;this.declutterTree_&&(t?(e=this.declutterGroup_)[4]++:(e=this.declutterGroup_=[1/0,1/0,-1/0,-1/0]).push(1));return e};t.prototype.clip=function(t,e){var i=this.getClipCoords(e);t.beginPath();t.moveTo(i[0],i[1]);t.lineTo(i[2],i[3]);t.lineTo(i[4],i[5]);t.lineTo(i[6],i[7]);t.clip()};t.prototype.hasReplays=function(t){for(var e in this.replaysByZIndex_)for(var i=this.replaysByZIndex_[e],r=0,o=t.length;r<o;++r)if(t[r]in i)return!0;return!1};t.prototype.finish=function(){for(var t in this.replaysByZIndex_){var e=this.replaysByZIndex_[t];for(var i in e)e[i].finish()}};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,o,n,s){var a,l=2*(r=Math.round(r))+1,h=Ue(this.hitDetectionTransform_,r+.5,r+.5,1/e,-1/e,-i,-t[0],-t[1]),u=this.hitDetectionContext_;if(u.canvas.width!==l||u.canvas.height!==l){u.canvas.width=l;u.canvas.height=l}else u.clearRect(0,0,l,l);if(void 0!==this.renderBuffer_){J(a=[1/0,1/0,-1/0,-1/0],t);k(a,e*(this.renderBuffer_+r),a)}var c,p,d=Du(r);this.declutterTree_&&(c=this.declutterTree_.all().map(function(t){return t.value}));function f(t){for(var e=u.getImageData(0,0,l,l).data,i=0;i<l;i++)for(var r=0;r<l;r++)if(d[i][r]&&0<e[4*(r*l+i)+3]){var o=void 0;(!c||p!=fu.IMAGE&&p!=fu.TEXT||-1!==c.indexOf(t))&&(o=n(t));if(o)return o;u.clearRect(0,0,l,l);return}}var _,g,y,v,m,E=Object.keys(this.replaysByZIndex_).map(Number);E.sort(wr);for(_=E.length-1;0<=_;--_){var x=E[_].toString();y=this.replaysByZIndex_[x];for(g=xu.length-1;0<=g;--g)if(void 0!==(v=y[p=xu[g]]))if(!s||p!=fu.IMAGE&&p!=fu.TEXT){if(m=v.replayHitDetection(u,h,i,o,f,a))return m}else{var T=s[x];T?T.push(v,h.slice(0)):s[x]=[v,h.slice(0)]}}};t.prototype.getClipCoords=function(t){var e=this.maxExtent_,i=e[0],r=e[1],o=e[2],n=e[3],s=[i,r,i,n,o,n,o,r];It(s,0,8,2,t,s);return s};t.prototype.getReplay=function(t,e){var i=void 0!==t?t.toString():"0",r=this.replaysByZIndex_[i];if(void 0===r){r={};this.replaysByZIndex_[i]=r}var o=r[e];if(void 0===o){o=new Mu[e](this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_);r[e]=o}return o};t.prototype.getReplays=function(){return this.replaysByZIndex_};t.prototype.isEmpty=function(){return Ct(this.replaysByZIndex_)};t.prototype.replay=function(t,e,i,r,o,n,s){var a=Object.keys(this.replaysByZIndex_).map(Number);a.sort(wr);t.save();this.clip(t,e);var l,h,u,c,p,d,f=n||xu;for(l=0,h=a.length;l<h;++l){var _=a[l].toString();p=this.replaysByZIndex_[_];for(u=0,c=f.length;u<c;++u){var g=f[u];d=p[g];if(void 0!==d)if(!s||g!=fu.IMAGE&&g!=fu.TEXT)d.replay(t,e,i,r,o);else{var y=s[_];y?y.push(d,e.slice(0)):s[_]=[d,e.slice(0)]}}}t.restore()};return t}(du),Au={0:[[!0]]};function Nu(t,e,i){var r,o=Math.floor(t.length/2);if(o<=e)for(r=o;r<e;r++)t[r][i]=!0;else if(e<o)for(r=e+1;r<o;r++)t[r][i]=!0}function Du(t){if(void 0!==Au[t])return Au[t];for(var e=2*t+1,i=new Array(e),r=0;r<e;r++)i[r]=new Array(e);for(var o=t,n=0,s=0;n<=o;){Nu(i,t+o,t+n);Nu(i,t+n,t+o);Nu(i,t-n,t+o);Nu(i,t-o,t+n);Nu(i,t-o,t-n);Nu(i,t-n,t-o);Nu(i,t+n,t-o);Nu(i,t+o,t-n);0<2*((s+=1+2*++n)-o)+1&&(s+=1-2*(o-=1))}return Au[t]=i}function Gu(t,e,i,r){for(var o=Object.keys(t).map(Number).sort(wr),n={},s=0,a=o.length;s<a;++s)for(var l=t[o[s].toString()],h=0,u=l.length;h<u;){var c=l[h++],p=l[h++];c.replay(e,p,i,n,r)}}var ku=.5,ju={Point:function(t,e,i,r){var o=i.getImage();if(o){if(o.getImageState()!=Ni.LOADED)return;var n=t.getReplay(i.getZIndex(),fu.IMAGE);n.setImageStyle(o,t.addDeclutter(!1));n.drawPoint(e,r)}var s=i.getText();if(s){var a=t.getReplay(i.getZIndex(),fu.TEXT);a.setTextStyle(s,t.addDeclutter(!!o));a.drawText(e,r)}},LineString:function(t,e,i,r){var o=i.getStroke();if(o){var n=t.getReplay(i.getZIndex(),fu.LINE_STRING);n.setFillStrokeStyle(null,o);n.drawLineString(e,r)}var s=i.getText();if(s){var a=t.getReplay(i.getZIndex(),fu.TEXT);a.setTextStyle(s,t.addDeclutter(!1));a.drawText(e,r)}},Polygon:function(t,e,i,r){var o=i.getFill(),n=i.getStroke();if(o||n){var s=t.getReplay(i.getZIndex(),fu.POLYGON);s.setFillStrokeStyle(o,n);s.drawPolygon(e,r)}var a=i.getText();if(a){var l=t.getReplay(i.getZIndex(),fu.TEXT);l.setTextStyle(a,t.addDeclutter(!1));l.drawText(e,r)}},MultiPoint:function(t,e,i,r){var o=i.getImage();if(o){if(o.getImageState()!=Ni.LOADED)return;var n=t.getReplay(i.getZIndex(),fu.IMAGE);n.setImageStyle(o,t.addDeclutter(!1));n.drawMultiPoint(e,r)}var s=i.getText();if(s){var a=t.getReplay(i.getZIndex(),fu.TEXT);a.setTextStyle(s,t.addDeclutter(!!o));a.drawText(e,r)}},MultiLineString:function(t,e,i,r){var o=i.getStroke();if(o){var n=t.getReplay(i.getZIndex(),fu.LINE_STRING);n.setFillStrokeStyle(null,o);n.drawMultiLineString(e,r)}var s=i.getText();if(s){var a=t.getReplay(i.getZIndex(),fu.TEXT);a.setTextStyle(s,t.addDeclutter(!1));a.drawText(e,r)}},MultiPolygon:function(t,e,i,r){var o=i.getFill(),n=i.getStroke();if(n||o){var s=t.getReplay(i.getZIndex(),fu.POLYGON);s.setFillStrokeStyle(o,n);s.drawMultiPolygon(e,r)}var a=i.getText();if(a){var l=t.getReplay(i.getZIndex(),fu.TEXT);l.setTextStyle(a,t.addDeclutter(!1));l.drawText(e,r)}},GeometryCollection:function(t,e,i,r){var o,n,s=e.getGeometriesArray();for(o=0,n=s.length;o<n;++o){var a=ju[s[o].getType()];a(t,s[o],i,r)}},Circle:function(t,e,i,r){var o=i.getFill(),n=i.getStroke();if(o||n){var s=t.getReplay(i.getZIndex(),fu.CIRCLE);s.setFillStrokeStyle(o,n);s.drawCircle(e,r)}var a=i.getText();if(a){var l=t.getReplay(i.getZIndex(),fu.TEXT);l.setTextStyle(a,t.addDeclutter(!1));l.drawText(e,r)}}};function Uu(t,e){return St(t)-St(e)}function Yu(t,e){var i=Bu(t,e);return i*i}function Bu(t,e){return ku*t/e}function Vu(t,e,i,r,o,n){var s=!1,a=i.getImage();if(a){var l=a.getImageState();if(l==Ni.LOADED||l==Ni.ERROR)a.unlistenImageChange(o,n);else{l==Ni.IDLE&&a.load();l=a.getImageState();a.listenImageChange(o,n);s=!0}}!function(t,e,i,r){var o=i.getGeometryFunction()(e);if(!o)return;var n=o.getSimplifiedGeometry(r);if(i.getRenderer())!function t(e,i,r,o){if(i.getType()==kt.GEOMETRY_COLLECTION){for(var n=i.getGeometries(),s=0,a=n.length;s<a;++s)t(e,n[s],r,o);return}var l=e.getReplay(r.getZIndex(),fu.DEFAULT);l.drawCustom(i,o,r.getRenderer())}(t,n,i,e);else{var s=ju[n.getType()];s(t,n,i,e)}}(t,e,i,r);return s}var Xu=function(e){function t(t){e.call(this,t);this.declutterTree_=t.getDeclutter()?Yl(9,void 0):null;this.dirty_=!1;this.renderedRevision_=-1;this.renderedResolution_=NaN;this.renderedExtent_=[1/0,1/0,-1/0,-1/0];this.renderedRenderOrder_=null;this.replayGroup_=null;this.replayGroupChanged=!0;this.context=ii();S($i,R.CLEAR,this.handleFontsChanged_,this)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.disposeInternal=function(){d($i,R.CLEAR,this.handleFontsChanged_,this);e.prototype.disposeInternal.call(this)};t.prototype.compose=function(t,e,i){var r=e.extent,o=e.pixelRatio,n=i.managed?e.skippedFeatureUids:{},s=e.viewState,a=s.projection,l=s.rotation,h=a.getExtent(),u=this.getLayer().getSource(),c=this.getTransform(e,0),p=i.extent,d=void 0!==p;d&&this.clip(t,e,p);var f=this.replayGroup_;if(f&&!f.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();var _,g=this.getLayer(),y=0,v=0,m=1!==i.opacity,E=g.hasListener(ln.RENDER);if(m||E){var x=t.canvas.width,T=t.canvas.height;if(l){var S=Math.round(Math.sqrt(x*x+T*T));y=(S-x)/2;v=(S-T)/2;x=T=S}this.context.canvas.width=x;this.context.canvas.height=T;_=this.context}else _=t;var C=_.globalAlpha;m||(_.globalAlpha=i.opacity);_!=t&&_.translate(y,v);var R=e.viewHints,I=!(R[bs.ANIMATING]||R[bs.INTERACTING]),w=e.size[0]*o,L=e.size[1]*o;hr(_,-l,w/2,L/2);f.replay(_,c,l,n,I);if(u.getWrapX()&&a.canWrapX()&&!Q(h,r)){for(var O,P=r[0],b=_t(h),M=0;P<h[0];){O=b*--M;c=this.getTransform(e,O);f.replay(_,c,l,n,I);P+=b}M=0;P=r[2];for(;P>h[2];){O=b*++M;c=this.getTransform(e,O);f.replay(_,c,l,n,I);P-=b}}hr(_,l,w/2,L/2);E&&this.dispatchRenderEvent(_,e,c);if(_!=t){if(m){var F=t.globalAlpha;t.globalAlpha=i.opacity;t.drawImage(_.canvas,-y,-v);t.globalAlpha=F}else t.drawImage(_.canvas,-y,-v);_.translate(-y,-v)}m||(_.globalAlpha=C)}d&&t.restore()};t.prototype.composeFrame=function(t,e,i){var r=this.getTransform(t,0);this.preCompose(i,t,r);this.compose(i,t,e);this.postCompose(i,t,e,r)};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,o){if(this.replayGroup_){var n=e.viewState.resolution,s=e.viewState.rotation,a=this.getLayer(),l={};return this.replayGroup_.forEachFeatureAtCoordinate(t,n,s,i,{},function(t){var e=St(t).toString();if(!(e in l)){l[e]=!0;return r.call(o,t,a)}},null)}};t.prototype.handleFontsChanged_=function(t){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()};t.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()};t.prototype.prepareFrame=function(t,e){var o=this.getLayer(),i=o.getSource(),r=t.viewHints[bs.ANIMATING],n=t.viewHints[bs.INTERACTING],s=o.getUpdateWhileAnimating(),a=o.getUpdateWhileInteracting();if(!this.dirty_&&!s&&r||!a&&n)return!0;var l=t.extent,h=t.viewState,u=h.projection,c=h.resolution,p=t.pixelRatio,d=o.getRevision(),f=o.getRenderBuffer(),_=o.getRenderOrder();void 0===_&&(_=Uu);var g=k(l,f*c),y=h.projection.getExtent();if(i.getWrapX()&&h.projection.canWrapX()&&!Q(y,t.extent)){var v=_t(y),m=Math.max(_t(g)/2,v);g[0]=y[0]-m;g[2]=y[2]+m}if(!this.dirty_&&this.renderedResolution_==c&&this.renderedRevision_==d&&this.renderedRenderOrder_==_&&Q(this.renderedExtent_,g))return!(this.replayGroupChanged=!1);this.replayGroup_=null;this.dirty_=!1;var E=new Fu(Bu(c,p),g,c,p,i.getOverlaps(),this.declutterTree_,o.getRenderBuffer());i.loadFeatures(g,c,u);var x=function(t){var e,i=t.getStyleFunction()||o.getStyleFunction();i&&(e=i(t,c));if(e){var r=this.renderFeature(t,c,p,e,E);this.dirty_=this.dirty_||r}}.bind(this);if(_){var T=[];i.forEachFeatureInExtent(g,function(t){T.push(t)},this);T.sort(_);for(var S=0,C=T.length;S<C;++S)x(T[S])}else i.forEachFeatureInExtent(g,x,this);E.finish();this.renderedResolution_=c;this.renderedRevision_=d;this.renderedRenderOrder_=_;this.renderedExtent_=g;this.replayGroup_=E;return this.replayGroupChanged=!0};t.prototype.renderFeature=function(t,e,i,r,o){if(!r)return!1;var n=!1;if(Array.isArray(r))for(var s=0,a=r.length;s<a;++s)n=Vu(o,t,r[s],Yu(e,i),this.handleStyleImageChange_,this)||n;else n=Vu(o,t,r,Yu(e,i),this.handleStyleImageChange_,this);return n};return t}(au);Xu.handles=function(t){return t.getType()===In.VECTOR};Xu.create=function(t,e){return new Xu(e)};var zu={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"},Wu={image:[fu.POLYGON,fu.CIRCLE,fu.LINE_STRING,fu.IMAGE,fu.TEXT],hybrid:[fu.POLYGON,fu.LINE_STRING]},Hu={image:[fu.DEFAULT],hybrid:[fu.IMAGE,fu.TEXT,fu.DEFAULT],vector:xu},Ku=function(F){function t(t){F.call(this,t,!0);this.declutterTree_=t.getDeclutter()?Yl(9,void 0):null;this.dirty_=!1;this.renderedLayerRevision_;this.tmpTransform_=[1,0,0,1,0,0];this.zDirection=t.getRenderMode()==zu.VECTOR?1:0;S($i,R.CLEAR,this.handleFontsChanged_,this)}F&&(t.__proto__=F);((t.prototype=Object.create(F&&F.prototype)).constructor=t).prototype.disposeInternal=function(){d($i,R.CLEAR,this.handleFontsChanged_,this);F.prototype.disposeInternal.call(this)};t.prototype.getTile=function(t,e,i,r,o){var n=F.prototype.getTile.call(this,t,e,i,r,o);if(n.getState()===yn.LOADED){this.createReplayGroup_(n,r,o);this.context&&this.renderTileImage_(n,r,o)}return n};t.prototype.prepareFrame=function(t,e){var i=this.getLayer(),r=i.getRevision();if(this.renderedLayerRevision_!=r){this.renderedTiles.length=0;var o=i.getRenderMode();this.context||o==zu.VECTOR||(this.context=ii());this.context&&o==zu.VECTOR&&(this.context=null)}this.renderedLayerRevision_=r;return F.prototype.prepareFrame.call(this,t,e)};t.prototype.createReplayGroup_=function(y,v,m){var E=this,x=this.getLayer(),t=x.getRevision(),T=x.getRenderOrder()||null,S=y.getReplayState(x);if(S.dirty||S.renderedRevision!=t||S.renderedRenderOrder!=T){for(var C=x.getSource(),R=C.getTileGrid(),I=C.getTileGridForProjection(m).getResolution(y.tileCoord[0]),w=y.extent,e=function(t,e){var i=y.getTile(y.tileKeys[t]);if(i.getState()==yn.LOADED){var r=i.tileCoord,o=R.getTileCoordExtent(r),n=pt(w,o),s=$(o,n)?null:k(n,x.getRenderBuffer()*I,E.tmpExtent),a=i.getProjection(),l=!1;if(!Ce(m,a)){l=!0;i.setProjection(m)}S.dirty=!1;var h=new Fu(0,n,I,v,C.getOverlaps(),E.declutterTree_,x.getRenderBuffer()),u=Yu(I,v),c=function(t){var e,i=t.getStyleFunction()||x.getStyleFunction();i&&(e=i(t,I));if(e){var r=this.renderFeature(t,u,e,h);this.dirty_=this.dirty_||r;S.dirty=S.dirty||r}},p=i.getFeatures();T&&T!==S.renderedRenderOrder&&p.sort(T);for(var d=0,f=p.length;d<f;++d){var _=p[d];if(l){if(a.getUnits()==Xt.TILE_PIXELS){a.setWorldExtent(o);a.setExtent(i.getExtent())}_.getGeometry().transform(a,m)}s&&!Rt(s,_.getGeometry().getExtent())||c.call(E,_)}h.finish();for(var g in h.getReplays());i.setReplayGroup(x,y.tileCoord.toString(),h)}},i=0,r=y.tileKeys.length;i<r;++i)e(i);S.renderedRevision=t;S.renderedRenderOrder=T}};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,o){var n=e.viewState.resolution,s=e.viewState.rotation;i=null==i?0:i;var a,l,h,u,c,p=this.getLayer(),d={},f=this.renderedTiles;for(h=0,u=f.length;h<u;++h){var _=f[h];if(Y(a=k(_.extent,i*n,a),t))for(var g=0,y=_.tileKeys.length;g<y;++g){var v=_.getTile(_.tileKeys[g]);if(v.getState()==yn.LOADED){c=v.getReplayGroup(p,_.tileCoord.toString());l=l||c.forEachFeatureAtCoordinate(t,n,s,i,{},function(t){var e=St(t).toString();if(!(e in d)){d[e]=!0;return r.call(o,t,p)}},null)}}}return l};t.prototype.getReplayTransform_=function(t,e){var i=this.getLayer().getSource().getTileGrid(),r=t.tileCoord,o=i.getResolution(r[0]),n=e.viewState,s=e.pixelRatio,a=n.resolution/s,l=i.getTileCoordExtent(r,this.tmpExtent),h=n.center,u=dt(l),c=e.size,p=Math.round(s*c[0]/2),d=Math.round(s*c[1]/2);return Ue(this.tmpTransform_,p,d,o/a,o/a,n.rotation,(u[0]-h[0])/o,(h[1]-u[1])/o)};t.prototype.handleFontsChanged_=function(t){var e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()};t.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()};t.prototype.postCompose=function(t,e,i){var r=this.getLayer(),o=r.getRenderMode();if(o!=zu.IMAGE){var n,s,a=r.getDeclutter()?{}:null,l=r.getSource(),h=Hu[o],u=e.pixelRatio,c=e.viewState.rotation,p=e.size;c&&hr(t,-c,n=Math.round(u*p[0]/2),s=Math.round(u*p[1]/2));a&&this.declutterTree_.clear();for(var d=e.viewHints,f=!(d[bs.ANIMATING]||d[bs.INTERACTING]),_=this.renderedTiles,g=l.getTileGridForProjection(e.viewState.projection),y=[],v=[],m=_.length-1;0<=m;--m){var E=_[m];if(E.getState()!=yn.ABORT)for(var x=E.tileCoord,T=g.getTileCoordExtent(x,this.tmpExtent)[0]-E.extent[0],S=void 0,C=0,R=E.tileKeys.length;C<R;++C){var I=E.getTile(E.tileKeys[C]);if(I.getState()==yn.LOADED){var w=I.getReplayGroup(r,x.toString());if(w&&w.hasReplays(h)){S||(S=this.getTransform(e,T));var L=I.tileCoord[0],O=w.getClipCoords(S);t.save();t.globalAlpha=i.opacity;for(var P=0,b=y.length;P<b;++P){var M=y[P];if(L<v[P]){t.beginPath();t.moveTo(O[0],O[1]);t.lineTo(O[2],O[3]);t.lineTo(O[4],O[5]);t.lineTo(O[6],O[7]);t.moveTo(M[6],M[7]);t.lineTo(M[4],M[5]);t.lineTo(M[2],M[3]);t.lineTo(M[0],M[1]);t.clip()}}w.replay(t,S,c,{},f,h,a);t.restore();y.push(O);v.push(L)}}}}a&&Gu(a,t,c,f);c&&hr(t,c,n,s)}F.prototype.postCompose.call(this,t,e,i)};t.prototype.renderFeature=function(t,e,i,r){if(!i)return!1;var o=!1;if(Array.isArray(i))for(var n=0,s=i.length;n<s;++n)o=Vu(r,t,i[n],e,this.handleStyleImageChange_,this)||o;else o=Vu(r,t,i,e,this.handleStyleImageChange_,this);return o};t.prototype.renderTileImage_=function(t,e,i){var r=this.getLayer(),o=t.getReplayState(r),n=r.getRevision(),s=Wu[r.getRenderMode()];if(s&&o.renderedTileRevision!==n){o.renderedTileRevision=n;var a=t.wrappedTileCoord,l=a[0],h=r.getSource(),u=h.getTileGridForProjection(i),c=u.getResolution(l),p=t.getContext(r),d=h.getTilePixelSize(l,e,i);p.canvas.width=d[0];p.canvas.height=d[1];for(var f=u.getTileCoordExtent(a,this.tmpExtent),_=0,g=t.tileKeys.length;_<g;++_){var y=t.getTile(t.tileKeys[_]);if(y.getState()==yn.LOADED){var v=e/c,m=Me(this.tmpTransform_);ke(m,v,-v);je(m,-f[0],-f[3]);y.getReplayGroup(r,t.tileCoord.toString()).replay(p,m,0,{},!0,s)}}}};return t}(pu);Ku.handles=function(t){return t.getType()===In.VECTOR_TILE};Ku.create=function(t,e){return new Ku(e)};var Zu=function(e){function t(t){(t=T({},t)).controls||(t.controls=ra());t.interactions||(t.interactions=Kh());e.call(this,t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.createRenderer=function(){var t=new nu(this);t.registerLayerRenderers([hu,pu,Xu,Ku]);return t};return t}(Ks),qu={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"},Ju="element",Qu="map",$u="offset",tc="position",ec="positioning",ic=function(e){function t(t){e.call(this);this.options=t;this.id=t.id;this.insertFirst=void 0===t.insertFirst||t.insertFirst;this.stopEvent=void 0===t.stopEvent||t.stopEvent;this.element=document.createElement("div");this.element.className=void 0!==t.className?t.className:"ol-overlay-container "+Gi;this.element.style.position="absolute";this.autoPan=void 0!==t.autoPan&&t.autoPan;this.autoPanAnimation=t.autoPanAnimation||{};this.autoPanMargin=void 0!==t.autoPanMargin?t.autoPanMargin:20;this.rendered={bottom_:"",left_:"",right_:"",top_:"",visible:!0};this.mapPostrenderListenerKey=null;S(this,P(Ju),this.handleElementChanged,this);S(this,P(Qu),this.handleMapChanged,this);S(this,P($u),this.handleOffsetChanged,this);S(this,P(tc),this.handlePositionChanged,this);S(this,P(ec),this.handlePositioningChanged,this);void 0!==t.element&&this.setElement(t.element);this.setOffset(void 0!==t.offset?t.offset:[0,0]);this.setPositioning(void 0!==t.positioning?t.positioning:qu.TOP_LEFT);void 0!==t.position&&this.setPosition(t.position)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getElement=function(){return this.get(Ju)};t.prototype.getId=function(){return this.id};t.prototype.getMap=function(){return this.get(Qu)};t.prototype.getOffset=function(){return this.get($u)};t.prototype.getPosition=function(){return this.get(tc)};t.prototype.getPositioning=function(){return this.get(ec)};t.prototype.handleElementChanged=function(){ai(this.element);var t=this.getElement();t&&this.element.appendChild(t)};t.prototype.handleMapChanged=function(){if(this.mapPostrenderListenerKey){si(this.element);g(this.mapPostrenderListenerKey);this.mapPostrenderListenerKey=null}var t=this.getMap();if(t){this.mapPostrenderListenerKey=S(t,ys.POSTRENDER,this.render,this);this.updatePixelPosition();var e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element)}};t.prototype.render=function(){this.updatePixelPosition()};t.prototype.handleOffsetChanged=function(){this.updatePixelPosition()};t.prototype.handlePositionChanged=function(){this.updatePixelPosition();this.get(tc)&&this.autoPan&&this.panIntoView()};t.prototype.handlePositioningChanged=function(){this.updatePixelPosition()};t.prototype.setElement=function(t){this.set(Ju,t)};t.prototype.setMap=function(t){this.set(Qu,t)};t.prototype.setOffset=function(t){this.set($u,t)};t.prototype.setPosition=function(t){this.set(tc,t)};t.prototype.panIntoView=function(){var t=this.getMap();if(t&&t.getTargetElement()){var e=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),r=this.getRect(i,[ri(i),oi(i)]),o=this.autoPanMargin;if(!Q(e,r)){var n=r[0]-e[0],s=e[2]-r[2],a=r[1]-e[1],l=e[3]-r[3],h=[0,0];n<0?h[0]=n-o:s<0&&(h[0]=Math.abs(s)+o);a<0?h[1]=a-o:l<0&&(h[1]=Math.abs(l)+o);if(0!==h[0]||0!==h[1]){var u=t.getView().getCenter(),c=t.getPixelFromCoordinate(u),p=[c[0]+h[0],c[1]+h[1]];t.getView().animate({center:t.getCoordinateFromPixel(p),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}};t.prototype.getRect=function(t,e){var i=t.getBoundingClientRect(),r=i.left+window.pageXOffset,o=i.top+window.pageYOffset;return[r,o,r+e[0],o+e[1]]};t.prototype.setPositioning=function(t){this.set(ec,t)};t.prototype.setVisible=function(t){if(this.rendered.visible!==t){this.element.style.display=t?"":"none";this.rendered.visible=t}};t.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(t&&t.isRendered()&&e){var i=t.getPixelFromCoordinate(e),r=t.getSize();this.updateRenderedPosition(i,r)}else this.setVisible(!1)};t.prototype.updateRenderedPosition=function(t,e){var i=this.element.style,r=this.getOffset(),o=this.getPositioning();this.setVisible(!0);var n=r[0],s=r[1];if(o==qu.BOTTOM_RIGHT||o==qu.CENTER_RIGHT||o==qu.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_=i.left="");var a=Math.round(e[0]-t[0]-n)+"px";this.rendered.right_!=a&&(this.rendered.right_=i.right=a)}else{""!==this.rendered.right_&&(this.rendered.right_=i.right="");o!=qu.BOTTOM_CENTER&&o!=qu.CENTER_CENTER&&o!=qu.TOP_CENTER||(n-=this.element.offsetWidth/2);var l=Math.round(t[0]+n)+"px";this.rendered.left_!=l&&(this.rendered.left_=i.left=l)}if(o==qu.BOTTOM_LEFT||o==qu.BOTTOM_CENTER||o==qu.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_=i.top="");var h=Math.round(e[1]-t[1]-s)+"px";this.rendered.bottom_!=h&&(this.rendered.bottom_=i.bottom=h)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=i.bottom="");o!=qu.CENTER_LEFT&&o!=qu.CENTER_CENTER&&o!=qu.CENTER_RIGHT||(s-=this.element.offsetHeight/2);var u=Math.round(t[1]+s)+"px";this.rendered.top_!=u&&(this.rendered.top_=i.top=u)}};t.prototype.getOptions=function(){return this.options};return t}(w);function rc(t,e,i,r){if(void 0===r)return[t,e,i];r[0]=t;r[1]=e;r[2]=i;return r}function oc(t,e,i){return t+"/"+e+"/"+i}function nc(t){return oc(t[0],t[1],t[2])}function sc(t){return t.split("/").map(Number)}function ac(t){return(t[1]<<t[0])+t[2]}function lc(t){var e,i,r=t[0],o=new Array(r),n=1<<r-1;for(e=0;e<r;++e){i=48;t[1]&n&&(i+=1);t[2]&n&&(i+=2);o[e]=String.fromCharCode(i);n>>=1}return o.join("")}function hc(t,e){var i=t[0],r=t[1],o=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;var n,s=e.getExtent();return!(n=s?e.getTileRangeForExtentAndZ(s,i):e.getFullTileRange(i))||n.containsXY(r,o)}var uc=function(e){function t(t){e.call(this,t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.expireCache=function(t){for(;this.canExpireCache();){var e=this.peekLast(),i=e.tileCoord[0].toString();if(i in t&&t[i].contains(e.tileCoord))break;this.pop().dispose()}};t.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var e=sc(this.peekFirstKey())[0];this.forEach(function(t){if(t.tileCoord[0]!==e){this.remove(nc(t.tileCoord));t.dispose()}},this)}};return t}(Vi),cc=function(x){function T(t,e,i,s,a,r,l,h,o,u,c,p,d,f,n){x.call(this,t,e,{transition:0});this.context_={};this.loader_;this.replayState_={};this.sourceTiles_=u;this.tileKeys=[];this.extent=null;this.sourceRevision_=i;this.wrappedTileCoord=r;this.loadListenerKeys_=[];this.sourceTileListenerKeys_=[];if(r){var _=this.extent=o.getTileCoordExtent(r),g=o.getResolution(n),y=h.getZForResolution(g),v=n!=t[0],m=0;h.forEachTileCoord(_,y,function(t){var e=pt(_,h.getTileCoordExtent(t)),i=h.getExtent();i&&(e=pt(e,i,e));if(.5<=_t(e)/g&&.5<=ct(e)/g){++m;var r=t.toString(),o=u[r];if(!o&&!v){var n=l(t,c,p);o=u[r]=new d(t,null==n?yn.EMPTY:yn.IDLE,null==n?"":n,s,a);this.sourceTileListenerKeys_.push(S(o,R.CHANGE,f))}if(o&&(!v||o.getState()==yn.LOADED)){o.consumers++;this.tileKeys.push(r)}}}.bind(this));v&&m==this.tileKeys.length&&this.finishLoading_();if(n<=t[0]&&this.state!=yn.LOADED)for(;n>o.getMinZoom();){var E=new T(t,e,i,s,a,r,l,h,o,u,c,p,d,L,--n);if(E.state==yn.LOADED){this.interimTile=E;break}}}}x&&(T.__proto__=x);((T.prototype=Object.create(x&&x.prototype)).constructor=T).prototype.disposeInternal=function(){this.state=yn.ABORT;this.changed();this.interimTile&&this.interimTile.dispose();for(var t=0,e=this.tileKeys.length;t<e;++t){var i=this.tileKeys[t],r=this.getTile(i);r.consumers--;if(0==r.consumers){delete this.sourceTiles_[i];r.dispose()}}this.tileKeys.length=0;this.sourceTiles_=null;this.loadListenerKeys_.forEach(g);this.loadListenerKeys_.length=0;this.sourceTileListenerKeys_.forEach(g);this.sourceTileListenerKeys_.length=0;x.prototype.disposeInternal.call(this)};T.prototype.getContext=function(t){var e=St(t).toString();e in this.context_||(this.context_[e]=ii());return this.context_[e]};T.prototype.getImage=function(t){return-1==this.getReplayState(t).renderedTileRevision?null:this.getContext(t).canvas};T.prototype.getReplayState=function(t){var e=St(t).toString();e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedRevision:-1,renderedTileRevision:-1});return this.replayState_[e]};T.prototype.getKey=function(){return this.tileKeys.join("/")+"-"+this.sourceRevision_};T.prototype.getTile=function(t){return this.sourceTiles_[t]};T.prototype.load=function(){var o=0,n={};this.state==yn.IDLE&&this.setState(yn.LOADING);this.state==yn.LOADING&&this.tileKeys.forEach(function(t){var r=this.getTile(t);if(r.state==yn.IDLE){r.setLoader(this.loader_);r.load()}if(r.state==yn.LOADING){var e=S(r,R.CHANGE,function(t){var e=r.getState();if(e==yn.LOADED||e==yn.ERROR){var i=St(r);if(e==yn.ERROR)n[i]=!0;else{--o;delete n[i]}o-Object.keys(n).length==0&&this.finishLoading_()}}.bind(this));this.loadListenerKeys_.push(e);++o}}.bind(this));o-Object.keys(n).length==0&&setTimeout(this.finishLoading_.bind(this),0)};T.prototype.finishLoading_=function(){for(var t=this.tileKeys.length,e=0,i=t-1;0<=i;--i){var r=this.getTile(this.tileKeys[i]).getState();r!=yn.LOADED&&--t;r==yn.EMPTY&&++e}if(t==this.tileKeys.length){this.loadListenerKeys_.forEach(g);this.loadListenerKeys_.length=0;this.setState(yn.LOADED)}else this.setState(e==this.tileKeys.length?yn.EMPTY:yn.ERROR)};return T}(Tn);function pc(t,e){var i=Al(e,t.getFormat(),t.onLoad.bind(t),t.onError.bind(t));t.setLoader(i)}var dc,fc=[0,0,4096,4096],_c=function(s){function t(t,e,i,r,o,n){s.call(this,t,e,n);this.consumers=0;this.extent_=null;this.format_=r;this.features_=null;this.loader_;this.projection_=null;this.replayGroups_={};this.tileLoadFunction_=o;this.url_=i}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.disposeInternal=function(){this.features_=null;this.replayGroups_={};this.state=yn.ABORT;this.changed();s.prototype.disposeInternal.call(this)};t.prototype.getExtent=function(){return this.extent_||fc};t.prototype.getFormat=function(){return this.format_};t.prototype.getFeatures=function(){return this.features_};t.prototype.getKey=function(){return this.url_};t.prototype.getProjection=function(){return this.projection_};t.prototype.getReplayGroup=function(t,e){return this.replayGroups_[St(t)+","+e]};t.prototype.load=function(){if(this.state==yn.IDLE){this.setState(yn.LOADING);this.tileLoadFunction_(this,this.url_);this.loader_(null,NaN,null)}};t.prototype.onLoad=function(t,e,i){this.setProjection(e);this.setFeatures(t);this.setExtent(i)};t.prototype.onError=function(){this.setState(yn.ERROR)};t.prototype.setExtent=function(t){this.extent_=t};t.prototype.setFeatures=function(t){this.features_=t;this.setState(yn.LOADED)};t.prototype.setProjection=function(t){this.projection_=t};t.prototype.setReplayGroup=function(t,e,i){this.replayGroups_[St(t)+","+e]=i};t.prototype.setLoader=function(t){this.loader_=t};return t}(Tn),gc=function(){if(!dc){var t=document.body;t.webkitRequestFullscreen?dc="webkitfullscreenchange":t.mozRequestFullScreen?dc="mozfullscreenchange":t.msRequestFullscreen?dc="MSFullscreenChange":t.requestFullscreen&&(dc="fullscreenchange")}return dc},yc=function(l){function t(t){var e=t||{};l.call(this,{element:document.createElement("div"),target:e.target});this.cssClassName_=void 0!==e.className?e.className:"ol-full-screen";var i=void 0!==e.label?e.label:"⤢";this.labelNode_="string"==typeof i?document.createTextNode(i):i;var r=void 0!==e.labelActive?e.labelActive:"×";this.labelActiveNode_="string"==typeof r?document.createTextNode(r):r;var o=e.tipLabel?e.tipLabel:"Toggle full-screen",n=document.createElement("button");n.className=this.cssClassName_+"-"+mc();n.setAttribute("type","button");n.title=o;n.appendChild(this.labelNode_);S(n,R.CLICK,this.handleClick_,this);var s=this.cssClassName_+" "+ki+" "+Ui+" "+(vc()?"":ji),a=this.element;a.className=s;a.appendChild(n);this.keys_=void 0!==e.keys&&e.keys;this.source_=e.source}l&&(t.__proto__=l);((t.prototype=Object.create(l&&l.prototype)).constructor=t).prototype.handleClick_=function(t){t.preventDefault();this.handleFullScreen_()};t.prototype.handleFullScreen_=function(){if(vc()){var t=this.getMap();if(t){if(mc())document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{var e;e=this.source_?"string"==typeof this.source_?document.getElementById(this.source_):this.source_:t.getTargetElement();this.keys_?(i=e).mozRequestFullScreenWithKeys?i.mozRequestFullScreenWithKeys():i.webkitRequestFullscreen?i.webkitRequestFullscreen():Ec(i):Ec(e)}var i}}};t.prototype.handleFullScreenChange_=function(){var t=this.element.firstElementChild,e=this.getMap();if(mc()){t.className=this.cssClassName_+"-true";ni(this.labelActiveNode_,this.labelNode_)}else{t.className=this.cssClassName_+"-false";ni(this.labelNode_,this.labelActiveNode_)}e&&e.updateSize()};t.prototype.setMap=function(t){l.prototype.setMap.call(this,t);t&&this.listenerKeys.push(S(document,gc(),this.handleFullScreenChange_,this))};return t}(Zs);function vc(){var t=document.body;return!!(t.webkitRequestFullscreen||t.mozRequestFullScreen&&document.mozFullScreenEnabled||t.msRequestFullscreen&&document.msFullscreenEnabled||t.requestFullscreen&&document.fullscreenEnabled)}function mc(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)}function Ec(t){t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}var xc=function(y){function t(t){var e=t||{};y.call(this,{element:document.createElement("div"),render:e.render||Tc,target:e.target});this.collapsed_=void 0===e.collapsed||e.collapsed;this.collapsible_=void 0===e.collapsible||e.collapsible;this.collapsible_||(this.collapsed_=!1);var i=void 0!==e.className?e.className:"ol-overviewmap",r=void 0!==e.tipLabel?e.tipLabel:"Overview map",o=void 0!==e.collapseLabel?e.collapseLabel:"«";if("string"==typeof o){this.collapseLabel_=document.createElement("span");this.collapseLabel_.textContent=o}else this.collapseLabel_=o;var n=void 0!==e.label?e.label:"»";if("string"==typeof n){this.label_=document.createElement("span");this.label_.textContent=n}else this.label_=n;var s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button");a.title=r;a.appendChild(s);S(a,R.CLICK,this.handleClick_,this);this.ovmapDiv_=document.createElement("div");this.ovmapDiv_.className="ol-overviewmap-map";this.ovmap_=new Zu({controls:new F,interactions:new F,view:e.view});var l=this.ovmap_;e.layers&&e.layers.forEach(function(t){l.addLayer(t)}.bind(this));var h=document.createElement("div");h.className="ol-overviewmap-box";h.style.boxSizing="border-box";this.boxOverlay_=new ic({position:[0,0],positioning:qu.BOTTOM_LEFT,element:h});this.ovmap_.addOverlay(this.boxOverlay_);var u=i+" "+ki+" "+Ui+(this.collapsed_&&this.collapsible_?" "+Yi:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=u;c.appendChild(this.ovmapDiv_);c.appendChild(a);var p=this,d=this.boxOverlay_,f=this.boxOverlay_.getElement(),_=function(t){var e,i=l.getEventCoordinate({clientX:(e=t).clientX-f.offsetWidth/2,clientY:e.clientY+f.offsetHeight/2});d.setPosition(i)},g=function(t){var e=l.getEventCoordinate(t);p.getMap().getView().setCenter(e);window.removeEventListener("mousemove",_);window.removeEventListener("mouseup",g)};f.addEventListener("mousedown",function(){window.addEventListener("mousemove",_);window.addEventListener("mouseup",g)})}y&&(t.__proto__=y);((t.prototype=Object.create(y&&y.prototype)).constructor=t).prototype.setMap=function(t){var e=this.getMap();if(t!==e){if(e){var i=e.getView();i&&this.unbindView_(i);this.ovmap_.setTarget(null)}y.prototype.setMap.call(this,t);if(t){this.ovmap_.setTarget(this.ovmapDiv_);this.listenerKeys.push(S(t,l.PROPERTYCHANGE,this.handleMapPropertyChange_,this));0===this.ovmap_.getLayers().getLength()&&this.ovmap_.setLayerGroup(t.getLayerGroup());var r=t.getView();if(r){this.bindView_(r);if(r.isDef()){this.ovmap_.updateSize();this.resetExtent_()}}}}};t.prototype.handleMapPropertyChange_=function(t){if(t.key===vs.VIEW){var e=t.oldValue;e&&this.unbindView_(e);var i=this.getMap().getView();this.bindView_(i)}};t.prototype.bindView_=function(t){S(t,P(Ms.ROTATION),this.handleRotationChanged_,this)};t.prototype.unbindView_=function(t){d(t,P(Ms.ROTATION),this.handleRotationChanged_,this)};t.prototype.handleRotationChanged_=function(){this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())};t.prototype.validateExtent_=function(){var t=this.getMap(),e=this.ovmap_;if(t.isRendered()&&e.isRendered()){var i=t.getSize(),r=t.getView().calculateExtent(i),o=e.getSize(),n=e.getView().calculateExtent(o),s=e.getPixelFromCoordinate(dt(r)),a=e.getPixelFromCoordinate(at(r)),l=Math.abs(s[0]-a[0]),h=Math.abs(s[1]-a[1]),u=o[0],c=o[1];l<.1*u||h<.1*c||.75*u<l||.75*c<h?this.resetExtent_():Q(n,r)||this.recenter_()}};t.prototype.resetExtent_=function(){var t=this.getMap(),e=this.ovmap_,i=t.getSize(),r=t.getView().calculateExtent(i),o=e.getView(),n=Math.log(7.5)/Math.LN2;vt(r,1/(.1*Math.pow(2,n/2)));o.fit(r)};t.prototype.recenter_=function(){var t=this.getMap(),e=this.ovmap_,i=t.getView();e.getView().setCenter(i.getCenter())};t.prototype.updateBox_=function(){var t=this.getMap(),e=this.ovmap_;if(t.isRendered()&&e.isRendered()){var i=t.getSize(),r=t.getView(),o=e.getView(),n=r.getRotation(),s=this.boxOverlay_,a=this.boxOverlay_.getElement(),l=r.calculateExtent(i),h=o.getResolution(),u=st(l),c=ft(l),p=this.calculateCoordinateRotate_(n,u);s.setPosition(p);if(a){a.style.width=Math.abs((u[0]-c[0])/h)+"px";a.style.height=Math.abs((c[1]-u[1])/h)+"px"}}};t.prototype.calculateCoordinateRotate_=function(t,e){var i,r=this.getMap().getView().getCenter();if(r){Ho(i=[e[0]-r[0],e[1]-r[1]],t);Yo(i,r)}return i};t.prototype.handleClick_=function(t){t.preventDefault();this.handleToggle_()};t.prototype.handleToggle_=function(){this.element.classList.toggle(Yi);this.collapsed_?ni(this.collapseLabel_,this.label_):ni(this.label_,this.collapseLabel_);this.collapsed_=!this.collapsed_;var t=this.ovmap_;if(!this.collapsed_&&!t.isRendered()){t.updateSize();this.resetExtent_();n(t,ys.POSTRENDER,function(t){this.updateBox_()},this)}};t.prototype.getCollapsible=function(){return this.collapsible_};t.prototype.setCollapsible=function(t){if(this.collapsible_!==t){this.collapsible_=t;this.element.classList.toggle("ol-uncollapsible");!t&&this.collapsed_&&this.handleToggle_()}};t.prototype.setCollapsed=function(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()};t.prototype.getCollapsed=function(){return this.collapsed_};t.prototype.getOverviewMap=function(){return this.ovmap_};return t}(Zs);function Tc(t){this.validateExtent_();this.updateBox_()}var Sc="units",Cc={DEGREES:"degrees",IMPERIAL:"imperial",NAUTICAL:"nautical",METRIC:"metric",US:"us"},Rc=[1,2,5],Ic=function(r){function t(t){var e=t||{},i=void 0!==e.className?e.className:"ol-scale-line";r.call(this,{element:document.createElement("div"),render:e.render||wc,target:e.target});this.innerElement_=document.createElement("div");this.innerElement_.className=i+"-inner";this.element.className=i+" "+ki;this.element.appendChild(this.innerElement_);this.viewState_=null;this.minWidth_=void 0!==e.minWidth?e.minWidth:64;this.renderedVisible_=!1;this.renderedWidth_=void 0;this.renderedHTML_="";S(this,P(Sc),this.handleUnitsChanged_,this);this.setUnits(e.units||Cc.METRIC)}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getUnits=function(){return this.get(Sc)};t.prototype.handleUnitsChanged_=function(){this.updateElement_()};t.prototype.setUnits=function(t){this.set(Sc,t)};t.prototype.updateElement_=function(){var t=this.viewState_;if(t){var e=t.center,i=t.projection,r=this.getUnits(),o=r==Cc.DEGREES?Xt.DEGREES:Xt.METERS,n=ve(i,t.resolution,e,o);i.getUnits()!=Xt.DEGREES&&i.getMetersPerUnit()&&o==Xt.METERS&&(n*=i.getMetersPerUnit());var s=this.minWidth_*n,a="";if(r==Cc.DEGREES){var l=zt[Xt.DEGREES];i.getUnits()==Xt.DEGREES?s*=l:n/=l;if(s<l/60){a="″";n*=3600}else if(s<l){a="′";n*=60}else a="°"}else if(r==Cc.IMPERIAL)if(s<.9144){a="in";n/=.0254}else if(s<1609.344){a="ft";n/=.3048}else{a="mi";n/=1609.344}else if(r==Cc.NAUTICAL){n/=1852;a="nm"}else if(r==Cc.METRIC)if(s<.001){a="μm";n*=1e6}else if(s<1){a="mm";n*=1e3}else if(s<1e3)a="m";else{a="km";n/=1e3}else if(r==Cc.US)if(s<.9144){a="in";n*=39.37}else if(s<1609.344){a="ft";n/=.30480061}else{a="mi";n/=1609.3472}else A(!1,33);for(var h,u,c=3*Math.floor(Math.log(this.minWidth_*n)/Math.log(10));;){h=Rc[(c%3+3)%3]*Math.pow(10,Math.floor(c/3));u=Math.round(h/n);if(isNaN(u)){this.element.style.display="none";this.renderedVisible_=!1;return}if(u>=this.minWidth_)break;++c}var p=h+" "+a;if(this.renderedHTML_!=p){this.innerElement_.innerHTML=p;this.renderedHTML_=p}if(this.renderedWidth_!=u){this.innerElement_.style.width=u+"px";this.renderedWidth_=u}if(!this.renderedVisible_){this.element.style.display="";this.renderedVisible_=!0}}else if(this.renderedVisible_){this.element.style.display="none";this.renderedVisible_=!1}};return t}(Zs);function wc(t){var e=t.frameState;this.viewState_=e?e.viewState:null;this.updateElement_()}var Lc=0,Oc=1,Pc=function(n){function t(t){var e=t||{};n.call(this,{element:document.createElement("div"),render:e.render||bc});this.currentResolution_=void 0;this.direction_=Lc;this.dragging_;this.heightLimit_=0;this.widthLimit_=0;this.previousX_;this.previousY_;this.thumbSize_=null;this.sliderInitialized_=!1;this.duration_=void 0!==e.duration?e.duration:200;var i=void 0!==e.className?e.className:"ol-zoomslider",r=document.createElement("button");r.setAttribute("type","button");r.className=i+"-thumb "+ki;var o=this.element;o.className=i+" "+ki+" "+Ui;o.appendChild(r);this.dragger_=new _s(o);S(this.dragger_,bn.POINTERDOWN,this.handleDraggerStart_,this);S(this.dragger_,bn.POINTERMOVE,this.handleDraggerDrag_,this);S(this.dragger_,bn.POINTERUP,this.handleDraggerEnd_,this);S(o,R.CLICK,this.handleContainerClick_,this);S(r,R.CLICK,E)}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.disposeInternal=function(){this.dragger_.dispose();n.prototype.disposeInternal.call(this)};t.prototype.setMap=function(t){n.prototype.setMap.call(this,t);t&&t.render()};t.prototype.initSlider_=function(){var t=this.element,e=t.offsetWidth,i=t.offsetHeight,r=t.firstElementChild,o=getComputedStyle(r),n=r.offsetWidth+parseFloat(o.marginRight)+parseFloat(o.marginLeft),s=r.offsetHeight+parseFloat(o.marginTop)+parseFloat(o.marginBottom);this.thumbSize_=[n,s];if(i<e){this.direction_=Oc;this.widthLimit_=e-n}else{this.direction_=Lc;this.heightLimit_=i-s}this.sliderInitialized_=!0};t.prototype.handleContainerClick_=function(t){var e=this.getMap().getView(),i=this.getRelativePosition_(t.offsetX-this.thumbSize_[0]/2,t.offsetY-this.thumbSize_[1]/2),r=this.getResolutionForPosition_(i);e.animate({resolution:e.constrainResolution(r),duration:this.duration_,easing:mn})};t.prototype.handleDraggerStart_=function(t){if(!this.dragging_&&t.originalEvent.target===this.element.firstElementChild){this.getMap().getView().setHint(bs.INTERACTING,1);this.previousX_=t.clientX;this.previousY_=t.clientY;this.dragging_=!0}};t.prototype.handleDraggerDrag_=function(t){if(this.dragging_){var e=this.element.firstElementChild,i=t.clientX-this.previousX_+parseInt(e.style.left,10),r=t.clientY-this.previousY_+parseInt(e.style.top,10),o=this.getRelativePosition_(i,r);this.currentResolution_=this.getResolutionForPosition_(o);this.getMap().getView().setResolution(this.currentResolution_);this.setThumbPosition_(this.currentResolution_);this.previousX_=t.clientX;this.previousY_=t.clientY}};t.prototype.handleDraggerEnd_=function(t){if(this.dragging_){var e=this.getMap().getView();e.setHint(bs.INTERACTING,-1);e.animate({resolution:e.constrainResolution(this.currentResolution_),duration:this.duration_,easing:mn});this.dragging_=!1;this.previousX_=void 0;this.previousY_=void 0}};t.prototype.setThumbPosition_=function(t){var e=this.getPositionForResolution_(t),i=this.element.firstElementChild;this.direction_==Oc?i.style.left=this.widthLimit_*e+"px":i.style.top=this.heightLimit_*e+"px"};t.prototype.getRelativePosition_=function(t,e){return Lt(this.direction_===Oc?t/this.widthLimit_:e/this.heightLimit_,0,1)};t.prototype.getResolutionForPosition_=function(t){return this.getMap().getView().getResolutionForValueFunction()(1-t)};t.prototype.getPositionForResolution_=function(t){return 1-this.getMap().getView().getValueForResolutionFunction()(t)};return t}(Zs);function bc(t){if(t.frameState){this.sliderInitialized_||this.initSlider_();var e=t.frameState.viewState.resolution;if(e!==this.currentResolution_){this.currentResolution_=e;this.setThumbPosition_(e)}}}var Mc=function(l){function t(t){var e=t||{};l.call(this,{element:document.createElement("div"),target:e.target});this.extent=e.extent?e.extent:null;var i=void 0!==e.className?e.className:"ol-zoom-extent",r=void 0!==e.label?e.label:"E",o=void 0!==e.tipLabel?e.tipLabel:"Fit to extent",n=document.createElement("button");n.setAttribute("type","button");n.title=o;n.appendChild("string"==typeof r?document.createTextNode(r):r);S(n,R.CLICK,this.handleClick_,this);var s=i+" "+ki+" "+Ui,a=this.element;a.className=s;a.appendChild(n)}l&&(t.__proto__=l);((t.prototype=Object.create(l&&l.prototype)).constructor=t).prototype.handleClick_=function(t){t.preventDefault();this.handleZoomToExtent()};t.prototype.handleZoomToExtent=function(){var t=this.getMap().getView(),e=this.extent?this.extent:t.getProjection().getExtent();t.fit(e)};return t}(Zs),Fc=function(t){this.source_=t};Fc.prototype.isAnimated=function(){return!1};Fc.prototype.getType=function(){};Fc.prototype.getSource=function(){return this.source_};var Ac=function(e){function t(t){e.call(this,t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getType=function(){return 35632};return t}(Fc),Nc=function(e){function t(t){e.call(this,t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getType=function(){return 35633};return t}(Fc),Dc=new Ac("precision mediump float;\nvarying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_fillColor;\nuniform vec4 u_strokeColor;\nuniform vec2 u_size;\n\nvoid main(void) {\n  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  float radius = length(windowCenter - windowOffset);\n  float dist = length(windowCenter - gl_FragCoord.xy);\n  if (dist > radius + v_halfWidth) {\n    if (u_strokeColor.a == 0.0) {\n      gl_FragColor = u_fillColor;\n    } else {\n      gl_FragColor = u_strokeColor;\n    }\n    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));\n  } else if (u_fillColor.a == 0.0) {\n    // Hooray, no fill, just stroke. We can use real antialiasing.\n    gl_FragColor = u_strokeColor;\n    if (dist < radius - v_halfWidth) {\n      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);\n    }\n  } else {\n    gl_FragColor = u_fillColor;\n    float strokeDist = radius - v_halfWidth;\n    float antialias = 2.0 * v_pixelRatio;\n    if (dist > strokeDist) {\n      gl_FragColor = u_strokeColor;\n    } else if (dist >= strokeDist - antialias) {\n      float step = smoothstep(strokeDist - antialias, strokeDist, dist);\n      gl_FragColor = mix(u_fillColor, u_strokeColor, step);\n    }\n  }\n  gl_FragColor.a = gl_FragColor.a * u_opacity;\n  if (gl_FragColor.a <= 0.0) {\n    discard;\n  }\n}\n"),Gc=new Nc("varying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\nattribute vec2 a_position;\nattribute float a_instruction;\nattribute float a_radius;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;\n  v_pixelRatio = u_pixelRatio;\n  float lineWidth = u_lineWidth * u_pixelRatio;\n  v_halfWidth = lineWidth / 2.0;\n  if (lineWidth == 0.0) {\n    lineWidth = 2.0 * u_pixelRatio;\n  }\n  vec2 offset;\n  // Radius with anitaliasing (roughly).\n  float radius = a_radius + 3.0 * u_pixelRatio;\n  // Until we get gl_VertexID in WebGL, we store an instruction.\n  if (a_instruction == 0.0) {\n    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however\n    // we should also leave some space for the antialiasing, thus we offset by lineWidth.\n    offset = vec2(-1.0, 1.0);\n  } else if (a_instruction == 1.0) {\n    offset = vec2(-1.0, -1.0);\n  } else if (a_instruction == 2.0) {\n    offset = vec2(1.0, -1.0);\n  } else {\n    offset = vec2(1.0, 1.0);\n  }\n\n  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +\n      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);\n  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,\n      0.0, 1.0)).xy;\n\n  if (distance(v_center, v_offset) > 20000.0) {\n    gl_Position = vec4(v_center, 0.0, 1.0);\n  }\n}\n\n\n"),kc=function(t,e){this.u_projectionMatrix=t.getUniformLocation(e,"u_projectionMatrix");this.u_offsetScaleMatrix=t.getUniformLocation(e,"u_offsetScaleMatrix");this.u_offsetRotateMatrix=t.getUniformLocation(e,"u_offsetRotateMatrix");this.u_lineWidth=t.getUniformLocation(e,"u_lineWidth");this.u_pixelRatio=t.getUniformLocation(e,"u_pixelRatio");this.u_opacity=t.getUniformLocation(e,"u_opacity");this.u_fillColor=t.getUniformLocation(e,"u_fillColor");this.u_strokeColor=t.getUniformLocation(e,"u_strokeColor");this.u_size=t.getUniformLocation(e,"u_size");this.a_position=t.getAttribLocation(e,"a_position");this.a_instruction=t.getAttribLocation(e,"a_instruction");this.a_radius=t.getAttribLocation(e,"a_radius")};function jc(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Uc(t,e){t[0]=e[0];t[1]=e[1];t[4]=e[2];t[5]=e[3];t[12]=e[4];t[13]=e[5];return t}var Yc=function(i){function t(t,e){i.call(this);this.tolerance=t;this.maxExtent=e;this.origin=lt(e);this.projectionMatrix_=[1,0,0,1,0,0];this.offsetRotateMatrix_=[1,0,0,1,0,0];this.offsetScaleMatrix_=[1,0,0,1,0,0];this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];this.indices=[];this.indicesBuffer=null;this.startIndices=[];this.startIndicesFeature=[];this.vertices=[];this.verticesBuffer=null;this.lineStringReplay=void 0}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getDeleteResourcesFunction=function(t){};t.prototype.finish=function(t){};t.prototype.setUpProgram=function(t,e,i,r){};t.prototype.shutDownProgram=function(t,e){};t.prototype.drawReplay=function(t,e,i,r){};t.prototype.drawHitDetectionReplayOneByOne=function(t,e,i,r,o){};t.prototype.drawHitDetectionReplay=function(t,e,i,r,o,n){return o?this.drawHitDetectionReplayOneByOne(t,e,i,r,n):this.drawHitDetectionReplayAll(t,e,i,r)};t.prototype.drawHitDetectionReplayAll=function(t,e,i,r){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);this.drawReplay(t,e,i,!0);var o=r(null);return o||void 0};t.prototype.replay=function(t,e,i,r,o,n,s,a,l,h,u){var c,p,d,f,_,g,y,v,m=t.getGL();if(this.lineStringReplay){c=m.isEnabled(m.STENCIL_TEST);p=m.getParameter(m.STENCIL_FUNC);d=m.getParameter(m.STENCIL_VALUE_MASK);f=m.getParameter(m.STENCIL_REF);_=m.getParameter(m.STENCIL_WRITEMASK);g=m.getParameter(m.STENCIL_FAIL);y=m.getParameter(m.STENCIL_PASS_DEPTH_PASS);v=m.getParameter(m.STENCIL_PASS_DEPTH_FAIL);m.enable(m.STENCIL_TEST);m.clear(m.STENCIL_BUFFER_BIT);m.stencilMask(255);m.stencilFunc(m.ALWAYS,1,255);m.stencilOp(m.KEEP,m.KEEP,m.REPLACE);this.lineStringReplay.replay(t,e,i,r,o,n,s,a,l,h,u);m.stencilMask(0);m.stencilFunc(m.NOTEQUAL,1,255)}t.bindBuffer(li,this.verticesBuffer);t.bindBuffer(34963,this.indicesBuffer);var E=this.setUpProgram(m,t,o,n),x=Me(this.projectionMatrix_);ke(x,2/(i*o[0]),2/(i*o[1]));Ge(x,-r);je(x,-(e[0]-this.origin[0]),-(e[1]-this.origin[1]));var T=Me(this.offsetScaleMatrix_);ke(T,2/o[0],2/o[1]);var S,C=Me(this.offsetRotateMatrix_);0!==r&&Ge(C,-r);m.uniformMatrix4fv(E.u_projectionMatrix,!1,Uc(this.tmpMat4_,x));m.uniformMatrix4fv(E.u_offsetScaleMatrix,!1,Uc(this.tmpMat4_,T));m.uniformMatrix4fv(E.u_offsetRotateMatrix,!1,Uc(this.tmpMat4_,C));m.uniform1f(E.u_opacity,s);void 0===l?this.drawReplay(m,t,a,!1):S=this.drawHitDetectionReplay(m,t,a,l,h,u);this.shutDownProgram(m,E);if(this.lineStringReplay){c||m.disable(m.STENCIL_TEST);m.clear(m.STENCIL_BUFFER_BIT);m.stencilFunc(p,f,d);m.stencilMask(_);m.stencilOp(g,v,y)}return S};t.prototype.drawElements=function(t,e,i,r){var o=e.hasOESElementIndexUint?5125:5123,n=r-i,s=i*(e.hasOESElementIndexUint?4:2);t.drawElements(4,n,o,s)};return t}(qh),Bc="10px sans-serif",Vc=[0,0,0,1],Xc="round",zc=[],Wc="round",Hc=[0,0,0,1],Kc=Number.EPSILON||2220446049250313e-31,Zc=function(t,e,i,r,o,n){var s=(i-t)*(n-e)-(o-t)*(r-e);return s<=Kc&&-Kc<=s?void 0:0<s},qc=35044,Jc=function(t,e){this.arr_=void 0!==t?t:[];this.usage_=void 0!==e?e:qc};Jc.prototype.getArray=function(){return this.arr_};Jc.prototype.getUsage=function(){return this.usage_};var Qc=function(i){function t(t,e){i.call(this,t,e);this.defaultLocations_=null;this.styles_=[];this.styleIndices_=[];this.radius_=0;this.state_={fillColor:null,strokeColor:null,lineDash:null,lineDashOffset:void 0,lineWidth:void 0,changed:!1}}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.drawCoordinates_=function(t,e,i,r){var o,n,s=this,a=this.vertices.length,l=this.indices.length,h=a/4;for(o=e,n=i;o<n;o+=r){s.vertices[a++]=t[o];s.vertices[a++]=t[o+1];s.vertices[a++]=0;s.vertices[a++]=s.radius_;s.vertices[a++]=t[o];s.vertices[a++]=t[o+1];s.vertices[a++]=1;s.vertices[a++]=s.radius_;s.vertices[a++]=t[o];s.vertices[a++]=t[o+1];s.vertices[a++]=2;s.vertices[a++]=s.radius_;s.vertices[a++]=t[o];s.vertices[a++]=t[o+1];s.vertices[a++]=3;s.vertices[a++]=s.radius_;s.indices[l++]=h;s.indices[l++]=h+1;s.indices[l++]=h+2;s.indices[l++]=h+2;s.indices[l++]=h+3;s.indices[l++]=h;h+=4}};t.prototype.drawCircle=function(t,e){var i=t.getRadius(),r=t.getStride();if(i){this.startIndices.push(this.indices.length);this.startIndicesFeature.push(e);if(this.state_.changed){this.styleIndices_.push(this.indices.length);this.state_.changed=!1}this.radius_=i;var o=t.getFlatCoordinates();o=wt(o,0,2,r,-this.origin[0],-this.origin[1]);this.drawCoordinates_(o,0,2,r)}else if(this.state_.changed){this.styles_.pop();if(this.styles_.length){var n=this.styles_[this.styles_.length-1];this.state_.fillColor=n[0];this.state_.strokeColor=n[1];this.state_.lineWidth=n[2];this.state_.changed=!1}}};t.prototype.finish=function(t){this.verticesBuffer=new Jc(this.vertices);this.indicesBuffer=new Jc(this.indices);this.startIndices.push(this.indices.length);0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]);this.vertices=null;this.indices=null};t.prototype.getDeleteResourcesFunction=function(t){var e=this.verticesBuffer,i=this.indicesBuffer;return function(){t.deleteBuffer(e);t.deleteBuffer(i)}};t.prototype.setUpProgram=function(t,e,i,r){var o,n=e.getProgram(Dc,Gc);if(this.defaultLocations_)o=this.defaultLocations_;else{o=new kc(t,n);this.defaultLocations_=o}e.useProgram(n);t.enableVertexAttribArray(o.a_position);t.vertexAttribPointer(o.a_position,2,hi,!1,16,0);t.enableVertexAttribArray(o.a_instruction);t.vertexAttribPointer(o.a_instruction,1,hi,!1,16,8);t.enableVertexAttribArray(o.a_radius);t.vertexAttribPointer(o.a_radius,1,hi,!1,16,12);t.uniform2fv(o.u_size,i);t.uniform1f(o.u_pixelRatio,r);return o};t.prototype.shutDownProgram=function(t,e){t.disableVertexAttribArray(e.a_position);t.disableVertexAttribArray(e.a_instruction);t.disableVertexAttribArray(e.a_radius)};t.prototype.drawReplay=function(t,e,i,r){if(Ct(i)){var o,n,s,a;s=this.startIndices[this.startIndices.length-1];for(o=this.styleIndices_.length-1;0<=o;--o){n=this.styleIndices_[o];a=this.styles_[o];this.setFillStyle_(t,a[0]);this.setStrokeStyle_(t,a[1],a[2]);this.drawElements(t,e,n,s);s=n}}else this.drawReplaySkipping_(t,e,i)};t.prototype.drawHitDetectionReplayOneByOne=function(t,e,i,r,o){var n,s,a,l,h,u,c;c=this.startIndices.length-2;a=this.startIndices[c+1];for(n=this.styleIndices_.length-1;0<=n;--n){l=this.styles_[n];this.setFillStyle_(t,l[0]);this.setStrokeStyle_(t,l[1],l[2]);h=this.styleIndices_[n];for(;0<=c&&this.startIndices[c]>=h;){s=this.startIndices[c];if(void 0===i[St(u=this.startIndicesFeature[c]).toString()]&&u.getGeometry()&&(void 0===o||Rt(o,u.getGeometry().getExtent()))){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);this.drawElements(t,e,s,a);var p=r(u);if(p)return p}c--;a=s}}};t.prototype.drawReplaySkipping_=function(t,e,i){var r,o,n,s,a,l,h;l=this.startIndices.length-2;n=o=this.startIndices[l+1];for(r=this.styleIndices_.length-1;0<=r;--r){s=this.styles_[r];this.setFillStyle_(t,s[0]);this.setStrokeStyle_(t,s[1],s[2]);a=this.styleIndices_[r];for(;0<=l&&this.startIndices[l]>=a;){h=this.startIndices[l];if(i[St(this.startIndicesFeature[l]).toString()]){o!==n&&this.drawElements(t,e,o,n);n=h}l--;o=h}o!==n&&this.drawElements(t,e,o,n);o=n=a}};t.prototype.setFillStyle_=function(t,e){t.uniform4fv(this.defaultLocations_.u_fillColor,e)};t.prototype.setStrokeStyle_=function(t,e,i){t.uniform4fv(this.defaultLocations_.u_strokeColor,e);t.uniform1f(this.defaultLocations_.u_lineWidth,i)};t.prototype.setFillStrokeStyle=function(t,e){var i,r;if(e){var o=e.getLineDash();this.state_.lineDash=o||zc;var n=e.getLineDashOffset();this.state_.lineDashOffset=n||0;i=(i=e.getColor())instanceof CanvasGradient||i instanceof CanvasPattern?Hc:Je(i).map(function(t,e){return 3!=e?t/255:t})||Hc;r=void 0!==(r=e.getWidth())?r:1}else{i=[0,0,0,0];r=0}var s=t?t.getColor():[0,0,0,0];s=s instanceof CanvasGradient||s instanceof CanvasPattern?Vc:Je(s).map(function(t,e){return 3!=e?t/255:t})||Vc;if(!(this.state_.strokeColor&&Ar(this.state_.strokeColor,i)&&this.state_.fillColor&&Ar(this.state_.fillColor,s)&&this.state_.lineWidth===r)){this.state_.changed=!0;this.state_.fillColor=s;this.state_.strokeColor=i;this.state_.lineWidth=r;this.styles_.push([s,i,r])}};return t}(Yc),$c=new Ac("precision mediump float;\nvarying vec2 v_texCoord;\nvarying float v_opacity;\n\nuniform float u_opacity;\nuniform sampler2D u_image;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  float alpha = texColor.a * v_opacity * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n"),tp=new Nc("varying vec2 v_texCoord;\nvarying float v_opacity;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nattribute vec2 a_offsets;\nattribute float a_opacity;\nattribute float a_rotateWithView;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix;\n  if (a_rotateWithView == 1.0) {\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  }\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n  v_texCoord = a_texCoord;\n  v_opacity = a_opacity;\n}\n\n\n"),ep=function(t,e){this.u_projectionMatrix=t.getUniformLocation(e,"u_projectionMatrix");this.u_offsetScaleMatrix=t.getUniformLocation(e,"u_offsetScaleMatrix");this.u_offsetRotateMatrix=t.getUniformLocation(e,"u_offsetRotateMatrix");this.u_opacity=t.getUniformLocation(e,"u_opacity");this.u_image=t.getUniformLocation(e,"u_image");this.a_position=t.getAttribLocation(e,"a_position");this.a_texCoord=t.getAttribLocation(e,"a_texCoord");this.a_offsets=t.getAttribLocation(e,"a_offsets");this.a_opacity=t.getAttribLocation(e,"a_opacity");this.a_rotateWithView=t.getAttribLocation(e,"a_rotateWithView")},ip={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},rp=function(i){function t(t,e){i.call(this);this.canvas_=t;this.gl_=e;this.bufferCache_={};this.shaderCache_={};this.programCache_={};this.currentProgram_=null;this.hitDetectionFramebuffer_=null;this.hitDetectionTexture_=null;this.hitDetectionRenderbuffer_=null;this.hasOESElementIndexUint=Lr(Ei,"OES_element_index_uint");this.hasOESElementIndexUint&&e.getExtension("OES_element_index_uint");S(this.canvas_,ip.LOST,this.handleWebGLContextLost,this);S(this.canvas_,ip.RESTORED,this.handleWebGLContextRestored,this)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.bindBuffer=function(t,e){var i=this.getGL(),r=e.getArray(),o=String(St(e));if(o in this.bufferCache_){var n=this.bufferCache_[o];i.bindBuffer(t,n.buffer)}else{var s,a=i.createBuffer();i.bindBuffer(t,a);t==li?s=new Float32Array(r):34963==t&&(s=this.hasOESElementIndexUint?new Uint32Array(r):new Uint16Array(r));i.bufferData(t,s,e.getUsage());this.bufferCache_[o]={buf:e,buffer:a}}};t.prototype.deleteBuffer=function(t){var e=this.getGL(),i=String(St(t)),r=this.bufferCache_[i];e.isContextLost()||e.deleteBuffer(r.buffer);delete this.bufferCache_[i]};t.prototype.disposeInternal=function(){f(this.canvas_);var t=this.getGL();if(!t.isContextLost()){for(var e in this.bufferCache_)t.deleteBuffer(this.bufferCache_[e].buffer);for(var i in this.programCache_)t.deleteProgram(this.programCache_[i]);for(var r in this.shaderCache_)t.deleteShader(this.shaderCache_[r]);t.deleteFramebuffer(this.hitDetectionFramebuffer_);t.deleteRenderbuffer(this.hitDetectionRenderbuffer_);t.deleteTexture(this.hitDetectionTexture_)}};t.prototype.getCanvas=function(){return this.canvas_};t.prototype.getGL=function(){return this.gl_};t.prototype.getHitDetectionFramebuffer=function(){this.hitDetectionFramebuffer_||this.initHitDetectionFramebuffer_();return this.hitDetectionFramebuffer_};t.prototype.getShader=function(t){var e=String(St(t));if(e in this.shaderCache_)return this.shaderCache_[e];var i=this.getGL(),r=i.createShader(t.getType());i.shaderSource(r,t.getSource());i.compileShader(r);return this.shaderCache_[e]=r};t.prototype.getProgram=function(t,e){var i=St(t)+"/"+St(e);if(i in this.programCache_)return this.programCache_[i];var r=this.getGL(),o=r.createProgram();r.attachShader(o,this.getShader(t));r.attachShader(o,this.getShader(e));r.linkProgram(o);return this.programCache_[i]=o};t.prototype.handleWebGLContextLost=function(){_(this.bufferCache_);_(this.shaderCache_);_(this.programCache_);this.currentProgram_=null;this.hitDetectionFramebuffer_=null;this.hitDetectionTexture_=null;this.hitDetectionRenderbuffer_=null};t.prototype.handleWebGLContextRestored=function(){};t.prototype.initHitDetectionFramebuffer_=function(){var t=this.gl_,e=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);var i=np(t,1,1),r=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,r);t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,1,1);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,r);t.bindTexture(t.TEXTURE_2D,null);t.bindRenderbuffer(t.RENDERBUFFER,null);t.bindFramebuffer(t.FRAMEBUFFER,null);this.hitDetectionFramebuffer_=e;this.hitDetectionTexture_=i;this.hitDetectionRenderbuffer_=r};t.prototype.useProgram=function(t){if(t==this.currentProgram_)return!1;this.getGL().useProgram(t);this.currentProgram_=t;return!0};return t}(i);function op(t,e,i){var r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);void 0!==e&&t.texParameteri(fi,pi,e);void 0!==i&&t.texParameteri(fi,di,i);return r}function np(t,e,i,r,o){var n=op(t,r,o);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null);return n}function sp(t,e,i,r){var o=op(t,i,r);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);return o}var ap=function(i){function t(t,e){i.call(this,t,e);this.anchorX=void 0;this.anchorY=void 0;this.groupIndices=[];this.hitDetectionGroupIndices=[];this.height=void 0;this.imageHeight=void 0;this.imageWidth=void 0;this.defaultLocations=null;this.opacity=void 0;this.originX=void 0;this.originY=void 0;this.rotateWithView=void 0;this.rotation=void 0;this.scale=void 0;this.width=void 0}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getDeleteResourcesFunction=function(i){var r=this.verticesBuffer,o=this.indicesBuffer,n=this.getTextures(!0),s=i.getGL();return function(){if(!s.isContextLost()){var t,e;for(t=0,e=n.length;t<e;++t)s.deleteTexture(n[t])}i.deleteBuffer(r);i.deleteBuffer(o)}};t.prototype.drawCoordinates=function(t,e,i,r){var o,n,s,a,l,h,u=this,c=this.anchorX,p=this.anchorY,d=this.height,f=this.imageHeight,_=this.imageWidth,g=this.opacity,y=this.originX,v=this.originY,m=this.rotateWithView?1:0,E=-this.rotation,x=this.scale,T=this.width,S=Math.cos(E),C=Math.sin(E),R=this.indices.length,I=this.vertices.length;for(o=e;o<i;o+=r){l=t[o]-u.origin[0];h=t[o+1]-u.origin[1];n=I/8;s=-x*c;a=-x*(d-p);u.vertices[I++]=l;u.vertices[I++]=h;u.vertices[I++]=s*S-a*C;u.vertices[I++]=s*C+a*S;u.vertices[I++]=y/_;u.vertices[I++]=(v+d)/f;u.vertices[I++]=g;u.vertices[I++]=m;s=x*(T-c);a=-x*(d-p);u.vertices[I++]=l;u.vertices[I++]=h;u.vertices[I++]=s*S-a*C;u.vertices[I++]=s*C+a*S;u.vertices[I++]=(y+T)/_;u.vertices[I++]=(v+d)/f;u.vertices[I++]=g;u.vertices[I++]=m;s=x*(T-c);a=x*p;u.vertices[I++]=l;u.vertices[I++]=h;u.vertices[I++]=s*S-a*C;u.vertices[I++]=s*C+a*S;u.vertices[I++]=(y+T)/_;u.vertices[I++]=v/f;u.vertices[I++]=g;u.vertices[I++]=m;s=-x*c;a=x*p;u.vertices[I++]=l;u.vertices[I++]=h;u.vertices[I++]=s*S-a*C;u.vertices[I++]=s*C+a*S;u.vertices[I++]=y/_;u.vertices[I++]=v/f;u.vertices[I++]=g;u.vertices[I++]=m;u.indices[R++]=n;u.indices[R++]=n+1;u.indices[R++]=n+2;u.indices[R++]=n;u.indices[R++]=n+2;u.indices[R++]=n+3}return I};t.prototype.createTextures=function(t,e,i,r){var o,n,s,a,l=e.length;for(a=0;a<l;++a){if((s=St(n=e[a]).toString())in i)o=i[s];else{o=sp(r,n,_i,_i);i[s]=o}t[a]=o}};t.prototype.setUpProgram=function(t,e,i,r){var o,n=e.getProgram($c,tp);if(this.defaultLocations)o=this.defaultLocations;else{o=new ep(t,n);this.defaultLocations=o}e.useProgram(n);t.enableVertexAttribArray(o.a_position);t.vertexAttribPointer(o.a_position,2,hi,!1,32,0);t.enableVertexAttribArray(o.a_offsets);t.vertexAttribPointer(o.a_offsets,2,hi,!1,32,8);t.enableVertexAttribArray(o.a_texCoord);t.vertexAttribPointer(o.a_texCoord,2,hi,!1,32,16);t.enableVertexAttribArray(o.a_opacity);t.vertexAttribPointer(o.a_opacity,1,hi,!1,32,24);t.enableVertexAttribArray(o.a_rotateWithView);t.vertexAttribPointer(o.a_rotateWithView,1,hi,!1,32,28);return o};t.prototype.shutDownProgram=function(t,e){t.disableVertexAttribArray(e.a_position);t.disableVertexAttribArray(e.a_offsets);t.disableVertexAttribArray(e.a_texCoord);t.disableVertexAttribArray(e.a_opacity);t.disableVertexAttribArray(e.a_rotateWithView)};t.prototype.drawReplay=function(t,e,i,r){var o=r?this.getHitDetectionTextures():this.getTextures(),n=r?this.hitDetectionGroupIndices:this.groupIndices;if(Ct(i)){var s,a,l;for(s=0,a=o.length,l=0;s<a;++s){t.bindTexture(fi,o[s]);var h=n[s];this.drawElements(t,e,l,h);l=h}}else this.drawReplaySkipping(t,e,i,o,n)};t.prototype.drawReplaySkipping=function(t,e,i,r,o){var n,s,a=0;for(n=0,s=r.length;n<s;++n){t.bindTexture(fi,r[n]);for(var l=0<n?o[n-1]:0,h=o[n],u=l,c=l;a<this.startIndices.length&&this.startIndices[a]<=h;){if(void 0!==i[St(this.startIndicesFeature[a]).toString()]){u!==c&&this.drawElements(t,e,u,c);c=u=a===this.startIndices.length-1?h:this.startIndices[a+1]}else c=a===this.startIndices.length-1?h:this.startIndices[a+1];a++}u!==c&&this.drawElements(t,e,u,c)}};t.prototype.drawHitDetectionReplayOneByOne=function(t,e,i,r,o){var n,s,a,l,h,u=this.startIndices.length-1,c=this.getHitDetectionTextures();for(n=c.length-1;0<=n;--n){t.bindTexture(fi,c[n]);s=0<n?this.hitDetectionGroupIndices[n-1]:0;l=this.hitDetectionGroupIndices[n];for(;0<=u&&this.startIndices[u]>=s;){a=this.startIndices[u];if(void 0===i[St(h=this.startIndicesFeature[u]).toString()]&&h.getGeometry()&&(void 0===o||Rt(o,h.getGeometry().getExtent()))){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);this.drawElements(t,e,a,l);var p=r(h);if(p)return p}l=a;u--}}};t.prototype.finish=function(t){this.anchorX=void 0;this.anchorY=void 0;this.height=void 0;this.imageHeight=void 0;this.imageWidth=void 0;this.indices=null;this.opacity=void 0;this.originX=void 0;this.originY=void 0;this.rotateWithView=void 0;this.rotation=void 0;this.scale=void 0;this.vertices=null;this.width=void 0};t.prototype.getTextures=function(t){};t.prototype.getHitDetectionTextures=function(){};return t}(Yc),lp=function(o){function t(t,e){o.call(this,t,e);this.images_=[];this.hitDetectionImages_=[];this.textures_=[];this.hitDetectionTextures_=[]}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.drawMultiPoint=function(t,e){this.startIndices.push(this.indices.length);this.startIndicesFeature.push(e);var i=t.getFlatCoordinates(),r=t.getStride();this.drawCoordinates(i,0,i.length,r)};t.prototype.drawPoint=function(t,e){this.startIndices.push(this.indices.length);this.startIndicesFeature.push(e);var i=t.getFlatCoordinates(),r=t.getStride();this.drawCoordinates(i,0,i.length,r)};t.prototype.finish=function(t){var e=t.getGL();this.groupIndices.push(this.indices.length);this.hitDetectionGroupIndices.push(this.indices.length);this.verticesBuffer=new Jc(this.vertices);var i=this.indices;this.indicesBuffer=new Jc(i);var r={};this.createTextures(this.textures_,this.images_,r,e);this.createTextures(this.hitDetectionTextures_,this.hitDetectionImages_,r,e);this.images_=null;this.hitDetectionImages_=null;o.prototype.finish.call(this,t)};t.prototype.setImageStyle=function(t){var e=t.getAnchor(),i=t.getImage(1),r=t.getImageSize(),o=t.getHitDetectionImage(1),n=t.getOpacity(),s=t.getOrigin(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getSize(),u=t.getScale();if(0===this.images_.length)this.images_.push(i);else if(St(this.images_[this.images_.length-1])!=St(i)){this.groupIndices.push(this.indices.length);this.images_.push(i)}if(0===this.hitDetectionImages_.length)this.hitDetectionImages_.push(o);else if(St(this.hitDetectionImages_[this.hitDetectionImages_.length-1])!=St(o)){this.hitDetectionGroupIndices.push(this.indices.length);this.hitDetectionImages_.push(o)}this.anchorX=e[0];this.anchorY=e[1];this.height=h[1];this.imageHeight=r[1];this.imageWidth=r[0];this.opacity=n;this.originX=s[0];this.originY=s[1];this.rotation=l;this.rotateWithView=a;this.scale=u;this.width=h[0]};t.prototype.getTextures=function(t){return t?this.textures_.concat(this.hitDetectionTextures_):this.textures_};t.prototype.getHitDetectionTextures=function(){return this.hitDetectionTextures_};return t}(ap);function hp(t,e,i,r){var o=i-r;return t[e]===t[o]&&t[e+1]===t[o+1]&&3<(i-e)/r&&!!Br(t,e,i,r)}var up=new Ac("precision mediump float;\nvarying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_color;\nuniform vec2 u_size;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  if (v_round > 0.0) {\n    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,\n        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);\n    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {\n      discard;\n    }\n  }\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n"),cp=new Nc("varying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\nattribute vec2 a_lastPos;\nattribute vec2 a_position;\nattribute vec2 a_nextPos;\nattribute float a_direction;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_miterLimit;\n\nbool nearlyEquals(in float value, in float ref) {\n  float epsilon = 0.000000000001;\n  return value >= ref - epsilon && value <= ref + epsilon;\n}\n\nvoid alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {\n  vec2 dirVect = nextP - a_position;\n  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));\n  offset = u_lineWidth / 2.0 * normal * direction;\n}\n\nvoid miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {\n  float halfWidth = u_lineWidth / 2.0;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_nextPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n  offset = normal * direction * miterLength;\n  round = 0.0;\n  if (isRound) {\n    round = 1.0;\n  } else if (miterLength > u_miterLimit + u_lineWidth) {\n    offset = halfWidth * tmpNormal * direction;\n  }\n}\n\nbool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {\n  bool degenerate = false;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_lastPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  vec2 longOffset, shortOffset, longVertex;\n  vec4 shortProjVertex;\n  float halfWidth = u_lineWidth / 2.0;\n  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {\n    longOffset = tmpNormal * direction * halfWidth;\n    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_nextPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);\n  } else {\n    shortOffset = tmpNormal * direction * halfWidth;\n    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_lastPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);\n  }\n  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).\n  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);\n  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);\n  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);\n  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;\n  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;\n  float epsilon = 0.000000000001;\n  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {\n    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);\n    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);\n    offset = shortProjVertex.xy;\n    degenerate = true;\n  } else {\n    float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n    offset = normal * direction * miterLength;\n  }\n  return degenerate;\n}\n\nvoid squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,\n    in float turnDir, in float direction) {\n  round = 0.0;\n  vec2 dirVect = a_position - nextP;\n  vec2 firstNormal = normalize(dirVect);\n  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);\n  vec2 hypotenuse = normalize(firstNormal - secondNormal);\n  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);\n  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);\n  offset = normal * length;\n  if (isRound) {\n    round = 1.0;\n  }\n}\n\nvoid main(void) {\n  bool degenerate = false;\n  float direction = float(sign(a_direction));\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  vec2 offset;\n  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);\n\n  v_round = 0.0;\n  v_halfWidth = u_lineWidth / 2.0;\n  v_roundVertex = projPos.xy;\n\n  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {\n    alongNormal(offset, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {\n    alongNormal(offset, a_lastPos, -1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {\n    miterUp(offset, v_round, round, direction);\n  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {\n    degenerate = miterDown(offset, projPos, offsetMatrix, direction);\n  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {\n    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {\n    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);\n  }\n  if (!degenerate) {\n    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);\n    gl_Position = projPos + offsets;\n  } else {\n    gl_Position = vec4(offset, 0.0, 1.0);\n  }\n}\n\n\n"),pp=function(t,e){this.u_projectionMatrix=t.getUniformLocation(e,"u_projectionMatrix");this.u_offsetScaleMatrix=t.getUniformLocation(e,"u_offsetScaleMatrix");this.u_offsetRotateMatrix=t.getUniformLocation(e,"u_offsetRotateMatrix");this.u_lineWidth=t.getUniformLocation(e,"u_lineWidth");this.u_miterLimit=t.getUniformLocation(e,"u_miterLimit");this.u_opacity=t.getUniformLocation(e,"u_opacity");this.u_color=t.getUniformLocation(e,"u_color");this.u_size=t.getUniformLocation(e,"u_size");this.u_pixelRatio=t.getUniformLocation(e,"u_pixelRatio");this.a_lastPos=t.getAttribLocation(e,"a_lastPos");this.a_position=t.getAttribLocation(e,"a_position");this.a_nextPos=t.getAttribLocation(e,"a_nextPos");this.a_direction=t.getAttribLocation(e,"a_direction")},dp=3,fp=5,_p=7,gp=11,yp=13,vp=17,mp=19,Ep=23,xp=function(i){function t(t,e){i.call(this,t,e);this.defaultLocations_=null;this.styles_=[];this.styleIndices_=[];this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0,changed:!1}}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.drawCoordinates_=function(t,e,i,r){var o,n,s,a,l,h,u,c,p=this,d=this.vertices.length,f=this.indices.length,_="bevel"===this.state_.lineJoin?0:"miter"===this.state_.lineJoin?1:2,g="butt"===this.state_.lineCap?0:"square"===this.state_.lineCap?1:2,y=hp(t,e,i,r),v=f,m=1;for(o=e,n=i;o<n;o+=r){l=d/7;h=u;u=c||[t[o],t[o+1]];if(o===e){c=[t[o+r],t[o+r+1]];if(i-e==2*r&&Ar(u,c))break;if(!y){if(g){d=p.addVertices_([0,0],u,c,m*_p*g,d);d=p.addVertices_([0,0],u,c,-m*_p*g,d);p.indices[f++]=l+2;p.indices[f++]=l;p.indices[f++]=l+1;p.indices[f++]=l+1;p.indices[f++]=l+3;p.indices[f++]=l+2}d=p.addVertices_([0,0],u,c,m*dp*(g||1),d);v=(d=p.addVertices_([0,0],u,c,-m*dp*(g||1),d))/7-1;continue}h=[t[i-2*r],t[i-2*r+1]];s=c}else{if(o===i-r){if(y){c=s;break}h=h||[0,0];d=p.addVertices_(h,u,[0,0],m*fp*(g||1),d);d=p.addVertices_(h,u,[0,0],-m*fp*(g||1),d);p.indices[f++]=l;p.indices[f++]=v-1;p.indices[f++]=v;p.indices[f++]=v;p.indices[f++]=l+1;p.indices[f++]=l;if(g){d=p.addVertices_(h,u,[0,0],m*gp*g,d);d=p.addVertices_(h,u,[0,0],-m*gp*g,d);p.indices[f++]=l+2;p.indices[f++]=l;p.indices[f++]=l+1;p.indices[f++]=l+1;p.indices[f++]=l+3;p.indices[f++]=l+2}break}c=[t[o+r],t[o+r+1]]}a=Zc(h[0],h[1],u[0],u[1],c[0],c[1])?-1:1;d=p.addVertices_(h,u,c,a*yp*(_||1),d);d=p.addVertices_(h,u,c,a*vp*(_||1),d);d=p.addVertices_(h,u,c,-a*mp*(_||1),d);if(e<o){p.indices[f++]=l;p.indices[f++]=v-1;p.indices[f++]=v;p.indices[f++]=l+2;p.indices[f++]=l;p.indices[f++]=0<m*a?v:v-1}p.indices[f++]=l;p.indices[f++]=l+2;p.indices[f++]=l+1;v=l+2;m=a;if(_){d=p.addVertices_(h,u,c,a*Ep*_,d);p.indices[f++]=l+1;p.indices[f++]=l+3;p.indices[f++]=l}}if(y){l=l||d/7;a=Lo([h[0],h[1],u[0],u[1],c[0],c[1]],0,6,2)?1:-1;d=this.addVertices_(h,u,c,a*yp*(_||1),d);d=this.addVertices_(h,u,c,-a*mp*(_||1),d);this.indices[f++]=l;this.indices[f++]=v-1;this.indices[f++]=v;this.indices[f++]=l+1;this.indices[f++]=l;this.indices[f++]=0<m*a?v:v-1}};t.prototype.addVertices_=function(t,e,i,r,o){this.vertices[o++]=t[0];this.vertices[o++]=t[1];this.vertices[o++]=e[0];this.vertices[o++]=e[1];this.vertices[o++]=i[0];this.vertices[o++]=i[1];this.vertices[o++]=r;return o};t.prototype.isValid_=function(t,e,i,r){var o=i-e;return!(o<2*r)&&(o!==2*r||!Ar([t[e],t[e+1]],[t[e+r],t[e+r+1]]))};t.prototype.drawLineString=function(t,e){var i=t.getFlatCoordinates(),r=t.getStride();if(this.isValid_(i,0,i.length,r)){i=wt(i,0,i.length,r,-this.origin[0],-this.origin[1]);if(this.state_.changed){this.styleIndices_.push(this.indices.length);this.state_.changed=!1}this.startIndices.push(this.indices.length);this.startIndicesFeature.push(e);this.drawCoordinates_(i,0,i.length,r)}};t.prototype.drawMultiLineString=function(t,e){var i=this.indices.length,r=t.getEnds();r.unshift(0);var o,n,s=t.getFlatCoordinates(),a=t.getStride();if(1<r.length)for(o=1,n=r.length;o<n;++o)if(this.isValid_(s,r[o-1],r[o],a)){var l=wt(s,r[o-1],r[o],a,-this.origin[0],-this.origin[1]);this.drawCoordinates_(l,0,l.length,a)}if(this.indices.length>i){this.startIndices.push(i);this.startIndicesFeature.push(e);if(this.state_.changed){this.styleIndices_.push(i);this.state_.changed=!1}}};t.prototype.drawPolygonCoordinates=function(t,e,i){if(!hp(t,0,t.length,i)){t.push(t[0]);t.push(t[1])}this.drawCoordinates_(t,0,t.length,i);if(e.length){var r,o;for(r=0,o=e.length;r<o;++r){if(!hp(e[r],0,e[r].length,i)){e[r].push(e[r][0]);e[r].push(e[r][1])}this.drawCoordinates_(e[r],0,e[r].length,i)}}};t.prototype.setPolygonStyle=function(t,e){var i=void 0===e?this.indices.length:e;this.startIndices.push(i);this.startIndicesFeature.push(t);if(this.state_.changed){this.styleIndices_.push(i);this.state_.changed=!1}};t.prototype.getCurrentIndex=function(){return this.indices.length};t.prototype.finish=function(t){this.verticesBuffer=new Jc(this.vertices);this.indicesBuffer=new Jc(this.indices);this.startIndices.push(this.indices.length);0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]);this.vertices=null;this.indices=null};t.prototype.getDeleteResourcesFunction=function(t){var e=this.verticesBuffer,i=this.indicesBuffer;return function(){t.deleteBuffer(e);t.deleteBuffer(i)}};t.prototype.setUpProgram=function(t,e,i,r){var o,n=e.getProgram(up,cp);if(this.defaultLocations_)o=this.defaultLocations_;else{o=new pp(t,n);this.defaultLocations_=o}e.useProgram(n);t.enableVertexAttribArray(o.a_lastPos);t.vertexAttribPointer(o.a_lastPos,2,hi,!1,28,0);t.enableVertexAttribArray(o.a_position);t.vertexAttribPointer(o.a_position,2,hi,!1,28,8);t.enableVertexAttribArray(o.a_nextPos);t.vertexAttribPointer(o.a_nextPos,2,hi,!1,28,16);t.enableVertexAttribArray(o.a_direction);t.vertexAttribPointer(o.a_direction,1,hi,!1,28,24);t.uniform2fv(o.u_size,i);t.uniform1f(o.u_pixelRatio,r);return o};t.prototype.shutDownProgram=function(t,e){t.disableVertexAttribArray(e.a_lastPos);t.disableVertexAttribArray(e.a_position);t.disableVertexAttribArray(e.a_nextPos);t.disableVertexAttribArray(e.a_direction)};t.prototype.drawReplay=function(t,e,i,r){var o=t.getParameter(t.DEPTH_FUNC),n=t.getParameter(t.DEPTH_WRITEMASK);if(!r){t.enable(t.DEPTH_TEST);t.depthMask(!0);t.depthFunc(t.NOTEQUAL)}if(Ct(i)){var s,a,l,h;l=this.startIndices[this.startIndices.length-1];for(s=this.styleIndices_.length-1;0<=s;--s){a=this.styleIndices_[s];h=this.styles_[s];this.setStrokeStyle_(t,h[0],h[1],h[2]);this.drawElements(t,e,a,l);t.clear(t.DEPTH_BUFFER_BIT);l=a}}else this.drawReplaySkipping_(t,e,i);if(!r){t.disable(t.DEPTH_TEST);t.clear(t.DEPTH_BUFFER_BIT);t.depthMask(n);t.depthFunc(o)}};t.prototype.drawReplaySkipping_=function(t,e,i){var r,o,n,s,a,l,h;l=this.startIndices.length-2;n=o=this.startIndices[l+1];for(r=this.styleIndices_.length-1;0<=r;--r){s=this.styles_[r];this.setStrokeStyle_(t,s[0],s[1],s[2]);a=this.styleIndices_[r];for(;0<=l&&this.startIndices[l]>=a;){h=this.startIndices[l];if(i[St(this.startIndicesFeature[l]).toString()]){if(o!==n){this.drawElements(t,e,o,n);t.clear(t.DEPTH_BUFFER_BIT)}n=h}l--;o=h}if(o!==n){this.drawElements(t,e,o,n);t.clear(t.DEPTH_BUFFER_BIT)}o=n=a}};t.prototype.drawHitDetectionReplayOneByOne=function(t,e,i,r,o){var n,s,a,l,h,u,c;c=this.startIndices.length-2;a=this.startIndices[c+1];for(n=this.styleIndices_.length-1;0<=n;--n){l=this.styles_[n];this.setStrokeStyle_(t,l[0],l[1],l[2]);h=this.styleIndices_[n];for(;0<=c&&this.startIndices[c]>=h;){s=this.startIndices[c];if(void 0===i[St(u=this.startIndicesFeature[c]).toString()]&&u.getGeometry()&&(void 0===o||Rt(o,u.getGeometry().getExtent()))){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);this.drawElements(t,e,s,a);var p=r(u);if(p)return p}c--;a=s}}};t.prototype.setStrokeStyle_=function(t,e,i,r){t.uniform4fv(this.defaultLocations_.u_color,e);t.uniform1f(this.defaultLocations_.u_lineWidth,i);t.uniform1f(this.defaultLocations_.u_miterLimit,r)};t.prototype.setFillStrokeStyle=function(t,e){var i=e.getLineCap();this.state_.lineCap=void 0!==i?i:Xc;var r=e.getLineDash();this.state_.lineDash=r||zc;var o=e.getLineDashOffset();this.state_.lineDashOffset=o||0;var n=e.getLineJoin();this.state_.lineJoin=void 0!==n?n:Wc;var s=e.getColor();s=s instanceof CanvasGradient||s instanceof CanvasPattern?Hc:Je(s).map(function(t,e){return 3!=e?t/255:t})||Hc;var a=e.getWidth();a=void 0!==a?a:1;var l=e.getMiterLimit();l=void 0!==l?l:10;if(!this.state_.strokeColor||!Ar(this.state_.strokeColor,s)||this.state_.lineWidth!==a||this.state_.miterLimit!==l){this.state_.changed=!0;this.state_.strokeColor=s;this.state_.lineWidth=a;this.state_.miterLimit=l;this.styles_.push([s,a,l])}};return t}(Yc),Tp=new Ac("precision mediump float;\n\n\n\nuniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main(void) {\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n"),Sp=new Nc("\n\nattribute vec2 a_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n}\n\n\n"),Cp=function(t,e){this.u_projectionMatrix=t.getUniformLocation(e,"u_projectionMatrix");this.u_offsetScaleMatrix=t.getUniformLocation(e,"u_offsetScaleMatrix");this.u_offsetRotateMatrix=t.getUniformLocation(e,"u_offsetRotateMatrix");this.u_color=t.getUniformLocation(e,"u_color");this.u_opacity=t.getUniformLocation(e,"u_opacity");this.a_position=t.getAttribLocation(e,"a_position")},Rp=function(t){this.first_;this.last_;this.head_;this.circular_=void 0===t||t;this.length_=0};Rp.prototype.insertItem=function(t){var e={prev:void 0,next:void 0,data:t},i=this.head_;if(i){var r=i.next;e.prev=i;e.next=r;i.next=e;r&&(r.prev=e);i===this.last_&&(this.last_=e)}else{this.first_=e;this.last_=e;this.circular_&&((e.next=e).prev=e)}this.head_=e;this.length_++};Rp.prototype.removeItem=function(){var t=this.head_;if(t){var e=t.next,i=t.prev;e&&(e.prev=i);i&&(i.next=e);this.head_=e||i;if(this.first_===this.last_){this.head_=void 0;this.first_=void 0;this.last_=void 0}else this.first_===t?this.first_=this.head_:this.last_===t&&(this.last_=i?this.head_.prev:this.head_);this.length_--}};Rp.prototype.firstItem=function(){this.head_=this.first_;if(this.head_)return this.head_.data};Rp.prototype.lastItem=function(){this.head_=this.last_;if(this.head_)return this.head_.data};Rp.prototype.nextItem=function(){if(this.head_&&this.head_.next){this.head_=this.head_.next;return this.head_.data}};Rp.prototype.getNextItem=function(){if(this.head_&&this.head_.next)return this.head_.next.data};Rp.prototype.prevItem=function(){if(this.head_&&this.head_.prev){this.head_=this.head_.prev;return this.head_.data}};Rp.prototype.getPrevItem=function(){if(this.head_&&this.head_.prev)return this.head_.prev.data};Rp.prototype.getCurrItem=function(){if(this.head_)return this.head_.data};Rp.prototype.setFirstItem=function(){if(this.circular_&&this.head_){this.first_=this.head_;this.last_=this.head_.prev}};Rp.prototype.concat=function(t){if(t.head_){if(this.head_){var e=this.head_.next;this.head_.next=t.first_;t.first_.prev=this.head_;e.prev=t.last_;t.last_.next=e;this.length_+=t.length_}else{this.head_=t.head_;this.first_=t.first_;this.last_=t.last_;this.length_=t.length_}t.head_=void 0;t.first_=void 0;t.last_=void 0;t.length_=0}};Rp.prototype.getLength=function(){return this.length_};var Ip=function(i){function t(t,e){i.call(this,t,e);this.lineStringReplay=new xp(t,e);this.defaultLocations_=null;this.styles_=[];this.styleIndices_=[];this.state_={fillColor:null,changed:!1}}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.drawCoordinates_=function(t,e,i){var r=new Rp,o=new ih;this.processFlatCoordinates_(t,i,r,o,!0);var n=this.getMaxCoords_(r);if(e.length){var s,a,l=[];for(s=0,a=e.length;s<a;++s){var h={list:new Rp,maxCoords:void 0,rtree:new ih};l.push(h);this.processFlatCoordinates_(e[s],i,h.list,h.rtree,!1);this.classifyPoints_(h.list,h.rtree,!0);h.maxCoords=this.getMaxCoords_(h.list)}l.sort(function(t,e){return e.maxCoords[0]===t.maxCoords[0]?t.maxCoords[1]-e.maxCoords[1]:e.maxCoords[0]-t.maxCoords[0]});for(s=0;s<l.length;++s){var u=l[s].list,c=u.firstItem(),p=c,d=void 0;do{if(this.getIntersections_(p,o).length){d=!0;break}p=u.nextItem()}while(c!==p);if(!d&&this.bridgeHole_(u,l[s].maxCoords[0],r,n[0],o)){o.concat(l[s].rtree);this.classifyPoints_(r,o,!1)}}}else this.classifyPoints_(r,o,!1);this.triangulate_(r,o)};t.prototype.processFlatCoordinates_=function(t,e,i,r,o){var n,s,a,l,h,u=Lo(t,0,t.length,e),c=this.vertices.length/2,p=[],d=[];if(o===u){l=a=this.createPoint_(t[0],t[1],c++);for(n=e,s=t.length;n<s;n+=e){h=this.createPoint_(t[n],t[n+1],c++);d.push(this.insertItem_(l,h,i));p.push([Math.min(l.x,h.x),Math.min(l.y,h.y),Math.max(l.x,h.x),Math.max(l.y,h.y)]);l=h}d.push(this.insertItem_(h,a,i));p.push([Math.min(l.x,h.x),Math.min(l.y,h.y),Math.max(l.x,h.x),Math.max(l.y,h.y)])}else{var f=t.length-e;l=a=this.createPoint_(t[f],t[f+1],c++);for(n=f-e,s=0;s<=n;n-=e){h=this.createPoint_(t[n],t[n+1],c++);d.push(this.insertItem_(l,h,i));p.push([Math.min(l.x,h.x),Math.min(l.y,h.y),Math.max(l.x,h.x),Math.max(l.y,h.y)]);l=h}d.push(this.insertItem_(h,a,i));p.push([Math.min(l.x,h.x),Math.min(l.y,h.y),Math.max(l.x,h.x),Math.max(l.y,h.y)])}r.load(p,d)};t.prototype.getMaxCoords_=function(t){for(var e=t.firstItem(),i=e,r=[i.p0.x,i.p0.y];(i=t.nextItem()).p0.x>r[0]&&(r=[i.p0.x,i.p0.y]),i!==e;);return r};t.prototype.classifyPoints_=function(t,e,i){var r=t.firstItem(),o=r,n=t.nextItem(),s=!1;do{var a=i?Zc(n.p1.x,n.p1.y,o.p1.x,o.p1.y,o.p0.x,o.p0.y):Zc(o.p0.x,o.p0.y,o.p1.x,o.p1.y,n.p1.x,n.p1.y);if(void 0===a){this.removeItem_(o,n,t,e);s=!0;n===r&&(r=t.getNextItem());n=o;t.prevItem()}else if(o.p1.reflex!==a){o.p1.reflex=a;s=!0}o=n;n=t.nextItem()}while(o!==r);return s};t.prototype.bridgeHole_=function(t,e,i,r,o){for(var n=t.firstItem();n.p1.x!==e;)n=t.nextItem();var s,a,l,h,u=n.p1,c={x:r,y:u.y,i:-1},p=1/0,d=this.getIntersections_({p0:u,p1:c},o,!0);for(s=0,a=d.length;s<a;++s){var f=d[s],_=this.calculateIntersection_(u,c,f.p0,f.p1,!0),g=Math.abs(u.x-_[0]);if(g<p&&void 0!==Zc(u.x,u.y,f.p0.x,f.p0.y,f.p1.x,f.p1.y)){p=g;h={x:_[0],y:_[1],i:-1};n=f}}if(p===1/0)return!1;l=n.p1;if(0<p){var y=this.getPointsInTriangle_(u,h,n.p1,o);if(y.length){var v=1/0;for(s=0,a=y.length;s<a;++s){var m=y[s],E=Math.atan2(u.y-m.y,c.x-m.x);if(E<v||E===v&&m.x<l.x){v=E;l=m}}}}n=i.firstItem();for(;n.p1.x!==l.x||n.p1.y!==l.y;)n=i.nextItem();var x={x:u.x,y:u.y,i:u.i,reflex:void 0},T={x:n.p1.x,y:n.p1.y,i:n.p1.i,reflex:void 0};t.getNextItem().p0=x;this.insertItem_(u,n.p1,t,o);this.insertItem_(T,x,t,o);n.p1=T;t.setFirstItem();i.concat(t);return!0};t.prototype.triangulate_=function(t,e){for(var i=this,r=!1,o=this.isSimple_(t,e);3<t.getLength();)if(o){if(!i.clipEars_(t,e,o,r)&&!i.classifyPoints_(t,e,r)&&!i.resolveSelfIntersections_(t,e,!0))break}else if(!i.clipEars_(t,e,o,r)&&!i.classifyPoints_(t,e,r)&&!i.resolveSelfIntersections_(t,e)){if(!(o=i.isSimple_(t,e))){i.splitPolygon_(t,e);break}r=!i.isClockwise_(t);i.classifyPoints_(t,e,r)}if(3===t.getLength()){var n=this.indices.length;this.indices[n++]=t.getPrevItem().p0.i;this.indices[n++]=t.getCurrItem().p0.i;this.indices[n++]=t.getNextItem().p0.i}};t.prototype.clipEars_=function(t,e,i,r){var o,n,s,a=this.indices.length,l=t.firstItem(),h=t.getPrevItem(),u=l,c=t.nextItem(),p=t.getNextItem(),d=!1;do{o=u.p0;n=u.p1;s=c.p1;if(!1===n.reflex){var f=void 0;f=i?0===this.getPointsInTriangle_(o,n,s,e,!0).length:r?this.diagonalIsInside_(p.p1,s,n,o,h.p0):this.diagonalIsInside_(h.p0,o,n,s,p.p1);if((i||0===this.getIntersections_({p0:o,p1:s},e).length)&&f&&(i||!1===o.reflex||!1===s.reflex||Lo([h.p0.x,h.p0.y,o.x,o.y,n.x,n.y,s.x,s.y,p.p1.x,p.p1.y],0,10,2)===!r)){this.indices[a++]=o.i;this.indices[a++]=n.i;this.indices[a++]=s.i;this.removeItem_(u,c,t,e);c===l&&(l=p);d=!0}}h=t.getPrevItem();u=t.getCurrItem();c=t.nextItem();p=t.getNextItem()}while(u!==l&&3<t.getLength());return d};t.prototype.resolveSelfIntersections_=function(t,e,i){var r=t.firstItem();t.nextItem();var o=r,n=t.nextItem(),s=!1;do{var a=this.calculateIntersection_(o.p0,o.p1,n.p0,n.p1,i);if(a){var l=!1,h=this.vertices.length,u=this.indices.length,c=h/2,p=t.prevItem();t.removeItem();e.remove(p);l=p===r;var d=void 0;if(i){if(a[0]===o.p0.x&&a[1]===o.p0.y){t.prevItem();d=o.p0;n.p0=d;e.remove(o);l=l||o===r}else{d=n.p1;o.p1=d;e.remove(n);l=l||n===r}t.removeItem()}else{d=this.createPoint_(a[0],a[1],c);o.p1=d;n.p0=d;e.update([Math.min(o.p0.x,o.p1.x),Math.min(o.p0.y,o.p1.y),Math.max(o.p0.x,o.p1.x),Math.max(o.p0.y,o.p1.y)],o);e.update([Math.min(n.p0.x,n.p1.x),Math.min(n.p0.y,n.p1.y),Math.max(n.p0.x,n.p1.x),Math.max(n.p0.y,n.p1.y)],n)}this.indices[u++]=p.p0.i;this.indices[u++]=p.p1.i;this.indices[u++]=d.i;s=!0;if(l)break}o=t.getPrevItem();n=t.nextItem()}while(o!==r);return s};t.prototype.isSimple_=function(t,e){var i=t.firstItem(),r=i;do{if(this.getIntersections_(r,e).length)return!1;r=t.nextItem()}while(r!==i);return!0};t.prototype.isClockwise_=function(t){var e=2*t.getLength(),i=new Array(e),r=t.firstItem(),o=r,n=0;do{i[n++]=o.p0.x;i[n++]=o.p0.y;o=t.nextItem()}while(o!==r);return Lo(i,0,e,2)};t.prototype.splitPolygon_=function(t,e){var i=this,r=t.firstItem(),o=r;do{var n=i.getIntersections_(o,e);if(n.length){var s=n[0],a=i.vertices.length/2,l=i.calculateIntersection_(o.p0,o.p1,s.p0,s.p1),h=i.createPoint_(l[0],l[1],a),u=new Rp,c=new ih;i.insertItem_(h,o.p1,u,c);o.p1=h;e.update([Math.min(o.p0.x,h.x),Math.min(o.p0.y,h.y),Math.max(o.p0.x,h.x),Math.max(o.p0.y,h.y)],o);for(var p=t.nextItem();p!==s;){i.insertItem_(p.p0,p.p1,u,c);e.remove(p);t.removeItem();p=t.getCurrItem()}i.insertItem_(s.p0,h,u,c);s.p0=h;e.update([Math.min(s.p1.x,h.x),Math.min(s.p1.y,h.y),Math.max(s.p1.x,h.x),Math.max(s.p1.y,h.y)],s);i.classifyPoints_(t,e,!1);i.triangulate_(t,e);i.classifyPoints_(u,c,!1);i.triangulate_(u,c);break}o=t.nextItem()}while(o!==r)};t.prototype.createPoint_=function(t,e,i){var r=this.vertices.length;return{x:this.vertices[r++]=t,y:this.vertices[r++]=e,i:i,reflex:void 0}};t.prototype.insertItem_=function(t,e,i,r){var o={p0:t,p1:e};i.insertItem(o);r&&r.insert([Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.x,e.x),Math.max(t.y,e.y)],o);return o};t.prototype.removeItem_=function(t,e,i,r){if(i.getCurrItem()===e){i.removeItem();t.p1=e.p1;r.remove(e);r.update([Math.min(t.p0.x,t.p1.x),Math.min(t.p0.y,t.p1.y),Math.max(t.p0.x,t.p1.x),Math.max(t.p0.y,t.p1.y)],t)}};t.prototype.getPointsInTriangle_=function(t,e,i,r,o){for(var n=[],s=r.getInExtent([Math.min(t.x,e.x,i.x),Math.min(t.y,e.y,i.y),Math.max(t.x,e.x,i.x),Math.max(t.y,e.y,i.y)]),a=0,l=s.length;a<l;++a)for(var h in s[a]){var u=s[a][h];"object"!=typeof u||o&&!u.reflex||u.x===t.x&&u.y===t.y||u.x===e.x&&u.y===e.y||u.x===i.x&&u.y===i.y||-1!==n.indexOf(u)||!go([t.x,t.y,e.x,e.y,i.x,i.y],0,6,2,u.x,u.y)||n.push(u)}return n};t.prototype.getIntersections_=function(t,e,i){for(var r=t.p0,o=t.p1,n=e.getInExtent([Math.min(r.x,o.x),Math.min(r.y,o.y),Math.max(r.x,o.x),Math.max(r.y,o.y)]),s=[],a=0,l=n.length;a<l;++a){var h=n[a];t!==h&&(i||h.p0!==o||h.p1!==r)&&this.calculateIntersection_(r,o,h.p0,h.p1,i)&&s.push(h)}return s};t.prototype.calculateIntersection_=function(t,e,i,r,o){var n=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);if(0!==n){var s=((r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x))/n,a=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/n;if(!o&&Kc<s&&s<1-Kc&&Kc<a&&a<1-Kc||o&&0<=s&&s<=1&&0<=a&&a<=1)return[t.x+s*(e.x-t.x),t.y+s*(e.y-t.y)]}};t.prototype.diagonalIsInside_=function(t,e,i,r,o){if(void 0===e.reflex||void 0===r.reflex)return!1;var n=(i.x-r.x)*(e.y-r.y)>(i.y-r.y)*(e.x-r.x),s=(o.x-r.x)*(e.y-r.y)<(o.y-r.y)*(e.x-r.x),a=(t.x-e.x)*(r.y-e.y)>(t.y-e.y)*(r.x-e.x),l=(i.x-e.x)*(r.y-e.y)<(i.y-e.y)*(r.x-e.x),h=r.reflex?s||n:s&&n,u=e.reflex?l||a:l&&a;return h&&u};t.prototype.drawMultiPolygon=function(t,e){var i,r,o,n,s=t.getEndss(),a=t.getStride(),l=this.indices.length,h=this.lineStringReplay.getCurrentIndex(),u=t.getFlatCoordinates(),c=0;for(i=0,r=s.length;i<r;++i){var p=s[i];if(0<p.length){var d=wt(u,c,p[0],a,-this.origin[0],-this.origin[1]);if(d.length){var f=[],_=void 0;for(o=1,n=p.length;o<n;++o)if(p[o]!==p[o-1]){_=wt(u,p[o-1],p[o],a,-this.origin[0],-this.origin[1]);f.push(_)}this.lineStringReplay.drawPolygonCoordinates(d,f,a);this.drawCoordinates_(d,f,a)}}c=p[p.length-1]}if(this.indices.length>l){this.startIndices.push(l);this.startIndicesFeature.push(e);if(this.state_.changed){this.styleIndices_.push(l);this.state_.changed=!1}}this.lineStringReplay.getCurrentIndex()>h&&this.lineStringReplay.setPolygonStyle(e,h)};t.prototype.drawPolygon=function(t,e){var i=t.getEnds(),r=t.getStride();if(0<i.length){var o=t.getFlatCoordinates().map(Number),n=wt(o,0,i[0],r,-this.origin[0],-this.origin[1]);if(n.length){var s,a,l,h=[];for(s=1,a=i.length;s<a;++s)if(i[s]!==i[s-1]){l=wt(o,i[s-1],i[s],r,-this.origin[0],-this.origin[1]);h.push(l)}this.startIndices.push(this.indices.length);this.startIndicesFeature.push(e);if(this.state_.changed){this.styleIndices_.push(this.indices.length);this.state_.changed=!1}this.lineStringReplay.setPolygonStyle(e);this.lineStringReplay.drawPolygonCoordinates(n,h,r);this.drawCoordinates_(n,h,r)}}};t.prototype.finish=function(t){this.verticesBuffer=new Jc(this.vertices);this.indicesBuffer=new Jc(this.indices);this.startIndices.push(this.indices.length);this.lineStringReplay.finish(t);0===this.styleIndices_.length&&0<this.styles_.length&&(this.styles_=[]);this.vertices=null;this.indices=null};t.prototype.getDeleteResourcesFunction=function(t){var e=this.verticesBuffer,i=this.indicesBuffer,r=this.lineStringReplay.getDeleteResourcesFunction(t);return function(){t.deleteBuffer(e);t.deleteBuffer(i);r()}};t.prototype.setUpProgram=function(t,e,i,r){var o,n=e.getProgram(Tp,Sp);if(this.defaultLocations_)o=this.defaultLocations_;else{o=new Cp(t,n);this.defaultLocations_=o}e.useProgram(n);t.enableVertexAttribArray(o.a_position);t.vertexAttribPointer(o.a_position,2,hi,!1,8,0);return o};t.prototype.shutDownProgram=function(t,e){t.disableVertexAttribArray(e.a_position)};t.prototype.drawReplay=function(t,e,i,r){var o=t.getParameter(t.DEPTH_FUNC),n=t.getParameter(t.DEPTH_WRITEMASK);if(!r){t.enable(t.DEPTH_TEST);t.depthMask(!0);t.depthFunc(t.NOTEQUAL)}if(Ct(i)){var s,a,l,h;l=this.startIndices[this.startIndices.length-1];for(s=this.styleIndices_.length-1;0<=s;--s){a=this.styleIndices_[s];h=this.styles_[s];this.setFillStyle_(t,h);this.drawElements(t,e,a,l);l=a}}else this.drawReplaySkipping_(t,e,i);if(!r){t.disable(t.DEPTH_TEST);t.clear(t.DEPTH_BUFFER_BIT);t.depthMask(n);t.depthFunc(o)}};t.prototype.drawHitDetectionReplayOneByOne=function(t,e,i,r,o){var n,s,a,l,h,u,c;c=this.startIndices.length-2;a=this.startIndices[c+1];for(n=this.styleIndices_.length-1;0<=n;--n){l=this.styles_[n];this.setFillStyle_(t,l);h=this.styleIndices_[n];for(;0<=c&&this.startIndices[c]>=h;){s=this.startIndices[c];if(void 0===i[St(u=this.startIndicesFeature[c]).toString()]&&u.getGeometry()&&(void 0===o||Rt(o,u.getGeometry().getExtent()))){t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);this.drawElements(t,e,s,a);var p=r(u);if(p)return p}c--;a=s}}};t.prototype.drawReplaySkipping_=function(t,e,i){var r,o,n,s,a,l,h;l=this.startIndices.length-2;n=o=this.startIndices[l+1];for(r=this.styleIndices_.length-1;0<=r;--r){s=this.styles_[r];this.setFillStyle_(t,s);a=this.styleIndices_[r];for(;0<=l&&this.startIndices[l]>=a;){h=this.startIndices[l];if(i[St(this.startIndicesFeature[l]).toString()]){if(o!==n){this.drawElements(t,e,o,n);t.clear(t.DEPTH_BUFFER_BIT)}n=h}l--;o=h}if(o!==n){this.drawElements(t,e,o,n);t.clear(t.DEPTH_BUFFER_BIT)}o=n=a}};t.prototype.setFillStyle_=function(t,e){t.uniform4fv(this.defaultLocations_.u_color,e)};t.prototype.setFillStrokeStyle=function(t,e){var i=t?t.getColor():[0,0,0,0];i=i instanceof CanvasGradient||i instanceof CanvasPattern?Vc:Je(i).map(function(t,e){return 3!=e?t/255:t})||Vc;if(!this.state_.fillColor||!Ar(i,this.state_.fillColor)){this.state_.fillColor=i;this.state_.changed=!0;this.styles_.push(i)}if(e)this.lineStringReplay.setFillStrokeStyle(null,e);else{var r=new gr({color:[0,0,0,0],lineWidth:0});this.lineStringReplay.setFillStrokeStyle(null,r)}};return t}(Yc),wp=function(t,e){this.space_=e;this.emptyBlocks_=[{x:0,y:0,width:t,height:t}];this.entries_={};this.context_=ii(t,t);this.canvas_=this.context_.canvas};wp.prototype.get=function(t){return this.entries_[t]||null};wp.prototype.add=function(t,e,i,r,o){for(var n=this,s=0,a=this.emptyBlocks_.length;s<a;++s){var l=n.emptyBlocks_[s];if(l.width>=e+n.space_&&l.height>=i+n.space_){var h={offsetX:l.x+n.space_,offsetY:l.y+n.space_,image:n.canvas_};n.entries_[t]=h;r.call(o,n.context_,l.x+n.space_,l.y+n.space_);n.split_(s,l,e+n.space_,i+n.space_);return h}}return null};wp.prototype.split_=function(t,e,i,r){var o,n,s=e.width-i;if(e.height-r<s){o={x:e.x+i,y:e.y,width:e.width-i,height:e.height};n={x:e.x,y:e.y+r,width:i,height:e.height-r};this.updateBlocks_(t,o,n)}else{o={x:e.x+i,y:e.y,width:e.width-i,height:r};n={x:e.x,y:e.y+r,width:e.width,height:e.height-r};this.updateBlocks_(t,o,n)}};wp.prototype.updateBlocks_=function(t,e,i){var r=[t,1];0<e.width&&0<e.height&&r.push(e);0<i.width&&0<i.height&&r.push(i);this.emptyBlocks_.splice.apply(this.emptyBlocks_,r)};var Lp=function(t){var e=t||{};this.currentSize_=void 0!==e.initialSize?e.initialSize:256;this.maxSize_=void 0!==e.maxSize?e.maxSize:void 0!==mi?mi:2048;this.space_=void 0!==e.space?e.space:1;this.atlases_=[new wp(this.currentSize_,this.space_)];this.currentHitSize_=this.currentSize_;this.hitAtlases_=[new wp(this.currentHitSize_,this.space_)]};Lp.prototype.getInfo=function(t){var e=this.getInfo_(this.atlases_,t);if(!e)return null;var i=this.getInfo_(this.hitAtlases_,t);return this.mergeInfos_(e,i)};Lp.prototype.getInfo_=function(t,e){for(var i=0,r=t.length;i<r;++i){var o=t[i].get(e);if(o)return o}return null};Lp.prototype.mergeInfos_=function(t,e){return{offsetX:t.offsetX,offsetY:t.offsetY,image:t.image,hitImage:e.image}};Lp.prototype.add=function(t,e,i,r,o,n){if(e+this.space_>this.maxSize_||i+this.space_>this.maxSize_)return null;var s=this.add_(!1,t,e,i,r,n);if(!s)return null;var a=void 0!==o?o:L,l=this.add_(!0,t,e,i,a,n);return this.mergeInfos_(s,l)};Lp.prototype.add_=function(t,e,i,r,o,n){var s,a,l,h,u=t?this.hitAtlases_:this.atlases_;for(l=0,h=u.length;l<h;++l){if(a=(s=u[l]).add(e,i,r,o,n))return a;if(!a&&l===h-1){var c=void 0;if(t){c=Math.min(2*this.currentHitSize_,this.maxSize_);this.currentHitSize_=c}else{c=Math.min(2*this.currentSize_,this.maxSize_);this.currentSize_=c}s=new wp(c,this.space_);u.push(s);++h}}return null};var Op=function(i){function t(t,e){i.call(this,t,e);this.images_=[];this.textures_=[];this.measureCanvas_=ii(0,0).canvas;this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0};this.text_="";this.textAlign_=void 0;this.textBaseline_=void 0;this.offsetX_=void 0;this.offsetY_=void 0;this.atlases_={};this.currAtlas_=void 0;this.scale=1;this.opacity=1}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.drawText=function(t,e){var i=this;if(this.text_){var r=null,o=2,n=2;switch(t.getType()){case kt.POINT:case kt.MULTI_POINT:o=(r=t.getFlatCoordinates()).length;n=t.getStride();break;case kt.CIRCLE:r=t.getCenter();break;case kt.LINE_STRING:r=t.getFlatMidpoint();break;case kt.MULTI_LINE_STRING:o=(r=t.getFlatMidpoints()).length;break;case kt.POLYGON:r=t.getFlatInteriorPoint();break;case kt.MULTI_POLYGON:o=(r=t.getFlatInteriorPoints()).length}this.startIndices.push(this.indices.length);this.startIndicesFeature.push(e);var s,a,l,h,u,c,p,d,f=this.currAtlas_,_=this.text_.split("\n"),g=this.getTextSize_(_),y=Math.round(g[0]*this.textAlign_-this.offsetX_),v=Math.round(g[1]*this.textBaseline_-this.offsetY_),m=this.state_.lineWidth/2*this.state_.scale;for(s=0,a=_.length;s<a;++s){u=0;c=f.height*s;for(l=0,h=(p=_[s].split("")).length;l<h;++l){if(d=f.atlas.getInfo(p[l])){var E=d.image;i.anchorX=y-u;i.anchorY=v-c;i.originX=0===l?d.offsetX-m:d.offsetX;i.originY=d.offsetY;i.height=f.height;i.width=0===l||l===p.length-1?f.width[p[l]]+m:f.width[p[l]];i.imageHeight=E.height;i.imageWidth=E.width;if(0===i.images_.length)i.images_.push(E);else{if(St(i.images_[i.images_.length-1])!=St(E)){i.groupIndices.push(i.indices.length);i.images_.push(E)}}i.drawText_(r,0,o,n)}u+=i.width}}}};t.prototype.getTextSize_=function(t){var n=this,s=this.currAtlas_,e=t.length*s.height;return[t.map(function(t){for(var e=0,i=0,r=t.length;i<r;++i){var o=t[i];s.width[o]||n.addCharToAtlas_(o);e+=s.width[o]?s.width[o]:0}return e}).reduce(function(t,e){return Math.max(t,e)}),e]};t.prototype.drawText_=function(t,e,i,r){for(var o=e,n=i;o<n;o+=r)this.drawCoordinates(t,e,i,r)};t.prototype.addCharToAtlas_=function(r){if(1===r.length){var t=this.currAtlas_,o=this.state_,e=this.measureCanvas_.getContext("2d");e.font=o.font;var i=Math.ceil(e.measureText(r).width*o.scale);t.atlas.add(r,i,t.height,function(t,e,i){t.font=o.font;t.fillStyle=o.fillColor;t.strokeStyle=o.strokeColor;t.lineWidth=o.lineWidth;t.lineCap=o.lineCap;t.lineJoin=o.lineJoin;t.miterLimit=o.miterLimit;t.textAlign="left";t.textBaseline="top";if(Pi&&o.lineDash){t.setLineDash(o.lineDash);t.lineDashOffset=o.lineDashOffset}1!==o.scale&&t.setTransform(o.scale,0,0,o.scale,0,0);o.strokeColor&&t.strokeText(r,e,i);o.fillColor&&t.fillText(r,e,i)})&&(t.width[r]=i)}};t.prototype.finish=function(t){var e=t.getGL();this.groupIndices.push(this.indices.length);this.hitDetectionGroupIndices=this.groupIndices;this.verticesBuffer=new Jc(this.vertices);this.indicesBuffer=new Jc(this.indices);this.createTextures(this.textures_,this.images_,{},e);this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0};this.text_="";this.textAlign_=void 0;this.textBaseline_=void 0;this.offsetX_=void 0;this.offsetY_=void 0;this.images_=null;this.atlases_={};this.currAtlas_=void 0;i.prototype.finish.call(this,t)};t.prototype.setTextStyle=function(t){var e=this.state_,i=t.getFill(),r=t.getStroke();if(t&&t.getText()&&(i||r)){if(i){var o=i.getColor();e.fillColor=ti(o||Vc)}else e.fillColor=null;if(r){var n=r.getColor();e.strokeColor=ti(n||Hc);e.lineWidth=r.getWidth()||1;e.lineCap=r.getLineCap()||Xc;e.lineDashOffset=r.getLineDashOffset()||0;e.lineJoin=r.getLineJoin()||Wc;e.miterLimit=r.getMiterLimit()||10;var s=r.getLineDash();e.lineDash=s?s.slice():zc}else{e.strokeColor=null;e.lineWidth=0}e.font=t.getFont()||Bc;e.scale=t.getScale()||1;this.text_=t.getText();var a=Tu[t.getTextAlign()],l=Tu[t.getTextBaseline()];this.textAlign_=void 0===a?.5:a;this.textBaseline_=void 0===l?.5:l;this.offsetX_=t.getOffsetX()||0;this.offsetY_=t.getOffsetY()||0;this.rotateWithView=!!t.getRotateWithView();this.rotation=t.getRotation()||0;this.currAtlas_=this.getAtlas_(e)}else this.text_=""};t.prototype.getAtlas_=function(t){var e=[];for(var i in t)(t[i]||0===t[i])&&(Array.isArray(t[i])?e=e.concat(t[i]):e.push(t[i]));var r=this.calculateHash_(e);if(!this.atlases_[r]){var o=this.measureCanvas_.getContext("2d");o.font=t.font;var n=Math.ceil((1.5*o.measureText("M").width+t.lineWidth/2)*t.scale);this.atlases_[r]={atlas:new Lp({space:t.lineWidth+1}),width:{},height:n}}return this.atlases_[r]};t.prototype.calculateHash_=function(t){for(var e="",i=0,r=t.length;i<r;++i)e+=t[i];return e};t.prototype.getTextures=function(t){return this.textures_};t.prototype.getHitDetectionTextures=function(){return this.textures_};return t}(ap),Pp=[1,1],bp={Circle:Qc,Image:lp,LineString:xp,Polygon:Ip,Text:Op},Mp=function(r){function t(t,e,i){r.call(this);this.maxExtent_=e;this.tolerance_=t;this.renderBuffer_=i;this.replaysByZIndex_={}}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.addDeclutter=function(t,e){};t.prototype.getDeleteResourcesFunction=function(t){var e,o=[];for(e in this.replaysByZIndex_){var i=this.replaysByZIndex_[e];for(var r in i)o.push(i[r].getDeleteResourcesFunction(t))}return function(){for(var t,e=arguments,i=o.length,r=0;r<i;r++)t=o[r].apply(this,e);return t}};t.prototype.finish=function(t){var e;for(e in this.replaysByZIndex_){var i=this.replaysByZIndex_[e];for(var r in i)i[r].finish(t)}};t.prototype.getReplay=function(t,e){var i=void 0!==t?t.toString():"0",r=this.replaysByZIndex_[i];if(void 0===r){r={};this.replaysByZIndex_[i]=r}var o=r[e];if(void 0===o){o=new bp[e](this.tolerance_,this.maxExtent_);r[e]=o}return o};t.prototype.isEmpty=function(){return Ct(this.replaysByZIndex_)};t.prototype.replay=function(t,e,i,r,o,n,s,a){var l,h,u,c,p,d,f=Object.keys(this.replaysByZIndex_).map(Number);f.sort(wr);for(l=0,h=f.length;l<h;++l){p=this.replaysByZIndex_[f[l].toString()];for(u=0,c=xu.length;u<c;++u){d=p[xu[u]];void 0!==d&&d.replay(t,e,i,r,o,n,s,a,void 0,!1)}}};t.prototype.replayHitDetection_=function(t,e,i,r,o,n,s,a,l,h,u){var c,p,d,f,_,g,y=Object.keys(this.replaysByZIndex_).map(Number);y.sort(function(t,e){return e-t});for(c=0,p=y.length;c<p;++c){f=this.replaysByZIndex_[y[c].toString()];for(d=xu.length-1;0<=d;--d)if(void 0!==(_=f[xu[d]])&&(g=_.replay(t,e,i,r,o,n,s,a,l,h,u)))return g}};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,o,n,s,a,l,h){var u,c=e.getGL();c.bindFramebuffer(c.FRAMEBUFFER,e.getHitDetectionFramebuffer());void 0!==this.renderBuffer_&&(u=k(H(t),r*this.renderBuffer_));return this.replayHitDetection_(e,t,r,o,Pp,s,a,l,function(t){var e=new Uint8Array(4);c.readPixels(0,0,1,1,c.RGBA,c.UNSIGNED_BYTE,e);if(0<e[3]){var i=h(t);if(i)return i}},!0,u)};t.prototype.hasFeatureAtCoordinate=function(t,e,i,r,o,n,s,a,l){var h=e.getGL();h.bindFramebuffer(h.FRAMEBUFFER,e.getHitDetectionFramebuffer());return void 0!==this.replayHitDetection_(e,t,r,o,Pp,s,a,l,function(t){var e=new Uint8Array(4);h.readPixels(0,0,1,1,h.RGBA,h.UNSIGNED_BYTE,e);return 0<e[3]},!1)};return t}(du),Fp=function(a){function t(t,e,i,r,o,n,s){a.call(this);this.context_=t;this.center_=e;this.extent_=n;this.pixelRatio_=s;this.size_=o;this.rotation_=r;this.resolution_=i;this.imageStyle_=null;this.fillStyle_=null;this.strokeStyle_=null;this.textStyle_=null}a&&(t.__proto__=a);((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.drawText_=function(t,e){var i=this.context_,r=t.getReplay(0,fu.TEXT);r.setTextStyle(this.textStyle_);r.drawText(e,null);r.finish(i);r.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);r.getDeleteResourcesFunction(i)()};t.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke());this.setImageStyle(t.getImage());this.setTextStyle(t.getText())};t.prototype.drawGeometry=function(t){switch(t.getType()){case kt.POINT:this.drawPoint(t,null);break;case kt.LINE_STRING:this.drawLineString(t,null);break;case kt.POLYGON:this.drawPolygon(t,null);break;case kt.MULTI_POINT:this.drawMultiPoint(t,null);break;case kt.MULTI_LINE_STRING:this.drawMultiLineString(t,null);break;case kt.MULTI_POLYGON:this.drawMultiPolygon(t,null);break;case kt.GEOMETRY_COLLECTION:this.drawGeometryCollection(t,null);break;case kt.CIRCLE:this.drawCircle(t,null)}};t.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);if(i&&Rt(this.extent_,i.getExtent())){this.setStyle(e);this.drawGeometry(i)}};t.prototype.drawGeometryCollection=function(t,e){var i,r,o=t.getGeometriesArray();for(i=0,r=o.length;i<r;++i)this.drawGeometry(o[i])};t.prototype.drawPoint=function(t,e){var i=this.context_,r=new Mp(1,this.extent_),o=r.getReplay(0,fu.IMAGE);o.setImageStyle(this.imageStyle_);o.drawPoint(t,e);o.finish(i);o.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);o.getDeleteResourcesFunction(i)();this.textStyle_&&this.drawText_(r,t)};t.prototype.drawMultiPoint=function(t,e){var i=this.context_,r=new Mp(1,this.extent_),o=r.getReplay(0,fu.IMAGE);o.setImageStyle(this.imageStyle_);o.drawMultiPoint(t,e);o.finish(i);o.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);o.getDeleteResourcesFunction(i)();this.textStyle_&&this.drawText_(r,t)};t.prototype.drawLineString=function(t,e){var i=this.context_,r=new Mp(1,this.extent_),o=r.getReplay(0,fu.LINE_STRING);o.setFillStrokeStyle(null,this.strokeStyle_);o.drawLineString(t,e);o.finish(i);o.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);o.getDeleteResourcesFunction(i)();this.textStyle_&&this.drawText_(r,t)};t.prototype.drawMultiLineString=function(t,e){var i=this.context_,r=new Mp(1,this.extent_),o=r.getReplay(0,fu.LINE_STRING);o.setFillStrokeStyle(null,this.strokeStyle_);o.drawMultiLineString(t,e);o.finish(i);o.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);o.getDeleteResourcesFunction(i)();this.textStyle_&&this.drawText_(r,t)};t.prototype.drawPolygon=function(t,e){var i=this.context_,r=new Mp(1,this.extent_),o=r.getReplay(0,fu.POLYGON);o.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_);o.drawPolygon(t,e);o.finish(i);o.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);o.getDeleteResourcesFunction(i)();this.textStyle_&&this.drawText_(r,t)};t.prototype.drawMultiPolygon=function(t,e){var i=this.context_,r=new Mp(1,this.extent_),o=r.getReplay(0,fu.POLYGON);o.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_);o.drawMultiPolygon(t,e);o.finish(i);o.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);o.getDeleteResourcesFunction(i)();this.textStyle_&&this.drawText_(r,t)};t.prototype.drawCircle=function(t,e){var i=this.context_,r=new Mp(1,this.extent_),o=r.getReplay(0,fu.CIRCLE);o.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_);o.drawCircle(t,e);o.finish(i);o.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);o.getDeleteResourcesFunction(i)();this.textStyle_&&this.drawText_(r,t)};t.prototype.setImageStyle=function(t){this.imageStyle_=t};t.prototype.setFillStrokeStyle=function(t,e){this.fillStyle_=t;this.strokeStyle_=e};t.prototype.setTextStyle=function(t){this.textStyle_=t};return t}(qh),Ap=new Ac("precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform float u_opacity;\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_texture, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  gl_FragColor.a = texColor.a * u_opacity;\n}\n"),Np=new Nc("varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat4 u_texCoordMatrix;\nuniform mat4 u_projectionMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\n}\n\n\n"),Dp=function(t,e){this.u_texCoordMatrix=t.getUniformLocation(e,"u_texCoordMatrix");this.u_projectionMatrix=t.getUniformLocation(e,"u_projectionMatrix");this.u_opacity=t.getUniformLocation(e,"u_opacity");this.u_texture=t.getUniformLocation(e,"u_texture");this.a_position=t.getAttribLocation(e,"a_position");this.a_texCoord=t.getAttribLocation(e,"a_texCoord")},Gp=function(i){function t(t,e){i.call(this,e);this.mapRenderer=t;this.arrayBuffer_=new Jc([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);this.texture=null;this.framebuffer=null;this.framebufferDimension=void 0;this.texCoordMatrix=[1,0,0,1,0,0];this.projectionMatrix=[1,0,0,1,0,0];this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];this.defaultLocations_=null}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.bindFramebuffer=function(t,e){var i=this.mapRenderer.getGL();if(void 0===this.framebufferDimension||this.framebufferDimension!=e){var r=function(t,e,i){if(!t.isContextLost()){t.deleteFramebuffer(e);t.deleteTexture(i)}}.bind(null,i,this.framebuffer,this.texture);t.postRenderFunctions.push(r);var o=np(i,e,e),n=i.createFramebuffer();i.bindFramebuffer(gi,n);i.framebufferTexture2D(gi,36064,fi,o,0);this.texture=o;this.framebuffer=n;this.framebufferDimension=e}else i.bindFramebuffer(gi,this.framebuffer)};t.prototype.composeFrame=function(t,e,i){this.dispatchComposeEvent_(ln.PRECOMPOSE,i,t);i.bindBuffer(li,this.arrayBuffer_);var r,o=i.getGL(),n=i.getProgram(Ap,Np);if(this.defaultLocations_)r=this.defaultLocations_;else{r=new Dp(o,n);this.defaultLocations_=r}if(i.useProgram(n)){o.enableVertexAttribArray(r.a_position);o.vertexAttribPointer(r.a_position,2,hi,!1,16,0);o.enableVertexAttribArray(r.a_texCoord);o.vertexAttribPointer(r.a_texCoord,2,hi,!1,16,8);o.uniform1i(r.u_texture,0)}o.uniformMatrix4fv(r.u_texCoordMatrix,!1,Uc(this.tmpMat4_,this.getTexCoordMatrix()));o.uniformMatrix4fv(r.u_projectionMatrix,!1,Uc(this.tmpMat4_,this.getProjectionMatrix()));o.uniform1f(r.u_opacity,e.opacity);o.bindTexture(fi,this.getTexture());o.drawArrays(5,0,4);this.dispatchComposeEvent_(ln.POSTCOMPOSE,i,t)};t.prototype.dispatchComposeEvent_=function(t,e,i){var r=this.getLayer();if(r.hasListener(t)){var o=i.viewState,n=o.resolution,s=i.pixelRatio,a=i.extent,l=o.center,h=o.rotation,u=i.size,c=new Fp(e,l,n,h,u,a,s),p=new Zh(t,c,i,null,e);r.dispatchEvent(p)}};t.prototype.getTexCoordMatrix=function(){return this.texCoordMatrix};t.prototype.getTexture=function(){return this.texture};t.prototype.getProjectionMatrix=function(){return this.projectionMatrix};t.prototype.handleWebGLContextLost=function(){this.texture=null;this.framebuffer=null;this.framebufferDimension=void 0};t.prototype.prepareFrame=function(t,e,i){};t.prototype.forEachLayerAtPixel=function(t,e,i,r){};return t}(su),kp=function(i){function t(t,e){i.call(this,t,e);this.image_=null;this.hitCanvasContext_=null;this.hitTransformationMatrix_=null}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.createTexture_=function(t){var e=t.getImage();return sp(this.mapRenderer.getGL(),e,_i,_i)};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,o){var n=this.getLayer(),s=n.getSource(),a=e.viewState.resolution,l=e.viewState.rotation,h=e.skippedFeatureUids;return s.forEachFeatureAtCoordinate(t,a,l,i,h,function(t){return r.call(o,t,n)})};t.prototype.prepareFrame=function(t,e,i){var r=this.mapRenderer.getGL(),o=t.pixelRatio,n=t.viewState,s=n.center,a=n.resolution,l=n.rotation,h=this.image_,u=this.texture,c=this.getLayer().getSource(),p=t.viewHints,d=t.extent;void 0!==e.extent&&(d=pt(d,e.extent));if(!p[bs.ANIMATING]&&!p[bs.INTERACTING]&&!gt(d)){var f=n.projection,_=c.getImage(d,a,o,f);if(_){if(this.loadImage(_)){h=_;u=this.createTexture_(_);if(this.texture){var g=function(t,e){t.isContextLost()||t.deleteTexture(e)}.bind(null,r,this.texture);t.postRenderFunctions.push(g)}}}}if(h){var y=this.mapRenderer.getContext().getCanvas();this.updateProjectionMatrix_(y.width,y.height,o,s,a,l,h.getExtent());this.hitTransformationMatrix_=null;var v=this.texCoordMatrix;Me(v);ke(v,1,-1);je(v,0,-1);this.image_=h;this.texture=u}return!!h};t.prototype.updateProjectionMatrix_=function(t,e,i,r,o,n,s){var a=t*o,l=e*o,h=this.projectionMatrix;Me(h);ke(h,2*i/a,2*i/l);Ge(h,-n);je(h,s[0]-r[0],s[1]-r[1]);ke(h,(s[2]-s[0])/2,(s[3]-s[1])/2);je(h,1,1)};t.prototype.hasFeatureAtCoordinate=function(t,e){return void 0!==this.forEachFeatureAtCoordinate(t,e,0,y,this)};t.prototype.forEachLayerAtPixel=function(t,e,i,r){if(this.image_&&this.image_.getImage()){if(this.getLayer().getSource().forEachFeatureAtCoordinate!==L){var o=De(e.pixelToCoordinateTransform,t.slice());return this.forEachFeatureAtCoordinate(o,e,0,y,this)?i.call(r,this.getLayer(),null):void 0}var n=[this.image_.getImage().width,this.image_.getImage().height];this.hitTransformationMatrix_||(this.hitTransformationMatrix_=this.getHitTransformationMatrix_(e.size,n));var s=De(this.hitTransformationMatrix_,t.slice());if(!(s[0]<0||s[0]>n[0]||s[1]<0||s[1]>n[1])){this.hitCanvasContext_||(this.hitCanvasContext_=ii(1,1));this.hitCanvasContext_.clearRect(0,0,1,1);this.hitCanvasContext_.drawImage(this.image_.getImage(),s[0],s[1],1,1,0,0,1,1);var a=this.hitCanvasContext_.getImageData(0,0,1,1).data;return 0<a[3]?i.call(r,this.getLayer(),a):void 0}}};t.prototype.getHitTransformationMatrix_=function(t,e){var i=[1,0,0,1,0,0];je(i,-1,-1);ke(i,2/t[0],2/t[1]);je(i,0,t[1]);ke(i,1,-1);var r=Ye(this.projectionMatrix.slice()),o=[1,0,0,1,0,0];je(o,0,e[1]);ke(o,1,-1);ke(o,e[0]/2,e[1]/2);je(o,1,1);Fe(o,r);Fe(o,i);return o};return t}(Gp);kp.handles=function(t){return t.getType()===In.IMAGE};kp.create=function(t,e){return new kp(t,e)};var jp=function(i){function t(t){i.call(this,t);var e=t.getViewport();this.canvas_=document.createElement("canvas");this.canvas_.style.width="100%";this.canvas_.style.height="100%";this.canvas_.style.display="block";this.canvas_.className=ki;e.insertBefore(this.canvas_,e.childNodes[0]||null);this.clipTileCanvasWidth_=0;this.clipTileCanvasHeight_=0;this.clipTileContext_=ii();this.renderedVisible_=!0;this.gl_=vi(this.canvas_,{antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0});this.context_=new rp(this.canvas_,this.gl_);S(this.canvas_,ip.LOST,this.handleWebGLContextLost,this);S(this.canvas_,ip.RESTORED,this.handleWebGLContextRestored,this);this.textureCache_=new Vi;this.focus_=null;this.tileTextureQueue_=new ms(function(t){var e=t[1],i=t[2],r=e[0]-this.focus_[0],o=e[1]-this.focus_[1];return 65536*Math.log(i)+Math.sqrt(r*r+o*o)/i}.bind(this),function(t){return t[0].getKey()});this.loadNextTileTexture_=function(t,e){if(!this.tileTextureQueue_.isEmpty()){this.tileTextureQueue_.reprioritize();var i=this.tileTextureQueue_.dequeue(),r=i[0],o=i[3],n=i[4];this.bindTileTexture(r,o,n,ci,ci)}return!1}.bind(this);this.textureCacheFrameMarkerCount_=0;this.initializeGL_()}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.bindTileTexture=function(t,e,i,r,o){var n=this.getGL(),s=t.getKey();if(this.textureCache_.containsKey(s)){var a=this.textureCache_.get(s);n.bindTexture(fi,a.texture);if(a.magFilter!=r){n.texParameteri(fi,10240,r);a.magFilter=r}if(a.minFilter!=o){n.texParameteri(fi,10241,o);a.minFilter=o}}else{var l=n.createTexture();n.bindTexture(fi,l);if(0<i){var h=this.clipTileContext_.canvas,u=this.clipTileContext_;if(this.clipTileCanvasWidth_!==e[0]||this.clipTileCanvasHeight_!==e[1]){h.width=e[0];h.height=e[1];this.clipTileCanvasWidth_=e[0];this.clipTileCanvasHeight_=e[1]}else u.clearRect(0,0,e[0],e[1]);u.drawImage(t.getImage(),i,i,e[0],e[1],0,0,e[0],e[1]);n.texImage2D(fi,0,ui,ui,5121,h)}else n.texImage2D(fi,0,ui,ui,5121,t.getImage());n.texParameteri(fi,10240,r);n.texParameteri(fi,10241,o);n.texParameteri(fi,pi,_i);n.texParameteri(fi,di,_i);this.textureCache_.set(s,{texture:l,magFilter:r,minFilter:o})}};t.prototype.dispatchRenderEvent=function(t,e){var i=this.getMap();if(i.hasListener(t)){var r=this.context_,o=e.extent,n=e.size,s=e.viewState,a=e.pixelRatio,l=s.resolution,h=s.center,u=s.rotation,c=new Fp(r,h,l,u,n,o,a),p=new Zh(t,c,e,null,r);i.dispatchEvent(p)}};t.prototype.disposeInternal=function(){var e=this.getGL();e.isContextLost()||this.textureCache_.forEach(function(t){t&&e.deleteTexture(t.texture)});this.context_.dispose();i.prototype.disposeInternal.call(this)};t.prototype.expireCache_=function(t,e){for(var i,r=this.getGL();1024<this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_;){if(i=this.textureCache_.peekLast())r.deleteTexture(i.texture);else{if(+this.textureCache_.peekLastKey()==e.index)break;--this.textureCacheFrameMarkerCount_}this.textureCache_.pop()}};t.prototype.getContext=function(){return this.context_};t.prototype.getGL=function(){return this.gl_};t.prototype.getTileTextureQueue=function(){return this.tileTextureQueue_};t.prototype.handleWebGLContextLost=function(t){t.preventDefault();this.textureCache_.clear();this.textureCacheFrameMarkerCount_=0;var e=this.getLayerRenderers();for(var i in e){e[i].handleWebGLContextLost()}};t.prototype.handleWebGLContextRestored=function(){this.initializeGL_();this.getMap().render()};t.prototype.initializeGL_=function(){var t=this.gl_;t.activeTexture(33984);t.blendFuncSeparate(770,771,1,771);t.disable(2884);t.disable(2929);t.disable(3089);t.disable(2960)};t.prototype.isTileTextureLoaded=function(t){return this.textureCache_.containsKey(t.getKey())};t.prototype.renderFrame=function(t){var e=this.getContext(),i=this.getGL();if(i.isContextLost())return!1;if(!t){if(this.renderedVisible_){this.canvas_.style.display="none";this.renderedVisible_=!1}return!1}this.focus_=t.focus;this.textureCache_.set((-t.index).toString(),null);++this.textureCacheFrameMarkerCount_;this.dispatchRenderEvent(ln.PRECOMPOSE,t);var r=[],o=t.layerStatesArray;Nr(o,ru);var n,s,a,l=t.viewState.resolution;for(n=0,s=o.length;n<s;++n)Js(a=o[n],l)&&a.sourceState==Ys.READY&&this.getLayerRenderer(a.layer).prepareFrame(t,a,e)&&r.push(a);var h=t.size[0]*t.pixelRatio,u=t.size[1]*t.pixelRatio;if(this.canvas_.width!=h||this.canvas_.height!=u){this.canvas_.width=h;this.canvas_.height=u}i.bindFramebuffer(gi,null);i.clearColor(0,0,0,0);i.clear(16384);i.enable(3042);i.viewport(0,0,this.canvas_.width,this.canvas_.height);for(n=0,s=r.length;n<s;++n){a=r[n];this.getLayerRenderer(a.layer).composeFrame(t,a,e)}if(!this.renderedVisible_){this.canvas_.style.display="";this.renderedVisible_=!0}this.calculateMatrices2D(t);1024<this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_&&t.postRenderFunctions.push(this.expireCache_.bind(this));if(!this.tileTextureQueue_.isEmpty()){t.postRenderFunctions.push(this.loadNextTileTexture_);t.animate=!0}this.dispatchRenderEvent(ln.POSTCOMPOSE,t);this.scheduleRemoveUnusedLayerRenderers(t);this.scheduleExpireIconCache(t)};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,o,n,s){var a;if(this.getGL().isContextLost())return!1;var l,h=e.viewState,u=e.layerStatesArray;for(l=u.length-1;0<=l;--l){var c=u[l],p=c.layer;if(Js(c,h.resolution)&&n.call(s,p)){if(a=this.getLayerRenderer(p).forEachFeatureAtCoordinate(t,e,i,r,o))return a}}};t.prototype.hasFeatureAtCoordinate=function(t,e,i,r,o){var n=!1;if(this.getGL().isContextLost())return!1;var s,a=e.viewState,l=e.layerStatesArray;for(s=l.length-1;0<=s;--s){var h=l[s],u=h.layer;if(Js(h,a.resolution)&&r.call(o,u)){if(n=this.getLayerRenderer(u).hasFeatureAtCoordinate(t,e))return!0}}return n};t.prototype.forEachLayerAtPixel=function(t,e,i,r,o,n,s){if(this.getGL().isContextLost())return!1;var a,l,h=e.viewState,u=e.layerStatesArray;for(l=u.length-1;0<=l;--l){var c=u[l],p=c.layer;if(Js(c,h.resolution)&&n.call(o,p)){if(a=this.getLayerRenderer(p).forEachLayerAtPixel(t,e,r,o))return a}}};return t}(eu),Up=[0,0,0],Yp=function(t){var e;this.minZoom=void 0!==t.minZoom?t.minZoom:0;this.resolutions_=t.resolutions;A(Gr(this.resolutions_,function(t,e){return e-t},!0),17);if(!t.origins)for(var i=0,r=this.resolutions_.length-1;i<r;++i)if(e){if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}else e=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=e;this.maxZoom=this.resolutions_.length-1;this.origin_=void 0!==t.origin?t.origin:null;this.origins_=null;if(void 0!==t.origins){this.origins_=t.origins;A(this.origins_.length==this.resolutions_.length,20)}var o=t.extent;void 0===o||this.origin_||this.origins_||(this.origin_=dt(o));A(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18);this.tileSizes_=null;if(void 0!==t.tileSizes){this.tileSizes_=t.tileSizes;A(this.tileSizes_.length==this.resolutions_.length,19)}this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:Ts;A(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22);this.extent_=void 0!==o?o:null;this.fullTileRanges_=null;this.tmpSize_=[0,0];void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,e){return new uu(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1))},this):o&&this.calculateTileRanges_(o)};Yp.prototype.forEachTileCoord=function(t,e,i){for(var r=this.getTileRangeForExtentAndZ(t,e),o=r.minX,n=r.maxX;o<=n;++o)for(var s=r.minY,a=r.maxY;s<=a;++s)i([e,o,s])};Yp.prototype.forEachTileCoordParentTileRange=function(t,e,i,r,o){var n,s,a,l=null,h=t[0]-1;if(2===this.zoomFactor_){s=t[1];a=t[2]}else l=this.getTileCoordExtent(t,o);for(;h>=this.minZoom;){n=2===this.zoomFactor_?cu(s=Math.floor(s/2),s,a=Math.floor(a/2),a,r):this.getTileRangeForExtentAndZ(l,h,r);if(e.call(i,h,n))return!0;--h}return!1};Yp.prototype.getExtent=function(){return this.extent_};Yp.prototype.getMaxZoom=function(){return this.maxZoom};Yp.prototype.getMinZoom=function(){return this.minZoom};Yp.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]};Yp.prototype.getResolution=function(t){return this.resolutions_[t]};Yp.prototype.getResolutions=function(){return this.resolutions_};Yp.prototype.getTileCoordChildTileRange=function(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var r=2*t[1],o=2*t[2];return cu(r,r+1,o,o+1,e)}var n=this.getTileCoordExtent(t,i);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null};Yp.prototype.getTileRangeExtent=function(t,e,i){var r=this.getOrigin(t),o=this.getResolution(t),n=Hs(this.getTileSize(t),this.tmpSize_),s=r[0]+e.minX*n[0]*o,a=r[0]+(e.maxX+1)*n[0]*o;return z(s,r[1]+e.minY*n[1]*o,a,r[1]+(e.maxY+1)*n[1]*o,i)};Yp.prototype.getTileRangeForExtentAndZ=function(t,e,i){var r=Up;this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r);var o=r[1],n=r[2];this.getTileCoordForXYAndZ_(t[2],t[3],e,!0,r);return cu(o,r[1],n,r[2],i)};Yp.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=Hs(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]+(t[2]+.5)*r[1]*i]};Yp.prototype.getTileCoordExtent=function(t,e){var i=this.getOrigin(t[0]),r=this.getResolution(t[0]),o=Hs(this.getTileSize(t[0]),this.tmpSize_),n=i[0]+t[1]*o[0]*r,s=i[1]+t[2]*o[1]*r;return z(n,s,n+o[0]*r,s+o[1]*r,e)};Yp.prototype.getTileCoordForCoordAndResolution=function(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)};Yp.prototype.getTileCoordForXYAndResolution_=function(t,e,i,r,o){var n=this.getZForResolution(i),s=i/this.getResolution(n),a=this.getOrigin(n),l=Hs(this.getTileSize(n),this.tmpSize_),h=r?.5:0,u=r?0:.5,c=Math.floor((t-a[0])/i+h),p=Math.floor((e-a[1])/i+u),d=s*c/l[0],f=s*p/l[1];if(r){d=Math.ceil(d)-1;f=Math.ceil(f)-1}else{d=Math.floor(d);f=Math.floor(f)}return rc(n,d,f,o)};Yp.prototype.getTileCoordForXYAndZ_=function(t,e,i,r,o){var n=this.getOrigin(i),s=this.getResolution(i),a=Hs(this.getTileSize(i),this.tmpSize_),l=r?.5:0,h=r?0:.5,u=Math.floor((t-n[0])/s+l),c=Math.floor((e-n[1])/s+h),p=u/a[0],d=c/a[1];if(r){p=Math.ceil(p)-1;d=Math.ceil(d)-1}else{p=Math.floor(p);d=Math.floor(d)}return rc(i,p,d,o)};Yp.prototype.getTileCoordForCoordAndZ=function(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)};Yp.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]};Yp.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]};Yp.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null};Yp.prototype.getZForResolution=function(t,e){return Lt(Or(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)};Yp.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,i=new Array(e),r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i};function Bp(t){var e=t.getDefaultTileGrid();if(!e){e=Hp(t);t.setDefaultTileGrid(e)}return e}function Vp(t,e,i){var r=e[0],o=t.getTileCoordCenter(e),n=Kp(i);if(Y(n,o))return e;var s=_t(n),a=Math.ceil((n[0]-o[0])/s);o[0]+=s*a;return t.getTileCoordForCoordAndZ(o,r)}function Xp(t,e,i,r){var o=void 0!==r?r:N.TOP_LEFT,n=Wp(t,e,i);return new Yp({extent:t,origin:ht(t,o),resolutions:n,tileSize:i})}function zp(t){var e=t||{},i=e.extent||ye("EPSG:3857").getExtent(),r={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Wp(i,e.maxZoom,e.tileSize)};return new Yp(r)}function Wp(t,e,i){for(var r=void 0!==e?e:xs,o=ct(t),n=_t(t),s=Hs(void 0!==i?i:Ts),a=Math.max(n/s[0],o/s[1]),l=r+1,h=new Array(l),u=0;u<l;++u)h[u]=a/Math.pow(2,u);return h}function Hp(t,e,i,r){return Xp(Kp(t),e,i,r)}function Kp(t){var e=(t=ye(t)).getExtent();if(!e){var i=180*zt[Xt.DEGREES]/t.getMetersPerUnit();e=z(-i,-i,i,i)}return e}var Zp=function(e){function t(t){e.call(this,{attributions:t.attributions,extent:t.extent,projection:t.projection,state:t.state,wrapX:t.wrapX});this.opaque_=void 0!==t.opaque&&t.opaque;this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1;this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;this.tileCache=new uc(t.cacheSize);this.tmpSize=[0,0];this.key_="";this.tileOptions={transition:t.transition}}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.canExpireCache=function(){return this.tileCache.canExpireCache()};t.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);i&&i.expireCache(e)};t.prototype.forEachLoadedTile=function(t,e,i,r){var o=this.getTileCacheForProjection(t);if(!o)return!1;for(var n,s,a,l=!0,h=i.minX;h<=i.maxX;++h)for(var u=i.minY;u<=i.maxY;++u){s=oc(e,h,u);a=!1;o.containsKey(s)&&(a=(n=o.get(s)).getState()===yn.LOADED)&&(a=!1!==r(n));a||(l=!1)}return l};t.prototype.getGutterForProjection=function(t){return 0};t.prototype.getKey=function(){return this.key_};t.prototype.setKey=function(t){if(this.key_!==t){this.key_=t;this.changed()}};t.prototype.getOpaque=function(t){return this.opaque_};t.prototype.getResolutions=function(){return this.tileGrid.getResolutions()};t.prototype.getTile=function(t,e,i,r,o){};t.prototype.getTileGrid=function(){return this.tileGrid};t.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:Bp(t)};t.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return e&&!Ce(e,t)?null:this.tileCache};t.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_};t.prototype.getTilePixelSize=function(t,e,i){var r=this.getTileGridForProjection(i),o=this.getTilePixelRatio(e),n=Hs(r.getTileSize(t),this.tmpSize);return 1==o?n:Ws(n,o,this.tmpSize)};t.prototype.getTileCoordForTileUrlFunction=function(t,e){var i=void 0!==e?e:this.getProjection(),r=this.getTileGridForProjection(i);this.getWrapX()&&i.isGlobal()&&(t=Vp(r,t,i));return hc(t,r)?t:null};t.prototype.refresh=function(){this.tileCache.clear();this.changed()};t.prototype.useTile=function(t,e,i,r){};return t}(Gl),qp=function(i){function t(t,e){i.call(this,t);this.tile=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(m),Jp=new Ac("precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n"),Qp=new Nc("varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 u_tileOffset;\n\nvoid main(void) {\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\n  v_texCoord = a_texCoord;\n}\n\n\n"),$p=function(t,e){this.u_tileOffset=t.getUniformLocation(e,"u_tileOffset");this.u_texture=t.getUniformLocation(e,"u_texture");this.a_position=t.getAttribLocation(e,"a_position");this.a_texCoord=t.getAttribLocation(e,"a_texCoord")},td=function(i){function t(t,e){i.call(this,t,e);this.fragmentShader_=Jp;this.vertexShader_=Qp;this.locations_=null;this.renderArrayBuffer_=new Jc([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]);this.renderedTileRange_=null;this.renderedFramebufferExtent_=null;this.renderedRevision_=-1;this.tmpSize_=[0,0]}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.disposeInternal=function(){this.mapRenderer.getContext().deleteBuffer(this.renderArrayBuffer_);i.prototype.disposeInternal.call(this)};t.prototype.createLoadedTileFinder=function(e,r,o){var n=this.mapRenderer;return function(i,t){return e.forEachLoadedTile(r,i,t,function(t){var e=n.isTileTextureLoaded(t);if(e){o[i]||(o[i]={});o[i][t.tileCoord.toString()]=t}return e})}};t.prototype.handleWebGLContextLost=function(){i.prototype.handleWebGLContextLost.call(this);this.locations_=null};t.prototype.prepareFrame=function(t,e,i){var r=this.mapRenderer,o=i.getGL(),n=t.viewState,s=n.projection,a=this.getLayer(),l=a.getSource();if(!(l instanceof Zp))return!0;var h,u=l.getTileGridForProjection(s),c=u.getZForResolution(n.resolution),p=u.getResolution(c),d=l.getTilePixelSize(c,t.pixelRatio,s),f=d[0]/Hs(u.getTileSize(c),this.tmpSize_)[0],_=p/f,g=l.getTilePixelRatio(f)*l.getGutterForProjection(s),y=n.center,v=t.extent,m=u.getTileRangeForExtentAndZ(v,c);if(this.renderedTileRange_&&this.renderedTileRange_.equals(m)&&this.renderedRevision_==l.getRevision())h=this.renderedFramebufferExtent_;else{var E=m.getSize(),x=Pt(Math.max(E[0]*d[0],E[1]*d[1])),T=_*x,S=u.getOrigin(c),C=S[0]+m.minX*d[0]*_,R=S[1]+m.minY*d[1]*_;h=[C,R,C+T,R+T];this.bindFramebuffer(t,x);o.viewport(0,0,x,x);o.clearColor(0,0,0,0);o.clear(16384);o.disable(3042);var I=i.getProgram(this.fragmentShader_,this.vertexShader_);i.useProgram(I);this.locations_||(this.locations_=new $p(o,I));i.bindBuffer(li,this.renderArrayBuffer_);o.enableVertexAttribArray(this.locations_.a_position);o.vertexAttribPointer(this.locations_.a_position,2,hi,!1,16,0);o.enableVertexAttribArray(this.locations_.a_texCoord);o.vertexAttribPointer(this.locations_.a_texCoord,2,hi,!1,16,8);o.uniform1i(this.locations_.u_texture,0);var w={};w[c]={};var L,O,P,b,M,F,A=this.createLoadedTileFinder(l,s,w),N=a.getUseInterimTilesOnError(),D=!0,G=[1/0,1/0,-1/0,-1/0],k=new uu(0,0,0,0);for(b=m.minX;b<=m.maxX;++b)for(M=m.minY;M<=m.maxY;++M){O=l.getTile(c,b,M,f,s);if(void 0===e.extent||Rt(F=u.getTileCoordExtent(O.tileCoord,G),e.extent)){(P=O.getState())==yn.LOADED||P==yn.EMPTY||P==yn.ERROR&&!N||(O=O.getInterimTile());if((P=O.getState())==yn.LOADED){if(r.isTileTextureLoaded(O)){w[c][O.tileCoord.toString()]=O;continue}}else if(P==yn.EMPTY||P==yn.ERROR&&!N)continue;D=!1;u.forEachTileCoordParentTileRange(O.tileCoord,A,null,k,G)||(L=u.getTileCoordChildTileRange(O.tileCoord,k,G))&&A(c+1,L)}}var j=Object.keys(w).map(Number);j.sort(wr);for(var U=new Float32Array(4),Y=0,B=j.length;Y<B;++Y){var V=w[j[Y]];for(var X in V)if((O=V[X])instanceof Sn){F=u.getTileCoordExtent(O.tileCoord,G);U[0]=2*(F[2]-F[0])/T;U[1]=2*(F[3]-F[1])/T;U[2]=2*(F[0]-h[0])/T-1;U[3]=2*(F[1]-h[1])/T-1;o.uniform4fv(this.locations_.u_tileOffset,U);r.bindTileTexture(O,d,g*f,ci,ci);o.drawArrays(5,0,4)}}if(D){this.renderedTileRange_=m;this.renderedFramebufferExtent_=h;this.renderedRevision_=l.getRevision()}else{this.renderedTileRange_=null;this.renderedFramebufferExtent_=null;this.renderedRevision_=-1;t.animate=!0}}this.updateUsedTiles(t.usedTiles,l,c,m);var z=r.getTileTextureQueue();this.manageTilePyramid(t,l,u,f,s,v,c,a.getPreload(),function(t){t.getState()!=yn.LOADED||r.isTileTextureLoaded(t)||z.isKeyQueued(t.getKey())||z.enqueue([t,u.getTileCoordCenter(t.tileCoord),u.getResolution(t.tileCoord[0]),d,g*f])},this);this.scheduleExpireCache(t,l);var W=this.texCoordMatrix;Me(W);je(W,(Math.round(y[0]/p)*p-h[0])/(h[2]-h[0]),(Math.round(y[1]/p)*p-h[1])/(h[3]-h[1]));0!==n.rotation&&Ge(W,n.rotation);ke(W,t.size[0]*n.resolution/(h[2]-h[0]),t.size[1]*n.resolution/(h[3]-h[1]));je(W,-.5,-.5);return!0};t.prototype.forEachLayerAtPixel=function(t,e,i,r){if(this.framebuffer){var o=[t[0]/e.size[0],(e.size[1]-t[1])/e.size[1]],n=De(this.texCoordMatrix,o.slice()),s=[n[0]*this.framebufferDimension,n[1]*this.framebufferDimension],a=this.mapRenderer.getContext().getGL();a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer);var l=new Uint8Array(4);a.readPixels(s[0],s[1],1,1,a.RGBA,a.UNSIGNED_BYTE,l);return 0<l[3]?i.call(r,this.getLayer(),l):void 0}};return t}(Gp);td.handles=function(t){return t.getType()===In.TILE};td.create=function(t,e){return new td(t,e)};var ed=function(i){function t(t,e){i.call(this,t,e);this.dirty_=!1;this.renderedRevision_=-1;this.renderedResolution_=NaN;this.renderedExtent_=[1/0,1/0,-1/0,-1/0];this.renderedRenderOrder_=null;this.replayGroup_=null;this.layerState_=null}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.composeFrame=function(t,e,i){this.layerState_=e;var r=t.viewState,o=this.replayGroup_,n=t.size,s=t.pixelRatio,a=this.mapRenderer.getGL();if(o&&!o.isEmpty()){a.enable(a.SCISSOR_TEST);a.scissor(0,0,n[0]*s,n[1]*s);o.replay(i,r.center,r.resolution,r.rotation,n,s,e.opacity,e.managed?t.skippedFeatureUids:{});a.disable(a.SCISSOR_TEST)}};t.prototype.disposeInternal=function(){var t=this.replayGroup_;if(t){var e=this.mapRenderer.getContext();t.getDeleteResourcesFunction(e)();this.replayGroup_=null}i.prototype.disposeInternal.call(this)};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,o){if(this.replayGroup_&&this.layerState_){var n=this.mapRenderer.getContext(),s=e.viewState,a=this.getLayer(),l=this.layerState_,h={};return this.replayGroup_.forEachFeatureAtCoordinate(t,n,s.center,s.resolution,s.rotation,e.size,e.pixelRatio,l.opacity,{},function(t){var e=St(t).toString();if(!(e in h)){h[e]=!0;return r.call(o,t,a)}})}};t.prototype.hasFeatureAtCoordinate=function(t,e){if(this.replayGroup_&&this.layerState_){var i=this.mapRenderer.getContext(),r=e.viewState,o=this.layerState_;return this.replayGroup_.hasFeatureAtCoordinate(t,i,r.center,r.resolution,r.rotation,e.size,e.pixelRatio,o.opacity,e.skippedFeatureUids)}return!1};t.prototype.forEachLayerAtPixel=function(t,e,i,r){var o=De(e.pixelToCoordinateTransform,t.slice());return this.hasFeatureAtCoordinate(o,e)?i.call(r,this.getLayer(),null):void 0};t.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()};t.prototype.prepareFrame=function(t,e,i){var o=this.getLayer(),r=o.getSource(),n=t.viewHints[bs.ANIMATING],s=t.viewHints[bs.INTERACTING],a=o.getUpdateWhileAnimating(),l=o.getUpdateWhileInteracting();if(!this.dirty_&&!a&&n||!l&&s)return!0;var h=t.extent,u=t.viewState,c=u.projection,p=u.resolution,d=t.pixelRatio,f=o.getRevision(),_=o.getRenderBuffer(),g=o.getRenderOrder();void 0===g&&(g=Uu);var y=k(h,_*p);if(!this.dirty_&&this.renderedResolution_==p&&this.renderedRevision_==f&&this.renderedRenderOrder_==g&&Q(this.renderedExtent_,y))return!0;this.replayGroup_&&t.postRenderFunctions.push(this.replayGroup_.getDeleteResourcesFunction(i));this.dirty_=!1;var v=new Mp(Bu(p,d),y,o.getRenderBuffer());r.loadFeatures(y,p,c);var m=function(t){var e,i=t.getStyleFunction()||o.getStyleFunction();i&&(e=i(t,p));if(e){var r=this.renderFeature(t,p,d,e,v);this.dirty_=this.dirty_||r}};if(g){var E=[];r.forEachFeatureInExtent(y,function(t){E.push(t)},this);E.sort(g);E.forEach(m.bind(this))}else r.forEachFeatureInExtent(y,m,this);v.finish(i);this.renderedResolution_=p;this.renderedRevision_=f;this.renderedRenderOrder_=g;this.renderedExtent_=y;this.replayGroup_=v;return!0};t.prototype.renderFeature=function(t,e,i,r,o){if(!r)return!1;var n=!1;if(Array.isArray(r))for(var s=r.length-1;0<=s;--s)n=Vu(o,t,r[s],Yu(e,i),this.handleStyleImageChange_,this)||n;else n=Vu(o,t,r,Yu(e,i),this.handleStyleImageChange_,this)||n;return n};return t}(Gp);ed.handles=function(t){return t.getType()===In.VECTOR};ed.create=function(t,e){return new ed(t,e)};var id=function(e){function t(t){(t=T({},t)).controls||(t.controls=ra());t.interactions||(t.interactions=Kh());e.call(this,t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.createRenderer=function(){var t=new jp(this);t.registerLayerRenderers([kp,td,ed]);return t};return t}(Ks),rd="projection",od="coordinateFormat",nd=function(r){function t(t){var e=t||{},i=document.createElement("div");i.className=void 0!==e.className?e.className:"ol-mouse-position";r.call(this,{element:i,render:e.render||sd,target:e.target});S(this,P(rd),this.handleProjectionChanged_,this);e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat);e.projection&&this.setProjection(e.projection);this.undefinedHTML_=void 0!==e.undefinedHTML?e.undefinedHTML:"&#160;";this.renderOnMouseOut_=!!this.undefinedHTML_;this.renderedHTML_=i.innerHTML;this.mapProjection_=null;this.transform_=null;this.lastMouseMovePixel_=null}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.handleProjectionChanged_=function(){this.transform_=null};t.prototype.getCoordinateFormat=function(){return this.get(od)};t.prototype.getProjection=function(){return this.get(rd)};t.prototype.handleMouseMove=function(t){var e=this.getMap();this.lastMouseMovePixel_=e.getEventPixel(t);this.updateHTML_(this.lastMouseMovePixel_)};t.prototype.handleMouseOut=function(t){this.updateHTML_(null);this.lastMouseMovePixel_=null};t.prototype.setMap=function(t){r.prototype.setMap.call(this,t);if(t){var e=t.getViewport();this.listenerKeys.push(S(e,R.MOUSEMOVE,this.handleMouseMove,this),S(e,R.TOUCHSTART,this.handleMouseMove,this));this.renderOnMouseOut_&&this.listenerKeys.push(S(e,R.MOUSEOUT,this.handleMouseOut,this),S(e,R.TOUCHEND,this.handleMouseOut,this))}};t.prototype.setCoordinateFormat=function(t){this.set(od,t)};t.prototype.setProjection=function(t){this.set(rd,ye(t))};t.prototype.updateHTML_=function(t){var e=this.undefinedHTML_;if(t&&this.mapProjection_){if(!this.transform_){var i=this.getProjection();this.transform_=i?Re(this.mapProjection_,i):fe}var r=this.getMap().getCoordinateFromPixel(t);if(r){this.transform_(r,r);var o=this.getCoordinateFormat();e=o?o(r):r.toString()}}if(!this.renderedHTML_||e!==this.renderedHTML_){this.element.innerHTML=e;this.renderedHTML_=e}};return t}(Zs);function sd(t){var e=t.frameState;if(e){if(this.mapProjection_!=e.viewState.projection){this.mapProjection_=e.viewState.projection;this.transform_=null}}else this.mapProjection_=null}var ad=function(){this.dataProjection=null;this.defaultFeatureProjection=null};ad.prototype.getReadOptions=function(t,e){var i;e&&(i={dataProjection:e.dataProjection?e.dataProjection:this.readProjection(t),featureProjection:e.featureProjection});return this.adaptOptions(i)};ad.prototype.adaptOptions=function(t){return T({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)};ad.prototype.getLastExtent=function(){return null};ad.prototype.getType=function(){};ad.prototype.readFeature=function(t,e){};ad.prototype.readFeatures=function(t,e){};ad.prototype.readGeometry=function(t,e){};ad.prototype.readProjection=function(t){};ad.prototype.writeFeature=function(t,e){};ad.prototype.writeFeatures=function(t,e){};ad.prototype.writeGeometry=function(t,e){};function ld(t,e,i){var r,o=i?ye(i.featureProjection):null,n=i?ye(i.dataProjection):null;r=o&&n&&!Ce(o,n)?t instanceof Xe?(e?t.clone():t).transform(e?o:n,e?n:o):Le(t,n,o):t;if(e&&i&&void 0!==i.decimals){var s=Math.pow(10,i.decimals);r===t&&(r=r.clone());r.applyTransform(function(t){for(var e=0,i=t.length;e<i;++e)t[e]=Math.round(t[e]*s)/s;return t})}return r}var hd=function(t){function e(){t.call(this)}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getType=function(){return Fl.JSON};e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(ud(t),this.getReadOptions(t,e))};e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(ud(t),this.getReadOptions(t,e))};e.prototype.readFeatureFromObject=function(t,e){};e.prototype.readFeaturesFromObject=function(t,e){};e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(ud(t),this.getReadOptions(t,e))};e.prototype.readGeometryFromObject=function(t,e){};e.prototype.readProjection=function(t){return this.readProjectionFromObject(ud(t))};e.prototype.readProjectionFromObject=function(t){};e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))};e.prototype.writeFeatureObject=function(t,e){};e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))};e.prototype.writeFeaturesObject=function(t,e){};e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))};e.prototype.writeGeometryObject=function(t,e){};return e}(ad);function ud(t){if("string"!=typeof t)return null!==t?t:null;var e=JSON.parse(t);return e||null}var cd={};cd[kt.POINT]=function(t){var e;e=void 0!==t.m&&void 0!==t.z?new fo([t.x,t.y,t.z,t.m],kr.XYZM):void 0!==t.z?new fo([t.x,t.y,t.z],kr.XYZ):void 0!==t.m?new fo([t.x,t.y,t.m],kr.XYM):new fo([t.x,t.y]);return e};cd[kt.LINE_STRING]=function(t){var e=_d(t);return new on(t.paths[0],e)};cd[kt.POLYGON]=function(t){var e=_d(t);return new Fo(t.rings,e)};cd[kt.MULTI_POINT]=function(t){var e=_d(t);return new wl(t.points,e)};cd[kt.MULTI_LINE_STRING]=function(t){var e=_d(t);return new Il(t.paths,e)};cd[kt.MULTI_POLYGON]=function(t){var e=_d(t);return new Ol(t.rings,e)};var pd={};pd[kt.POINT]=function(t,e){var i,r=t.getCoordinates(),o=t.getLayout();o===kr.XYZ?i={x:r[0],y:r[1],z:r[2]}:o===kr.XYM?i={x:r[0],y:r[1],m:r[2]}:o===kr.XYZM?i={x:r[0],y:r[1],z:r[2],m:r[3]}:o===kr.XY?i={x:r[0],y:r[1]}:A(!1,34);return i};pd[kt.LINE_STRING]=function(t,e){var i=gd(t);return{hasZ:i.hasZ,hasM:i.hasM,paths:[t.getCoordinates()]}};pd[kt.POLYGON]=function(t,e){var i=gd(t);return{hasZ:i.hasZ,hasM:i.hasM,rings:t.getCoordinates(!1)}};pd[kt.MULTI_POINT]=function(t,e){var i=gd(t);return{hasZ:i.hasZ,hasM:i.hasM,points:t.getCoordinates()}};pd[kt.MULTI_LINE_STRING]=function(t,e){var i=gd(t);return{hasZ:i.hasZ,hasM:i.hasM,paths:t.getCoordinates()}};pd[kt.MULTI_POLYGON]=function(t,e){for(var i=gd(t),r=t.getCoordinates(!1),o=[],n=0;n<r.length;n++)for(var s=r[n].length-1;0<=s;s--)o.push(r[n][s]);return{hasZ:i.hasZ,hasM:i.hasM,rings:o}};var dd=function(i){function t(t){var e=t||{};i.call(this);this.geometryName_=e.geometryName}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeatureFromObject=function(t,e){var i=t,r=fd(i.geometry,e),o=new Sr;this.geometryName_&&o.setGeometryName(this.geometryName_);o.setGeometry(r);e&&e.idField&&i.attributes[e.idField]&&o.setId(i.attributes[e.idField]);i.attributes&&o.setProperties(i.attributes);return o};t.prototype.readFeaturesFromObject=function(t,e){var i=e||{};if(t.features){var r=[],o=t.features;i.idField=t.objectIdFieldName;for(var n=0,s=o.length;n<s;++n)r.push(this.readFeatureFromObject(o[n],i));return r}return[this.readFeatureFromObject(t,i)]};t.prototype.readGeometryFromObject=function(t,e){return fd(t,e)};t.prototype.readProjectionFromObject=function(t){var e=t;if(e.spatialReference&&e.spatialReference.wkid){return ye("EPSG:"+e.spatialReference.wkid)}return null};t.prototype.writeGeometryObject=function(t,e){return yd(t,this.adaptOptions(e))};t.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var i={},r=t.getGeometry();if(r){i.geometry=yd(r,e);e&&e.featureProjection&&(i.geometry.spatialReference={wkid:ye(e.featureProjection).getCode().split(":").pop()})}var o=t.getProperties();delete o[t.getGeometryName()];Ct(o)?i.attributes={}:i.attributes=o;return i};t.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var i=[],r=0,o=t.length;r<o;++r)i.push(this.writeFeatureObject(t[r],e));return{features:i}};return t}(hd);function fd(t,e){if(!t)return null;var i;if("number"==typeof t.x&&"number"==typeof t.y)i=kt.POINT;else if(t.points)i=kt.MULTI_POINT;else if(t.paths)i=1===t.paths.length?kt.LINE_STRING:kt.MULTI_LINE_STRING;else if(t.rings){var r=_d(t),o=function(t,e){var i,r,o=[],n=[],s=[];for(i=0,r=t.length;i<r;++i){o.length=0;$r(o,0,t[i],e.length);var a=Lo(o,0,o.length,e.length);a?n.push([t[i]]):s.push(t[i])}for(;s.length;){var l=s.shift(),h=!1;for(i=n.length-1;0<=i;i--){var u=n[i][0],c=Q(new po(u).getExtent(),new po(l).getExtent());if(c){n[i].push(l);h=!0;break}}h||n.push([l.reverse()])}return n}(t.rings,r);t=T({},t);if(1===o.length){i=kt.POLYGON;t.rings=o[0]}else{i=kt.MULTI_POLYGON;t.rings=o}}return ld((0,cd[i])(t),!1,e)}function _d(t){var e=kr.XY;!0===t.hasZ&&!0===t.hasM?e=kr.XYZM:!0===t.hasZ?e=kr.XYZ:!0===t.hasM&&(e=kr.XYM);return e}function gd(t){var e=t.getLayout();return{hasZ:e===kr.XYZ||e===kr.XYZM,hasM:e===kr.XYM||e===kr.XYZM}}function yd(t,e){return(0,pd[t.getType()])(ld(t,!0,e),e)}var vd=document.implementation.createDocument("","",null),md="http://www.w3.org/2001/XMLSchema-instance";function Ed(t,e){return vd.createElementNS(t,e)}function xd(t,e){return Td(t,e,[]).join("")}function Td(t,e,i){if(t.nodeType==Node.CDATA_SECTION_NODE||t.nodeType==Node.TEXT_NODE)e?i.push(String(t.nodeValue).replace(/(\r\n|\r|\n)/g,"")):i.push(t.nodeValue);else{var r;for(r=t.firstChild;r;r=r.nextSibling)Td(r,e,i)}return i}function Sd(t){return t instanceof Document}function Cd(t){return t instanceof Node}function Rd(t,e,i){return t.getAttributeNS(e,i)||""}function Id(t){return(new DOMParser).parseFromString(t,"application/xml")}function wd(r,o){return function(t,e){var i=r.call(void 0!==o?o:this,t,e);if(void 0!==i){br(e[e.length-1],i)}}}function Ld(r,o){return function(t,e){var i=r.call(void 0!==o?o:this,t,e);if(void 0!==i){e[e.length-1].push(i)}}}function Od(r,o){return function(t,e){var i=r.call(void 0!==o?o:this,t,e);void 0!==i&&(e[e.length-1]=i)}}function Pd(n,s,a){return function(t,e){var i=n.call(void 0!==a?a:this,t,e);if(void 0!==i){var r=e[e.length-1],o=void 0!==s?s:t.localName;(o in r?r[o]:r[o]=[]).push(i)}}}function bd(r,o,n){return function(t,e){var i=r.call(void 0!==n?n:this,t,e);if(void 0!==i){e[e.length-1][void 0!==o?o:t.localName]=i}}}function Md(r,o){return function(t,e,i){r.call(void 0!==o?o:this,t,e,i);i[i.length-1].node.appendChild(t)}}function Fd(o,t){var n,s;return function(t,e,i){if(void 0===n){n={};var r={};r[t.localName]=o;n[t.namespaceURI]=r;s=Ad(t.localName)}Ud(n,s,e,i)}}function Ad(t,n){var s=t;return function(t,e,i){var r=e[e.length-1].node,o=s;void 0===o&&(o=i);return Ed(void 0!==n?n:r.namespaceURI,o)}}var Nd=Ad();function Dd(t,e){for(var i=e.length,r=new Array(i),o=0;o<i;++o)r[o]=t[e[o]];return r}function Gd(t,e,i){var r,o,n=void 0!==i?i:{};for(r=0,o=t.length;r<o;++r)n[t[r]]=e;return n}function kd(t,e,i,r){var o;for(o=e.firstElementChild;o;o=o.nextElementSibling){var n=t[o.namespaceURI];if(void 0!==n){var s=n[o.localName];void 0!==s&&s.call(r,o,i)}}}function jd(t,e,i,r,o){r.push(t);kd(e,i,r,o);return r.pop()}function Ud(t,e,i,r,o,n){for(var s,a,l=(void 0!==o?o:i).length,h=0;h<l;++h)void 0!==(s=i[h])&&void 0!==(a=e.call(void 0!==n?n:this,s,r,void 0!==o?o[h]:void 0))&&t[a.namespaceURI][a.localName].call(n,a,s,r)}function Yd(t,e,i,r,o,n,s){o.push(t);Ud(e,i,r,o,n,s);return o.pop()}var Bd=function(t){function e(){t.call(this);this.xmlSerializer_=new XMLSerializer}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getType=function(){return Fl.XML};e.prototype.readFeature=function(t,e){if(Sd(t))return this.readFeatureFromDocument(t,e);if(Cd(t))return this.readFeatureFromNode(t,e);if("string"!=typeof t)return null;var i=Id(t);return this.readFeatureFromDocument(i,e)};e.prototype.readFeatureFromDocument=function(t,e){var i=this.readFeaturesFromDocument(t,e);return 0<i.length?i[0]:null};e.prototype.readFeatureFromNode=function(t,e){return null};e.prototype.readFeatures=function(t,e){if(Sd(t))return this.readFeaturesFromDocument(t,e);if(Cd(t))return this.readFeaturesFromNode(t,e);if("string"!=typeof t)return[];var i=Id(t);return this.readFeaturesFromDocument(i,e)};e.prototype.readFeaturesFromDocument=function(t,e){for(var i=[],r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&br(i,this.readFeaturesFromNode(r,e));return i};e.prototype.readFeaturesFromNode=function(t,e){};e.prototype.readGeometry=function(t,e){if(Sd(t))return this.readGeometryFromDocument(t,e);if(Cd(t))return this.readGeometryFromNode(t,e);if("string"!=typeof t)return null;var i=Id(t);return this.readGeometryFromDocument(i,e)};e.prototype.readGeometryFromDocument=function(t,e){return null};e.prototype.readGeometryFromNode=function(t,e){return null};e.prototype.readProjection=function(t){if(Sd(t))return this.readProjectionFromDocument(t);if(Cd(t))return this.readProjectionFromNode(t);if("string"!=typeof t)return null;var e=Id(t);return this.readProjectionFromDocument(e)};e.prototype.readProjectionFromDocument=function(t){return this.dataProjection};e.prototype.readProjectionFromNode=function(t){return this.dataProjection};e.prototype.writeFeature=function(t,e){var i=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(i)};e.prototype.writeFeatureNode=function(t,e){return null};e.prototype.writeFeatures=function(t,e){var i=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(i)};e.prototype.writeFeaturesNode=function(t,e){return null};e.prototype.writeGeometry=function(t,e){var i=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(i)};e.prototype.writeGeometryNode=function(t,e){return null};return e}(ad),Vd="http://www.opengis.net/gml",Xd=/^[\s\xa0]*$/,zd=function(i){function t(t){i.call(this);var e=t||{};this.featureType=e.featureType;this.featureNS=e.featureNS;this.srsName=e.srsName;this.schemaLocation="";this.FEATURE_COLLECTION_PARSERS={};this.FEATURE_COLLECTION_PARSERS[Vd]={featureMember:Od(this.readFeaturesInternal),featureMembers:Od(this.readFeaturesInternal)}}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeaturesInternal=function(t,e){var i=t.localName,r=null;if("FeatureCollection"==i)r="http://www.opengis.net/wfs"===t.namespaceURI?jd([],this.FEATURE_COLLECTION_PARSERS,t,e,this):jd(null,this.FEATURE_COLLECTION_PARSERS,t,e,this);else if("featureMembers"==i||"featureMember"==i){var o=e[0],n=o.featureType,s=o.featureNS;if(!n&&t.childNodes){n=[],s={};for(var a=0,l=t.childNodes.length;a<l;++a){var h=t.childNodes[a];if(1===h.nodeType){var u=h.nodeName.split(":").pop();if(-1===n.indexOf(u)){var c="",p=0,d=h.namespaceURI;for(var f in s){if(s[f]===d){c=f;break}++p}c||(s[c="p"+p]=d);n.push(c+":"+u)}}}if("featureMember"!=i){o.featureType=n;o.featureNS=s}}if("string"==typeof s){var _=s;(s={}).p0=_}var g={},y=Array.isArray(n)?n:[n];for(var v in s){for(var m={},E=0,x=y.length;E<x;++E){(-1===y[E].indexOf(":")?"p0":y[E].split(":")[0])===v&&(m[y[E].split(":").pop()]="featureMembers"==i?Ld(this.readFeatureElement,this):Od(this.readFeatureElement,this))}g[s[v]]=m}r=jd("featureMember"==i?void 0:[],g,t,e)}null===r&&(r=[]);return r};t.prototype.readGeometryElement=function(t,e){var i=e[0];i.srsName=t.firstElementChild.getAttribute("srsName");i.srsDimension=t.firstElementChild.getAttribute("srsDimension");var r=jd(null,this.GEOMETRY_PARSERS_,t,e,this);return r?ld(r,!1,i):void 0};t.prototype.readFeatureElement=function(t,e){var i,r,o=t.getAttribute("fid")||Rd(t,Vd,"id"),n={};for(i=t.firstElementChild;i;i=i.nextElementSibling){var s=i.localName;if(0===i.childNodes.length||1===i.childNodes.length&&(3===i.firstChild.nodeType||4===i.firstChild.nodeType)){var a=xd(i,!1);Xd.test(a)&&(a=void 0);n[s]=a}else{"boundedBy"!==s&&(r=s);n[s]=this.readGeometryElement(i,e)}}var l=new Sr(n);r&&l.setGeometryName(r);o&&l.setId(o);return l};t.prototype.readPoint=function(t,e){var i=this.readFlatCoordinatesFromNode_(t,e);if(i)return new fo(i,kr.XYZ)};t.prototype.readMultiPoint=function(t,e){var i=jd([],this.MULTIPOINT_PARSERS_,t,e,this);return i?new wl(i):void 0};t.prototype.readMultiLineString=function(t,e){var i=jd([],this.MULTILINESTRING_PARSERS_,t,e,this);if(i)return new Il(i)};t.prototype.readMultiPolygon=function(t,e){var i=jd([],this.MULTIPOLYGON_PARSERS_,t,e,this);if(i)return new Ol(i)};t.prototype.pointMemberParser_=function(t,e){kd(this.POINTMEMBER_PARSERS_,t,e,this)};t.prototype.lineStringMemberParser_=function(t,e){kd(this.LINESTRINGMEMBER_PARSERS_,t,e,this)};t.prototype.polygonMemberParser_=function(t,e){kd(this.POLYGONMEMBER_PARSERS_,t,e,this)};t.prototype.readLineString=function(t,e){var i=this.readFlatCoordinatesFromNode_(t,e);if(i){return new on(i,kr.XYZ)}};t.prototype.readFlatLinearRing_=function(t,e){var i=jd(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS_,t,e,this);return i||void 0};t.prototype.readLinearRing=function(t,e){var i=this.readFlatCoordinatesFromNode_(t,e);if(i)return new po(i,kr.XYZ)};t.prototype.readPolygon=function(t,e){var i=jd([null],this.FLAT_LINEAR_RINGS_PARSERS_,t,e,this);if(i&&i[0]){var r,o,n=i[0],s=[n.length];for(r=1,o=i.length;r<o;++r){br(n,i[r]);s.push(n.length)}return new Fo(n,kr.XYZ,s)}};t.prototype.readFlatCoordinatesFromNode_=function(t,e){return jd(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS_,t,e,this)};t.prototype.readGeometryFromNode=function(t,e){var i=this.readGeometryElement(t,[this.getReadOptions(t,e||{})]);return i||null};t.prototype.readFeaturesFromNode=function(t,e){var i={featureType:this.featureType,featureNS:this.featureNS};e&&T(i,this.getReadOptions(t,e));return this.readFeaturesInternal(t,[i])||[]};t.prototype.readProjectionFromNode=function(t){return ye(this.srsName?this.srsName:t.firstElementChild.getAttribute("srsName"))};return t}(Bd);zd.prototype.MULTIPOINT_PARSERS_={"http://www.opengis.net/gml":{pointMember:Ld(zd.prototype.pointMemberParser_),pointMembers:Ld(zd.prototype.pointMemberParser_)}};zd.prototype.MULTILINESTRING_PARSERS_={"http://www.opengis.net/gml":{lineStringMember:Ld(zd.prototype.lineStringMemberParser_),lineStringMembers:Ld(zd.prototype.lineStringMemberParser_)}};zd.prototype.MULTIPOLYGON_PARSERS_={"http://www.opengis.net/gml":{polygonMember:Ld(zd.prototype.polygonMemberParser_),polygonMembers:Ld(zd.prototype.polygonMemberParser_)}};zd.prototype.POINTMEMBER_PARSERS_={"http://www.opengis.net/gml":{Point:Ld(zd.prototype.readFlatCoordinatesFromNode_)}};zd.prototype.LINESTRINGMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:Ld(zd.prototype.readLineString)}};zd.prototype.POLYGONMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:Ld(zd.prototype.readPolygon)}};zd.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Od(zd.prototype.readFlatLinearRing_)}};function Wd(t){return Hd(xd(t,!1))}function Hd(t){var e=/^\s*(true|1)|(false|0)\s*$/.exec(t);return e?void 0!==e[1]||!1:void 0}function Kd(t){var e=xd(t,!1),i=Date.parse(e);return isNaN(i)?void 0:i/1e3}function Zd(t){return qd(xd(t,!1))}function qd(t){var e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);return e?parseFloat(e[1]):void 0}function Jd(t){return Qd(xd(t,!1))}function Qd(t){var e=/^\s*(\d+)\s*$/.exec(t);return e?parseInt(e[1],10):void 0}function $d(t){return xd(t,!1).trim()}function tf(t,e){sf(t,e?"1":"0")}function ef(t,e){t.appendChild(vd.createCDATASection(e))}function rf(t,e){var i=new Date(1e3*e),r=i.getUTCFullYear()+"-"+jo(i.getUTCMonth()+1,2)+"-"+jo(i.getUTCDate(),2)+"T"+jo(i.getUTCHours(),2)+":"+jo(i.getUTCMinutes(),2)+":"+jo(i.getUTCSeconds(),2)+"Z";t.appendChild(vd.createTextNode(r))}function of(t,e){var i=e.toPrecision();t.appendChild(vd.createTextNode(i))}function nf(t,e){var i=e.toString();t.appendChild(vd.createTextNode(i))}function sf(t,e){t.appendChild(vd.createTextNode(e))}var af=Vd+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",lf={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},hf=function(i){function t(t){var e=t||{};i.call(this,e);this.surface_=void 0!==e.surface&&e.surface;this.curve_=void 0!==e.curve&&e.curve;this.multiCurve_=void 0===e.multiCurve||e.multiCurve;this.multiSurface_=void 0===e.multiSurface||e.multiSurface;this.schemaLocation=e.schemaLocation?e.schemaLocation:af;this.hasZ=void 0!==e.hasZ&&e.hasZ}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readMultiCurve_=function(t,e){var i=jd([],this.MULTICURVE_PARSERS_,t,e,this);if(i){return new Il(i)}};t.prototype.readMultiSurface_=function(t,e){var i=jd([],this.MULTISURFACE_PARSERS_,t,e,this);if(i)return new Ol(i)};t.prototype.curveMemberParser_=function(t,e){kd(this.CURVEMEMBER_PARSERS_,t,e,this)};t.prototype.surfaceMemberParser_=function(t,e){kd(this.SURFACEMEMBER_PARSERS_,t,e,this)};t.prototype.readPatch_=function(t,e){return jd([null],this.PATCHES_PARSERS_,t,e,this)};t.prototype.readSegment_=function(t,e){return jd([null],this.SEGMENTS_PARSERS_,t,e,this)};t.prototype.readPolygonPatch_=function(t,e){return jd([null],this.FLAT_LINEAR_RINGS_PARSERS_,t,e,this)};t.prototype.readLineStringSegment_=function(t,e){return jd([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS_,t,e,this)};t.prototype.interiorParser_=function(t,e){var i=jd(void 0,this.RING_PARSERS,t,e,this);if(i){e[e.length-1].push(i)}};t.prototype.exteriorParser_=function(t,e){var i=jd(void 0,this.RING_PARSERS,t,e,this);if(i){e[e.length-1][0]=i}};t.prototype.readSurface_=function(t,e){var i=jd([null],this.SURFACE_PARSERS_,t,e,this);if(i&&i[0]){var r,o,n=i[0],s=[n.length];for(r=1,o=i.length;r<o;++r){br(n,i[r]);s.push(n.length)}return new Fo(n,kr.XYZ,s)}};t.prototype.readCurve_=function(t,e){var i=jd([null],this.CURVE_PARSERS_,t,e,this);if(i){return new on(i,kr.XYZ)}};t.prototype.readEnvelope_=function(t,e){var i=jd([null],this.ENVELOPE_PARSERS_,t,e,this);return z(i[1][0],i[1][1],i[2][0],i[2][1])};t.prototype.readFlatPos_=function(t,e){for(var i,r=xd(t,!1),o=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,n=[];i=o.exec(r);){n.push(parseFloat(i[1]));r=r.substr(i[0].length)}if(""===r){var s=e[0].srsName,a="enu";if(s){a=ye(s).getAxisOrientation()}if("neu"===a){var l,h;for(l=0,h=n.length;l<h;l+=3){var u=n[l],c=n[l+1];n[l]=c;n[l+1]=u}}var p=n.length;2==p&&n.push(0);if(0!==p)return n}};t.prototype.readFlatPosList_=function(t,e){var i=xd(t,!1).replace(/^\s*|\s*$/g,""),r=e[0],o=r.srsName,n=r.srsDimension,s="enu";if(o){s=ye(o).getAxisOrientation()}var a,l,h,u=i.split(/\s+/),c=2;t.getAttribute("srsDimension")?c=Qd(t.getAttribute("srsDimension")):t.getAttribute("dimension")?c=Qd(t.getAttribute("dimension")):t.parentNode.getAttribute("srsDimension")?c=Qd(t.parentNode.getAttribute("srsDimension")):n&&(c=Qd(n));for(var p=[],d=0,f=u.length;d<f;d+=c){a=parseFloat(u[d]);l=parseFloat(u[d+1]);h=3===c?parseFloat(u[d+2]):0;"en"===s.substr(0,2)?p.push(a,l,h):p.push(l,a,h)}return p};t.prototype.writePos_=function(t,e,i){var r=i[i.length-1],o=r.hasZ,n=o?3:2;t.setAttribute("srsDimension",n);var s=r.srsName,a="enu";s&&(a=ye(s).getAxisOrientation());var l,h=e.getCoordinates();l="en"===a.substr(0,2)?h[0]+" "+h[1]:h[1]+" "+h[0];if(o){l+=" "+(h[2]||0)}sf(t,l)};t.prototype.getCoords_=function(t,e,i){var r="enu";e&&(r=ye(e).getAxisOrientation());var o="en"===r.substr(0,2)?t[0]+" "+t[1]:t[1]+" "+t[0];if(i){o+=" "+(t[2]||0)}return o};t.prototype.writePosList_=function(t,e,i){var r=i[i.length-1],o=r.hasZ,n=o?3:2;t.setAttribute("srsDimension",n);for(var s,a=r.srsName,l=e.getCoordinates(),h=l.length,u=new Array(h),c=0;c<h;++c){s=l[c];u[c]=this.getCoords_(s,a,o)}sf(t,u.join(" "))};t.prototype.writePoint_=function(t,e,i){var r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);var o=Ed(t.namespaceURI,"pos");t.appendChild(o);this.writePos_(o,e,i)};t.prototype.writeEnvelope=function(t,e,i){var r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);var o=[e[0]+" "+e[1],e[2]+" "+e[3]];Yd({node:t},this.ENVELOPE_SERIALIZERS_,Nd,o,i,["lowerCorner","upperCorner"],this)};t.prototype.writeLinearRing_=function(t,e,i){var r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);var o=Ed(t.namespaceURI,"posList");t.appendChild(o);this.writePosList_(o,e,i)};t.prototype.RING_NODE_FACTORY_=function(t,e,i){var r=e[e.length-1],o=r.node,n=r.exteriorWritten;void 0===n&&(r.exteriorWritten=!0);return Ed(o.namespaceURI,void 0!==n?"interior":"exterior")};t.prototype.writeSurfaceOrPolygon_=function(t,e,i){var r=i[i.length-1],o=r.hasZ,n=r.srsName;"PolygonPatch"!==t.nodeName&&n&&t.setAttribute("srsName",n);if("Polygon"===t.nodeName||"PolygonPatch"===t.nodeName){var s=e.getLinearRings();Yd({node:t,hasZ:o,srsName:n},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,s,i,void 0,this)}else if("Surface"===t.nodeName){var a=Ed(t.namespaceURI,"patches");t.appendChild(a);this.writeSurfacePatches_(a,e,i)}};t.prototype.writeCurveOrLineString_=function(t,e,i){var r=i[i.length-1].srsName;"LineStringSegment"!==t.nodeName&&r&&t.setAttribute("srsName",r);if("LineString"===t.nodeName||"LineStringSegment"===t.nodeName){var o=Ed(t.namespaceURI,"posList");t.appendChild(o);this.writePosList_(o,e,i)}else if("Curve"===t.nodeName){var n=Ed(t.namespaceURI,"segments");t.appendChild(n);this.writeCurveSegments_(n,e,i)}};t.prototype.writeMultiSurfaceOrPolygon_=function(t,e,i){var r=i[i.length-1],o=r.hasZ,n=r.srsName,s=r.surface;n&&t.setAttribute("srsName",n);var a=e.getPolygons();Yd({node:t,hasZ:o,srsName:n,surface:s},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)};t.prototype.writeMultiPoint_=function(t,e,i){var r=i[i.length-1],o=r.srsName,n=r.hasZ;o&&t.setAttribute("srsName",o);var s=e.getPoints();Yd({node:t,hasZ:n,srsName:o},this.POINTMEMBER_SERIALIZERS_,Ad("pointMember"),s,i,void 0,this)};t.prototype.writeMultiCurveOrLineString_=function(t,e,i){var r=i[i.length-1],o=r.hasZ,n=r.srsName,s=r.curve;n&&t.setAttribute("srsName",n);var a=e.getLineStrings();Yd({node:t,hasZ:o,srsName:n,curve:s},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)};t.prototype.writeRing_=function(t,e,i){var r=Ed(t.namespaceURI,"LinearRing");t.appendChild(r);this.writeLinearRing_(r,e,i)};t.prototype.writeSurfaceOrPolygonMember_=function(t,e,i){var r=this.GEOMETRY_NODE_FACTORY_(e,i);if(r){t.appendChild(r);this.writeSurfaceOrPolygon_(r,e,i)}};t.prototype.writePointMember_=function(t,e,i){var r=Ed(t.namespaceURI,"Point");t.appendChild(r);this.writePoint_(r,e,i)};t.prototype.writeLineStringOrCurveMember_=function(t,e,i){var r=this.GEOMETRY_NODE_FACTORY_(e,i);if(r){t.appendChild(r);this.writeCurveOrLineString_(r,e,i)}};t.prototype.writeSurfacePatches_=function(t,e,i){var r=Ed(t.namespaceURI,"PolygonPatch");t.appendChild(r);this.writeSurfaceOrPolygon_(r,e,i)};t.prototype.writeCurveSegments_=function(t,e,i){var r=Ed(t.namespaceURI,"LineStringSegment");t.appendChild(r);this.writeCurveOrLineString_(r,e,i)};t.prototype.writeGeometryElement=function(t,e,i){var r,o=i[i.length-1],n=T({},o);n.node=t;r=Array.isArray(e)?o.dataProjection?Le(e,o.featureProjection,o.dataProjection):e:ld(e,!0,o);Yd(n,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[r],i,void 0,this)};t.prototype.writeFeatureElement=function(t,e,i){var r=e.getId();r&&t.setAttribute("fid",r);var o=i[i.length-1],n=o.featureNS,s=e.getGeometryName();if(!o.serializers){o.serializers={};o.serializers[n]={}}var a=e.getProperties(),l=[],h=[];for(var u in a){var c=a[u];if(null!==c){l.push(u);h.push(c);u==s||c instanceof Xe?u in o.serializers[n]||(o.serializers[n][u]=Md(this.writeGeometryElement,this)):u in o.serializers[n]||(o.serializers[n][u]=Md(sf))}}var p=T({},o);p.node=t;Yd(p,o.serializers,Ad(void 0,n),h,i,l)};t.prototype.writeFeatureMembers_=function(t,e,i){var r=i[i.length-1],o=r.featureType,n=r.featureNS,s={};s[n]={};s[n][o]=Md(this.writeFeatureElement,this);var a=T({},r);a.node=t;Yd(a,s,Ad(o,n),e,i)};t.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(t,e,i){var r=e[e.length-1].node;return Ed("http://www.opengis.net/gml",lf[r.nodeName])};t.prototype.GEOMETRY_NODE_FACTORY_=function(t,e,i){var r,o=e[e.length-1],n=o.multiSurface,s=o.surface,a=o.curve,l=o.multiCurve;Array.isArray(t)?r="Envelope":"MultiPolygon"===(r=t.getType())&&!0===n?r="MultiSurface":"Polygon"===r&&!0===s?r="Surface":"LineString"===r&&!0===a?r="Curve":"MultiLineString"===r&&!0===l&&(r="MultiCurve");return Ed("http://www.opengis.net/gml",r)};t.prototype.writeGeometryNode=function(t,e){e=this.adaptOptions(e);var i=Ed("http://www.opengis.net/gml","geom"),r={node:i,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};e&&T(r,e);this.writeGeometryElement(i,t,[r]);return i};t.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var i=Ed("http://www.opengis.net/gml","featureMembers");i.setAttributeNS(md,"xsi:schemaLocation",this.schemaLocation);var r={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};e&&T(r,e);this.writeFeatureMembers_(i,t,[r]);return i};return t}(zd);hf.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_={"http://www.opengis.net/gml":{pos:Od(hf.prototype.readFlatPos_),posList:Od(hf.prototype.readFlatPosList_)}};hf.prototype.FLAT_LINEAR_RINGS_PARSERS_={"http://www.opengis.net/gml":{interior:hf.prototype.interiorParser_,exterior:hf.prototype.exteriorParser_}};hf.prototype.GEOMETRY_PARSERS_={"http://www.opengis.net/gml":{Point:Od(zd.prototype.readPoint),MultiPoint:Od(zd.prototype.readMultiPoint),LineString:Od(zd.prototype.readLineString),MultiLineString:Od(zd.prototype.readMultiLineString),LinearRing:Od(zd.prototype.readLinearRing),Polygon:Od(zd.prototype.readPolygon),MultiPolygon:Od(zd.prototype.readMultiPolygon),Surface:Od(hf.prototype.readSurface_),MultiSurface:Od(hf.prototype.readMultiSurface_),Curve:Od(hf.prototype.readCurve_),MultiCurve:Od(hf.prototype.readMultiCurve_),Envelope:Od(hf.prototype.readEnvelope_)}};hf.prototype.MULTICURVE_PARSERS_={"http://www.opengis.net/gml":{curveMember:Ld(hf.prototype.curveMemberParser_),curveMembers:Ld(hf.prototype.curveMemberParser_)}};hf.prototype.MULTISURFACE_PARSERS_={"http://www.opengis.net/gml":{surfaceMember:Ld(hf.prototype.surfaceMemberParser_),surfaceMembers:Ld(hf.prototype.surfaceMemberParser_)}};hf.prototype.CURVEMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:Ld(zd.prototype.readLineString),Curve:Ld(hf.prototype.readCurve_)}};hf.prototype.SURFACEMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:Ld(zd.prototype.readPolygon),Surface:Ld(hf.prototype.readSurface_)}};hf.prototype.SURFACE_PARSERS_={"http://www.opengis.net/gml":{patches:Od(hf.prototype.readPatch_)}};hf.prototype.CURVE_PARSERS_={"http://www.opengis.net/gml":{segments:Od(hf.prototype.readSegment_)}};hf.prototype.ENVELOPE_PARSERS_={"http://www.opengis.net/gml":{lowerCorner:Ld(hf.prototype.readFlatPosList_),upperCorner:Ld(hf.prototype.readFlatPosList_)}};hf.prototype.PATCHES_PARSERS_={"http://www.opengis.net/gml":{PolygonPatch:Od(hf.prototype.readPolygonPatch_)}};hf.prototype.SEGMENTS_PARSERS_={"http://www.opengis.net/gml":{LineStringSegment:Od(hf.prototype.readLineStringSegment_)}};hf.prototype.writeFeatures;hf.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{exterior:Md(hf.prototype.writeRing_),interior:Md(hf.prototype.writeRing_)}};hf.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:Md(sf),upperCorner:Md(sf)}};hf.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:Md(hf.prototype.writeSurfaceOrPolygonMember_),polygonMember:Md(hf.prototype.writeSurfaceOrPolygonMember_)}};hf.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:Md(hf.prototype.writePointMember_)}};hf.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:Md(hf.prototype.writeLineStringOrCurveMember_),curveMember:Md(hf.prototype.writeLineStringOrCurveMember_)}};hf.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:Md(hf.prototype.writeCurveOrLineString_),MultiCurve:Md(hf.prototype.writeMultiCurveOrLineString_),Point:Md(hf.prototype.writePoint_),MultiPoint:Md(hf.prototype.writeMultiPoint_),LineString:Md(hf.prototype.writeCurveOrLineString_),MultiLineString:Md(hf.prototype.writeMultiCurveOrLineString_),LinearRing:Md(hf.prototype.writeLinearRing_),Polygon:Md(hf.prototype.writeSurfaceOrPolygon_),MultiPolygon:Md(hf.prototype.writeMultiSurfaceOrPolygon_),Surface:Md(hf.prototype.writeSurfaceOrPolygon_),MultiSurface:Md(hf.prototype.writeMultiSurfaceOrPolygon_),Envelope:Md(hf.prototype.writeEnvelope)}};var uf=hf;uf.prototype.writeFeatures;uf.prototype.writeFeaturesNode;var cf=Vd+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",pf={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},df=function(i){function t(t){var e=t||{};i.call(this,e);this.FEATURE_COLLECTION_PARSERS[Vd].featureMember=Ld(this.readFeaturesInternal);this.schemaLocation=e.schemaLocation?e.schemaLocation:cf}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFlatCoordinates_=function(t,e){var i=xd(t,!1).replace(/^\s*|\s*$/g,""),r=e[0].srsName,o="enu";if(r){var n=ye(r);n&&(o=n.getAxisOrientation())}for(var s=i.trim().split(/\s+/),a=[],l=0,h=s.length;l<h;l++){var u=s[l].split(/,+/),c=parseFloat(u[0]),p=parseFloat(u[1]),d=3===u.length?parseFloat(u[2]):0;"en"===o.substr(0,2)?a.push(c,p,d):a.push(p,c,d)}return a};t.prototype.readBox_=function(t,e){var i=jd([null],this.BOX_PARSERS_,t,e,this);return z(i[1][0],i[1][1],i[1][3],i[1][4])};t.prototype.innerBoundaryIsParser_=function(t,e){var i=jd(void 0,this.RING_PARSERS,t,e,this);if(i){e[e.length-1].push(i)}};t.prototype.outerBoundaryIsParser_=function(t,e){var i=jd(void 0,this.RING_PARSERS,t,e,this);if(i){e[e.length-1][0]=i}};t.prototype.GEOMETRY_NODE_FACTORY_=function(t,e,i){var r,o=e[e.length-1],n=o.multiSurface,s=o.surface,a=o.multiCurve;Array.isArray(t)?r="Envelope":"MultiPolygon"===(r=t.getType())&&!0===n?r="MultiSurface":"Polygon"===r&&!0===s?r="Surface":"MultiLineString"===r&&!0===a&&(r="MultiCurve");return Ed("http://www.opengis.net/gml",r)};t.prototype.writeFeatureElement=function(t,e,i){var r=e.getId();r&&t.setAttribute("fid",r);var o=i[i.length-1],n=o.featureNS,s=e.getGeometryName();if(!o.serializers){o.serializers={};o.serializers[n]={}}var a=e.getProperties(),l=[],h=[];for(var u in a){var c=a[u];if(null!==c){l.push(u);h.push(c);u==s||c instanceof Xe?u in o.serializers[n]||(o.serializers[n][u]=Md(this.writeGeometryElement,this)):u in o.serializers[n]||(o.serializers[n][u]=Md(sf))}}var p=T({},o);p.node=t;Yd(p,o.serializers,Ad(void 0,n),h,i,l)};t.prototype.writeCurveOrLineString_=function(t,e,i){var r=i[i.length-1].srsName;"LineStringSegment"!==t.nodeName&&r&&t.setAttribute("srsName",r);if("LineString"===t.nodeName||"LineStringSegment"===t.nodeName){var o=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(o);this.writeCoordinates_(o,e,i)}else if("Curve"===t.nodeName){var n=Ed(t.namespaceURI,"segments");t.appendChild(n);this.writeCurveSegments_(n,e,i)}};t.prototype.writeLineStringOrCurveMember_=function(t,e,i){var r=this.GEOMETRY_NODE_FACTORY_(e,i);if(r){t.appendChild(r);this.writeCurveOrLineString_(r,e,i)}};t.prototype.writeMultiCurveOrLineString_=function(t,e,i){var r=i[i.length-1],o=r.hasZ,n=r.srsName,s=r.curve;n&&t.setAttribute("srsName",n);var a=e.getLineStrings();Yd({node:t,hasZ:o,srsName:n,curve:s},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)};t.prototype.writeGeometryElement=function(t,e,i){var r,o=i[i.length-1],n=T({},o);n.node=t;r=Array.isArray(e)?o.dataProjection?Le(e,o.featureProjection,o.dataProjection):e:ld(e,!0,o);Yd(n,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[r],i,void 0,this)};t.prototype.createCoordinatesNode_=function(t){var e=Ed(t,"coordinates");e.setAttribute("decimal",".");e.setAttribute("cs",",");e.setAttribute("ts"," ");return e};t.prototype.writeCoordinates_=function(t,e,i){for(var r=i[i.length-1],o=r.hasZ,n=r.srsName,s=e.getCoordinates(),a=s.length,l=new Array(a),h=0;h<a;++h){var u=s[h];l[h]=this.getCoords_(u,n,o)}sf(t,l.join(" "))};t.prototype.writeCurveSegments_=function(t,e,i){var r=Ed(t.namespaceURI,"LineStringSegment");t.appendChild(r);this.writeCurveOrLineString_(r,e,i)};t.prototype.writeSurfaceOrPolygon_=function(t,e,i){var r=i[i.length-1],o=r.hasZ,n=r.srsName;"PolygonPatch"!==t.nodeName&&n&&t.setAttribute("srsName",n);if("Polygon"===t.nodeName||"PolygonPatch"===t.nodeName){var s=e.getLinearRings();Yd({node:t,hasZ:o,srsName:n},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,s,i,void 0,this)}else if("Surface"===t.nodeName){var a=Ed(t.namespaceURI,"patches");t.appendChild(a);this.writeSurfacePatches_(a,e,i)}};t.prototype.RING_NODE_FACTORY_=function(t,e,i){var r=e[e.length-1],o=r.node,n=r.exteriorWritten;void 0===n&&(r.exteriorWritten=!0);return Ed(o.namespaceURI,void 0!==n?"innerBoundaryIs":"outerBoundaryIs")};t.prototype.writeSurfacePatches_=function(t,e,i){var r=Ed(t.namespaceURI,"PolygonPatch");t.appendChild(r);this.writeSurfaceOrPolygon_(r,e,i)};t.prototype.writeRing_=function(t,e,i){var r=Ed(t.namespaceURI,"LinearRing");t.appendChild(r);this.writeLinearRing_(r,e,i)};t.prototype.getCoords_=function(t,e,i){var r="enu";e&&(r=ye(e).getAxisOrientation());var o="en"===r.substr(0,2)?t[0]+","+t[1]:t[1]+","+t[0];if(i){o+=","+(t[2]||0)}return o};t.prototype.writePoint_=function(t,e,i){var r=i[i.length-1],o=r.hasZ,n=r.srsName;n&&t.setAttribute("srsName",n);var s=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(s);var a=e.getCoordinates();sf(s,this.getCoords_(a,n,o))};t.prototype.writeMultiPoint_=function(t,e,i){var r=i[i.length-1],o=r.hasZ,n=r.srsName;n&&t.setAttribute("srsName",n);var s=e.getPoints();Yd({node:t,hasZ:o,srsName:n},this.POINTMEMBER_SERIALIZERS_,Ad("pointMember"),s,i,void 0,this)};t.prototype.writePointMember_=function(t,e,i){var r=Ed(t.namespaceURI,"Point");t.appendChild(r);this.writePoint_(r,e,i)};t.prototype.writeLinearRing_=function(t,e,i){var r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);var o=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(o);this.writeCoordinates_(o,e,i)};t.prototype.writeMultiSurfaceOrPolygon_=function(t,e,i){var r=i[i.length-1],o=r.hasZ,n=r.srsName,s=r.surface;n&&t.setAttribute("srsName",n);var a=e.getPolygons();Yd({node:t,hasZ:o,srsName:n,surface:s},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)};t.prototype.writeSurfaceOrPolygonMember_=function(t,e,i){var r=this.GEOMETRY_NODE_FACTORY_(e,i);if(r){t.appendChild(r);this.writeSurfaceOrPolygon_(r,e,i)}};t.prototype.writeEnvelope=function(t,e,i){var r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);var o=[e[0]+" "+e[1],e[2]+" "+e[3]];Yd({node:t},this.ENVELOPE_SERIALIZERS_,Nd,o,i,["lowerCorner","upperCorner"],this)};t.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(t,e,i){var r=e[e.length-1].node;return Ed("http://www.opengis.net/gml",pf[r.nodeName])};return t}(zd);df.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_={"http://www.opengis.net/gml":{coordinates:Od(df.prototype.readFlatCoordinates_)}};df.prototype.FLAT_LINEAR_RINGS_PARSERS_={"http://www.opengis.net/gml":{innerBoundaryIs:df.prototype.innerBoundaryIsParser_,outerBoundaryIs:df.prototype.outerBoundaryIsParser_}};df.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:Ld(df.prototype.readFlatCoordinates_)}};df.prototype.GEOMETRY_PARSERS_={"http://www.opengis.net/gml":{Point:Od(zd.prototype.readPoint),MultiPoint:Od(zd.prototype.readMultiPoint),LineString:Od(zd.prototype.readLineString),MultiLineString:Od(zd.prototype.readMultiLineString),LinearRing:Od(zd.prototype.readLinearRing),Polygon:Od(zd.prototype.readPolygon),MultiPolygon:Od(zd.prototype.readMultiPolygon),Box:Od(df.prototype.readBox_)}};df.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:Md(df.prototype.writeCurveOrLineString_),MultiCurve:Md(df.prototype.writeMultiCurveOrLineString_),Point:Md(df.prototype.writePoint_),MultiPoint:Md(df.prototype.writeMultiPoint_),LineString:Md(df.prototype.writeCurveOrLineString_),MultiLineString:Md(df.prototype.writeMultiCurveOrLineString_),LinearRing:Md(df.prototype.writeLinearRing_),Polygon:Md(df.prototype.writeSurfaceOrPolygon_),MultiPolygon:Md(df.prototype.writeMultiSurfaceOrPolygon_),Surface:Md(df.prototype.writeSurfaceOrPolygon_),MultiSurface:Md(df.prototype.writeMultiSurfaceOrPolygon_),Envelope:Md(df.prototype.writeEnvelope)}};df.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:Md(df.prototype.writeLineStringOrCurveMember_),curveMember:Md(df.prototype.writeLineStringOrCurveMember_)}};df.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{outerBoundaryIs:Md(df.prototype.writeRing_),innerBoundaryIs:Md(df.prototype.writeRing_)}};df.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:Md(df.prototype.writePointMember_)}};df.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:Md(df.prototype.writeSurfaceOrPolygonMember_),polygonMember:Md(df.prototype.writeSurfaceOrPolygonMember_)}};df.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:Md(sf),upperCorner:Md(sf)}};var ff=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],_f={rte:Vf,trk:Xf,wpt:zf},gf=Gd(ff,{rte:Ld(Vf),trk:Ld(Xf),wpt:Ld(zf)}),yf=Gd(ff,{text:bd($d,"linkText"),type:bd($d,"linkType")}),vf=Gd(ff,{rte:Md(function(t,e,i){var r=i[0],o=e.getProperties(),n={node:t,properties:o},s=e.getGeometry();if(s){s=ld(s,!0,r);n.geometryLayout=s.getLayout();o.rtept=s.getCoordinates()}var a=i[i.length-1].node,l=Lf[a.namespaceURI],h=Dd(o,l);Yd(n,Of,Nd,h,i,l)}),trk:Md(function(t,e,i){var r=i[0],o=e.getProperties(),n={node:t,properties:o},s=e.getGeometry();if(s){s=ld(s,!0,r);o.trkseg=s.getLineStrings()}var a=i[i.length-1].node,l=bf[a.namespaceURI],h=Dd(o,l);Yd(n,Mf,Nd,h,i,l)}),wpt:Md(function(t,e,i){var r=i[0],o=i[i.length-1];o.properties=e.getProperties();var n=e.getGeometry();if(n){n=ld(n,!0,r);o.geometryLayout=n.getLayout();Hf(t,n.getCoordinates(),i)}})}),mf=function(i){function t(t){i.call(this);var e=t||{};this.dataProjection=ye("EPSG:4326");this.readExtensions_=e.readExtensions}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.handleReadExtensions_=function(t){t||(t=[]);for(var e=0,i=t.length;e<i;++e){var r=t[e];if(this.readExtensions_){var o=r.get("extensionsNode_")||null;this.readExtensions_(r,o)}r.set("extensionsNode_",void 0)}};t.prototype.readFeatureFromNode=function(t,e){if(!Lr(ff,t.namespaceURI))return null;var i=_f[t.localName];if(!i)return null;var r=i(t,[this.getReadOptions(t,e)]);if(!r)return null;this.handleReadExtensions_([r]);return r};t.prototype.readFeaturesFromNode=function(t,e){if(!Lr(ff,t.namespaceURI))return[];if("gpx"!=t.localName)return[];var i=jd([],gf,t,[this.getReadOptions(t,e)]);if(i){this.handleReadExtensions_(i);return i}return[]};t.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var i=Ed("http://www.topografix.com/GPX/1/1","gpx");i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",md);i.setAttributeNS(md,"xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd");i.setAttribute("version","1.1");i.setAttribute("creator","OpenLayers");Yd({node:i},vf,kf,t,[e]);return i};return t}(Bd),Ef=Gd(ff,{name:bd($d),cmt:bd($d),desc:bd($d),src:bd($d),link:Yf,number:bd(Jd),extensions:Bf,type:bd($d),rtept:function(t,e){var i=jd({},xf,t,e);if(i){var r=e[e.length-1],o=r.flatCoordinates,n=r.layoutOptions;jf(o,n,t,i)}}}),xf=Gd(ff,{ele:bd(Zd),time:bd(Kd)}),Tf=Gd(ff,{name:bd($d),cmt:bd($d),desc:bd($d),src:bd($d),link:Yf,number:bd(Jd),type:bd($d),extensions:Bf,trkseg:function(t,e){var i=e[e.length-1];kd(Sf,t,e);var r=i.flatCoordinates;i.ends.push(r.length)}}),Sf=Gd(ff,{trkpt:function(t,e){var i=jd({},Cf,t,e);if(i){var r=e[e.length-1],o=r.flatCoordinates,n=r.layoutOptions;jf(o,n,t,i)}}}),Cf=Gd(ff,{ele:bd(Zd),time:bd(Kd)}),Rf=Gd(ff,{ele:bd(Zd),time:bd(Kd),magvar:bd(Zd),geoidheight:bd(Zd),name:bd($d),cmt:bd($d),desc:bd($d),src:bd($d),link:Yf,sym:bd($d),type:bd($d),fix:bd($d),sat:bd(Jd),hdop:bd(Zd),vdop:bd(Zd),pdop:bd(Zd),ageofdgpsdata:bd(Zd),dgpsid:bd(Jd),extensions:Bf}),If=["text","type"],wf=Gd(ff,{text:Md(sf),type:Md(sf)}),Lf=Gd(ff,["name","cmt","desc","src","link","number","type","rtept"]),Of=Gd(ff,{name:Md(sf),cmt:Md(sf),desc:Md(sf),src:Md(sf),link:Md(Wf),number:Md(nf),type:Md(sf),rtept:Fd(Md(Hf))}),Pf=Gd(ff,["ele","time"]),bf=Gd(ff,["name","cmt","desc","src","link","number","type","trkseg"]),Mf=Gd(ff,{name:Md(sf),cmt:Md(sf),desc:Md(sf),src:Md(sf),link:Md(Wf),number:Md(nf),type:Md(sf),trkseg:Fd(Md(function(t,e,i){Yd({node:t,geometryLayout:e.getLayout(),properties:{}},Af,Ff,e.getCoordinates(),i)}))}),Ff=Ad("trkpt"),Af=Gd(ff,{trkpt:Md(Hf)}),Nf=Gd(ff,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Df=Gd(ff,{ele:Md(of),time:Md(rf),magvar:Md(of),geoidheight:Md(of),name:Md(sf),cmt:Md(sf),desc:Md(sf),src:Md(sf),link:Md(Wf),sym:Md(sf),type:Md(sf),fix:Md(sf),sat:Md(nf),hdop:Md(of),vdop:Md(of),pdop:Md(of),ageofdgpsdata:Md(of),dgpsid:Md(nf)}),Gf={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function kf(t,e,i){var r=t.getGeometry();if(r){var o=Gf[r.getType()];if(o){return Ed(e[e.length-1].node.namespaceURI,o)}}}function jf(t,e,i,r){t.push(parseFloat(i.getAttribute("lon")),parseFloat(i.getAttribute("lat")));if("ele"in r){t.push(r.ele);delete r.ele;e.hasZ=!0}else t.push(0);if("time"in r){t.push(r.time);delete r.time;e.hasM=!0}else t.push(0);return t}function Uf(t,e,i){var r=kr.XY,o=2;if(t.hasZ&&t.hasM){r=kr.XYZM;o=4}else if(t.hasZ){r=kr.XYZ;o=3}else if(t.hasM){r=kr.XYM;o=3}if(4!==o){for(var n=0,s=e.length/4;n<s;n++){e[n*o]=e[4*n];e[n*o+1]=e[4*n+1];t.hasZ&&(e[n*o+2]=e[4*n+2]);t.hasM&&(e[n*o+2]=e[4*n+3])}e.length=e.length/4*o;if(i)for(var a=0,l=i.length;a<l;a++)i[a]=i[a]/4*o}return r}function Yf(t,e){var i=e[e.length-1],r=t.getAttribute("href");null!==r&&(i.link=r);kd(yf,t,e)}function Bf(t,e){e[e.length-1].extensionsNode_=t}function Vf(t,e){var i=e[0],r=jd({flatCoordinates:[],layoutOptions:{}},Ef,t,e);if(r){var o=r.flatCoordinates;delete r.flatCoordinates;var n=r.layoutOptions;delete r.layoutOptions;var s=Uf(n,o),a=new on(o,s);ld(a,!1,i);var l=new Sr(a);l.setProperties(r);return l}}function Xf(t,e){var i=e[0],r=jd({flatCoordinates:[],ends:[],layoutOptions:{}},Tf,t,e);if(r){var o=r.flatCoordinates;delete r.flatCoordinates;var n=r.ends;delete r.ends;var s=r.layoutOptions;delete r.layoutOptions;var a=Uf(s,o,n),l=new Il(o,a,n);ld(l,!1,i);var h=new Sr(l);h.setProperties(r);return h}}function zf(t,e){var i=e[0],r=jd({},Rf,t,e);if(r){var o={},n=jf([],o,t,r),s=Uf(o,n),a=new fo(n,s);ld(a,!1,i);var l=new Sr(a);l.setProperties(r);return l}}function Wf(t,e,i){t.setAttribute("href",e);var r=i[i.length-1].properties,o=[r.linkText,r.linkType];Yd({node:t},wf,Nd,o,i,If)}function Hf(t,e,i){var r=i[i.length-1],o=r.node.namespaceURI,n=r.properties;t.setAttributeNS(null,"lat",e[1]);t.setAttributeNS(null,"lon",e[0]);switch(r.geometryLayout){case kr.XYZM:0!==e[3]&&(n.time=e[3]);case kr.XYZ:0!==e[2]&&(n.ele=e[2]);break;case kr.XYM:0!==e[2]&&(n.time=e[2])}var s="rtept"==t.nodeName?Pf[o]:Nf[o],a=Dd(n,s);Yd({node:t,properties:n},Df,Nd,a,i,s)}var Kf=function(e){function u(t){e.call(this);this.geometries_=t||null;this.listenGeometriesChange_()}e&&(u.__proto__=e);((u.prototype=Object.create(e&&e.prototype)).constructor=u).prototype.unlistenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)d(this.geometries_[t],R.CHANGE,this.changed,this)};u.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)S(this.geometries_[t],R.CHANGE,this.changed,this)};u.prototype.clone=function(){var t=new u(null);t.setGeometries(this.geometries_);return t};u.prototype.closestPointXY=function(t,e,i,r){if(r<U(this.getExtent(),t,e))return r;for(var o=this.geometries_,n=0,s=o.length;n<s;++n)r=o[n].closestPointXY(t,e,i,r);return r};u.prototype.containsXY=function(t,e){for(var i=this.geometries_,r=0,o=i.length;r<o;++r)if(i[r].containsXY(t,e))return!0;return!1};u.prototype.computeExtent=function(t){W(t);for(var e=this.geometries_,i=0,r=e.length;i<r;++i)q(t,e[i].getExtent());return t};u.prototype.getGeometries=function(){return Zf(this.geometries_)};u.prototype.getGeometriesArray=function(){return this.geometries_};u.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()){_(this.simplifiedGeometryCache);this.simplifiedGeometryMaxMinSquaredTolerance=0;this.simplifiedGeometryRevision=this.getRevision()}if(t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(e))return this.simplifiedGeometryCache[e];for(var i=[],r=this.geometries_,o=!1,n=0,s=r.length;n<s;++n){var a=r[n],l=a.getSimplifiedGeometry(t);i.push(l);l!==a&&(o=!0)}if(o){var h=new u(null);h.setGeometriesArray(i);return this.simplifiedGeometryCache[e]=h}this.simplifiedGeometryMaxMinSquaredTolerance=t;return this};u.prototype.getType=function(){return kt.GEOMETRY_COLLECTION};u.prototype.intersectsExtent=function(t){for(var e=this.geometries_,i=0,r=e.length;i<r;++i)if(e[i].intersectsExtent(t))return!0;return!1};u.prototype.isEmpty=function(){return 0===this.geometries_.length};u.prototype.rotate=function(t,e){for(var i=this.geometries_,r=0,o=i.length;r<o;++r)i[r].rotate(t,e);this.changed()};u.prototype.scale=function(t,e,i){var r=i;r||(r=lt(this.getExtent()));for(var o=this.geometries_,n=0,s=o.length;n<s;++n)o[n].scale(t,e,r);this.changed()};u.prototype.setGeometries=function(t){this.setGeometriesArray(Zf(t))};u.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_();this.geometries_=t;this.listenGeometriesChange_();this.changed()};u.prototype.applyTransform=function(t){for(var e=this.geometries_,i=0,r=e.length;i<r;++i)e[i].applyTransform(t);this.changed()};u.prototype.translate=function(t,e){for(var i=this.geometries_,r=0,o=i.length;r<o;++r)i[r].translate(t,e);this.changed()};u.prototype.disposeInternal=function(){this.unlistenGeometriesChange_();e.prototype.disposeInternal.call(this)};return u}(Xe);function Zf(t){for(var e=[],i=0,r=t.length;i<r;++i)e.push(t[i].clone());return e}var qf=function(i){function t(t){var e=t||{};i.call(this);this.dataProjection=ye(e.dataProjection?e.dataProjection:"EPSG:4326");e.featureProjection&&(this.defaultFeatureProjection=ye(e.featureProjection));this.geometryName_=e.geometryName;this.extractGeometryName_=e.extractGeometryName}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeatureFromObject=function(t,e){var i=null,r=Jf((i="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry,e),o=new Sr;this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&o.setGeometryName(i.geometry_name);o.setGeometry(r);"id"in i&&o.setId(i.id);i.properties&&o.setProperties(i.properties);return o};t.prototype.readFeaturesFromObject=function(t,e){var i=null;if("FeatureCollection"===t.type){i=[];for(var r=t.features,o=0,n=r.length;o<n;++o)i.push(this.readFeatureFromObject(r[o],e))}else i=[this.readFeatureFromObject(t,e)];return i};t.prototype.readGeometryFromObject=function(t,e){return Jf(t,e)};t.prototype.readProjectionFromObject=function(t){var e,i=t.crs;i?"name"==i.type?e=ye(i.properties.name):A(!1,36):e=this.dataProjection;return e};t.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var i={type:"Feature",geometry:null,properties:null},r=t.getId();void 0!==r&&(i.id=r);var o=t.getGeometry();o&&(i.geometry=Qf(o,e));var n=t.getProperties();delete n[t.getGeometryName()];Ct(n)||(i.properties=n);return i};t.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var i=[],r=0,o=t.length;r<o;++r)i.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:i}};t.prototype.writeGeometryObject=function(t,e){return Qf(t,this.adaptOptions(e))};return t}(hd);function Jf(t,e){if(!t)return null;var i,r,o;switch(t.type){case kt.POINT:i=new fo(t.coordinates);break;case kt.LINE_STRING:i=new on(t.coordinates);break;case kt.POLYGON:i=new Fo(t.coordinates);break;case kt.MULTI_POINT:i=new wl(t.coordinates);break;case kt.MULTI_LINE_STRING:i=new Il(t.coordinates);break;case kt.MULTI_POLYGON:i=new Ol(t.coordinates);break;case kt.GEOMETRY_COLLECTION:i=(o=t.geometries.map(function(t){return Jf(t,r)}),new Kf(o));break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return ld(i,!1,e)}function Qf(t,e){var i,r,o=(t=ld(t,!0,e)).getType();switch(o){case kt.POINT:i={type:"Point",coordinates:t.getCoordinates()};break;case kt.LINE_STRING:i={type:"LineString",coordinates:t.getCoordinates()};break;case kt.POLYGON:i=function(t,e){var i;e&&(i=e.rightHanded);return{type:"Polygon",coordinates:t.getCoordinates(i)}}(t,e);break;case kt.MULTI_POINT:i={type:"MultiPoint",coordinates:t.getCoordinates()};break;case kt.MULTI_LINE_STRING:i={type:"MultiLineString",coordinates:t.getCoordinates()};break;case kt.MULTI_POLYGON:i=function(t,e){var i;e&&(i=e.rightHanded);return{type:"MultiPolygon",coordinates:t.getCoordinates(i)}}(t,e);break;case kt.GEOMETRY_COLLECTION:i=(r=e,{type:"GeometryCollection",geometries:t.getGeometriesArray().map(function(t){var e=T({},r);delete e.featureProjection;return Qf(t,e)})});break;case kt.CIRCLE:i={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+o)}return i}var $f=function(t){function e(){t.call(this)}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getType=function(){return Fl.TEXT};e.prototype.readFeature=function(t,e){return this.readFeatureFromText(t_(t),this.adaptOptions(e))};e.prototype.readFeatureFromText=function(t,e){};e.prototype.readFeatures=function(t,e){return this.readFeaturesFromText(t_(t),this.adaptOptions(e))};e.prototype.readFeaturesFromText=function(t,e){};e.prototype.readGeometry=function(t,e){return this.readGeometryFromText(t_(t),this.adaptOptions(e))};e.prototype.readGeometryFromText=function(t,e){};e.prototype.readProjection=function(t){return this.readProjectionFromText(t_(t))};e.prototype.readProjectionFromText=function(t){return this.dataProjection};e.prototype.writeFeature=function(t,e){return this.writeFeatureText(t,this.adaptOptions(e))};e.prototype.writeFeatureText=function(t,e){};e.prototype.writeFeatures=function(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))};e.prototype.writeFeaturesText=function(t,e){};e.prototype.writeGeometry=function(t,e){return this.writeGeometryText(t,this.adaptOptions(e))};e.prototype.writeGeometryText=function(t,e){};return e}(ad);function t_(t){return"string"==typeof t?t:""}var e_="barometric",i_="gps",r_="none",o_=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,n_=/^H.([A-Z]{3}).*?:(.*)/,s_=/^HFDTE(\d{2})(\d{2})(\d{2})/,a_=/\r\n|\r|\n/,l_=function(i){function t(t){i.call(this);var e=t||{};this.dataProjection=ye("EPSG:4326");this.altitudeMode_=e.altitudeMode?e.altitudeMode:r_}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeatureFromText=function(t,e){var i,r,o=this.altitudeMode_,n=t.split(a_),s={},a=[],l=2e3,h=0,u=1,c=-1;for(i=0,r=n.length;i<r;++i){var p=n[i],d=void 0;if("B"==p.charAt(0)){if(d=o_.exec(p)){var f=parseInt(d[1],10),_=parseInt(d[2],10),g=parseInt(d[3],10),y=parseInt(d[4],10)+parseInt(d[5],10)/6e4;"S"==d[6]&&(y=-y);var v=parseInt(d[7],10)+parseInt(d[8],10)/6e4;"W"==d[9]&&(v=-v);a.push(v,y);if(o!=r_){var m=void 0;m=o==i_?parseInt(d[11],10):o==e_?parseInt(d[12],10):0;a.push(m)}var E=Date.UTC(l,h,u,f,_,g);E<c&&(E=Date.UTC(l,h,u+1,f,_,g));a.push(E/1e3);c=E}}else if("H"==p.charAt(0))if(d=s_.exec(p)){u=parseInt(d[1],10);h=parseInt(d[2],10)-1;l=2e3+parseInt(d[3],10)}else(d=n_.exec(p))&&(s[d[1]]=d[2].trim())}if(0===a.length)return null;var x=o==r_?kr.XYM:kr.XYZM,T=new on(a,x),S=new Sr(ld(T,!1,e));S.setProperties(s);return S};t.prototype.readFeaturesFromText=function(t,e){var i=this.readFeatureFromText(t,e);return i?[i]:[]};return t}($f),h_={FRACTION:"fraction",PIXELS:"pixels"},u_=function(s){function t(t,e,i,r,o,n){s.call(this);this.hitDetectionImage_=null;this.image_=t||new Image;null!==r&&this.image_ instanceof HTMLImageElement&&(this.image_.crossOrigin=r);this.canvas_=n?document.createElement("canvas"):null;this.color_=n;this.imageListenerKeys_=null;this.imageState_=o;this.size_=i;this.src_=e;this.tainted_}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===Ni.LOADED){this.tainted_=!1;var t=ii(1,1);try{t.drawImage(this.image_,0,0);t.getImageData(0,0,1,1)}catch(t){this.tainted_=!0}}return!0===this.tainted_};t.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(R.CHANGE)};t.prototype.handleImageError_=function(){this.imageState_=Ni.ERROR;this.unlistenImage_();this.dispatchChangeEvent_()};t.prototype.handleImageLoad_=function(){this.imageState_=Ni.LOADED;if(this.size_){this.image_.width=this.size_[0];this.image_.height=this.size_[1]}this.size_=[this.image_.width,this.image_.height];this.unlistenImage_();this.replaceColor_();this.dispatchChangeEvent_()};t.prototype.getImage=function(t){return this.canvas_?this.canvas_:this.image_};t.prototype.getImageState=function(){return this.imageState_};t.prototype.getHitDetectionImage=function(t){if(!this.hitDetectionImage_)if(this.isTainted_()){var e=this.size_[0],i=this.size_[1],r=ii(e,i);r.fillRect(0,0,e,i);this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_};t.prototype.getSize=function(){return this.size_};t.prototype.getSrc=function(){return this.src_};t.prototype.load=function(){if(this.imageState_==Ni.IDLE){this.imageState_=Ni.LOADING;this.imageListenerKeys_=[n(this.image_,R.ERROR,this.handleImageError_,this),n(this.image_,R.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(t){this.handleImageError_()}}};t.prototype.replaceColor_=function(){if(this.color_&&!this.isTainted_()){this.canvas_.width=this.image_.width;this.canvas_.height=this.image_.height;var t=this.canvas_.getContext("2d");t.drawImage(this.image_,0,0);for(var e=t.getImageData(0,0,this.image_.width,this.image_.height),i=e.data,r=this.color_[0]/255,o=this.color_[1]/255,n=this.color_[2]/255,s=0,a=i.length;s<a;s+=4){i[s]*=r;i[s+1]*=o;i[s+2]*=n}t.putImageData(e,0,0)}};t.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(g);this.imageListenerKeys_=null};return t}(x);function c_(t,e,i,r,o,n){var s=tu.get(e,r,n);if(!s){s=new u_(t,e,i,r,o,n);tu.set(e,r,n,s)}return s}var p_,d_,f_,__,g_,y_,v_,m_={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},E_=function(u){function t(t){var e=t||{},i=void 0!==e.opacity?e.opacity:1,r=void 0!==e.rotation?e.rotation:0,o=void 0!==e.scale?e.scale:1,n=void 0!==e.rotateWithView&&e.rotateWithView;u.call(this,{opacity:i,rotation:r,scale:o,rotateWithView:n});this.anchor_=void 0!==e.anchor?e.anchor:[.5,.5];this.normalizedAnchor_=null;this.anchorOrigin_=void 0!==e.anchorOrigin?e.anchorOrigin:m_.TOP_LEFT;this.anchorXUnits_=void 0!==e.anchorXUnits?e.anchorXUnits:h_.FRACTION;this.anchorYUnits_=void 0!==e.anchorYUnits?e.anchorYUnits:h_.FRACTION;this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;var s=void 0!==e.img?e.img:null,a=void 0!==e.imgSize?e.imgSize:null,l=e.src;A(!(void 0!==l&&s),4);A(!s||s&&a,5);void 0!==l&&0!==l.length||!s||(l=s instanceof HTMLImageElement&&s.src||St(s).toString());A(void 0!==l&&0<l.length,6);var h=void 0!==e.src?Ni.IDLE:Ni.LOADED;this.color_=void 0!==e.color?Je(e.color):null;this.iconImage_=c_(s,l,a,this.crossOrigin_,h,this.color_);this.offset_=void 0!==e.offset?e.offset:[0,0];this.offsetOrigin_=void 0!==e.offsetOrigin?e.offsetOrigin:m_.TOP_LEFT;this.origin_=null;this.size_=void 0!==e.size?e.size:null}u&&(t.__proto__=u);((t.prototype=Object.create(u&&u.prototype)).constructor=t).prototype.clone=function(){return new t({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})};t.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,e=this.getSize();if(this.anchorXUnits_==h_.FRACTION||this.anchorYUnits_==h_.FRACTION){if(!e)return null;t=this.anchor_.slice();this.anchorXUnits_==h_.FRACTION&&(t[0]*=e[0]);this.anchorYUnits_==h_.FRACTION&&(t[1]*=e[1])}if(this.anchorOrigin_!=m_.TOP_LEFT){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice());this.anchorOrigin_!=m_.TOP_RIGHT&&this.anchorOrigin_!=m_.BOTTOM_RIGHT||(t[0]=-t[0]+e[0]);this.anchorOrigin_!=m_.BOTTOM_LEFT&&this.anchorOrigin_!=m_.BOTTOM_RIGHT||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t;return this.normalizedAnchor_};t.prototype.setAnchor=function(t){this.anchor_=t;this.normalizedAnchor_=null};t.prototype.getColor=function(){return this.color_};t.prototype.getImage=function(t){return this.iconImage_.getImage(t)};t.prototype.getImageSize=function(){return this.iconImage_.getSize()};t.prototype.getHitDetectionImageSize=function(){return this.getImageSize()};t.prototype.getImageState=function(){return this.iconImage_.getImageState()};t.prototype.getHitDetectionImage=function(t){return this.iconImage_.getHitDetectionImage(t)};t.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=m_.TOP_LEFT){var e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice();this.offsetOrigin_!=m_.TOP_RIGHT&&this.offsetOrigin_!=m_.BOTTOM_RIGHT||(t[0]=i[0]-e[0]-t[0]);this.offsetOrigin_!=m_.BOTTOM_LEFT&&this.offsetOrigin_!=m_.BOTTOM_RIGHT||(t[1]=i[1]-e[1]-t[1])}this.origin_=t;return this.origin_};t.prototype.getSrc=function(){return this.iconImage_.getSrc()};t.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()};t.prototype.listenImageChange=function(t,e){return S(this.iconImage_,R.CHANGE,t,e)};t.prototype.load=function(){this.iconImage_.load()};t.prototype.unlistenImageChange=function(t,e){d(this.iconImage_,R.CHANGE,t,e)};return t}(pr),x_=["http://www.google.com/kml/ext/2.2"],T_=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],S_={fraction:h_.FRACTION,pixels:h_.PIXELS,insetPixels:h_.PIXELS},C_=Gd(T_,{ExtendedData:yg,Region:vg,MultiGeometry:bd(lg,"geometry"),LineString:bd(ng,"geometry"),LinearRing:bd(sg,"geometry"),Point:bd(hg,"geometry"),Polygon:bd(cg,"geometry"),Style:bd(dg),StyleMap:function(t,e){var i=z_(t,e);if(!i)return;var r=e[e.length-1];Array.isArray(i)?r.Style=i:"string"==typeof i?r.styleUrl=i:A(!1,38)},address:bd($d),description:bd($d),name:bd($d),open:bd(Wd),phoneNumber:bd($d),styleUrl:bd(B_),visibility:bd(Wd)},Gd(x_,{MultiTrack:bd(function(t,e){var i=jd([],Q_,t,e);return i?new Il(i):void 0},"geometry"),Track:bd(tg,"geometry")})),R_=Gd(T_,{ExtendedData:yg,Region:vg,Link:function(t,e){kd(I_,t,e)},address:bd($d),description:bd($d),name:bd($d),open:bd(Wd),phoneNumber:bd($d),visibility:bd(Wd)}),I_=Gd(T_,{href:bd(B_)}),w_=Gd(T_,{LatLonAltBox:function(t,e){var i=jd({},xg,t,e);if(!i)return;var r=e[e.length-1],o=[parseFloat(i.west),parseFloat(i.south),parseFloat(i.east),parseFloat(i.north)];r.extent=o;r.altitudeMode=i.altitudeMode;r.minAltitude=parseFloat(i.minAltitude);r.maxAltitude=parseFloat(i.maxAltitude)},Lod:function(t,e){var i=jd({},Tg,t,e);if(!i)return;var r=e[e.length-1];r.minLodPixels=parseFloat(i.minLodPixels);r.maxLodPixels=parseFloat(i.maxLodPixels);r.minFadeExtent=parseFloat(i.minFadeExtent);r.maxFadeExtent=parseFloat(i.maxFadeExtent)}}),L_=Gd(T_,["Document","Placemark"]),O_=Gd(T_,{Document:Md(function(t,e,i){Yd({node:t},wg,Lg,e,i,void 0,this)}),Placemark:Md(Qg)}),P_=null;var b_,M_=null;var F_,A_=null;var N_=null;var D_=null;var G_=null;var k_=function(i){function t(t){i.call(this);var e=t||{};G_||function(){P_=new _r({color:p_=[255,255,255,1]});d_=[20,2];f_=h_.PIXELS;__=h_.PIXELS;g_=[64,64];y_="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png";v_=.5;M_=new E_({anchor:d_,anchorOrigin:m_.BOTTOM_LEFT,anchorXUnits:f_,anchorYUnits:__,crossOrigin:"anonymous",rotation:0,scale:v_,size:g_,src:y_});b_="NO_IMAGE";A_=new gr({color:p_,width:1});F_=new gr({color:[51,51,51,1],width:2});N_=new un({font:"bold 16px Helvetica",fill:P_,stroke:F_,scale:.8});D_=new yr({fill:P_,image:M_,text:N_,stroke:A_,zIndex:0});G_=[D_]}();this.dataProjection=ye("EPSG:4326");this.defaultStyle_=e.defaultStyle?e.defaultStyle:G_;this.extractStyles_=void 0===e.extractStyles||e.extractStyles;this.writeStyles_=void 0===e.writeStyles||e.writeStyles;this.sharedStyles_={};this.showPointNames_=void 0===e.showPointNames||e.showPointNames}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readDocumentOrFolder_=function(t,e){var i=jd([],Gd(T_,{Document:wd(this.readDocumentOrFolder_,this),Folder:wd(this.readDocumentOrFolder_,this),Placemark:Ld(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),t,e,this);return i||void 0};t.prototype.readPlacemark_=function(t,e){var i=jd({geometry:null},C_,t,e);if(i){var r=new Sr,o=t.getAttribute("id");null!==o&&r.setId(o);var a,l,h,u,c,n=e[0],s=i.geometry;s&&ld(s,!1,n);r.setGeometry(s);delete i.geometry;if(this.extractStyles_){var p=i.Style,d=i.styleUrl,f=(a=p,l=d,h=this.defaultStyle_,u=this.sharedStyles_,c=this.showPointNames_,function(t,e){var i,r=c,o="";if(r){var n=t.getGeometry();n&&(r=n.getType()===kt.POINT)}if(r){o=t.get("name");r=r&&o}if(a){if(r){i=j_(a[0],o);return a.concat(i)}return a}if(l){var s=function t(e,i,r){if(Array.isArray(e))return e;if("string"!=typeof e)return i;!(e in r)&&"#"+e in r&&(e="#"+e);return t(r[e],i,r)}(l,h,u);if(r){i=j_(s[0],o);return s.concat(i)}return s}if(r){i=j_(h[0],o);return h.concat(i)}return h});r.setStyle(f)}delete i.Style;r.setProperties(i);return r}};t.prototype.readSharedStyle_=function(t,e){var i=t.getAttribute("id");if(null!==i){var r=dg(t,e);if(r){var o,n=t.baseURI;n&&"about:blank"!=n||(n=window.location.href);if(n){o=new URL("#"+i,n).href}else o="#"+i;this.sharedStyles_[o]=r}}};t.prototype.readSharedStyleMap_=function(t,e){var i=t.getAttribute("id");if(null!==i){var r=z_(t,e);if(r){var o,n=t.baseURI;n&&"about:blank"!=n||(n=window.location.href);if(n){o=new URL("#"+i,n).href}else o="#"+i;this.sharedStyles_[o]=r}}};t.prototype.readFeatureFromNode=function(t,e){if(!Lr(T_,t.namespaceURI))return null;var i=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return i||null};t.prototype.readFeaturesFromNode=function(t,e){var i;if(!Lr(T_,t.namespaceURI))return[];var r=t.localName;if("Document"==r||"Folder"==r)return(i=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]))||[];if("Placemark"==r){var o=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return o?[o]:[]}if("kml"!=r)return[];i=[];for(var n=t.firstElementChild;n;n=n.nextElementSibling){var s=this.readFeaturesFromNode(n,e);s&&br(i,s)}return i};t.prototype.readName=function(t){if(Sd(t))return this.readNameFromDocument(t);if(Cd(t))return this.readNameFromNode(t);if("string"==typeof t){var e=Id(t);return this.readNameFromDocument(e)}};t.prototype.readNameFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){var i=this.readNameFromNode(e);if(i)return i}};t.prototype.readNameFromNode=function(t){for(var e=t.firstElementChild;e;e=e.nextElementSibling)if(Lr(T_,e.namespaceURI)&&"name"==e.localName)return $d(e);for(var i=t.firstElementChild;i;i=i.nextElementSibling){var r=i.localName;if(Lr(T_,i.namespaceURI)&&("Document"==r||"Folder"==r||"Placemark"==r||"kml"==r)){var o=this.readNameFromNode(i);if(o)return o}}};t.prototype.readNetworkLinks=function(t){var e=[];if(Sd(t))br(e,this.readNetworkLinksFromDocument(t));else if(Cd(t))br(e,this.readNetworkLinksFromNode(t));else if("string"==typeof t){var i=Id(t);br(e,this.readNetworkLinksFromDocument(i))}return e};t.prototype.readNetworkLinksFromDocument=function(t){for(var e=[],i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&br(e,this.readNetworkLinksFromNode(i));return e};t.prototype.readNetworkLinksFromNode=function(t){for(var e=[],i=t.firstElementChild;i;i=i.nextElementSibling)if(Lr(T_,i.namespaceURI)&&"NetworkLink"==i.localName){var r=jd({},R_,i,[]);e.push(r)}for(var o=t.firstElementChild;o;o=o.nextElementSibling){var n=o.localName;!Lr(T_,o.namespaceURI)||"Document"!=n&&"Folder"!=n&&"kml"!=n||br(e,this.readNetworkLinksFromNode(o))}return e};t.prototype.readRegion=function(t){var e=[];if(Sd(t))br(e,this.readRegionFromDocument(t));else if(Cd(t))br(e,this.readRegionFromNode(t));else if("string"==typeof t){var i=Id(t);br(e,this.readRegionFromDocument(i))}return e};t.prototype.readRegionFromDocument=function(t){for(var e=[],i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&br(e,this.readRegionFromNode(i));return e};t.prototype.readRegionFromNode=function(t){for(var e=[],i=t.firstElementChild;i;i=i.nextElementSibling)if(Lr(T_,i.namespaceURI)&&"Region"==i.localName){var r=jd({},w_,i,[]);e.push(r)}for(var o=t.firstElementChild;o;o=o.nextElementSibling){var n=o.localName;!Lr(T_,o.namespaceURI)||"Document"!=n&&"Folder"!=n&&"kml"!=n||br(e,this.readRegionFromNode(o))}return e};t.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var i=Ed(T_[4],"kml"),r="http://www.w3.org/2000/xmlns/";i.setAttributeNS(r,"xmlns:gx",x_[0]);i.setAttributeNS(r,"xmlns:xsi",md);i.setAttributeNS(md,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var o={node:i},n={};1<t.length?n.Document=t:1==t.length&&(n.Placemark=t[0]);var s=L_[i.namespaceURI],a=Dd(n,s);Yd(o,O_,Nd,a,[e],s,this);return i};return t}(Bd);function j_(t,e){var i=null,r=[0,0],o="start";if(t.getImage()){var n=t.getImage().getImageSize();null===n&&(n=g_);if(2==n.length){var s=t.getImage().getScale();r[0]=s*n[0]/2;r[1]=-s*n[1]/2;o="left"}}if(null!==t.getText()){var a=t.getText();(i=a.clone()).setFont(a.getFont()||N_.getFont());i.setScale(a.getScale()||N_.getScale());i.setFill(a.getFill()||N_.getFill());i.setStroke(a.getStroke()||F_)}else i=N_.clone();i.setText(e);i.setOffsetX(r[0]);i.setOffsetY(r[1]);i.setTextAlign(o);return new yr({text:i})}function U_(t){var e=xd(t,!1),i=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(i){var r=i[1];return[parseInt(r.substr(6,2),16),parseInt(r.substr(4,2),16),parseInt(r.substr(2,2),16),parseInt(r.substr(0,2),16)/255]}}function Y_(t){for(var e,i=xd(t,!1),r=[],o=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;e=o.exec(i);){var n=parseFloat(e[1]),s=parseFloat(e[2]),a=e[3]?parseFloat(e[3]):0;r.push(n,s,a);i=i.substr(e[0].length)}if(""===i)return r}function B_(t){var e=xd(t,!1).trim(),i=t.baseURI;i&&"about:blank"!=i||(i=window.location.href);if(i){return new URL(e,i).href}return e}function V_(t){return Zd(t)}var X_=Gd(T_,{Pair:function(t,e){var i=jd({},mg,t,e);if(!i)return;var r=i.key;if(r&&"normal"==r){var o=i.styleUrl;o&&(e[e.length-1]=o);var n=i.Style;n&&(e[e.length-1]=n)}}});function z_(t,e){return jd(void 0,X_,t,e)}var W_=Gd(T_,{Icon:bd(function(t,e){var i=jd({},eg,t,e);return i||null}),heading:bd(Zd),hotSpot:bd(function(t){var e,i=t.getAttribute("xunits"),r=t.getAttribute("yunits");e="insetPixels"!==i?"insetPixels"!==r?m_.BOTTOM_LEFT:m_.TOP_LEFT:"insetPixels"!==r?m_.BOTTOM_RIGHT:m_.TOP_RIGHT;return{x:parseFloat(t.getAttribute("x")),xunits:S_[i],y:parseFloat(t.getAttribute("y")),yunits:S_[r],origin:e}}),scale:bd(V_)});var H_=Gd(T_,{color:bd(U_),scale:bd(V_)});var K_=Gd(T_,{color:bd(U_),width:bd(Zd)});var Z_=Gd(T_,{color:bd(U_),fill:bd(Wd),outline:bd(Wd)});var q_=Gd(T_,{coordinates:Od(Y_)});function J_(t,e){return jd(null,q_,t,e)}var Q_=Gd(x_,{Track:Ld(tg)});var $_=Gd(T_,{when:function(t,e){var i=e[e.length-1].whens,r=xd(t,!1),o=Date.parse(r);i.push(isNaN(o)?0:o)}},Gd(x_,{coord:function(t,e){var i=e[e.length-1].flatCoordinates,r=xd(t,!1),o=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(r);if(o){var n=parseFloat(o[1]),s=parseFloat(o[2]),a=parseFloat(o[3]);i.push(n,s,a,0)}else i.push(0,0,0,0)}}));function tg(t,e){var i=jd({flatCoordinates:[],whens:[]},$_,t,e);if(i){for(var r=i.flatCoordinates,o=i.whens,n=0,s=Math.min(r.length,o.length);n<s;++n)r[4*n+3]=o[n];return new on(r,kr.XYZM)}}var eg=Gd(T_,{href:bd(B_)},Gd(x_,{x:bd(Zd),y:bd(Zd),w:bd(Zd),h:bd(Zd)}));var ig=Gd(T_,{coordinates:Od(Y_)});function rg(t,e){return jd(null,ig,t,e)}var og=Gd(T_,{extrude:bd(Wd),tessellate:bd(Wd),altitudeMode:bd($d)});function ng(t,e){var i=jd({},og,t,e),r=rg(t,e);if(r){var o=new on(r,kr.XYZ);o.setProperties(i);return o}}function sg(t,e){var i=jd({},og,t,e),r=rg(t,e);if(r){var o=new Fo(r,kr.XYZ,[r.length]);o.setProperties(i);return o}}var ag=Gd(T_,{LineString:Ld(ng),LinearRing:Ld(sg),MultiGeometry:Ld(lg),Point:Ld(hg),Polygon:Ld(cg)});function lg(t,e){var i,r=jd([],ag,t,e);if(!r)return null;if(0===r.length)return new Kf(r);for(var o=!0,n=r[0].getType(),s=1,a=r.length;s<a;++s)if(r[s].getType()!=n){o=!1;break}if(o){var l,h;if(n==kt.POINT){var u=r[0];l=u.getLayout();h=u.getFlatCoordinates();for(var c=1,p=r.length;c<p;++c)br(h,r[c].getFlatCoordinates());fg(i=new wl(h,l),r)}else n==kt.LINE_STRING?fg(i=new Il(r),r):n==kt.POLYGON?fg(i=new Ol(r),r):n==kt.GEOMETRY_COLLECTION?i=new Kf(r):A(!1,37)}else i=new Kf(r);return i}function hg(t,e){var i=jd({},og,t,e),r=rg(t,e);if(r){var o=new fo(r,kr.XYZ);o.setProperties(i);return o}}var ug=Gd(T_,{innerBoundaryIs:function(t,e){var i=jd(void 0,Sg,t,e);if(i){var r=e[e.length-1];r.push(i)}},outerBoundaryIs:function(t,e){var i=jd(void 0,Cg,t,e);if(i){var r=e[e.length-1];r[0]=i}}});function cg(t,e){var i=jd({},og,t,e),r=jd([null],ug,t,e);if(r&&r[0]){for(var o=r[0],n=[o.length],s=1,a=r.length;s<a;++s){br(o,r[s]);n.push(o.length)}var l=new Fo(o,kr.XYZ,n);l.setProperties(i);return l}}var pg=Gd(T_,{IconStyle:function(t,e){var i=jd({},W_,t,e);if(i){var r,o,n,s,a=e[e.length-1],l="Icon"in i?i.Icon:{},h=!("Icon"in i)||0<Object.keys(l).length,u=l.href;u?r=u:h&&(r=y_);var c,p=m_.BOTTOM_LEFT,d=i.hotSpot;if(d){o=[d.x,d.y];n=d.xunits;s=d.yunits;p=d.origin}else if(r===y_){o=d_;n=f_;s=__}else if(/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(r)){o=[.5,0];n=h_.FRACTION;s=h_.FRACTION}var f,_=l.x,g=l.y;void 0!==_&&void 0!==g&&(c=[_,g]);var y,v=l.w,m=l.h;void 0!==v&&void 0!==m&&(f=[v,m]);var E=i.heading;void 0!==E&&(y=Nt(E));var x=i.scale;if(h){if(r==y_){f=g_;void 0===x&&(x=v_)}var T=new E_({anchor:o,anchorOrigin:p,anchorXUnits:n,anchorYUnits:s,crossOrigin:"anonymous",offset:c,offsetOrigin:m_.BOTTOM_LEFT,rotation:y,scale:x,size:f,src:r});a.imageStyle=T}else a.imageStyle=b_}},LabelStyle:function(t,e){var i=jd({},H_,t,e);if(i){var r=e[e.length-1],o=new un({fill:new _r({color:"color"in i?i.color:p_}),scale:i.scale});r.textStyle=o}},LineStyle:function(t,e){var i=jd({},K_,t,e);if(i){var r=e[e.length-1],o=new gr({color:"color"in i?i.color:p_,width:"width"in i?i.width:1});r.strokeStyle=o}},PolyStyle:function(t,e){var i=jd({},Z_,t,e);if(i){var r=e[e.length-1],o=new _r({color:"color"in i?i.color:p_});r.fillStyle=o;var n=i.fill;void 0!==n&&(r.fill=n);var s=i.outline;void 0!==s&&(r.outline=s)}}});function dg(t,e){var i=jd({},pg,t,e);if(!i)return null;var r="fillStyle"in i?i.fillStyle:P_,o=i.fill;void 0===o||o||(r=null);var n="imageStyle"in i?i.imageStyle:M_;n==b_&&(n=void 0);var s="textStyle"in i?i.textStyle:N_,a="strokeStyle"in i?i.strokeStyle:A_,l=i.outline;void 0===l||l||(a=null);return[new yr({fill:r,image:n,stroke:a,text:s,zIndex:void 0})]}function fg(t,e){var i,r,o,n=e.length,s=new Array(e.length),a=new Array(e.length),l=new Array(e.length);i=r=o=!1;for(var h=0;h<n;++h){var u=e[h];s[h]=u.get("extrude");a[h]=u.get("tessellate");l[h]=u.get("altitudeMode");i=i||void 0!==s[h];r=r||void 0!==a[h];o=o||l[h]}i&&t.set("extrude",s);r&&t.set("tessellate",a);o&&t.set("altitudeMode",l)}var _g=Gd(T_,{displayName:bd($d),value:bd($d)});var gg=Gd(T_,{Data:function(t,e){var i=t.getAttribute("name");kd(_g,t,e);var r=e[e.length-1];null!==i?r[i]=r.value:null!==r.displayName&&(r[r.displayName]=r.value);delete r.value},SchemaData:function(t,e){kd(Eg,t,e)}});function yg(t,e){kd(gg,t,e)}function vg(t,e){kd(w_,t,e)}var mg=Gd(T_,{Style:bd(dg),key:bd($d),styleUrl:bd(B_)});var Eg=Gd(T_,{SimpleData:function(t,e){var i=t.getAttribute("name");if(null!==i){var r=$d(t),o=e[e.length-1];o[i]=r}}});var xg=Gd(T_,{altitudeMode:bd($d),minAltitude:bd(Zd),maxAltitude:bd(Zd),north:bd(Zd),south:bd(Zd),east:bd(Zd),west:bd(Zd)});var Tg=Gd(T_,{minLodPixels:bd(Zd),maxLodPixels:bd(Zd),minFadeExtent:bd(Zd),maxFadeExtent:bd(Zd)});var Sg=Gd(T_,{LinearRing:Od(J_)});var Cg=Gd(T_,{LinearRing:Od(J_)});function Rg(t,e){for(var i=Je(e),r=[255*(4==i.length?i[3]:1),i[2],i[1],i[0]],o=0;o<4;++o){var n=parseInt(r[o],10).toString(16);r[o]=1==n.length?"0"+n:n}sf(t,r.join(""))}var Ig=Gd(T_,{Data:Md(function(t,e,i){t.setAttribute("name",e.name);var r={node:t},o=e.value;if("object"==typeof o){null!==o&&o.displayName&&Yd(r,Ig,Nd,[o.displayName],i,["displayName"]);null!==o&&o.value&&Yd(r,Ig,Nd,[o.value],i,["value"])}else Yd(r,Ig,Nd,[o],i,["value"])}),value:Md(function(t,e){sf(t,e)}),displayName:Md(function(t,e){ef(t,e)})});var wg=Gd(T_,{Placemark:Md(Qg)}),Lg=function(t,e,i){return Ed(e[e.length-1].node.namespaceURI,"Placemark")};var Og=Ad("Data");var Pg=Gd(T_,["href"],Gd(x_,["x","y","w","h"])),bg=Gd(T_,{href:Md(sf)},Gd(x_,{x:Md(of),y:Md(of),w:Md(of),h:Md(of)})),Mg=function(t,e,i){return Ed(x_[0],"gx:"+i)};var Fg=Gd(T_,["scale","heading","Icon","hotSpot"]),Ag=Gd(T_,{Icon:Md(function(t,e,i){var r={node:t},o=i[i.length-1].node,n=Pg[o.namespaceURI],s=Dd(e,n);Yd(r,bg,Nd,s,i,n);s=Dd(e,n=Pg[x_[0]]);Yd(r,bg,Mg,s,i,n)}),heading:Md(of),hotSpot:Md(function(t,e){t.setAttribute("x",e.x);t.setAttribute("y",e.y);t.setAttribute("xunits",e.xunits);t.setAttribute("yunits",e.yunits)}),scale:Md(ly)});var Ng=Gd(T_,["color","scale"]),Dg=Gd(T_,{color:Md(Rg),scale:Md(ly)});var Gg=Gd(T_,["color","width"]),kg=Gd(T_,{color:Md(Rg),width:Md(of)});var jg={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Ug=function(t,e,i){if(t){return Ed(e[e.length-1].node.namespaceURI,jg[t.getType()])}},Yg=Ad("Point"),Bg=Ad("LineString"),Vg=Ad("LinearRing"),Xg=Ad("Polygon"),zg=Gd(T_,{LineString:Md(ey),Point:Md(ey),Polygon:Md(ny),GeometryCollection:Md(Wg)});function Wg(t,e,i){var r,o,n={node:t},s=e.getType();if(s==kt.GEOMETRY_COLLECTION){r=e.getGeometries();o=Ug}else if(s==kt.MULTI_POINT){r=e.getPoints();o=Yg}else if(s==kt.MULTI_LINE_STRING){r=e.getLineStrings();o=Bg}else if(s==kt.MULTI_POLYGON){r=e.getPolygons();o=Xg}else A(!1,39);Yd(n,zg,o,r,i)}var Hg=Gd(T_,{LinearRing:Md(ey)});function Kg(t,e,i){Yd({node:t},Hg,Vg,[e],i)}var Zg=Gd(T_,{ExtendedData:Md(function(t,e,i){for(var r={node:t},o=e.names,n=e.values,s=o.length,a=0;a<s;a++)Yd(r,Ig,Og,[{name:o[a],value:n[a]}],i)}),MultiGeometry:Md(Wg),LineString:Md(ey),LinearRing:Md(ey),Point:Md(ey),Polygon:Md(ny),Style:Md(function(t,e,i){var r={node:t},o={},n=e.getFill(),s=e.getStroke(),a=e.getImage(),l=e.getText();a instanceof E_&&(o.IconStyle=a);l&&(o.LabelStyle=l);s&&(o.LineStyle=s);n&&(o.PolyStyle=n);var h=i[i.length-1].node,u=hy[h.namespaceURI],c=Dd(o,u);Yd(r,uy,Nd,c,i,u)}),address:Md(sf),description:Md(sf),name:Md(sf),open:Md(tf),phoneNumber:Md(sf),styleUrl:Md(sf),visibility:Md(tf)}),qg=Gd(T_,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),Jg=Ad("ExtendedData");function Qg(t,e,i){var r={node:t};e.getId()&&t.setAttribute("id",e.getId());var o=e.getProperties(),n={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};n[e.getGeometryName()]=1;var s=Object.keys(o||{}).sort().filter(function(t){return!n[t]});if(0<s.length){var a=Dd(o,s);Yd(r,Zg,Jg,[{names:s,values:a}],i)}var l=e.getStyleFunction();if(l){var h=l(e,0);if(h){var u=Array.isArray(h)?h[0]:h;this.writeStyles_&&(o.Style=u);var c=u.getText();c&&(o.name=c.getText())}}var p=i[i.length-1].node,d=qg[p.namespaceURI],f=Dd(o,d);Yd(r,Zg,Nd,f,i,d);var _=i[0],g=e.getGeometry();g&&(g=ld(g,!0,_));Yd(r,Zg,Ug,[g],i)}var $g=Gd(T_,["extrude","tessellate","altitudeMode","coordinates"]),ty=Gd(T_,{extrude:Md(tf),tessellate:Md(tf),altitudeMode:Md(sf),coordinates:Md(function(t,e,i){var r,o=i[i.length-1],n=o.layout,s=o.stride;n==kr.XY||n==kr.XYM?r=2:n==kr.XYZ||n==kr.XYZM?r=3:A(!1,34);var a=e.length,l="";if(0<a){l+=e[0];for(var h=1;h<r;++h)l+=","+e[h];for(var u=s;u<a;u+=s){l+=" "+e[u];for(var c=1;c<r;++c)l+=","+e[u+c]}}sf(t,l)})});function ey(t,e,i){var r=e.getFlatCoordinates(),o={node:t};o.layout=e.getLayout();o.stride=e.getStride();var n=e.getProperties();n.coordinates=r;var s=i[i.length-1].node,a=$g[s.namespaceURI],l=Dd(n,a);Yd(o,ty,Nd,l,i,a)}var iy=Gd(T_,{outerBoundaryIs:Md(Kg),innerBoundaryIs:Md(Kg)}),ry=Ad("innerBoundaryIs"),oy=Ad("outerBoundaryIs");function ny(t,e,i){var r=e.getLinearRings(),o=r.shift(),n={node:t};Yd(n,iy,ry,r,i);Yd(n,iy,oy,[o],i)}var sy=Gd(T_,{color:Md(Rg)}),ay=Ad("color");function ly(t,e){of(t,Math.round(1e6*e)/1e6)}var hy=Gd(T_,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),uy=Gd(T_,{IconStyle:Md(function(t,e,i){var r={node:t},o={},n=e.getSrc(),s=e.getSize(),a=e.getImageSize(),l={href:n};if(s){l.w=s[0];l.h=s[1];var h=e.getAnchor(),u=e.getOrigin();if(u&&a&&0!==u[0]&&u[1]!==s[1]){l.x=u[0];l.y=a[1]-(u[1]+s[1])}if(h&&(h[0]!==s[0]/2||h[1]!==s[1]/2)){var c={x:h[0],xunits:h_.PIXELS,y:s[1]-h[1],yunits:h_.PIXELS};o.hotSpot=c}}o.Icon=l;var p=e.getScale();1!==p&&(o.scale=p);var d=e.getRotation();0!==d&&(o.heading=d);var f=i[i.length-1].node,_=Fg[f.namespaceURI],g=Dd(o,_);Yd(r,Ag,Nd,g,i,_)}),LabelStyle:Md(function(t,e,i){var r={node:t},o={},n=e.getFill();n&&(o.color=n.getColor());var s=e.getScale();s&&1!==s&&(o.scale=s);var a=i[i.length-1].node,l=Ng[a.namespaceURI],h=Dd(o,l);Yd(r,Dg,Nd,h,i,l)}),LineStyle:Md(function(t,e,i){var r={node:t},o={color:e.getColor(),width:e.getWidth()},n=i[i.length-1].node,s=Gg[n.namespaceURI],a=Dd(o,s);Yd(r,kg,Nd,a,i,s)}),PolyStyle:Md(function(t,e,i){Yd({node:t},sy,ay,[e.getColor()],i)})});var cy=function(t,e,i,r,o){var n,s,a=8*o-r-1,l=(1<<a)-1,h=l>>1,u=-7,c=i?o-1:0,p=i?-1:1,d=t[e+c];c+=p;n=d&(1<<-u)-1;d>>=-u;u+=a;for(;0<u;n=256*n+t[e+c],c+=p,u-=8);s=n&(1<<-u)-1;n>>=-u;u+=r;for(;0<u;s=256*s+t[e+c],c+=p,u-=8);if(0===n)n=1-h;else{if(n===l)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r);n-=h}return(d?-1:1)*s*Math.pow(2,n-r)},py=function(t,e,i,r,o,n){var s,a,l,h=8*n-o-1,u=(1<<h)-1,c=u>>1,p=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:n-1,f=r?1:-1,_=e<0||0===e&&1/e<0?1:0;e=Math.abs(e);if(isNaN(e)||e===1/0){a=isNaN(e)?1:0;s=u}else{s=Math.floor(Math.log(e)/Math.LN2);if(e*(l=Math.pow(2,-s))<1){s--;l*=2}if(2<=(e+=1<=s+c?p/l:p*Math.pow(2,1-c))*l){s++;l/=2}if(u<=s+c){a=0;s=u}else if(1<=s+c){a=(e*l-1)*Math.pow(2,o);s+=c}else{a=e*Math.pow(2,c-1)*Math.pow(2,o);s=0}}for(;8<=o;t[i+d]=255&a,d+=f,a/=256,o-=8);s=s<<o|a;h+=o;for(;0<h;t[i+d]=255&s,d+=f,s/=256,h-=8);t[i+d-f]|=128*_},dy=fy;function fy(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0);this.pos=0;this.type=0;this.length=this.buf.length}fy.Varint=0;fy.Fixed64=1;fy.Bytes=2;fy.Fixed32=5;var _y=4294967296,gy=1/_y;fy.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){i=i||this.length;for(;this.pos<i;){var r=this.readVarint(),o=r>>3,n=this.pos;this.type=7&r;t(o,e,this);this.pos===n&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Oy(this.buf,this.pos);this.pos+=4;return t},readSFixed32:function(){var t=by(this.buf,this.pos);this.pos+=4;return t},readFixed64:function(){var t=Oy(this.buf,this.pos)+Oy(this.buf,this.pos+4)*_y;this.pos+=8;return t},readSFixed64:function(){var t=Oy(this.buf,this.pos)+by(this.buf,this.pos+4)*_y;this.pos+=8;return t},readFloat:function(){var t=cy(this.buf,this.pos,!0,23,4);this.pos+=4;return t},readDouble:function(){var t=cy(this.buf,this.pos,!0,52,8);this.pos+=8;return t},readVarint:function(t){var e,i,r=this.buf;e=127&(i=r[this.pos++]);if(i<128)return e;e|=(127&(i=r[this.pos++]))<<7;if(i<128)return e;e|=(127&(i=r[this.pos++]))<<14;if(i<128)return e;e|=(127&(i=r[this.pos++]))<<21;return i<128?e:function(t,e,i){var r,o,n=i.buf;o=n[i.pos++];r=(112&o)>>4;if(o<128)return vy(t,r,e);o=n[i.pos++];r|=(127&o)<<3;if(o<128)return vy(t,r,e);o=n[i.pos++];r|=(127&o)<<10;if(o<128)return vy(t,r,e);o=n[i.pos++];r|=(127&o)<<17;if(o<128)return vy(t,r,e);o=n[i.pos++];r|=(127&o)<<24;if(o<128)return vy(t,r,e);o=n[i.pos++];r|=(1&o)<<31;if(o<128)return vy(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this)},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,i){var r="",o=e;for(;o<i;){var n,s,a,l=t[o],h=null,u=239<l?4:223<l?3:191<l?2:1;if(i<o+u)break;if(1===u)l<128&&(h=l);else if(2===u)128==(192&(n=t[o+1]))&&(h=(31&l)<<6|63&n)<=127&&(h=null);else if(3===u){n=t[o+1];s=t[o+2];128==(192&n)&&128==(192&s)&&((h=(15&l)<<12|(63&n)<<6|63&s)<=2047||55296<=h&&h<=57343)&&(h=null)}else if(4===u){n=t[o+1];s=t[o+2];a=t[o+3];128==(192&n)&&128==(192&s)&&128==(192&a)&&((h=(15&l)<<18|(63&n)<<12|(63&s)<<6|63&a)<=65535||1114112<=h)&&(h=null)}if(null===h){h=65533;u=1}else if(65535<h){h-=65536;r+=String.fromCharCode(h>>>10&1023|55296);h=56320|1023&h}r+=String.fromCharCode(h);o+=u}return r}(this.buf,this.pos,t);this.pos=t;return e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);this.pos=t;return e},readPackedVarint:function(t,e){var i=yy(this);t=t||[];for(;this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=yy(this);t=t||[];for(;this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=yy(this);t=t||[];for(;this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=yy(this);t=t||[];for(;this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=yy(this);t=t||[];for(;this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=yy(this);t=t||[];for(;this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=yy(this);t=t||[];for(;this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=yy(this);t=t||[];for(;this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=yy(this);t=t||[];for(;this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===fy.Varint)for(;127<this.buf[this.pos++];);else if(e===fy.Bytes)this.pos=this.readVarint()+this.pos;else if(e===fy.Fixed32)this.pos+=4;else{if(e!==fy.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf);this.buf=i;this.length=e}},finish:function(){this.length=this.pos;this.pos=0;return this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4);Py(this.buf,t,this.pos);this.pos+=4},writeSFixed32:function(t){this.realloc(4);Py(this.buf,t,this.pos);this.pos+=4},writeFixed64:function(t){this.realloc(8);Py(this.buf,-1&t,this.pos);Py(this.buf,Math.floor(t*gy),this.pos+4);this.pos+=8},writeSFixed64:function(t){this.realloc(8);Py(this.buf,-1&t,this.pos);Py(this.buf,Math.floor(t*gy),this.pos+4);this.pos+=8},writeVarint:function(t){if(268435455<(t=+t||0)||t<0)!function(t,e){var i,r;if(0<=t){i=t%4294967296|0;r=t/4294967296|0}else{r=~(-t/4294967296);4294967295^(i=~(-t%4294967296))?i=i+1|0:r=r+1|(i=0)}if(0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10);!function(t,e,i){i.buf[i.pos++]=127&t|128;t>>>=7;i.buf[i.pos++]=127&t|128;t>>>=7;i.buf[i.pos++]=127&t|128;t>>>=7;i.buf[i.pos++]=127&t|128;t>>>=7;i.buf[i.pos]=127&t}(i,0,e);!function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0);if(!t)return;e.buf[e.pos++]=127&t|((t>>>=7)?128:0);if(!t)return;e.buf[e.pos++]=127&t|((t>>>=7)?128:0);if(!t)return;e.buf[e.pos++]=127&t|((t>>>=7)?128:0);if(!t)return;e.buf[e.pos++]=127&t|((t>>>=7)?128:0);if(!t)return;e.buf[e.pos++]=127&t}(r,e)}(t,this);else{this.realloc(4);this.buf[this.pos++]=127&t|(127<t?128:0);if(!(t<=127)){this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0);if(!(t<=127)){this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0);t<=127||(this.buf[this.pos++]=t>>>7&127)}}}},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t);this.realloc(4*t.length);this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,o,n=0;n<e.length;n++){if(55295<(r=e.charCodeAt(n))&&r<57344){if(!o){if(56319<r||n+1===e.length){t[i++]=239;t[i++]=191;t[i++]=189}else o=r;continue}if(r<56320){t[i++]=239;t[i++]=191;t[i++]=189;o=r;continue}r=o-55296<<10|r-56320|65536;o=null}else if(o){t[i++]=239;t[i++]=191;t[i++]=189;o=null}if(r<128)t[i++]=r;else{if(r<2048)t[i++]=r>>6|192;else{if(r<65536)t[i++]=r>>12|224;else{t[i++]=r>>18|240;t[i++]=r>>12&63|128}t[i++]=r>>6&63|128}t[i++]=63&r|128}}return i}(this.buf,t,this.pos);var i=this.pos-e;128<=i&&my(e,i,this);this.pos=e-1;this.writeVarint(i);this.pos+=i},writeFloat:function(t){this.realloc(4);py(this.buf,t,this.pos,!0,23,4);this.pos+=4},writeDouble:function(t){this.realloc(8);py(this.buf,t,this.pos,!0,52,8);this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e);this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;128<=r&&my(i,r,this);this.pos=i-1;this.writeVarint(r);this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,fy.Bytes);this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,Ey,e)},writePackedSVarint:function(t,e){this.writeMessage(t,xy,e)},writePackedBoolean:function(t,e){this.writeMessage(t,Cy,e)},writePackedFloat:function(t,e){this.writeMessage(t,Ty,e)},writePackedDouble:function(t,e){this.writeMessage(t,Sy,e)},writePackedFixed32:function(t,e){this.writeMessage(t,Ry,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,Iy,e)},writePackedFixed64:function(t,e){this.writeMessage(t,wy,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,Ly,e)},writeBytesField:function(t,e){this.writeTag(t,fy.Bytes);this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,fy.Fixed32);this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,fy.Fixed32);this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,fy.Fixed64);this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,fy.Fixed64);this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,fy.Varint);this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,fy.Varint);this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,fy.Bytes);this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,fy.Fixed32);this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,fy.Fixed64);this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};function yy(t){return t.type===fy.Bytes?t.readVarint()+t.pos:t.pos+1}function vy(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function my(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var o=i.pos-1;t<=o;o--)i.buf[o+r]=i.buf[o]}function Ey(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function xy(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Ty(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Sy(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function Cy(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Ry(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Iy(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function wy(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Ly(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Oy(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Py(t,e,i){t[i]=e;t[i+1]=e>>>8;t[i+2]=e>>>16;t[i+3]=e>>>24}function by(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}var My=[1,0,0,1,0,0],Fy=function(t,e,i,r,o){this.extent_;this.id_=o;this.type_=t;this.flatCoordinates_=e;this.flatInteriorPoints_=null;this.flatMidpoints_=null;this.ends_=i;this.properties_=r};Fy.prototype.get=function(t){return this.properties_[t]};Fy.prototype.getExtent=function(){this.extent_||(this.extent_=this.type_===kt.POINT?H(this.flatCoordinates_):Z(this.flatCoordinates_,0,this.flatCoordinates_.length,2));return this.extent_};Fy.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){var t=lt(this.getExtent());this.flatInteriorPoints_=mo(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_};Fy.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){var t=Ll(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=Eo(this.flatCoordinates_,0,this.ends_,2,t)}return this.flatInteriorPoints_};Fy.prototype.getFlatMidpoint=function(){this.flatMidpoints_||(this.flatMidpoints_=$o(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5));return this.flatMidpoints_};Fy.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];for(var t=this.flatCoordinates_,e=0,i=this.ends_,r=0,o=i.length;r<o;++r){var n=i[r],s=$o(t,e,n,2,.5);br(this.flatMidpoints_,s);e=n}}return this.flatMidpoints_};Fy.prototype.getId=function(){return this.id_};Fy.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_};Fy.prototype.getGeometry=function(){return this};Fy.prototype.getProperties=function(){return this.properties_};Fy.prototype.getStride=function(){return 2};Fy.prototype.getStyleFunction=function(){};Fy.prototype.getType=function(){return this.type_};Fy.prototype.transform=function(t,e){var i=(t=ye(t)).getExtent(),r=t.getWorldExtent(),o=ct(r)/ct(i);Ue(My,r[0],r[3],o,-o,0,0,0);It(this.flatCoordinates_,0,this.flatCoordinates_.length,2,My,this.flatCoordinates_)};Fy.prototype.getEnds=Fy.prototype.getEndss=function(){return this.ends_};Fy.prototype.getFlatCoordinates=Fy.prototype.getOrientedFlatCoordinates;Fy.prototype.getSimplifiedGeometry=Fy.prototype.getGeometry;var Ay=function(i){function t(t){i.call(this);var e=t||{};this.dataProjection=new Wt({code:"",units:Xt.TILE_PIXELS});this.featureClass_=e.featureClass?e.featureClass:Fy;this.geometryName_=e.geometryName;this.layerName_=e.layerName?e.layerName:"layer";this.layers_=e.layers?e.layers:null;this.extent_=null}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readRawGeometry_=function(t,e,i,r){t.pos=e.geometry;for(var o=t.readVarint()+t.pos,n=1,s=0,a=0,l=0,h=0,u=0;t.pos<o;){if(!s){var c=t.readVarint();n=7&c;s=c>>3}s--;if(1===n||2===n){a+=t.readSVarint();l+=t.readSVarint();if(1===n&&u<h){r.push(h);u=h}i.push(a,l);h+=2}else if(7===n){if(u<h){i.push(i[u],i[u+1]);h+=2}}else A(!1,59)}if(u<h){r.push(h);u=h}};t.prototype.createFeature_=function(t,e,i){var r,o=e.type;if(0===o)return null;var n=e.id,s=e.properties;s[this.layerName_]=e.layer.name;var a=[],l=[];this.readRawGeometry_(t,e,a,l);var h=function(t,e){var i;1===t?i=1===e?kt.POINT:kt.MULTI_POINT:2===t?i=1===e?kt.LINE_STRING:kt.MULTI_LINE_STRING:3===t&&(i=kt.POLYGON);return i}(o,l.length);if(this.featureClass_===Fy)r=new this.featureClass_(h,a,l,s,n);else{var u;if(h==kt.POLYGON){for(var c=[],p=0,d=0,f=0,_=l.length;f<_;++f){var g=l[f];if(!Lo(a,p,g,2)){c.push(l.slice(d,f));d=f}p=g}u=1<c.length?new Ol(a,kr.XY,c):new Fo(a,kr.XY,l)}else u=h===kt.POINT?new fo(a,kr.XY):h===kt.LINE_STRING?new on(a,kr.XY):h===kt.POLYGON?new Fo(a,kr.XY,l):h===kt.MULTI_POINT?new wl(a,kr.XY):h===kt.MULTI_LINE_STRING?new Il(a,kr.XY,l):null;r=new this.featureClass_;this.geometryName_&&r.setGeometryName(this.geometryName_);var y=ld(u,!1,this.adaptOptions(i));r.setGeometry(y);r.setId(n);r.setProperties(s)}return r};t.prototype.getLastExtent=function(){return this.extent_};t.prototype.getType=function(){return Fl.ARRAY_BUFFER};t.prototype.readFeatures=function(t,e){var i=this.layers_,r=new dy(t),o=r.readFields(Ny,{}),n=[];for(var s in o)if(!i||-1!=i.indexOf(s)){for(var a=o[s],l=0,h=a.length;l<h;++l){var u=ky(r,a,l);n.push(this.createFeature_(r,u))}this.extent_=a?[0,0,a.extent,a.extent]:null}return n};t.prototype.readProjection=function(t){return this.dataProjection};t.prototype.setLayers=function(t){this.layers_=t};return t}(ad);function Ny(t,e,i){if(3===t){var r={keys:[],values:[],features:[]},o=i.readVarint()+i.pos;i.readFields(Dy,r,o);r.length=r.features.length;r.length&&(e[r.name]=r)}}function Dy(t,e,i){if(15===t)e.version=i.readVarint();else if(1===t)e.name=i.readString();else if(5===t)e.extent=i.readVarint();else if(2===t)e.features.push(i.pos);else if(3===t)e.keys.push(i.readString());else if(4===t){for(var r=null,o=i.readVarint()+i.pos;i.pos<o;)r=1===(t=i.readVarint()>>3)?i.readString():2===t?i.readFloat():3===t?i.readDouble():4===t?i.readVarint64():5===t?i.readVarint():6===t?i.readSVarint():7===t?i.readBoolean():null;e.values.push(r)}}function Gy(t,e,i){if(1==t)e.id=i.readVarint();else if(2==t)for(var r=i.readVarint()+i.pos;i.pos<r;){var o=e.layer.keys[i.readVarint()],n=e.layer.values[i.readVarint()];e.properties[o]=n}else 3==t?e.type=i.readVarint():4==t&&(e.geometry=i.pos)}function ky(t,e,i){t.pos=e.features[i];var r=t.readVarint()+t.pos,o={layer:e,type:0,properties:{}};t.readFields(Gy,o,r);return o}var jy=[null],Uy=Gd(jy,{nd:function(t,e){e[e.length-1].ndrefs.push(t.getAttribute("ref"))},tag:Xy}),Yy=Gd(jy,{node:function(t,e){var i=e[0],r=e[e.length-1],o=t.getAttribute("id"),n=[parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))];r.nodes[o]=n;var s=jd({tags:{}},Vy,t,e);if(!Ct(s.tags)){var a=new fo(n);ld(a,!1,i);var l=new Sr(a);l.setId(o);l.setProperties(s.tags);r.features.push(l)}},way:function(t,e){var i=jd({id:t.getAttribute("id"),ndrefs:[],tags:{}},Uy,t,e);e[e.length-1].ways.push(i)}}),By=function(t){function e(){t.call(this);this.dataProjection=ye("EPSG:4326")}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.readFeaturesFromNode=function(t,e){var i=this.getReadOptions(t,e);if("osm"==t.localName){for(var r=jd({nodes:{},ways:[],features:[]},Yy,t,[i]),o=0;o<r.ways.length;o++){for(var n=r.ways[o],s=[],a=0,l=n.ndrefs.length;a<l;a++){br(s,r.nodes[n.ndrefs[a]])}var h=void 0;ld(h=n.ndrefs[0]==n.ndrefs[n.ndrefs.length-1]?new Fo(s,kr.XY,[s.length]):new on(s,kr.XY),!1,i);var u=new Sr(h);u.setId(n.id);u.setProperties(n.tags);r.features.push(u)}if(r.features)return r.features}return[]};return e}(Bd),Vy=Gd(jy,{tag:Xy});function Xy(t,e){e[e.length-1].tags[t.getAttribute("k")]=t.getAttribute("v")}var zy="http://www.w3.org/1999/xlink";function Wy(t){return t.getAttributeNS(zy,"href")}var Hy=function(){};Hy.prototype.read=function(t){if(Sd(t))return this.readFromDocument(t);if(Cd(t))return this.readFromNode(t);if("string"!=typeof t)return null;var e=Id(t);return this.readFromDocument(e)};Hy.prototype.readFromDocument=function(t){};Hy.prototype.readFromNode=function(t){};var Ky=[null,"http://www.opengis.net/ows/1.1"],Zy=Gd(Ky,{ServiceIdentification:bd(function(t,e){return jd({},lv,t,e)}),ServiceProvider:bd(function(t,e){return jd({},hv,t,e)}),OperationsMetadata:bd(function(t,e){return jd({},ov,t,e)})}),qy=function(t){function e(){t.call(this)}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null};e.prototype.readFromNode=function(t){var e=jd({},Zy,t,[]);return e||null};return e}(Hy),Jy=Gd(Ky,{DeliveryPoint:bd($d),City:bd($d),AdministrativeArea:bd($d),PostalCode:bd($d),Country:bd($d),ElectronicMailAddress:bd($d)}),Qy=Gd(Ky,{Value:Pd(function(t,e){return $d(t)})}),$y=Gd(Ky,{AllowedValues:bd(function(t,e){return jd({},Qy,t,e)})}),tv=Gd(Ky,{Phone:bd(function(t,e){return jd({},nv,t,e)}),Address:bd(function(t,e){return jd({},Jy,t,e)})}),ev=Gd(Ky,{HTTP:bd(function(t,e){return jd({},iv,t,e)})}),iv=Gd(Ky,{Get:Pd(function(t,e){var i=Wy(t);return i?jd({href:i},sv,t,e):void 0}),Post:void 0}),rv=Gd(Ky,{DCP:bd(function(t,e){return jd({},ev,t,e)})}),ov=Gd(Ky,{Operation:function(t,e){var i=t.getAttribute("name"),r=jd({},rv,t,e);if(!r)return;e[e.length-1][i]=r}}),nv=Gd(Ky,{Voice:bd($d),Facsimile:bd($d)}),sv=Gd(Ky,{Constraint:Pd(function(t,e){var i=t.getAttribute("name");return i?jd({name:i},$y,t,e):void 0})}),av=Gd(Ky,{IndividualName:bd($d),PositionName:bd($d),ContactInfo:bd(function(t,e){return jd({},tv,t,e)})}),lv=Gd(Ky,{Abstract:bd($d),AccessConstraints:bd($d),Fees:bd($d),Title:bd($d),ServiceTypeVersion:bd($d),ServiceType:bd($d)}),hv=Gd(Ky,{ProviderName:bd($d),ProviderSite:bd(Wy),ServiceContact:bd(function(t,e){return jd({},av,t,e)})});function uv(t,e,i,r,o,n){var s,a;if(void 0!==o){s=o;a=void 0!==n?n:0}else{s=[];a=0}for(var l=e;l<i;){var h=t[l++];s[a++]=t[l++];s[a++]=h;for(var u=2;u<r;++u)s[a++]=t[l++]}s.length=a;return s}var cv=function(i){function t(t){i.call(this);var e=t||{};this.dataProjection=ye("EPSG:4326");this.factor_=e.factor?e.factor:1e5;this.geometryLayout_=e.geometryLayout?e.geometryLayout:kr.XY}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeatureFromText=function(t,e){var i=this.readGeometryFromText(t,e);return new Sr(i)};t.prototype.readFeaturesFromText=function(t,e){return[this.readFeatureFromText(t,e)]};t.prototype.readGeometryFromText=function(t,e){var i=Ur(this.geometryLayout_),r=dv(t,i,this.factor_);uv(r,0,r.length,i,r);var o=io(r,0,r.length,i);return ld(new on(o,this.geometryLayout_),!1,this.adaptOptions(e))};t.prototype.writeFeatureText=function(t,e){var i=t.getGeometry();if(i)return this.writeGeometryText(i,e);A(!1,40);return""};t.prototype.writeFeaturesText=function(t,e){return this.writeFeatureText(t[0],e)};t.prototype.writeGeometryText=function(t,e){var i=(t=ld(t,!0,this.adaptOptions(e))).getFlatCoordinates(),r=t.getStride();uv(i,0,i.length,r,i);return pv(i,r,this.factor_)};return t}($f);function pv(t,e,i){var r,o=i||1e5,n=new Array(e);for(r=0;r<e;++r)n[r]=0;for(var s=0,a=t.length;s<a;)for(r=0;r<e;++r,++s){var l=t[s],h=l-n[r];n[r]=l;t[s]=h}return fv(t,o)}function dv(t,e,i){var r,o=i||1e5,n=new Array(e);for(r=0;r<e;++r)n[r]=0;for(var s=_v(t,o),a=0,l=s.length;a<l;)for(r=0;r<e;++r,++a){n[r]+=s[a];s[a]=n[r]}return s}function fv(t,e){for(var i=e||1e5,r=0,o=t.length;r<o;++r)t[r]=Math.round(t[r]*i);return gv(t)}function _v(t,e){for(var i=e||1e5,r=yv(t),o=0,n=r.length;o<n;++o)r[o]/=i;return r}function gv(t){for(var e=0,i=t.length;e<i;++e){var r=t[e];t[e]=r<0?~(r<<1):r<<1}return vv(t)}function yv(t){for(var e=mv(t),i=0,r=e.length;i<r;++i){var o=e[i];e[i]=1&o?~(o>>1):o>>1}return e}function vv(t){for(var e="",i=0,r=t.length;i<r;++i)e+=Ev(t[i]);return e}function mv(t){for(var e=[],i=0,r=0,o=0,n=t.length;o<n;++o){var s=t.charCodeAt(o)-63;i|=(31&s)<<r;if(s<32){e.push(i);r=i=0}else r+=5}return e}function Ev(t){for(var e,i="";32<=t;){e=63+(32|31&t);i+=String.fromCharCode(e);t>>=5}e=t+63;return i+=String.fromCharCode(e)}var xv=function(i){function t(t){i.call(this);var e=t||{};this.layerName_=e.layerName;this.layers_=e.layers?e.layers:null;this.dataProjection=ye(e.dataProjection?e.dataProjection:"EPSG:4326")}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeaturesFromObject=function(t,e){if("Topology"!=t.type)return[];var i,r=t,o=null,n=null;if(r.transform){o=(i=r.transform).scale;n=i.translate}var s=r.arcs;i&&function(t,e,i){for(var r=0,o=t.length;r<o;++r)Iv(t[r],e,i)}(s,o,n);var a,l=[],h=r.objects,u=this.layerName_;for(var c in h)if(!this.layers_||-1!=this.layers_.indexOf(c))if("GeometryCollection"===h[c].type){a=h[c];l.push.apply(l,Cv(a,s,o,n,u,c,e))}else{a=h[c];l.push(Rv(a,s,o,n,u,c,e))}return l};t.prototype.readProjectionFromObject=function(t){return this.dataProjection};return t}(hd),Tv={Point:function(t,e,i){var r=t.coordinates;e&&i&&wv(r,e,i);return new fo(r)},LineString:function(t,e){var i=Sv(t.arcs,e);return new on(i)},Polygon:function(t,e){for(var i=[],r=0,o=t.arcs.length;r<o;++r)i[r]=Sv(t.arcs[r],e);return new Fo(i)},MultiPoint:function(t,e,i){var r=t.coordinates;if(e&&i)for(var o=0,n=r.length;o<n;++o)wv(r[o],e,i);return new wl(r)},MultiLineString:function(t,e){for(var i=[],r=0,o=t.arcs.length;r<o;++r)i[r]=Sv(t.arcs[r],e);return new Il(i)},MultiPolygon:function(t,e){for(var i=[],r=0,o=t.arcs.length;r<o;++r){for(var n=t.arcs[r],s=[],a=0,l=n.length;a<l;++a)s[a]=Sv(n[a],e);i[r]=s}return new Ol(i)}};function Sv(t,e){for(var i,r,o=[],n=0,s=t.length;n<s;++n){i=t[n];0<n&&o.pop();r=0<=i?e[i]:e[~i].slice().reverse();o.push.apply(o,r)}for(var a=0,l=o.length;a<l;++a)o[a]=o[a].slice();return o}function Cv(t,e,i,r,o,n,s){for(var a=t.geometries,l=[],h=0,u=a.length;h<u;++h)l[h]=Rv(a[h],e,i,r,o,n,s);return l}function Rv(t,e,i,r,o,n,s){var a,l=t.type,h=Tv[l];a="Point"===l||"MultiPoint"===l?h(t,i,r):h(t,e);var u=new Sr;u.setGeometry(ld(a,!1,s));void 0!==t.id&&u.setId(t.id);var c=t.properties;if(o){c||(c={});c[o]=n}c&&u.setProperties(c);return u}function Iv(t,e,i){for(var r=0,o=0,n=0,s=t.length;n<s;++n){var a=t[n];r+=a[0];o+=a[1];a[0]=r;a[1]=o;wv(a,e,i)}}function wv(t,e,i){t[0]=t[0]*e[0]+i[0];t[1]=t[1]*e[1]+i[1]}var Lv=function(t){this.tagName_=t};Lv.prototype.getTagName=function(){return this.tagName_};var Ov=function(i){function t(t,e){i.call(this,t);this.conditions=Array.prototype.slice.call(arguments,1);A(2<=this.conditions.length,57)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Lv),Pv=function(i){function t(t){var e=["And"].concat(Array.prototype.slice.call(arguments));i.apply(this,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Ov),bv=function(r){function t(t,e,i){r.call(this,"BBOX");this.geometryName=t;this.extent=e;this.srsName=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(Lv),Mv=function(o){function t(t,e,i,r){o.call(this,t);this.geometryName=e||"the_geom";this.geometry=i;this.srsName=r}o&&(t.__proto__=o);return(t.prototype=Object.create(o&&o.prototype)).constructor=t}(Lv),Fv=function(r){function t(t,e,i){r.call(this,"Contains",t,e,i)}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(Mv),Av=function(i){function t(t,e){i.call(this,t);this.propertyName=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Lv),Nv=function(r){function t(t,e,i){r.call(this,"During",t);this.begin=e;this.end=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(Av),Dv=function(o){function t(t,e,i,r){o.call(this,t,e);this.expression=i;this.matchCase=r}o&&(t.__proto__=o);return(t.prototype=Object.create(o&&o.prototype)).constructor=t}(Av),Gv=function(r){function t(t,e,i){r.call(this,"PropertyIsEqualTo",t,e,i)}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(Dv),kv=function(i){function t(t,e){i.call(this,"PropertyIsGreaterThan",t,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Dv),jv=function(i){function t(t,e){i.call(this,"PropertyIsGreaterThanOrEqualTo",t,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Dv),Uv=function(r){function t(t,e,i){r.call(this,"Intersects",t,e,i)}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(Mv),Yv=function(r){function t(t,e,i){r.call(this,"PropertyIsBetween",t);this.lowerBoundary=e;this.upperBoundary=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(Av),Bv=function(s){function t(t,e,i,r,o,n){s.call(this,"PropertyIsLike",t);this.pattern=e;this.wildCard=void 0!==i?i:"*";this.singleChar=void 0!==r?r:".";this.escapeChar=void 0!==o?o:"!";this.matchCase=n}s&&(t.__proto__=s);return(t.prototype=Object.create(s&&s.prototype)).constructor=t}(Av),Vv=function(e){function t(t){e.call(this,"PropertyIsNull",t)}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(Av),Xv=function(i){function t(t,e){i.call(this,"PropertyIsLessThan",t,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Dv),zv=function(i){function t(t,e){i.call(this,"PropertyIsLessThanOrEqualTo",t,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Dv),Wv=function(e){function t(t){e.call(this,"Not");this.condition=t}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(Lv),Hv=function(r){function t(t,e,i){r.call(this,"PropertyIsNotEqualTo",t,e,i)}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(Dv),Kv=function(i){function t(t){var e=["Or"].concat(Array.prototype.slice.call(arguments));i.apply(this,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Ov),Zv=function(r){function t(t,e,i){r.call(this,"Within",t,e,i)}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(Mv);function qv(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Pv,e))}function Jv(t,e,i){return new bv(t,e,i)}var Qv={"http://www.opengis.net/gml":{boundedBy:bd(zd.prototype.readGeometryElement,"bounds")}},$v={"http://www.opengis.net/wfs":{totalInserted:bd(Jd),totalUpdated:bd(Jd),totalDeleted:bd(Jd)}},tm={"http://www.opengis.net/wfs":{TransactionSummary:bd(function(t,e){return jd({},$v,t,e)},"transactionSummary"),InsertResults:bd(function(t,e){return jd([],um,t,e)},"insertIds")}},em={"http://www.opengis.net/wfs":{PropertyName:Md(sf)}},im={"http://www.opengis.net/wfs":{Insert:Md(function(t,e,i){var r=i[i.length-1],o=r.featureType,n=r.featureNS,s=r.gmlVersion,a=Ed(n,o);t.appendChild(a);2===s?df.prototype.writeFeatureElement(a,e,i):hf.prototype.writeFeatureElement(a,e,i)}),Update:Md(function(t,e,i){var r=i[i.length-1];A(void 0!==e.getId(),27);var o=r.featureType,n=r.featurePrefix,s=r.featureNS,a=pm(n,o),l=e.getGeometryName();t.setAttribute("typeName",a);t.setAttributeNS(om,"xmlns:"+n,s);var h=e.getId();if(void 0!==h){for(var u=e.getKeys(),c=[],p=0,d=u.length;p<d;p++){var f=e.get(u[p]);if(void 0!==f){var _=u[p];f instanceof Xe&&(_=l);c.push({name:_,value:f})}}Yd({gmlVersion:r.gmlVersion,node:t,hasZ:r.hasZ,srsName:r.srsName},im,Ad("Property"),c,i);cm(t,h,i)}}),Delete:Md(function(t,e,i){var r=i[i.length-1];A(void 0!==e.getId(),26);var o=r.featureType,n=r.featurePrefix,s=r.featureNS,a=pm(n,o);t.setAttribute("typeName",a);t.setAttributeNS(om,"xmlns:"+n,s);var l=e.getId();void 0!==l&&cm(t,l,i)}),Property:Md(function(t,e,i){var r=Ed(sm,"Name"),o=i[i.length-1].gmlVersion;t.appendChild(r);sf(r,e.name);if(void 0!==e.value&&null!==e.value){var n=Ed(sm,"Value");t.appendChild(n);e.value instanceof Xe?2===o?df.prototype.writeGeometryElement(n,e.value,i):hf.prototype.writeGeometryElement(n,e.value,i):sf(n,e.value)}}),Native:Md(function(t,e,i){e.vendorId&&t.setAttribute("vendorId",e.vendorId);void 0!==e.safeToIgnore&&t.setAttribute("safeToIgnore",e.safeToIgnore);void 0!==e.value&&sf(t,e.value)})}},rm="feature",om="http://www.w3.org/2000/xmlns/",nm="http://www.opengis.net/ogc",sm="http://www.opengis.net/wfs",am={"1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},lm=function(i){function t(t){i.call(this);var e=t||{};this.featureType_=e.featureType;this.featureNS_=e.featureNS;this.gmlFormat_=e.gmlFormat?e.gmlFormat:new hf;this.schemaLocation_=e.schemaLocation?e.schemaLocation:am["1.1.0"]}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getFeatureType=function(){return this.featureType_};t.prototype.setFeatureType=function(t){this.featureType_=t};t.prototype.readFeaturesFromNode=function(t,e){var i={featureType:this.featureType_,featureNS:this.featureNS_};T(i,this.getReadOptions(t,e||{}));var r=[i];this.gmlFormat_.FEATURE_COLLECTION_PARSERS[Vd].featureMember=Ld(zd.prototype.readFeaturesInternal);var o=jd([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,r,this.gmlFormat_);o||(o=[]);return o};t.prototype.readTransactionResponse=function(t){if(Sd(t))return this.readTransactionResponseFromDocument(t);if(Cd(t))return this.readTransactionResponseFromNode(t);if("string"==typeof t){var e=Id(t);return this.readTransactionResponseFromDocument(e)}};t.prototype.readFeatureCollectionMetadata=function(t){if(Sd(t))return this.readFeatureCollectionMetadataFromDocument(t);if(Cd(t))return this.readFeatureCollectionMetadataFromNode(t);if("string"==typeof t){var e=Id(t);return this.readFeatureCollectionMetadataFromDocument(e)}};t.prototype.readFeatureCollectionMetadataFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)};t.prototype.readFeatureCollectionMetadataFromNode=function(t){var e={},i=Qd(t.getAttribute("numberOfFeatures"));e.numberOfFeatures=i;return jd(e,Qv,t,[],this.gmlFormat_)};t.prototype.readTransactionResponseFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)};t.prototype.readTransactionResponseFromNode=function(t){return jd({},tm,t,[])};t.prototype.writeGetFeature=function(t){var e,i=Ed(sm,"GetFeature");i.setAttribute("service","WFS");i.setAttribute("version","1.1.0");if(t){t.handle&&i.setAttribute("handle",t.handle);t.outputFormat&&i.setAttribute("outputFormat",t.outputFormat);void 0!==t.maxFeatures&&i.setAttribute("maxFeatures",t.maxFeatures);t.resultType&&i.setAttribute("resultType",t.resultType);void 0!==t.startIndex&&i.setAttribute("startIndex",t.startIndex);void 0!==t.count&&i.setAttribute("count",t.count);e=t.filter;if(t.bbox){A(t.geometryName,12);var r=Jv(t.geometryName,t.bbox,t.srsName);e=e?qv(e,r):r}}i.setAttributeNS(md,"xsi:schemaLocation",this.schemaLocation_);var o={node:i,srsName:t.srsName,featureNS:t.featureNS?t.featureNS:this.featureNS_,featurePrefix:t.featurePrefix,geometryName:t.geometryName,filter:e,propertyNames:t.propertyNames?t.propertyNames:[]};A(Array.isArray(t.featureTypes),11);!function(t,e,i){var r=i[i.length-1],o=T({},r);o.node=t;Yd(o,dm,Ad("Query"),e,i)}(i,t.featureTypes,[o]);return i};t.prototype.writeTransaction=function(t,e,i,r){var o,n,s=[],a=Ed(sm,"Transaction"),l=r.version?r.version:"1.1.0",h="1.0.0"===l?2:3;a.setAttribute("service","WFS");a.setAttribute("version",l);if(r){o=r.gmlOptions?r.gmlOptions:{};r.handle&&a.setAttribute("handle",r.handle)}var u=am[l];a.setAttributeNS(md,"xsi:schemaLocation",u);var c=r.featurePrefix?r.featurePrefix:rm;if(t){n={node:a,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:h,hasZ:r.hasZ,srsName:r.srsName};T(n,o);Yd(n,im,Ad("Insert"),t,s)}if(e){n={node:a,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:h,hasZ:r.hasZ,srsName:r.srsName};T(n,o);Yd(n,im,Ad("Update"),e,s)}i&&Yd({node:a,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:h,srsName:r.srsName},im,Ad("Delete"),i,s);r.nativeElements&&Yd({node:a,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:h,srsName:r.srsName},im,Ad("Native"),r.nativeElements,s);return a};t.prototype.readProjectionFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null};t.prototype.readProjectionFromNode=function(t){if(t.firstElementChild&&t.firstElementChild.firstElementChild)for(var e=(t=t.firstElementChild.firstElementChild).firstElementChild;e;e=e.nextElementSibling)if(0!==e.childNodes.length&&(1!==e.childNodes.length||3!==e.firstChild.nodeType)){var i=[{}];this.gmlFormat_.readGeometryElement(e,i);return ye(i.pop().srsName)}return null};return t}(Bd);var hm={"http://www.opengis.net/ogc":{FeatureId:Ld(function(t,e){return t.getAttribute("fid")})}};var um={"http://www.opengis.net/wfs":{Feature:function(t,e){kd(hm,t,e)}}};function cm(t,e,i){var r=Ed(nm,"Filter"),o=Ed(nm,"FeatureId");r.appendChild(o);o.setAttribute("fid",e);t.appendChild(r)}function pm(t,e){var i=(t=t||rm)+":";return 0===e.indexOf(i)?e:i+e}var dm={"http://www.opengis.net/wfs":{Query:Md(function(t,e,i){var r,o=i[i.length-1],n=o.featurePrefix,s=o.featureNS,a=o.propertyNames,l=o.srsName;r=n?pm(n,e):e;t.setAttribute("typeName",r);l&&t.setAttribute("srsName",l);s&&t.setAttributeNS(om,"xmlns:"+n,s);var h=T({},o);h.node=t;Yd(h,em,Ad("PropertyName"),a,i);var u=o.filter;if(u){var c=Ed(nm,"Filter");t.appendChild(c);fm(c,u,i)}})},"http://www.opengis.net/ogc":{During:Md(function(t,e,i){var r=Ed("http://www.opengis.net/fes","ValueReference");sf(r,e.propertyName);t.appendChild(r);var o=Ed(Vd,"TimePeriod");t.appendChild(o);var n=Ed(Vd,"begin");o.appendChild(n);Em(n,e.begin);var s=Ed(Vd,"end");o.appendChild(s);Em(s,e.end)}),And:Md(_m),Or:Md(_m),Not:Md(function(t,e,i){var r={node:t},o=e.condition;Yd(r,dm,Ad(o.getTagName()),[o],i)}),BBOX:Md(function(t,e,i){i[i.length-1].srsName=e.srsName;vm(t,e.geometryName);hf.prototype.writeGeometryElement(t,e.extent,i)}),Contains:Md(function(t,e,i){i[i.length-1].srsName=e.srsName;vm(t,e.geometryName);hf.prototype.writeGeometryElement(t,e.geometry,i)}),Intersects:Md(function(t,e,i){i[i.length-1].srsName=e.srsName;vm(t,e.geometryName);hf.prototype.writeGeometryElement(t,e.geometry,i)}),Within:Md(function(t,e,i){i[i.length-1].srsName=e.srsName;vm(t,e.geometryName);hf.prototype.writeGeometryElement(t,e.geometry,i)}),PropertyIsEqualTo:Md(gm),PropertyIsNotEqualTo:Md(gm),PropertyIsLessThan:Md(gm),PropertyIsLessThanOrEqualTo:Md(gm),PropertyIsGreaterThan:Md(gm),PropertyIsGreaterThanOrEqualTo:Md(gm),PropertyIsNull:Md(function(t,e,i){vm(t,e.propertyName)}),PropertyIsBetween:Md(function(t,e,i){vm(t,e.propertyName);var r=Ed(nm,"LowerBoundary");t.appendChild(r);mm(r,""+e.lowerBoundary);var o=Ed(nm,"UpperBoundary");t.appendChild(o);mm(o,""+e.upperBoundary)}),PropertyIsLike:Md(function(t,e,i){t.setAttribute("wildCard",e.wildCard);t.setAttribute("singleChar",e.singleChar);t.setAttribute("escapeChar",e.escapeChar);void 0!==e.matchCase&&t.setAttribute("matchCase",e.matchCase.toString());vm(t,e.propertyName);mm(t,""+e.pattern)})}};function fm(t,e,i){Yd({node:t},dm,Ad(e.getTagName()),[e],i)}function _m(t,e,i){for(var r={node:t},o=e.conditions,n=0,s=o.length;n<s;++n){var a=o[n];Yd(r,dm,Ad(a.getTagName()),[a],i)}}function gm(t,e,i){void 0!==e.matchCase&&t.setAttribute("matchCase",e.matchCase.toString());vm(t,e.propertyName);mm(t,""+e.expression)}function ym(t,e,i){var r=Ed(nm,t);sf(r,i);e.appendChild(r)}function vm(t,e){ym("PropertyName",t,e)}function mm(t,e){ym("Literal",t,e)}function Em(t,e){var i=Ed(Vd,"TimeInstant");t.appendChild(i);var r=Ed(Vd,"timePosition");i.appendChild(r);sf(r,e)}var xm={POINT:fo,LINESTRING:on,POLYGON:Fo,MULTIPOINT:wl,MULTILINESTRING:Il,MULTIPOLYGON:Ol},Tm="EMPTY",Sm="Z",Cm="M",Rm=1,Im=2,wm=3,Lm=4,Om=5,Pm=6,bm={};for(var Mm in kt)bm[Mm]=kt[Mm].toUpperCase();var Fm=function(t){this.wkt=t;this.index_=-1};Fm.prototype.isAlpha_=function(t){return"a"<=t&&t<="z"||"A"<=t&&t<="Z"};Fm.prototype.isNumeric_=function(t,e){return"0"<=t&&t<="9"||"."==t&&!(void 0!==e&&e)};Fm.prototype.isWhiteSpace_=function(t){return" "==t||"\t"==t||"\r"==t||"\n"==t};Fm.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)};Fm.prototype.nextToken=function(){var t=this.nextChar_(),e={position:this.index_,value:t};if("("==t)e.type=Im;else if(","==t)e.type=Om;else if(")"==t)e.type=wm;else if(this.isNumeric_(t)||"-"==t){e.type=Lm;e.value=this.readNumber_()}else if(this.isAlpha_(t)){e.type=Rm;e.value=this.readText_()}else{if(this.isWhiteSpace_(t))return this.nextToken();if(""!==t)throw new Error("Unexpected character: "+t);e.type=Pm}return e};Fm.prototype.readNumber_=function(){var t,e=this.index_,i=!1,r=!1;do{"."==t?i=!0:"e"!=t&&"E"!=t||(r=!0);t=this.nextChar_()}while(this.isNumeric_(t,i)||!r&&("e"==t||"E"==t)||r&&("-"==t||"+"==t));return parseFloat(this.wkt.substring(e,this.index_--))};Fm.prototype.readText_=function(){for(var t,e=this.index_;t=this.nextChar_(),this.isAlpha_(t););return this.wkt.substring(e,this.index_--).toUpperCase()};var Am=function(t){this.lexer_=t;this.token_;this.layout_=kr.XY};Am.prototype.consume_=function(){this.token_=this.lexer_.nextToken()};Am.prototype.isTokenType=function(t){return this.token_.type==t};Am.prototype.match=function(t){var e=this.isTokenType(t);e&&this.consume_();return e};Am.prototype.parse=function(){this.consume_();return this.parseGeometry_()};Am.prototype.parseGeometryLayout_=function(){var t=kr.XY,e=this.token_;if(this.isTokenType(Rm)){var i=e.value;i===Sm?t=kr.XYZ:i===Cm?t=kr.XYM:"ZM"===i&&(t=kr.XYZM);t!==kr.XY&&this.consume_()}return t};Am.prototype.parseGeometryCollectionText_=function(){if(this.match(Im)){for(var t=[];t.push(this.parseGeometry_()),this.match(Om););if(this.match(wm))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};Am.prototype.parsePointText_=function(){if(this.match(Im)){var t=this.parsePoint_();if(this.match(wm))return t}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())};Am.prototype.parseLineStringText_=function(){if(this.match(Im)){var t=this.parsePointList_();if(this.match(wm))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};Am.prototype.parsePolygonText_=function(){if(this.match(Im)){var t=this.parseLineStringTextList_();if(this.match(wm))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};Am.prototype.parseMultiPointText_=function(){if(this.match(Im)){var t;t=this.token_.type==Im?this.parsePointTextList_():this.parsePointList_();if(this.match(wm))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};Am.prototype.parseMultiLineStringText_=function(){if(this.match(Im)){var t=this.parseLineStringTextList_();if(this.match(wm))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};Am.prototype.parseMultiPolygonText_=function(){if(this.match(Im)){var t=this.parsePolygonTextList_();if(this.match(wm))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};Am.prototype.parsePoint_=function(){for(var t=[],e=this.layout_.length,i=0;i<e;++i){var r=this.token_;if(!this.match(Lm))break;t.push(r.value)}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())};Am.prototype.parsePointList_=function(){for(var t=[this.parsePoint_()];this.match(Om);)t.push(this.parsePoint_());return t};Am.prototype.parsePointTextList_=function(){for(var t=[this.parsePointText_()];this.match(Om);)t.push(this.parsePointText_());return t};Am.prototype.parseLineStringTextList_=function(){for(var t=[this.parseLineStringText_()];this.match(Om);)t.push(this.parseLineStringText_());return t};Am.prototype.parsePolygonTextList_=function(){for(var t=[this.parsePolygonText_()];this.match(Om);)t.push(this.parsePolygonText_());return t};Am.prototype.isEmptyGeometry_=function(){var t=this.isTokenType(Rm)&&this.token_.value==Tm;t&&this.consume_();return t};Am.prototype.formatErrorMessage_=function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"};Am.prototype.parseGeometry_=function(){var t=this.token_;if(this.match(Rm)){var e=t.value;this.layout_=this.parseGeometryLayout_();if("GEOMETRYCOLLECTION"==e){var i=this.parseGeometryCollectionText_();return new Kf(i)}var r,o=xm[e];if(!o)throw new Error("Invalid geometry type: "+e);switch(e){case"POINT":r=this.parsePointText_();break;case"LINESTRING":r=this.parseLineStringText_();break;case"POLYGON":r=this.parsePolygonText_();break;case"MULTIPOINT":r=this.parseMultiPointText_();break;case"MULTILINESTRING":r=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":r=this.parseMultiPolygonText_();break;default:throw new Error("Invalid geometry type: "+e)}r||(r=o===xm.POINT?[NaN,NaN]:[]);return new o(r,this.layout_)}throw new Error(this.formatErrorMessage_())};var Nm=function(i){function t(t){i.call(this);var e=t||{};this.splitCollection_=void 0!==e.splitCollection&&e.splitCollection}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.parse_=function(t){var e=new Fm(t);return new Am(e).parse()};t.prototype.readFeatureFromText=function(t,e){var i=this.readGeometryFromText(t,e);if(i){var r=new Sr;r.setGeometry(i);return r}return null};t.prototype.readFeaturesFromText=function(t,e){for(var i=[],r=this.readGeometryFromText(t,e),o=[],n=0,s=(i=this.splitCollection_&&r.getType()==kt.GEOMETRY_COLLECTION?r.getGeometriesArray():[r]).length;n<s;++n){var a=new Sr;a.setGeometry(i[n]);o.push(a)}return o};t.prototype.readGeometryFromText=function(t,e){var i=this.parse_(t);return i?ld(i,!1,e):null};t.prototype.writeFeatureText=function(t,e){var i=t.getGeometry();return i?this.writeGeometryText(i,e):""};t.prototype.writeFeaturesText=function(t,e){if(1==t.length)return this.writeFeatureText(t[0],e);for(var i=[],r=0,o=t.length;r<o;++r)i.push(t[r].getGeometry());var n=new Kf(i);return this.writeGeometryText(n,e)};t.prototype.writeGeometryText=function(t,e){return Um(ld(t,!0,e))};return t}($f);function Dm(t){var e=t.getCoordinates();return 0===e.length?"":e.join(" ")}function Gm(t){for(var e=t.getCoordinates(),i=[],r=0,o=e.length;r<o;++r)i.push(e[r].join(" "));return i.join(",")}function km(t){for(var e=[],i=t.getLinearRings(),r=0,o=i.length;r<o;++r)e.push("("+Gm(i[r])+")");return e.join(",")}var jm={Point:Dm,LineString:Gm,Polygon:km,MultiPoint:function(t){for(var e=[],i=t.getPoints(),r=0,o=i.length;r<o;++r)e.push("("+Dm(i[r])+")");return e.join(",")},MultiLineString:function(t){for(var e=[],i=t.getLineStrings(),r=0,o=i.length;r<o;++r)e.push("("+Gm(i[r])+")");return e.join(",")},MultiPolygon:function(t){for(var e=[],i=t.getPolygons(),r=0,o=i.length;r<o;++r)e.push("("+km(i[r])+")");return e.join(",")},GeometryCollection:function(t){for(var e=[],i=t.getGeometries(),r=0,o=i.length;r<o;++r)e.push(Um(i[r]));return e.join(",")}};function Um(t){var e=t.getType(),i=(0,jm[e])(t);e=e.toUpperCase();if(t instanceof jr){var r=function(t){var e=t.getLayout(),i="";e!==kr.XYZ&&e!==kr.XYZM||(i+=Sm);e!==kr.XYM&&e!==kr.XYZM||(i+=Cm);return i}(t);0<r.length&&(e+=" "+r)}return 0===i.length?e+" "+Tm:e+"("+i+")"}var Ym=[null,"http://www.opengis.net/wms"],Bm=Gd(Ym,{Service:bd(function(t,e){return jd({},zm,t,e)}),Capability:bd(function(t,e){return jd({},Vm,t,e)})}),Vm=Gd(Ym,{Request:bd(function(t,e){return jd({},$m,t,e)}),Exception:bd(function(t,e){return jd([],Zm,t,e)}),Layer:bd(function(t,e){return jd({},qm,t,e)})}),Xm=function(t){function e(){t.call(this);this.version=void 0}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null};e.prototype.readFromNode=function(t){this.version=t.getAttribute("version").trim();var e=jd({version:this.version},Bm,t,[]);return e||null};return e}(Hy),zm=Gd(Ym,{Name:bd($d),Title:bd($d),Abstract:bd($d),KeywordList:bd(hE),OnlineResource:bd(Wy),ContactInformation:bd(function(t,e){return jd({},Wm,t,e)}),Fees:bd($d),AccessConstraints:bd($d),LayerLimit:bd(Jd),MaxWidth:bd(Jd),MaxHeight:bd(Jd)}),Wm=Gd(Ym,{ContactPersonPrimary:bd(function(t,e){return jd({},Hm,t,e)}),ContactPosition:bd($d),ContactAddress:bd(function(t,e){return jd({},Km,t,e)}),ContactVoiceTelephone:bd($d),ContactFacsimileTelephone:bd($d),ContactElectronicMailAddress:bd($d)}),Hm=Gd(Ym,{ContactPerson:bd($d),ContactOrganization:bd($d)}),Km=Gd(Ym,{AddressType:bd($d),Address:bd($d),City:bd($d),StateOrProvince:bd($d),PostCode:bd($d),Country:bd($d)}),Zm=Gd(Ym,{Format:Ld($d)}),qm=Gd(Ym,{Name:bd($d),Title:bd($d),Abstract:bd($d),KeywordList:bd(hE),CRS:Pd($d),EX_GeographicBoundingBox:bd(function(t,e){var i=jd({},Qm,t,e);if(!i)return;var r=i.westBoundLongitude,o=i.southBoundLatitude,n=i.eastBoundLongitude,s=i.northBoundLatitude;return void 0!==r&&void 0!==o&&void 0!==n&&void 0!==s?[r,o,n,s]:void 0}),BoundingBox:Pd(function(t,e){var i=[qd(t.getAttribute("minx")),qd(t.getAttribute("miny")),qd(t.getAttribute("maxx")),qd(t.getAttribute("maxy"))],r=[qd(t.getAttribute("resx")),qd(t.getAttribute("resy"))];return{crs:t.getAttribute("CRS"),extent:i,res:r}}),Dimension:Pd(function(t,e){return{name:t.getAttribute("name"),units:t.getAttribute("units"),unitSymbol:t.getAttribute("unitSymbol"),default:t.getAttribute("default"),multipleValues:Hd(t.getAttribute("multipleValues")),nearestValue:Hd(t.getAttribute("nearestValue")),current:Hd(t.getAttribute("current")),values:$d(t)}}),Attribution:bd(function(t,e){return jd({},Jm,t,e)}),AuthorityURL:Pd(function(t,e){var i=sE(t,e);if(i){i.name=t.getAttribute("name");return i}return}),Identifier:Pd($d),MetadataURL:Pd(function(t,e){var i=sE(t,e);if(i){i.type=t.getAttribute("type");return i}return}),DataURL:Pd(sE),FeatureListURL:Pd(sE),Style:Pd(function(t,e){return jd({},rE,t,e)}),MinScaleDenominator:bd(Zd),MaxScaleDenominator:bd(Zd),Layer:Pd(function(t,e){var i=e[e.length-1],r=jd({},qm,t,e);if(!r)return;var o=Hd(t.getAttribute("queryable"));void 0===o&&(o=i.queryable);r.queryable=void 0!==o&&o;var n=Qd(t.getAttribute("cascaded"));void 0===n&&(n=i.cascaded);r.cascaded=n;var s=Hd(t.getAttribute("opaque"));void 0===s&&(s=i.opaque);r.opaque=void 0!==s&&s;var a=Hd(t.getAttribute("noSubsets"));void 0===a&&(a=i.noSubsets);r.noSubsets=void 0!==a&&a;var l=qd(t.getAttribute("fixedWidth"));l||(l=i.fixedWidth);r.fixedWidth=l;var h=qd(t.getAttribute("fixedHeight"));h||(h=i.fixedHeight);r.fixedHeight=h;["Style","CRS","AuthorityURL"].forEach(function(t){if(t in i){var e=r[t]||[];r[t]=e.concat(i[t])}});["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(t){if(!(t in r)){var e=i[t];r[t]=e}});return r})}),Jm=Gd(Ym,{Title:bd($d),OnlineResource:bd(Wy),LogoURL:bd(lE)}),Qm=Gd(Ym,{westBoundLongitude:bd(Zd),eastBoundLongitude:bd(Zd),southBoundLatitude:bd(Zd),northBoundLatitude:bd(Zd)}),$m=Gd(Ym,{GetCapabilities:bd(aE),GetMap:bd(aE),GetFeatureInfo:bd(aE)}),tE=Gd(Ym,{Format:Pd($d),DCPType:Pd(function(t,e){return jd({},eE,t,e)})}),eE=Gd(Ym,{HTTP:bd(function(t,e){return jd({},iE,t,e)})}),iE=Gd(Ym,{Get:bd(sE),Post:bd(sE)}),rE=Gd(Ym,{Name:bd($d),Title:bd($d),Abstract:bd($d),LegendURL:Pd(lE),StyleSheetURL:bd(sE),StyleURL:bd(sE)}),oE=Gd(Ym,{Format:bd($d),OnlineResource:bd(Wy)}),nE=Gd(Ym,{Keyword:Ld($d)});function sE(t,e){return jd({},oE,t,e)}function aE(t,e){return jd({},tE,t,e)}function lE(t,e){var i=sE(t,e);if(i){var r=[Qd(t.getAttribute("width")),Qd(t.getAttribute("height"))];i.size=r;return i}}function hE(t,e){return jd([],nE,t,e)}var uE=function(i){function t(t){i.call(this);var e=t||{};this.featureNS_="http://mapserver.gis.umn.edu/mapserver";this.gmlFormat_=new df;this.layers_=e.layers?e.layers:null}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getLayers=function(){return this.layers_};t.prototype.setLayers=function(t){this.layers_=t};t.prototype.readFeatures_=function(t,e){t.setAttribute("namespaceURI",this.featureNS_);var i=t.localName,r=[];if(0===t.childNodes.length)return r;if("msGMLOutput"==i)for(var o=0,n=t.childNodes.length;o<n;o++){var s=t.childNodes[o];if(s.nodeType===Node.ELEMENT_NODE){var a=e[0],l=s.localName.replace("_layer","");if(!this.layers_||Lr(this.layers_,l)){var h=l+"_feature";a.featureType=h;a.featureNS=this.featureNS_;var u={};u[h]=Ld(this.gmlFormat_.readFeatureElement,this.gmlFormat_);var c=Gd([a.featureNS,null],u);s.setAttribute("namespaceURI",this.featureNS_);var p=jd([],c,s,e,this.gmlFormat_);p&&br(r,p)}}}if("FeatureCollection"==i){var d=jd([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,[{}],this.gmlFormat_);d&&(r=d)}return r};t.prototype.readFeaturesFromNode=function(t,e){var i={};e&&T(i,this.getReadOptions(t,e));return this.readFeatures_(t,[i])};return t}(Bd),cE=[null,"http://www.opengis.net/wmts/1.0"],pE=[null,"http://www.opengis.net/ows/1.1"],dE=Gd(cE,{Contents:bd(function(t,e){return jd({},_E,t,e)})}),fE=function(t){function e(){t.call(this);this.owsParser_=new qy}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null};e.prototype.readFromNode=function(t){var e=t.getAttribute("version").trim(),i=this.owsParser_.readFromNode(t);if(!i)return null;i.version=e;return(i=jd(i,dE,t,[]))||null};return e}(Hy),_E=Gd(cE,{Layer:Pd(function(t,e){return jd({},gE,t,e)}),TileMatrixSet:Pd(function(t,e){return jd({},SE,t,e)})}),gE=Gd(cE,{Style:Pd(function(t,e){var i=jd({},yE,t,e);if(!i)return;var r="true"===t.getAttribute("isDefault");i.isDefault=r;return i}),Format:Pd($d),TileMatrixSetLink:Pd(function(t,e){return jd({},vE,t,e)}),Dimension:Pd(function(t,e){return jd({},xE,t,e)}),ResourceURL:Pd(function(t,e){var i=t.getAttribute("format"),r=t.getAttribute("template"),o=t.getAttribute("resourceType"),n={};i&&(n.format=i);r&&(n.template=r);o&&(n.resourceType=o);return n})},Gd(pE,{Title:bd($d),Abstract:bd($d),WGS84BoundingBox:bd(function(t,e){var i=jd([],TE,t,e);return 2==i.length?G(i):void 0}),Identifier:bd($d)})),yE=Gd(cE,{LegendURL:Pd(function(t,e){var i={};i.format=t.getAttribute("format");i.href=Wy(t);return i})},Gd(pE,{Title:bd($d),Identifier:bd($d)})),vE=Gd(cE,{TileMatrixSet:bd($d),TileMatrixSetLimits:bd(function(t,e){return jd([],mE,t,e)})}),mE=Gd(cE,{TileMatrixLimits:Ld(function(t,e){return jd({},EE,t,e)})}),EE=Gd(cE,{TileMatrix:bd($d),MinTileRow:bd(Jd),MaxTileRow:bd(Jd),MinTileCol:bd(Jd),MaxTileCol:bd(Jd)}),xE=Gd(cE,{Default:bd($d),Value:Pd($d)},Gd(pE,{Identifier:bd($d)})),TE=Gd(pE,{LowerCorner:Ld(RE),UpperCorner:Ld(RE)}),SE=Gd(cE,{WellKnownScaleSet:bd($d),TileMatrix:Pd(function(t,e){return jd({},CE,t,e)})},Gd(pE,{SupportedCRS:bd($d),Identifier:bd($d)})),CE=Gd(cE,{TopLeftCorner:bd(RE),ScaleDenominator:bd(Zd),TileWidth:bd(Jd),TileHeight:bd(Jd),MatrixWidth:bd(Jd),MatrixHeight:bd(Jd)},Gd(pE,{Identifier:bd($d)}));function RE(t,e){var i=$d(t).split(/\s+/);if(i&&2==i.length){var r=+i[0],o=+i[1];if(!isNaN(r)&&!isNaN(o))return[r,o]}}var IE="blur",wE="gradient",LE="radius",OE=["#00f","#0ff","#0f0","#ff0","#f00"],PE=function(o){function t(t){var e=t||{},i=T({},e);delete i.gradient;delete i.radius;delete i.blur;delete i.shadow;delete i.weight;o.call(this,i);this.gradient_=null;this.shadow_=void 0!==e.shadow?e.shadow:250;this.circleImage_=void 0;this.styleCache_=null;S(this,P(wE),this.handleGradientChanged_,this);this.setGradient(e.gradient?e.gradient:OE);this.setBlur(void 0!==e.blur?e.blur:15);this.setRadius(void 0!==e.radius?e.radius:8);S(this,P(IE),this.handleStyleChanged_,this);S(this,P(LE),this.handleStyleChanged_,this);this.handleStyleChanged_();var s,r=e.weight?e.weight:"weight";s="string"==typeof r?function(t){return t.get(r)}:r;this.setStyle(function(t,e){var i=s(t),r=void 0!==i?Lt(i,0,1):1,o=255*r|0,n=this.styleCache_[o];if(!n){n=[new yr({image:new E_({opacity:r,src:this.circleImage_})})];this.styleCache_[o]=n}return n}.bind(this));this.setRenderOrder(null);S(this,ln.RENDER,this.handleRender_,this)}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.createCircle_=function(){var t=this.getRadius(),e=this.getBlur(),i=t+e+1,r=2*i,o=ii(r,r);o.shadowOffsetX=o.shadowOffsetY=this.shadow_;o.shadowBlur=e;o.shadowColor="#000";o.beginPath();var n=i-this.shadow_;o.arc(n,n,t,0,2*Math.PI,!0);o.fill();return o.canvas.toDataURL()};t.prototype.getBlur=function(){return this.get(IE)};t.prototype.getGradient=function(){return this.get(wE)};t.prototype.getRadius=function(){return this.get(LE)};t.prototype.handleGradientChanged_=function(){this.gradient_=function(t){for(var e=ii(1,256),i=e.createLinearGradient(0,0,1,256),r=1/(t.length-1),o=0,n=t.length;o<n;++o)i.addColorStop(o*r,t[o]);e.fillStyle=i;e.fillRect(0,0,1,256);return e.getImageData(0,0,1,256).data}(this.getGradient())};t.prototype.handleStyleChanged_=function(){this.circleImage_=this.createCircle_();this.styleCache_=new Array(256);this.changed()};t.prototype.handleRender_=function(t){for(var e=t.context,i=e.canvas,r=e.getImageData(0,0,i.width,i.height),o=r.data,n=0,s=o.length;n<s;n+=4){var a=4*o[n+3];if(a){o[n]=this.gradient_[a];o[n+1]=this.gradient_[a+1];o[n+2]=this.gradient_[a+2]}}e.putImageData(r,0,0)};t.prototype.setBlur=function(t){this.set(IE,t)};t.prototype.setGradient=function(t){this.set(wE,t)};t.prototype.setRadius=function(t){this.set(LE,t)};return t}(Ml);var bE=function(i){function t(t){var e=t||{};i.call(this,e);this.type=In.IMAGE}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(qs);bE.prototype.getSource;var ME={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},FE=function(r){function t(t){var e=t||{},i=T({},e);delete i.preload;delete i.useInterimTilesOnError;r.call(this,i);this.setPreload(void 0!==e.preload?e.preload:0);this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError);this.type=In.TILE}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getPreload=function(){return this.get(ME.PRELOAD)};t.prototype.setPreload=function(t){this.set(ME.PRELOAD,t)};t.prototype.getUseInterimTilesOnError=function(){return this.get(ME.USE_INTERIM_TILES_ON_ERROR)};t.prototype.setUseInterimTilesOnError=function(t){this.set(ME.USE_INTERIM_TILES_ON_ERROR,t)};return t}(qs);FE.prototype.getSource;var AE=function(o){function t(t){var e=t||{},i=e.renderMode||zu.HYBRID;A(null==i||i==zu.IMAGE||i==zu.HYBRID||i==zu.VECTOR,28);e.declutter&&i==zu.IMAGE&&(i=zu.HYBRID);e.renderMode=i;var r=T({},e);delete r.preload;delete r.useInterimTilesOnError;o.call(this,r);this.setPreload(e.preload?e.preload:0);this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError);this.type=In.VECTOR_TILE}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.getPreload=function(){return this.get(ME.PRELOAD)};t.prototype.getUseInterimTilesOnError=function(){return this.get(ME.USE_INTERIM_TILES_ON_ERROR)};t.prototype.setPreload=function(t){this.set(ME.PRELOAD,t)};t.prototype.setUseInterimTilesOnError=function(t){this.set(ME.USE_INTERIM_TILES_ON_ERROR,t)};return t}(Ml);AE.prototype.getSource;function NE(t,e,i,r){var o=we(i,e,t),n=ve(e,r,i),s=e.getMetersPerUnit();void 0!==s&&(n*=s);var a=t.getMetersPerUnit();void 0!==a&&(n/=a);var l=t.getExtent();if(!l||Y(l,o)){var h=ve(t,n,o)/n;isFinite(h)&&0<h&&(n/=h)}return n}function DE(t,e,i,r){var o=i-t,n=r-e,s=Math.sqrt(o*o+n*n);return[Math.round(i+o/s),Math.round(r+n/s)]}function GE(t,e,R,I,i,w,r,o,n,a,s){var L=ii(Math.round(R*t),Math.round(R*e));if(0===n.length)return L.canvas;L.scale(R,R);var O=[1/0,1/0,-1/0,-1/0];n.forEach(function(t,e,i){q(O,t.extent)});var l=_t(O),h=ct(O),P=ii(Math.round(R*l/I),Math.round(R*h/I)),u=R/I;n.forEach(function(t,e,i){var r=t.extent[0]-O[0],o=-(t.extent[3]-O[3]),n=_t(t.extent),s=ct(t.extent);P.drawImage(t.image,a,a,t.image.width-2*a,t.image.height-2*a,r*u,o*u,n*u,s*u)});var b=dt(r);o.getTriangles().forEach(function(t,e,i){var r=t.source,o=t.target,n=r[0][0],s=r[0][1],a=r[1][0],l=r[1][1],h=r[2][0],u=r[2][1],c=(o[0][0]-b[0])/w,p=-(o[0][1]-b[1])/w,d=(o[1][0]-b[0])/w,f=-(o[1][1]-b[1])/w,_=(o[2][0]-b[0])/w,g=-(o[2][1]-b[1])/w,y=n,v=s,m=Ft([[a-=y,l-=v,s=n=0,0,d-c],[h-=y,u-=v,0,0,_-c],[0,0,a,l,f-p],[0,0,h,u,g-p]]);if(m){L.save();L.beginPath();var E=(c+d+_)/3,x=(p+f+g)/3,T=DE(E,x,c,p),S=DE(E,x,d,f),C=DE(E,x,_,g);L.moveTo(S[0],S[1]);L.lineTo(T[0],T[1]);L.lineTo(C[0],C[1]);L.clip();L.transform(m[0],m[2],m[1],m[3],c,p);L.translate(O[0]-y,O[3]-v);L.scale(I/R,-I/R);L.drawImage(P.canvas,0,0);L.restore()}});if(s){L.save();L.strokeStyle="black";L.lineWidth=1;o.getTriangles().forEach(function(t,e,i){var r=t.target,o=(r[0][0]-b[0])/w,n=-(r[0][1]-b[1])/w,s=(r[1][0]-b[0])/w,a=-(r[1][1]-b[1])/w,l=(r[2][0]-b[0])/w,h=-(r[2][1]-b[1])/w;L.beginPath();L.moveTo(s,a);L.lineTo(o,n);L.lineTo(l,h);L.closePath();L.stroke()});L.restore()}return L.canvas}var kE=function(t,e,i,r,o){this.sourceProj_=t;this.targetProj_=e;var n={},s=Ie(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];n[e]||(n[e]=s(t));return n[e]};this.maxSourceExtent_=r;this.errorThresholdSquared_=o*o;this.triangles_=[];this.wrapsXInSource_=!1;this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&_t(r)==_t(this.sourceProj_.getExtent());this.sourceWorldWidth_=this.sourceProj_.getExtent()?_t(this.sourceProj_.getExtent()):null;this.targetWorldWidth_=this.targetProj_.getExtent()?_t(this.targetProj_.getExtent()):null;var a=dt(i),l=ft(i),h=at(i),u=st(i),c=this.transformInv_(a),p=this.transformInv_(l),d=this.transformInv_(h),f=this.transformInv_(u);this.addQuad_(a,l,h,u,c,p,d,f,10);if(this.wrapsXInSource_){var _=1/0;this.triangles_.forEach(function(t,e,i){_=Math.min(_,t.source[0][0],t.source[1][0],t.source[2][0])});this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-_>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-_>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_);e[1][0]-_>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_);e[2][0]-_>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var i=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-i<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}n={}};kE.prototype.addTriangle_=function(t,e,i,r,o,n){this.triangles_.push({source:[r,o,n],target:[t,e,i]})};kE.prototype.addQuad_=function(t,e,i,r,o,n,s,a,l){var h=G([o,n,s,a]),u=this.sourceWorldWidth_?_t(h)/this.sourceWorldWidth_:null,c=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&.5<u&&u<1,d=!1;if(0<l){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){d=.25<_t(G([t,e,i,r]))/this.targetWorldWidth_||d}!p&&this.sourceProj_.isGlobal()&&u&&(d=.25<u||d)}if(d||!this.maxSourceExtent_||Rt(h,this.maxSourceExtent_)){if(!(d||isFinite(o[0])&&isFinite(o[1])&&isFinite(n[0])&&isFinite(n[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(a[0])&&isFinite(a[1]))){if(!(0<l))return;d=!0}if(0<l){if(!d){var f,_=[(t[0]+i[0])/2,(t[1]+i[1])/2],g=this.transformInv_(_);if(p){f=(Dt(o[0],c)+Dt(s[0],c))/2-Dt(g[0],c)}else f=(o[0]+s[0])/2-g[0];var y=(o[1]+s[1])/2-g[1];d=f*f+y*y>this.errorThresholdSquared_}if(d){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){var v=[(e[0]+i[0])/2,(e[1]+i[1])/2],m=this.transformInv_(v),E=[(r[0]+t[0])/2,(r[1]+t[1])/2],x=this.transformInv_(E);this.addQuad_(t,e,v,E,o,n,m,x,l-1);this.addQuad_(E,v,i,r,x,m,s,a,l-1)}else{var T=[(t[0]+e[0])/2,(t[1]+e[1])/2],S=this.transformInv_(T),C=[(i[0]+r[0])/2,(i[1]+r[1])/2],R=this.transformInv_(C);this.addQuad_(t,T,C,r,o,S,R,a,l-1);this.addQuad_(T,e,i,C,S,n,s,R,l-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(t,i,r,o,s,a);this.addTriangle_(t,e,i,o,n,s)}};kE.prototype.calculateSourceExtent=function(){var o=[1/0,1/0,-1/0,-1/0];this.triangles_.forEach(function(t,e,i){var r=t.source;J(o,r[0]);J(o,r[1]);J(o,r[2])});return o};kE.prototype.getTriangles=function(){return this.triangles_};var jE=function(f){function t(t,e,i,r,o,n){var s=t.getExtent(),a=e.getExtent(),l=a?pt(i,a):i,h=NE(t,e,lt(l),r),u=new kE(t,e,l,s,.5*h),c=n(u.calculateSourceExtent(),h,o),p=Ni.LOADED;c&&(p=Ni.IDLE);var d=c?c.getPixelRatio():1;f.call(this,i,r,d,p);this.targetProj_=e;this.maxSourceExtent_=s;this.triangulation_=u;this.targetResolution_=r;this.targetExtent_=i;this.sourceImage_=c;this.sourcePixelRatio_=d;this.canvas_=null;this.sourceListenerKey_=null}f&&(t.__proto__=f);((t.prototype=Object.create(f&&f.prototype)).constructor=t).prototype.disposeInternal=function(){this.state==Ni.LOADING&&this.unlistenSource_();f.prototype.disposeInternal.call(this)};t.prototype.getImage=function(){return this.canvas_};t.prototype.getProjection=function(){return this.targetProj_};t.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(t==Ni.LOADED){var e=_t(this.targetExtent_)/this.targetResolution_,i=ct(this.targetExtent_)/this.targetResolution_;this.canvas_=GE(e,i,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=t;this.changed()};t.prototype.load=function(){if(this.state==Ni.IDLE){this.state=Ni.LOADING;this.changed();var t=this.sourceImage_.getState();if(t==Ni.LOADED||t==Ni.ERROR)this.reproject_();else{this.sourceListenerKey_=S(this.sourceImage_,R.CHANGE,function(t){var e=this.sourceImage_.getState();if(e==Ni.LOADED||e==Ni.ERROR){this.unlistenSource_();this.reproject_()}},this);this.sourceImage_.load()}}};t.prototype.unlistenSource_=function(){g(this.sourceListenerKey_);this.sourceListenerKey_=null};return t}(fn),UE=function(C){function t(t,e,i,r,o,n,s,a,l,h,u){C.call(this,o,yn.IDLE);this.renderEdges_=void 0!==u&&u;this.pixelRatio_=s;this.gutter_=a;this.canvas_=null;this.sourceTileGrid_=e;this.targetTileGrid_=r;this.wrappedTileCoord_=n||o;this.sourceTiles_=[];this.sourcesListenerKeys_=null;this.sourceZ_=0;var c=r.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent(),d=this.sourceTileGrid_.getExtent(),f=p?pt(c,p):c;if(0!==nt(f)){var _=t.getExtent();_&&(d=d?pt(d,_):_);var g=r.getResolution(this.wrappedTileCoord_[0]),y=NE(t,i,lt(f),g);if(!isFinite(y)||y<=0)this.state=yn.EMPTY;else{var v=void 0!==h?h:.5;this.triangulation_=new kE(t,i,f,d,y*v);if(0!==this.triangulation_.getTriangles().length){this.sourceZ_=e.getZForResolution(y);var m=this.triangulation_.calculateSourceExtent();if(d)if(t.canWrapX()){m[1]=Lt(m[1],d[1],d[3]);m[3]=Lt(m[3],d[1],d[3])}else m=pt(m,d);if(nt(m)){for(var E=e.getTileRangeForExtentAndZ(m,this.sourceZ_),x=E.minX;x<=E.maxX;x++)for(var T=E.minY;T<=E.maxY;T++){var S=l(this.sourceZ_,x,T,s);S&&this.sourceTiles_.push(S)}0===this.sourceTiles_.length&&(this.state=yn.EMPTY)}else this.state=yn.EMPTY}else this.state=yn.EMPTY}}else this.state=yn.EMPTY}C&&(t.__proto__=C);((t.prototype=Object.create(C&&C.prototype)).constructor=t).prototype.disposeInternal=function(){this.state==yn.LOADING&&this.unlistenSources_();C.prototype.disposeInternal.call(this)};t.prototype.getImage=function(){return this.canvas_};t.prototype.reproject_=function(){var r=[];this.sourceTiles_.forEach(function(t,e,i){t&&t.getState()==yn.LOADED&&r.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this));if((this.sourceTiles_.length=0)===r.length)this.state=yn.ERROR;else{var t=this.wrappedTileCoord_[0],e=this.targetTileGrid_.getTileSize(t),i="number"==typeof e?e:e[0],o="number"==typeof e?e:e[1],n=this.targetTileGrid_.getResolution(t),s=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=GE(i,o,this.pixelRatio_,s,this.sourceTileGrid_.getExtent(),n,a,this.triangulation_,r,this.gutter_,this.renderEdges_);this.state=yn.LOADED}this.changed()};t.prototype.load=function(){if(this.state==yn.IDLE){this.state=yn.LOADING;this.changed();var n=0;this.sourcesListenerKeys_=[];this.sourceTiles_.forEach(function(i,t,e){var r=i.getState();if(r==yn.IDLE||r==yn.LOADING){n++;var o=S(i,R.CHANGE,function(t){var e=i.getState();if(e==yn.LOADED||e==yn.ERROR||e==yn.EMPTY){g(o);if(0===--n){this.unlistenSources_();this.reproject_()}}},this);this.sourcesListenerKeys_.push(o)}}.bind(this));this.sourceTiles_.forEach(function(t,e,i){t.getState()==yn.IDLE&&t.load()});0===n&&setTimeout(this.reproject_.bind(this),0)}};t.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(g);this.sourcesListenerKeys_=null};return t}(Tn);function YE(r,o){var n=/\{z\}/g,s=/\{x\}/g,a=/\{y\}/g,l=/\{-y\}/g;return function(i,t,e){return i?r.replace(n,i[0].toString()).replace(s,i[1].toString()).replace(a,function(){return(-i[2]-1).toString()}).replace(l,function(){var t=i[0],e=o.getFullTileRange(t);A(e,55);return(e.getHeight()+i[2]).toString()}):void 0}}function BE(t,e){for(var i=t.length,r=new Array(i),o=0;o<i;++o)r[o]=YE(t[o],e);return VE(r)}function VE(o){return 1===o.length?o[0]:function(t,e,i){if(t){var r=Dt(ac(t),o.length);return o[r](t,e,i)}}}function XE(t,e,i){}function zE(t){var e=[],i=/\{([a-z])-([a-z])\}/.exec(t);if(i){var r,o=i[1].charCodeAt(0),n=i[2].charCodeAt(0);for(r=o;r<=n;++r)e.push(t.replace(i[0],String.fromCharCode(r)));return e}if(i=i=/\{(\d+)-(\d+)\}/.exec(t)){for(var s=parseInt(i[2],10),a=parseInt(i[1],10);a<=s;a++)e.push(t.replace(i[0],a.toString()));return e}e.push(t);return e}function WE(t,e,i,r){var o=document.createElement("script"),n="olc_"+St(e);function s(){delete window[n];o.parentNode.removeChild(o)}o.async=!0;o.src=t+(-1==t.indexOf("?")?"?":"&")+(r||"callback")+"="+n;var a=setTimeout(function(){s();i&&i()},1e4);window[n]=function(t){clearTimeout(a);s();e(t)};document.getElementsByTagName("head")[0].appendChild(o)}var HE={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},KE=function(e){function t(t){e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,extent:t.extent,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition});this.tileLoadFunction=t.tileLoadFunction;this.tileUrlFunction=this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):XE;this.urls=null;t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url);t.tileUrlFunction&&this.setTileUrlFunction(t.tileUrlFunction);this.tileLoadingKeys_={}}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getTileLoadFunction=function(){return this.tileLoadFunction};t.prototype.getTileUrlFunction=function(){return this.tileUrlFunction};t.prototype.getUrls=function(){return this.urls};t.prototype.handleTileChange=function(t){var e,i=t.target,r=St(i),o=i.getState();if(o==yn.LOADING){this.tileLoadingKeys_[r]=!0;e=HE.TILELOADSTART}else if(r in this.tileLoadingKeys_){delete this.tileLoadingKeys_[r];e=o==yn.ERROR?HE.TILELOADERROR:o==yn.LOADED||o==yn.ABORT?HE.TILELOADEND:void 0}null!=e&&this.dispatchEvent(new qp(e,i))};t.prototype.setTileLoadFunction=function(t){this.tileCache.clear();this.tileLoadFunction=t;this.changed()};t.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t;this.tileCache.pruneExceptNewestZ();void 0!==e?this.setKey(e):this.changed()};t.prototype.setUrl=function(t){var e=this.urls=zE(t);this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):BE(e,this.tileGrid),t)};t.prototype.setUrls=function(t){var e=(this.urls=t).join("\n");this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):BE(t,this.tileGrid),e)};t.prototype.useTile=function(t,e,i){var r=oc(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)};return t}(Zp);KE.prototype.fixedTileUrlFunction;var ZE=function(e){function t(t){e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,extent:t.extent,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:qE,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition});this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null;this.tileClass=void 0!==t.tileClass?t.tileClass:Sn;this.tileCacheForProjection={};this.tileGridForProjection={};this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold;this.renderReprojectionEdges_=!1}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1};t.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(var r in this.tileCacheForProjection){var o=this.tileCacheForProjection[r];o.expireCache(o==i?e:{})}};t.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!Ce(this.getProjection(),t)?0:this.getGutter()};t.prototype.getGutter=function(){return 0};t.prototype.getOpaque=function(t){return!(this.getProjection()&&t&&!Ce(this.getProjection(),t))&&e.prototype.getOpaque.call(this,t)};t.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(!this.tileGrid||e&&!Ce(e,t)){var i=St(t).toString();i in this.tileGridForProjection||(this.tileGridForProjection[i]=Bp(t));return this.tileGridForProjection[i]}return this.tileGrid};t.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||Ce(e,t))return this.tileCache;var i=St(t).toString();i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new uc(this.tileCache.highWaterMark));return this.tileCacheForProjection[i]};t.prototype.createTile_=function(t,e,i,r,o,n){var s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s,o),l=a?this.tileUrlFunction(a,r,o):void 0,h=new this.tileClass(s,void 0!==l?yn.IDLE:yn.EMPTY,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);h.key=n;S(h,R.CHANGE,this.handleTileChange,this);return h};t.prototype.getTile=function(t,e,i,r,o){var n=this.getProjection();if(n&&o&&!Ce(n,o)){var s,a=this.getTileCacheForProjection(o),l=[t,e,i],h=nc(l);a.containsKey(h)&&(s=a.get(h));var u=this.getKey();if(s&&s.key==u)return s;var c=this.getTileGridForProjection(n),p=this.getTileGridForProjection(o),d=this.getTileCoordForTileUrlFunction(l,o),f=new UE(n,c,o,p,l,d,this.getTilePixelRatio(r),this.getGutter(),function(t,e,i,r){return this.getTileInternal(t,e,i,r,n)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);f.key=u;if(s){f.interimTile=s;f.refreshInterimChain();a.replace(h,f)}else a.set(h,f);return f}return this.getTileInternal(t,e,i,r,n||o)};t.prototype.getTileInternal=function(t,e,i,r,o){var n=null,s=oc(t,e,i),a=this.getKey();if(this.tileCache.containsKey(s)){if((n=this.tileCache.get(s)).key!=a){var l=n;n=this.createTile_(t,e,i,r,o,a);l.getState()==yn.IDLE?n.interimTile=l.interimTile:n.interimTile=l;n.refreshInterimChain();this.tileCache.replace(s,n)}}else{n=this.createTile_(t,e,i,r,o,a);this.tileCache.set(s,n)}return n};t.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(var e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}};t.prototype.setTileGridForProjection=function(t,e){var i=ye(t);if(i){var r=St(i).toString();r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}};return t}(KE);function qE(t,e){var i=t.getImage();(i instanceof HTMLImageElement||i instanceof HTMLVideoElement)&&(i.src=e)}var JE=function(i){function t(t){var e=void 0!==t.hidpi&&t.hidpi;i.call(this,{cacheSize:t.cacheSize,crossOrigin:"anonymous",opaque:!0,projection:ye("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:Ys.LOADING,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition});this.hidpi_=e;this.culture_=void 0!==t.culture?t.culture:"en-us";this.maxZoom_=void 0!==t.maxZoom?t.maxZoom:-1;this.apiKey_=t.key;this.imagerySet_=t.imagerySet;WE("https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_,this.handleImageryMetadataResponse.bind(this),void 0,"jsonp")}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getApiKey=function(){return this.apiKey_};t.prototype.getImagerySet=function(){return this.imagerySet_};t.prototype.handleImageryMetadataResponse=function(t){if(200==t.statusCode&&"OK"==t.statusDescription&&"ValidCredentials"==t.authenticationResultCode&&1==t.resourceSets.length&&1==t.resourceSets[0].resources.length){var e=t.resourceSets[0].resources[0],i=-1==this.maxZoom_?e.zoomMax:this.maxZoom_,r=Kp(this.getProjection()),o=this.hidpi_?2:1,n=e.imageWidth==e.imageHeight?e.imageWidth/o:[e.imageWidth/o,e.imageHeight/o],s=zp({extent:r,minZoom:e.zoomMin,maxZoom:i,tileSize:n});this.tileGrid=s;var a=this.culture_,l=this.hidpi_;this.tileUrlFunction=VE(e.imageUrlSubdomains.map(function(t){var o=[0,0,0],n=e.imageUrl.replace("{subdomain}",t).replace("{culture}",a);return function(t,e,i){if(t){rc(t[0],t[1],-t[2]-1,o);var r=n;l&&(r+="&dpi=d1&device=mobile");return r.replace("{quadkey}",lc(o))}}}));if(e.imageryProviders){var u=Re(ye("EPSG:4326"),this.getProjection());this.setAttributions(function(a){var l=[],h=a.viewState.zoom;e.imageryProviders.map(function(t){for(var e=!1,i=t.coverageAreas,r=0,o=i.length;r<o;++r){var n=i[r];if(h>=n.zoomMin&&h<=n.zoomMax){var s=n.bbox;if(Rt(Et([s[1],s[0],s[3],s[2]],u),a.extent)){e=!0;break}}}e&&l.push(t.attribution)});l.push('<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html">Terms of Use</a>');return l})}this.setState(Ys.READY)}else this.setState(Ys.ERROR)};return t}(ZE),QE=function(o){function t(t){var e=t||{},i=void 0!==e.projection?e.projection:"EPSG:3857",r=void 0!==e.tileGrid?e.tileGrid:zp({extent:Kp(i),maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});o.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,opaque:e.opaque,projection:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition})}o&&(t.__proto__=o);return(t.prototype=Object.create(o&&o.prototype)).constructor=t}(ZE),$E=function(e){function t(t){e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,maxZoom:void 0!==t.maxZoom?t.maxZoom:18,minZoom:t.minZoom,projection:t.projection,wrapX:t.wrapX});this.account_=t.account;this.mapId_=t.map||"";this.config_=t.config||{};this.templateCache_={};this.initializeMap_()}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getConfig=function(){return this.config_};t.prototype.updateConfig=function(t){T(this.config_,t);this.initializeMap_()};t.prototype.setConfig=function(t){this.config_=t||{};this.initializeMap_()};t.prototype.initializeMap_=function(){var t=JSON.stringify(this.config_);if(this.templateCache_[t])this.applyTemplate_(this.templateCache_[t]);else{var e="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(e+="/named/"+this.mapId_);var i=new XMLHttpRequest;i.addEventListener("load",this.handleInitResponse_.bind(this,t));i.addEventListener("error",this.handleInitError_.bind(this));i.open("POST",e);i.setRequestHeader("Content-type","application/json");i.send(JSON.stringify(this.config_))}};t.prototype.handleInitResponse_=function(t,e){var i=e.target;if(!i.status||200<=i.status&&i.status<300){var r;try{r=JSON.parse(i.responseText)}catch(t){this.setState(Ys.ERROR);return}this.applyTemplate_(r);this.templateCache_[t]=r;this.setState(Ys.READY)}else this.setState(Ys.ERROR)};t.prototype.handleInitError_=function(t){this.setState(Ys.ERROR)};t.prototype.applyTemplate_=function(t){var e="https://"+t.cdn_url.https+"/"+this.account_+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(e)};return t}(QE),tx=function(e){function t(t){e.call(this,{attributions:t.attributions,wrapX:t.wrapX});this.resolution=void 0;this.distance=void 0!==t.distance?t.distance:20;this.features=[];this.geometryFunction=t.geometryFunction||function(t){var e=t.getGeometry();A(e instanceof fo,10);return e};this.source=t.source;S(this.source,R.CHANGE,this.refresh,this)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getDistance=function(){return this.distance};t.prototype.getSource=function(){return this.source};t.prototype.loadFeatures=function(t,e,i){this.source.loadFeatures(t,e,i);if(e!==this.resolution){this.clear();this.resolution=e;this.cluster();this.addFeatures(this.features)}};t.prototype.setDistance=function(t){this.distance=t;this.refresh()};t.prototype.refresh=function(){this.clear();this.cluster();this.addFeatures(this.features);e.prototype.refresh.call(this)};t.prototype.cluster=function(){if(void 0!==this.resolution)for(var t=[1/(this.features.length=0),1/0,-1/0,-1/0],e=this.distance*this.resolution,i=this.source.getFeatures(),r={},o=0,n=i.length;o<n;o++){var s=i[o];if(!(St(s).toString()in r)){var a=this.geometryFunction(s);if(a){H(a.getCoordinates(),t);k(t,e,t);var l=this.source.getFeaturesInExtent(t);l=l.filter(function(t){var e=St(t).toString();return!(e in r)&&(r[e]=!0)});this.features.push(this.createCluster(l))}}}};t.prototype.createCluster=function(t){for(var e=[0,0],i=t.length-1;0<=i;--i){var r=this.geometryFunction(t[i]);r?Yo(e,r.getCoordinates()):t.splice(i,1)}Ko(e,1/t.length);var o=new Sr(new fo(e));o.set("features",t);return o};return t}(oh),ex="imageloadstart",ix="imageloadend",rx="imageloaderror",ox=function(i){function t(t,e){i.call(this,t);this.image=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(m),nx=function(e){function t(t){e.call(this,{attributions:t.attributions,projection:t.projection,state:t.state});this.resolutions_=void 0!==t.resolutions?t.resolutions:null;this.reprojectedImage_=null;this.reprojectedRevision_=0}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getResolutions=function(){return this.resolutions_};t.prototype.findNearestResolution=function(t){if(this.resolutions_){var e=Or(this.resolutions_,t,0);t=this.resolutions_[e]}return t};t.prototype.getImage=function(t,e,i,r){var o=this.getProjection();if(o&&r&&!Ce(o,r)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Ce(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==e&&$(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose();this.reprojectedImage_=null}this.reprojectedImage_=new jE(o,r,t,e,i,function(t,e,i){return this.getImageInternal(t,e,i,o)}.bind(this));this.reprojectedRevision_=this.getRevision();return this.reprojectedImage_}o&&(r=o);return this.getImageInternal(t,e,i,r)};t.prototype.getImageInternal=function(t,e,i,r){};t.prototype.handleImageChange=function(t){var e=t.target;switch(e.getState()){case Ni.LOADING:this.loading=!0;this.dispatchEvent(new ox(ex,e));break;case Ni.LOADED:this.loading=!1;this.dispatchEvent(new ox(ix,e));break;case Ni.ERROR:this.loading=!1;this.dispatchEvent(new ox(rx,e))}};return t}(Gl);function sx(t,e){var i=t.getImage();(i instanceof HTMLImageElement||i instanceof HTMLVideoElement)&&(i.src=e)}function ax(t,e){var i=[];Object.keys(e).forEach(function(t){null!==e[t]&&void 0!==e[t]&&i.push(t+"="+encodeURIComponent(e[t]))});var r=i.join("&");return(t=-1===(t=t.replace(/[?&]$/,"")).indexOf("?")?t+"?":t+"&")+r}var lx=function(i){function t(t){var e=t||{};i.call(this,{attributions:e.attributions,projection:e.projection,resolutions:e.resolutions});this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;this.hidpi_=void 0===e.hidpi||e.hidpi;this.url_=e.url;this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:sx;this.params_=e.params||{};this.image_=null;this.imageSize_=[0,0];this.renderedRevision_=0;this.ratio_=void 0!==e.ratio?e.ratio:1.5}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getParams=function(){return this.params_};t.prototype.getImageInternal=function(t,e,i,r){if(void 0===this.url_)return null;e=this.findNearestResolution(e);i=this.hidpi_?i:1;var o=this.image_;if(o&&this.renderedRevision_==this.getRevision()&&o.getResolution()==e&&o.getPixelRatio()==i&&Q(o.getExtent(),t))return o;var n={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};T(n,this.params_);var s=((t=t.slice())[0]+t[2])/2,a=(t[1]+t[3])/2;if(1!=this.ratio_){var l=this.ratio_*_t(t)/2,h=this.ratio_*ct(t)/2;t[0]=s-l;t[1]=a-h;t[2]=s+l;t[3]=a+h}var u=e/i,c=Math.ceil(_t(t)/u),p=Math.ceil(ct(t)/u);t[0]=s-u*c/2;t[2]=s+u*c/2;t[1]=a-u*p/2;t[3]=a+u*p/2;this.imageSize_[0]=c;this.imageSize_[1]=p;var d=this.getRequestUrl_(t,this.imageSize_,i,r,n);this.image_=new _n(t,e,i,d,this.crossOrigin_,this.imageLoadFunction_);this.renderedRevision_=this.getRevision();S(this.image_,R.CHANGE,this.handleImageChange,this);return this.image_};t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};t.prototype.getRequestUrl_=function(t,e,i,r,o){var n=r.getCode().split(":").pop();o.SIZE=e[0]+","+e[1];o.BBOX=t.join(",");o.BBOXSR=n;o.IMAGESR=n;o.DPI=Math.round(90*i);var s=this.url_,a=s.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");a==s&&A(!1,50);return ax(a,o)};t.prototype.getUrl=function(){return this.url_};t.prototype.setImageLoadFunction=function(t){this.image_=null;this.imageLoadFunction_=t;this.changed()};t.prototype.setUrl=function(t){if(t!=this.url_){this.url_=t;this.image_=null;this.changed()}};t.prototype.updateParams=function(t){T(this.params_,t);this.image_=null;this.changed()};return t}(nx),hx=function(e){function t(t){e.call(this,{attributions:t.attributions,projection:t.projection,resolutions:t.resolutions,state:t.state});this.canvasFunction_=t.canvasFunction;this.canvas_=null;this.renderedRevision_=0;this.ratio_=void 0!==t.ratio?t.ratio:1.5}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getImageInternal=function(t,e,i,r){e=this.findNearestResolution(e);var o=this.canvas_;if(o&&this.renderedRevision_==this.getRevision()&&o.getResolution()==e&&o.getPixelRatio()==i&&Q(o.getExtent(),t))return o;vt(t=t.slice(),this.ratio_);var n=[_t(t)/e*i,ct(t)/e*i],s=this.canvasFunction_(t,e,i,n,r);s&&(o=new gn(t,e,i,s));this.canvas_=o;this.renderedRevision_=this.getRevision();return o};return t}(nx),ux=function(e){function t(t){e.call(this,{projection:t.projection,resolutions:t.resolutions});this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;this.displayDpi_=void 0!==t.displayDpi?t.displayDpi:96;this.params_=t.params||{};this.url_=t.url;this.imageLoadFunction_=void 0!==t.imageLoadFunction?t.imageLoadFunction:sx;this.hidpi_=void 0===t.hidpi||t.hidpi;this.metersPerUnit_=void 0!==t.metersPerUnit?t.metersPerUnit:1;this.ratio_=void 0!==t.ratio?t.ratio:1;this.useOverlay_=void 0!==t.useOverlay&&t.useOverlay;this.image_=null;this.renderedRevision_=0}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getParams=function(){return this.params_};t.prototype.getImageInternal=function(t,e,i,r){e=this.findNearestResolution(e);i=this.hidpi_?i:1;var o=this.image_;if(o&&this.renderedRevision_==this.getRevision()&&o.getResolution()==e&&o.getPixelRatio()==i&&Q(o.getExtent(),t))return o;1!=this.ratio_&&vt(t=t.slice(),this.ratio_);var n=[_t(t)/e*i,ct(t)/e*i];if(void 0!==this.url_){var s=this.getUrl(this.url_,this.params_,t,n,r);S(o=new _n(t,e,i,s,this.crossOrigin_,this.imageLoadFunction_),R.CHANGE,this.handleImageChange,this)}else o=null;this.image_=o;this.renderedRevision_=this.getRevision();return o};t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};t.prototype.updateParams=function(t){T(this.params_,t);this.changed()};t.prototype.getUrl=function(t,e,i,r,o){var n,s,a,l,h,u,c,p,d,f=(n=i,s=r,a=this.metersPerUnit_,l=this.displayDpi_,h=_t(n),u=ct(n),c=s[0],p=s[1],d=.0254/l,c*u<p*h?h*a/(c*d):u*a/(p*d)),_=lt(i),g={OPERATION:this.useOverlay_?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:this.displayDpi_,SETDISPLAYWIDTH:Math.round(r[0]),SETDISPLAYHEIGHT:Math.round(r[1]),SETVIEWSCALE:f,SETVIEWCENTERX:_[0],SETVIEWCENTERY:_[1]};T(g,e);return ax(t,g)};t.prototype.setImageLoadFunction=function(t){this.image_=null;this.imageLoadFunction_=t;this.changed()};return t}(nx);var cx=function(h){function t(t){var e=void 0!==t.crossOrigin?t.crossOrigin:null,i=void 0!==t.imageLoadFunction?t.imageLoadFunction:sx;h.call(this,{attributions:t.attributions,projection:ye(t.projection)});this.url_=t.url;this.imageExtent_=t.imageExtent;this.image_=new _n(this.imageExtent_,void 0,1,this.url_,e,i);this.imageSize_=t.imageSize?t.imageSize:null;S(this.image_,R.CHANGE,this.handleImageChange,this)}h&&(t.__proto__=h);((t.prototype=Object.create(h&&h.prototype)).constructor=t).prototype.getImageExtent=function(){return this.imageExtent_};t.prototype.getImageInternal=function(t,e,i,r){return Rt(t,this.image_.getExtent())?this.image_:null};t.prototype.getUrl=function(){return this.url_};t.prototype.handleImageChange=function(t){if(this.image_.getState()==Ni.LOADED){var e,i,r=this.image_.getExtent(),o=this.image_.getImage();if(this.imageSize_){e=this.imageSize_[0];i=this.imageSize_[1]}else{e=o.width;i=o.height}var n=ct(r)/i,s=Math.ceil(_t(r)/n);if(s!=e){var a=ii(s,i),l=a.canvas;a.drawImage(o,0,0,e,i,0,0,l.width,l.height);this.image_.setImage(l)}}h.prototype.handleImageChange.call(this,t)};return t}(nx),px="1.3.0",dx={CARMENTA_SERVER:"carmentaserver",GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGIS:"qgis"},fx=[101,101],_x=function(i){function t(t){var e=t||{};i.call(this,{attributions:e.attributions,projection:e.projection,resolutions:e.resolutions});this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;this.url_=e.url;this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:sx;this.params_=e.params||{};this.v13_=!0;this.updateV13_();this.serverType_=e.serverType;this.hidpi_=void 0===e.hidpi||e.hidpi;this.image_=null;this.imageSize_=[0,0];this.renderedRevision_=0;this.ratio_=void 0!==e.ratio?e.ratio:1.5}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getGetFeatureInfoUrl=function(t,e,i,r){if(void 0!==this.url_){var o=ye(i),n=this.getProjection();if(n&&n!==o){e=NE(n,o,t,e);t=we(t,o,n)}var s=ut(t,e,0,fx),a={SERVICE:"WMS",VERSION:px,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};T(a,this.params_,r);var l=Math.floor((t[0]-s[0])/e),h=Math.floor((s[3]-t[1])/e);a[this.v13_?"I":"X"]=l;a[this.v13_?"J":"Y"]=h;return this.getRequestUrl_(s,fx,1,n||o,a)}};t.prototype.getParams=function(){return this.params_};t.prototype.getImageInternal=function(t,e,i,r){if(void 0===this.url_)return null;e=this.findNearestResolution(e);1==i||this.hidpi_&&void 0!==this.serverType_||(i=1);var o=e/i,n=lt(t),s=ut(n,o,0,[Math.ceil(_t(t)/o),Math.ceil(ct(t)/o)]),a=ut(n,o,0,[Math.ceil(this.ratio_*_t(t)/o),Math.ceil(this.ratio_*ct(t)/o)]),l=this.image_;if(l&&this.renderedRevision_==this.getRevision()&&l.getResolution()==e&&l.getPixelRatio()==i&&Q(l.getExtent(),s))return l;var h={SERVICE:"WMS",VERSION:px,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};T(h,this.params_);this.imageSize_[0]=Math.round(_t(a)/o);this.imageSize_[1]=Math.round(ct(a)/o);var u=this.getRequestUrl_(a,this.imageSize_,i,r,h);this.image_=new _n(a,e,i,u,this.crossOrigin_,this.imageLoadFunction_);this.renderedRevision_=this.getRevision();S(this.image_,R.CHANGE,this.handleImageChange,this);return this.image_};t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};t.prototype.getRequestUrl_=function(t,e,i,r,o){A(void 0!==this.url_,9);o[this.v13_?"CRS":"SRS"]=r.getCode();"STYLES"in this.params_||(o.STYLES="");if(1!=i)switch(this.serverType_){case dx.GEOSERVER:var n=90*i+.5|0;"FORMAT_OPTIONS"in o?o.FORMAT_OPTIONS+=";dpi:"+n:o.FORMAT_OPTIONS="dpi:"+n;break;case dx.MAPSERVER:o.MAP_RESOLUTION=90*i;break;case dx.CARMENTA_SERVER:case dx.QGIS:o.DPI=90*i;break;default:A(!1,8)}o.WIDTH=e[0];o.HEIGHT=e[1];var s,a=r.getAxisOrientation();s=this.v13_&&"ne"==a.substr(0,2)?[t[1],t[0],t[3],t[2]]:t;o.BBOX=s.join(",");return ax(this.url_,o)};t.prototype.getUrl=function(){return this.url_};t.prototype.setImageLoadFunction=function(t){this.image_=null;this.imageLoadFunction_=t;this.changed()};t.prototype.setUrl=function(t){if(t!=this.url_){this.url_=t;this.image_=null;this.changed()}};t.prototype.updateParams=function(t){T(this.params_,t);this.updateV13_();this.image_=null;this.changed()};t.prototype.updateV13_=function(){var t=this.params_.VERSION||px;this.v13_=0<=Uo(t,"1.3")};return t}(nx),gx='&#169; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.',yx=function(n){function t(t){var e,i=t||{};e=void 0!==i.attributions?i.attributions:[gx];var r=void 0!==i.crossOrigin?i.crossOrigin:"anonymous",o=void 0!==i.url?i.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";n.call(this,{attributions:e,cacheSize:i.cacheSize,crossOrigin:r,opaque:void 0===i.opaque||i.opaque,maxZoom:void 0!==i.maxZoom?i.maxZoom:19,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileLoadFunction:i.tileLoadFunction,url:o,wrapX:i.wrapX})}n&&(t.__proto__=n);return(t.prototype=Object.create(n&&n.prototype)).constructor=t}(QE),vx=!0;try{new ImageData(10,10)}catch(t){vx=!1}var mx=document.createElement("canvas").getContext("2d");var Ex={newImageData:function(t,e,i){if(vx)return new ImageData(t,e,i);var r=mx.createImageData(e,i);r.data.set(t);return r}}.newImageData;function xx(E){var x=!0;try{new ImageData(10,10)}catch(t){x=!1}return function(t){var e,i,r,o,n,s=t.buffers,a=t.meta,l=t.imageOps,h=t.width,u=t.height,c=s.length,p=s[0].byteLength;if(l){var d=new Array(c);for(i=0;i<c;++i)d[i]=(r=new Uint8ClampedArray(s[i]),o=h,n=u,x?new ImageData(r,o,n):{data:r,width:o,height:n});e=E(d,a).data}else{e=new Uint8ClampedArray(p);var f=new Array(c),_=new Array(c);for(i=0;i<c;++i){f[i]=new Uint8ClampedArray(s[i]);_[i]=[0,0,0,0]}for(var g=0;g<p;g+=4){for(var y=0;y<c;++y){var v=f[y];_[y][0]=v[g];_[y][1]=v[g+1];_[y][2]=v[g+2];_[y][3]=v[g+3]}var m=E(_,a);e[g]=m[0];e[g+1]=m[1];e[g+2]=m[2];e[g+3]=m[3]}}return e.buffer}}function Tx(e,t){var i=Object.keys(e.lib||{}).map(function(t){return"var "+t+" = "+e.lib[t].toString()+";"}).concat(["var __minion__ = ("+xx.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  var buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),r=new Blob(i,{type:"text/javascript"}),o=URL.createObjectURL(r),n=new Worker(o);n.addEventListener("message",t);return n}function Sx(t){var e;this._imageOps=!!t.imageOps;var i,r,o,n=[];if(e=0===t.threads?0:this._imageOps?1:t.threads||1)for(var s=0;s<e;++s)n[s]=Tx(t,this._onWorkerMessage.bind(this,s));else n[0]=(i=t,r=this._onWorkerMessage.bind(this,0),o=xx(i.operation),{postMessage:function(t){setTimeout(function(){r({data:{buffer:o(t),meta:t.meta}})},0)}});this._workers=n;this._queue=[];this._maxQueueLength=t.queue||1/0;this._running=0;this._dataLookup={};this._job=null}Sx.prototype.process=function(t,e,i){this._enqueue({inputs:t,meta:e,callback:i});this._dispatch()};Sx.prototype.destroy=function(){for(var t in this)this[t]=null;this._destroyed=!0};Sx.prototype._enqueue=function(t){this._queue.push(t);for(;this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)};Sx.prototype._dispatch=function(){if(0===this._running&&0<this._queue.length){var t=this._job=this._queue.shift(),e=t.inputs[0].width,i=t.inputs[0].height,r=t.inputs.map(function(t){return t.data.buffer}),o=this._workers.length;if(1===(this._running=o))this._workers[0].postMessage({buffers:r,meta:t.meta,imageOps:this._imageOps,width:e,height:i},r);else for(var n=t.inputs[0].data.length,s=4*Math.ceil(n/4/o),a=0;a<o;++a){for(var l=a*s,h=[],u=0,c=r.length;u<c;++u)h.push(r[a].slice(l,l+s));this._workers[a].postMessage({buffers:h,meta:t.meta,imageOps:this._imageOps,width:e,height:i},h)}}};Sx.prototype._onWorkerMessage=function(t,e){if(!this._destroyed){this._dataLookup[t]=e.data;--this._running;0===this._running&&this._resolveJob()}};Sx.prototype._resolveJob=function(){var t,e,i=this._job,r=this._workers.length;if(1===r){t=new Uint8ClampedArray(this._dataLookup[0].buffer);e=this._dataLookup[0].meta}else{var o=i.inputs[0].data.length;t=new Uint8ClampedArray(o);e=new Array(o);for(var n=4*Math.ceil(o/4/r),s=0;s<r;++s){var a=this._dataLookup[s].buffer,l=s*n;t.set(new Uint8ClampedArray(a),l);e[s]=this._dataLookup[s].meta}}this._job=null;this._dataLookup={};i.callback(null,Ex(t,i.inputs[0].width,i.inputs[0].height),e);this._dispatch()};var Cx=Sx,Rx="beforeoperations",Ix="afteroperations",wx="pixel",Lx="image",Ox=function(r){function t(t,e,i){r.call(this,t);this.extent=e.extent;this.resolution=e.viewState.resolution/e.pixelRatio;this.data=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(m),Px=function(a){function t(t){a.call(this,{});this.worker_=null;this.operationType_=void 0!==t.operationType?t.operationType:wx;this.threads_=void 0!==t.threads?t.threads:1;this.renderers_=function(t){for(var e=t.length,i=new Array(e),r=0;r<e;++r)i[r]=Fx(t[r]);return i}(t.sources);for(var e=0,i=this.renderers_.length;e<i;++e)S(this.renderers_[e],R.CHANGE,this.changed,this);this.tileQueue_=new Es(function(){return 1},this.changed.bind(this));for(var r=this.renderers_.map(function(t){return t.getLayer().getLayerState()}),o={},n=0,s=r.length;n<s;++n)o[St(r[n].layer)]=r[n];this.requestedFrameState_;this.renderedImageCanvas_=null;this.renderedRevision_;this.frameState_={animate:!1,coordinateToPixelTransform:[1,0,0,1,0,0],extent:null,focus:null,index:0,layerStates:o,layerStatesArray:r,pixelRatio:1,pixelToCoordinateTransform:[1,0,0,1,0,0],postRenderFunctions:[],size:[0,0],skippedFeatureUids:{},tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{}};void 0!==t.operation&&this.setOperation(t.operation,t.lib)}a&&(t.__proto__=a);((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.setOperation=function(t,e){this.worker_=new Cx({operation:t,imageOps:this.operationType_===Lx,queue:1,lib:e,threads:this.threads_});this.changed()};t.prototype.updateFrameState_=function(t,e,i){var r=T({},this.frameState_);r.viewState=T({},r.viewState);var o=lt(t);r.extent=t.slice();r.focus=o;r.size[0]=Math.round(_t(t)/e);r.size[1]=Math.round(ct(t)/e);r.time=Date.now();r.animate=!1;var n=r.viewState;n.center=o;n.projection=i;n.resolution=e;return r};t.prototype.allSourcesReady_=function(){for(var t=!0,e=0,i=this.renderers_.length;e<i;++e)if(this.renderers_[e].getLayer().getSource().getState()!==Ys.READY){t=!1;break}return t};t.prototype.getImage=function(t,e,i,r){if(!this.allSourcesReady_())return null;var o=this.updateFrameState_(t,e,r);this.requestedFrameState_=o;if(this.renderedImageCanvas_){var n=this.renderedImageCanvas_.getResolution(),s=this.renderedImageCanvas_.getExtent();e===n&&$(t,s)||(this.renderedImageCanvas_=null)}this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_();o.tileQueue.loadMoreTiles(16,16);o.animate&&requestAnimationFrame(this.changed.bind(this));return this.renderedImageCanvas_};t.prototype.processSources_=function(){for(var t=this.requestedFrameState_,e=this.renderers_.length,i=new Array(e),r=0;r<e;++r){var o=Mx(this.renderers_[r],t,t.layerStatesArray[r]);if(!o)return;i[r]=o}var n={};this.dispatchEvent(new Ox(Rx,t,n));this.worker_.process(i,n,this.onWorkerComplete_.bind(this,t))};t.prototype.onWorkerComplete_=function(t,e,i,r){if(!e&&i){var o=t.extent,n=t.viewState.resolution;if(n===this.requestedFrameState_.viewState.resolution&&$(o,this.requestedFrameState_.extent)){var s;if(this.renderedImageCanvas_)s=this.renderedImageCanvas_.getImage().getContext("2d");else{s=ii(Math.round(_t(o)/n),Math.round(ct(o)/n));this.renderedImageCanvas_=new gn(o,n,1,s.canvas)}s.putImageData(i,0,0);this.changed();this.renderedRevision_=this.getRevision();this.dispatchEvent(new Ox(Ix,t,r))}}};t.prototype.getImageInternal=function(){return null};return t}(nx),bx=null;function Mx(t,e,i){if(!t.prepareFrame(e,i))return null;var r=e.size[0],o=e.size[1];if(bx){var n=bx.canvas;n.width!==r||n.height!==o?bx=ii(r,o):bx.clearRect(0,0,r,o)}else bx=ii(r,o);t.composeFrame(e,i,bx);return bx.getImageData(0,0,r,o)}function Fx(t){var e,i,r=null;t instanceof Zp?r=(i=new FE({source:t}),new pu(i)):t instanceof nx?r=(e=new bE({source:t}),new hu(e)):t instanceof FE?r=new pu(t):t instanceof qs&&(t.getType()==In.IMAGE||t.getType()==In.VECTOR)&&(r=new hu(t));return r}var Ax=['Map tiles by <a href="https://stamen.com/">Stamen Design</a>, under <a href="https://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.',gx],Nx={terrain:{extension:"jpg",opaque:!0},"terrain-background":{extension:"jpg",opaque:!0},"terrain-labels":{extension:"png",opaque:!1},"terrain-lines":{extension:"png",opaque:!1},"toner-background":{extension:"png",opaque:!0},toner:{extension:"png",opaque:!0},"toner-hybrid":{extension:"png",opaque:!1},"toner-labels":{extension:"png",opaque:!1},"toner-lines":{extension:"png",opaque:!1},"toner-lite":{extension:"png",opaque:!0},watercolor:{extension:"jpg",opaque:!0}},Dx={terrain:{minZoom:4,maxZoom:18},toner:{minZoom:0,maxZoom:20},watercolor:{minZoom:1,maxZoom:16}},Gx=function(s){function t(t){var e=t.layer.indexOf("-"),i=-1==e?t.layer:t.layer.slice(0,e),r=Dx[i],o=Nx[t.layer],n=void 0!==t.url?t.url:"https://stamen-tiles-{a-d}.a.ssl.fastly.net/"+t.layer+"/{z}/{x}/{y}."+o.extension;s.call(this,{attributions:Ax,cacheSize:t.cacheSize,crossOrigin:"anonymous",maxZoom:null!=t.maxZoom?t.maxZoom:r.maxZoom,minZoom:null!=t.minZoom?t.minZoom:r.minZoom,opaque:o.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,url:n,wrapX:t.wrapX})}s&&(t.__proto__=s);return(t.prototype=Object.create(s&&s.prototype)).constructor=t}(QE),kx=function(i){function t(t){var e=t||{};i.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});this.params_=e.params||{};this.tmpExtent_=[1/0,1/0,-1/0,-1/0];this.setKey(this.getKeyForParams_())}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getKeyForParams_=function(){var t=0,e=[];for(var i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")};t.prototype.getParams=function(){return this.params_};t.prototype.getRequestUrl_=function(t,e,i,r,o,n){var s=this.urls;if(s){var a,l=o.getCode().split(":").pop();n.SIZE=e[0]+","+e[1];n.BBOX=i.join(",");n.BBOXSR=l;n.IMAGESR=l;n.DPI=Math.round(n.DPI?n.DPI*r:90*r);if(1==s.length)a=s[0];else{a=s[Dt(ac(t),s.length)]}return ax(a.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage"),n)}};t.prototype.getTilePixelRatio=function(t){return t};t.prototype.fixedTileUrlFunction=function(t,e,i){var r=this.getTileGrid();r||(r=this.getTileGridForProjection(i));if(!(r.getResolutions().length<=t[0])){var o=r.getTileCoordExtent(t,this.tmpExtent_),n=Hs(r.getTileSize(t[0]),this.tmpSize);1!=e&&(n=Ws(n,e,this.tmpSize));var s={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};T(s,this.params_);return this.getRequestUrl_(t,n,o,e,i,s)}};t.prototype.updateParams=function(t){T(this.params_,t);this.setKey(this.getKeyForParams_())};return t}(ZE),jx=function(r){function t(t,e,i){r.call(this,t,yn.LOADED);this.tileSize_=e;this.text_=i;this.canvas_=null}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getImage=function(){if(this.canvas_)return this.canvas_;var t=this.tileSize_,e=ii(t[0],t[1]);e.strokeStyle="black";e.strokeRect(.5,.5,t[0]+.5,t[1]+.5);e.fillStyle="black";e.textAlign="center";e.textBaseline="middle";e.font="24px sans-serif";e.fillText(this.text_,t[0]/2,t[1]/2);this.canvas_=e.canvas;return e.canvas};t.prototype.load=function(){};return t}(Tn),Ux=function(e){function t(t){e.call(this,{opaque:!1,projection:t.projection,tileGrid:t.tileGrid,wrapX:void 0===t.wrapX||t.wrapX})}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getTile=function(t,e,i){var r=oc(t,e,i);if(this.tileCache.containsKey(r))return this.tileCache.get(r);var o=Hs(this.tileGrid.getTileSize(t)),n=[t,e,i],s=this.getTileCoordForTileUrlFunction(n),a=s?this.getTileCoordForTileUrlFunction(s).toString():"",l=new jx(n,o,a);this.tileCache.set(r,l);return l};return t}(Zp),Yx=function(i){function t(t){i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,projection:ye("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:Ys.LOADING,tileLoadFunction:t.tileLoadFunction,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition});this.tileJSON_=null;if(t.url)if(t.jsonp)WE(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{var e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this));e.addEventListener("error",this.onXHRError_.bind(this));e.open("GET",t.url);e.send()}else t.tileJSON?this.handleTileJSONResponse(t.tileJSON):A(!1,51)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||200<=e.status&&e.status<300){var i;try{i=JSON.parse(e.responseText)}catch(t){this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()};t.prototype.onXHRError_=function(t){this.handleTileJSONError()};t.prototype.getTileJSON=function(){return this.tileJSON_};t.prototype.handleTileJSONResponse=function(e){var t,i=ye("EPSG:4326"),r=this.getProjection();if(void 0!==e.bounds){var o=Re(i,r);t=Et(e.bounds,o)}var n=e.minzoom||0,s=e.maxzoom||22,a=zp({extent:Kp(r),maxZoom:s,minZoom:n});this.tileGrid=a;this.tileUrlFunction=BE(e.tiles,a);if(void 0!==e.attribution&&!this.getAttributions()){var l=void 0!==t?t:i.getExtent();this.setAttributions(function(t){return Rt(l,t.extent)?[e.attribution]:null})}this.tileJSON_=e;this.setState(Ys.READY)};t.prototype.handleTileJSONError=function(){this.setState(Ys.ERROR)};return t}(ZE),Bx=function(o){function t(t){var e=t||{},i=e.params||{},r=!("TRANSPARENT"in i)||i.TRANSPARENT;o.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,opaque:!r,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});this.gutter_=void 0!==e.gutter?e.gutter:0;this.params_=i;this.v13_=!0;this.serverType_=e.serverType;this.hidpi_=void 0===e.hidpi||e.hidpi;this.tmpExtent_=[1/0,1/0,-1/0,-1/0];this.updateV13_();this.setKey(this.getKeyForParams_())}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.getGetFeatureInfoUrl=function(t,e,i,r){var o=ye(i),n=this.getProjection(),s=this.getTileGrid();s||(s=this.getTileGridForProjection(o));var a=s.getTileCoordForCoordAndResolution(t,e);if(!(s.getResolutions().length<=a[0])){var l=s.getResolution(a[0]),h=s.getTileCoordExtent(a,this.tmpExtent_),u=Hs(s.getTileSize(a[0]),this.tmpSize),c=this.gutter_;if(0!==c){u=Xs(u,c,this.tmpSize);h=k(h,l*c,h)}if(n&&n!==o){l=NE(n,o,t,l);h=Le(h,o,n);t=we(t,o,n)}var p={SERVICE:"WMS",VERSION:px,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};T(p,this.params_,r);var d=Math.floor((t[0]-h[0])/l),f=Math.floor((h[3]-t[1])/l);p[this.v13_?"I":"X"]=d;p[this.v13_?"J":"Y"]=f;return this.getRequestUrl_(a,u,h,1,n||o,p)}};t.prototype.getGutter=function(){return this.gutter_};t.prototype.getParams=function(){return this.params_};t.prototype.getRequestUrl_=function(t,e,i,r,o,n){var s=this.urls;if(s){n.WIDTH=e[0];n.HEIGHT=e[1];n[this.v13_?"CRS":"SRS"]=o.getCode();"STYLES"in this.params_||(n.STYLES="");if(1!=r)switch(this.serverType_){case dx.GEOSERVER:var a=90*r+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+a:n.FORMAT_OPTIONS="dpi:"+a;break;case dx.MAPSERVER:n.MAP_RESOLUTION=90*r;break;case dx.CARMENTA_SERVER:case dx.QGIS:n.DPI=90*r;break;default:A(!1,52)}var l,h=o.getAxisOrientation(),u=i;if(this.v13_&&"ne"==h.substr(0,2)){var c;c=i[0];u[0]=i[1];u[1]=c;c=i[2];u[2]=i[3];u[3]=c}n.BBOX=u.join(",");if(1==s.length)l=s[0];else{l=s[Dt(ac(t),s.length)]}return ax(l,n)}};t.prototype.getTilePixelRatio=function(t){return this.hidpi_&&void 0!==this.serverType_?t:1};t.prototype.getKeyForParams_=function(){var t=0,e=[];for(var i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")};t.prototype.fixedTileUrlFunction=function(t,e,i){var r=this.getTileGrid();r||(r=this.getTileGridForProjection(i));if(!(r.getResolutions().length<=t[0])){1==e||this.hidpi_&&void 0!==this.serverType_||(e=1);var o=r.getResolution(t[0]),n=r.getTileCoordExtent(t,this.tmpExtent_),s=Hs(r.getTileSize(t[0]),this.tmpSize),a=this.gutter_;if(0!==a){s=Xs(s,a,this.tmpSize);n=k(n,o*a,n)}1!=e&&(s=Ws(s,e,this.tmpSize));var l={SERVICE:"WMS",VERSION:px,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};T(l,this.params_);return this.getRequestUrl_(t,s,n,e,i,l)}};t.prototype.updateParams=function(t){T(this.params_,t);this.updateV13_();this.setKey(this.getKeyForParams_())};t.prototype.updateV13_=function(){var t=this.params_.VERSION||px;this.v13_=0<=Uo(t,"1.3")};return t}(ZE),Vx=function(s){function t(t,e,i,r,o,n){s.call(this,t,e);this.src_=i;this.extent_=r;this.preemptive_=o;this.grid_=null;this.keys_=null;this.data_=null;this.jsonp_=n}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.getImage=function(){return null};t.prototype.getData=function(t){if(!this.grid_||!this.keys_)return null;var e=(t[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),i=(t[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),r=this.grid_[Math.floor((1-i)*this.grid_.length)];if("string"!=typeof r)return null;var o=r.charCodeAt(Math.floor(e*r.length));93<=o&&o--;35<=o&&o--;var n=null;if((o-=32)in this.keys_){var s=this.keys_[o];n=this.data_&&s in this.data_?this.data_[s]:s}return n};t.prototype.forDataAtCoordinate=function(e,i,r,t){if(this.state==yn.IDLE&&!0===t){n(this,R.CHANGE,function(t){i.call(r,this.getData(e))},this);this.loadInternal_()}else!0===t?setTimeout(function(){i.call(r,this.getData(e))}.bind(this),0):i.call(r,this.getData(e))};t.prototype.getKey=function(){return this.src_};t.prototype.handleError_=function(){this.state=yn.ERROR;this.changed()};t.prototype.handleLoad_=function(t){this.grid_=t.grid;this.keys_=t.keys;this.data_=t.data;this.state=yn.EMPTY;this.changed()};t.prototype.loadInternal_=function(){if(this.state==yn.IDLE){this.state=yn.LOADING;if(this.jsonp_)WE(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{var t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this));t.addEventListener("error",this.onXHRError_.bind(this));t.open("GET",this.src_);t.send()}}};t.prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||200<=e.status&&e.status<300){var i;try{i=JSON.parse(e.responseText)}catch(t){this.handleError_();return}this.handleLoad_(i)}else this.handleError_()};t.prototype.onXHRError_=function(t){this.handleError_()};t.prototype.load=function(){this.preemptive_&&this.loadInternal_()};return t}(Tn),Xx=function(i){function t(t){i.call(this,{projection:ye("EPSG:3857"),state:Ys.LOADING});this.preemptive_=void 0===t.preemptive||t.preemptive;this.tileUrlFunction_=XE;this.template_=void 0;this.jsonp_=t.jsonp||!1;if(t.url)if(this.jsonp_)WE(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{var e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this));e.addEventListener("error",this.onXHRError_.bind(this));e.open("GET",t.url);e.send()}else t.tileJSON?this.handleTileJSONResponse(t.tileJSON):A(!1,51)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||200<=e.status&&e.status<300){var i;try{i=JSON.parse(e.responseText)}catch(t){this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()};t.prototype.onXHRError_=function(t){this.handleTileJSONError()};t.prototype.getTemplate=function(){return this.template_};t.prototype.forDataAtCoordinateAndResolution=function(t,e,i,r){if(this.tileGrid){var o=this.tileGrid.getTileCoordForCoordAndResolution(t,e);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(t,i,null,r)}else!0===r?setTimeout(function(){i(null)},0):i(null)};t.prototype.handleTileJSONError=function(){this.setState(Ys.ERROR)};t.prototype.handleTileJSONResponse=function(e){var t,i=ye("EPSG:4326"),r=this.getProjection();if(void 0!==e.bounds){var o=Re(i,r);t=Et(e.bounds,o)}var n=e.minzoom||0,s=e.maxzoom||22,a=zp({extent:Kp(r),maxZoom:s,minZoom:n});this.tileGrid=a;this.template_=e.template;var l=e.grids;if(l){this.tileUrlFunction_=BE(l,a);if(void 0!==e.attribution){var h=void 0!==t?t:i.getExtent();this.setAttributions(function(t){return Rt(h,t.extent)?[e.attribution]:null})}this.setState(Ys.READY)}else this.setState(Ys.ERROR)};t.prototype.getTile=function(t,e,i,r,o){var n=oc(t,e,i);if(this.tileCache.containsKey(n))return this.tileCache.get(n);var s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s,o),l=this.tileUrlFunction_(a,r,o),h=new Vx(s,void 0!==l?yn.IDLE:yn.EMPTY,void 0!==l?l:"",this.tileGrid.getTileCoordExtent(s),this.preemptive_,this.jsonp_);this.tileCache.set(n,h);return h};t.prototype.useTile=function(t,e,i){var r=oc(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)};return t}(Zp),zx=function(o){function t(t){var e=t.projection||"EPSG:3857",i=t.extent||Kp(e),r=t.tileGrid||zp({extent:i,maxZoom:t.maxZoom||22,minZoom:t.minZoom,tileSize:t.tileSize||512});o.call(this,{attributions:t.attributions,cacheSize:void 0!==t.cacheSize?t.cacheSize:128,extent:i,opaque:!1,projection:e,state:t.state,tileGrid:r,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:pc,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition});this.format_=t.format?t.format:null;this.sourceTiles_={};this.overlaps_=null==t.overlaps||t.overlaps;this.tileClass=t.tileClass?t.tileClass:_c;this.tileGrids_={}}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.getOverlaps=function(){return this.overlaps_};t.prototype.clear=function(){this.tileCache.clear();this.sourceTiles_={}};t.prototype.getTile=function(t,e,i,r,o){var n=oc(t,e,i);if(this.tileCache.containsKey(n))return this.tileCache.get(n);var s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s,o),l=new cc(s,null!==a?yn.IDLE:yn.EMPTY,this.getRevision(),this.format_,this.tileLoadFunction,a,this.tileUrlFunction,this.tileGrid,this.getTileGridForProjection(o),this.sourceTiles_,r,o,this.tileClass,this.handleTileChange.bind(this),s[0]);this.tileCache.set(n,l);return l};t.prototype.getTileGridForProjection=function(t){var e=t.getCode(),i=this.tileGrids_[e];if(!i){var r=this.tileGrid;i=this.tileGrids_[e]=Hp(t,void 0,r?r.getTileSize(r.getMinZoom()):void 0)}return i};t.prototype.getTilePixelRatio=function(t){return t};t.prototype.getTilePixelSize=function(t,e,i){var r=Hs(this.getTileGridForProjection(i).getTileSize(t),this.tmpSize);return[Math.round(r[0]*e),Math.round(r[1]*e)]};return t}(KE),Wx={KVP:"KVP",REST:"REST"},Hx=function(e){function t(t){e.call(this,{extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes});this.matrixIds_=t.matrixIds}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getMatrixId=function(t){return this.matrixIds_[t]};t.prototype.getMatrixIds=function(){return this.matrixIds_};return t}(Yp);function Kx(o,t,e){var n=[],s=[],a=[],l=[],h=[],u=void 0!==e?e:[],c="TileMatrix",p="Identifier",d="ScaleDenominator",f="TopLeftCorner",i=o.SupportedCRS,r=ye(i.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ye(i),_=r.getMetersPerUnit(),g="ne"==r.getAxisOrientation().substr(0,2);o[c].sort(function(t,e){return e[d]-t[d]});o[c].forEach(function(e){if(!(0<u.length)||Fr(u,function(t){return e[p]==t[c]||-1===e[p].indexOf(":")&&o[p]+":"+e[p]===t[c]})){s.push(e[p]);var t=28e-5*e[d]/_,i=e.TileWidth,r=e.TileHeight;g?a.push([e[f][1],e[f][0]]):a.push(e[f]);n.push(t);l.push(i==r?i:[i,r]);h.push([e.MatrixWidth,-e.MatrixHeight])}});return new Hx({extent:t,origins:a,resolutions:n,matrixIds:s,tileSizes:l,sizes:h})}var Zx=function(o){function t(t){var e=void 0!==t.requestEncoding?t.requestEncoding:Wx.KVP,i=t.tileGrid,r=t.urls;void 0===r&&void 0!==t.url&&(r=zE(t.url));o.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:XE,urls:r,wrapX:void 0!==t.wrapX&&t.wrapX,transition:t.transition});this.version_=void 0!==t.version?t.version:"1.0.0";this.format_=void 0!==t.format?t.format:"image/jpeg";this.dimensions_=void 0!==t.dimensions?t.dimensions:{};this.layer_=t.layer;this.matrixSet_=t.matrixSet;this.style_=t.style;this.requestEncoding_=e;this.setKey(this.getKeyForDimensions_());r&&0<r.length&&(this.tileUrlFunction=VE(r.map(qx.bind(this))))}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.setUrls=function(t){var e=(this.urls=t).join("\n");this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):VE(t.map(qx.bind(this))),e)};t.prototype.getDimensions=function(){return this.dimensions_};t.prototype.getFormat=function(){return this.format_};t.prototype.getLayer=function(){return this.layer_};t.prototype.getMatrixSet=function(){return this.matrixSet_};t.prototype.getRequestEncoding=function(){return this.requestEncoding_};t.prototype.getStyle=function(){return this.style_};t.prototype.getVersion=function(){return this.version_};t.prototype.getKeyForDimensions_=function(){var t=0,e=[];for(var i in this.dimensions_)e[t++]=i+"-"+this.dimensions_[i];return e.join("/")};t.prototype.updateDimensions=function(t){T(this.dimensions_,t);this.setKey(this.getKeyForDimensions_())};return t}(ZE);function qx(n){var s=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};s==Wx.KVP&&T(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_});n=s==Wx.KVP?ax(n,i):n.replace(/\{(\w+?)\}/g,function(t,e){return e.toLowerCase()in i?i[e.toLowerCase()]:t});var a=this.tileGrid,l=this.dimensions_;return function(t,e,i){if(t){var r={TileMatrix:a.getMatrixId(t[0]),TileCol:t[1],TileRow:-t[2]-1};T(r,l);var o=n;return o=s==Wx.KVP?ax(o,r):o.replace(/\{(\w+?)\}/g,function(t,e){return r[e]})}}}var Jx="default",Qx="truncated",$x=function(a){function t(t,e,i,r,o,n,s){a.call(this,e,i,r,o,n,s);this.zoomifyImage_=null;this.tileSize_=Hs(t.getTileSize(e[0]))}a&&(t.__proto__=a);((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.getImage=function(){if(this.zoomifyImage_)return this.zoomifyImage_;var t=a.prototype.getImage.call(this);if(this.state!=yn.LOADED)return t;var e=this.tileSize_;if(t.width==e[0]&&t.height==e[1])return this.zoomifyImage_=t;var i=ii(e[0],e[1]);i.drawImage(t,0,0);this.zoomifyImage_=i.canvas;return i.canvas};return t}(Sn),tT=function(E){function t(t){var e=t||{},i=e.size,r=void 0!==e.tierSizeCalculation?e.tierSizeCalculation:Jx,o=i[0],n=i[1],s=e.extent||[0,-i[1],i[0],0],c=[],a=e.tileSize||Ts,l=a;switch(r){case Jx:for(;l<o||l<n;){c.push([Math.ceil(o/l),Math.ceil(n/l)]);l+=l}break;case Qx:for(var h=o,u=n;l<h||l<u;){c.push([Math.ceil(h/l),Math.ceil(u/l)]);h>>=1;u>>=1}break;default:A(!1,53)}c.push([1,1]);c.reverse();for(var p=[1],d=[0],f=1,_=c.length;f<_;f++){p.push(1<<f);d.push(c[f-1][0]*c[f-1][1]+d[f-1])}p.reverse();var g=new Yp({tileSize:a,extent:s,origin:dt(s),resolutions:p}),y=e.url;y&&-1==y.indexOf("{TileGroup}")&&-1==y.indexOf("{tileIndex}")&&(y+="{TileGroup}/{z}-{x}-{y}.jpg");var v=VE(zE(y).map(function(u){return function(t,e,i){if(t){var r=t[0],o=t[1],n=-t[2]-1,s=o+n*c[r][0],a=g.getTileSize(r),l=Array.isArray(a)?a[0]:a,h={z:r,x:o,y:n,tileIndex:s,TileGroup:"TileGroup"+((s+d[r])/l|0)};return u.replace(/\{(\w+?)\}/g,function(t,e){return h[e]})}}})),m=$x.bind(null,g);E.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:m,tileGrid:g,tileUrlFunction:v,transition:e.transition})}E&&(t.__proto__=E);return(t.prototype=Object.create(E&&E.prototype)).constructor=t}(ZE);window[void 0]={};ol.AssertionError=o;ol.Collection=F;ol.Collection.CollectionEvent=M;ol.CollectionEventType=a;ol.Disposable=i;ol.Feature=Sr;ol.Feature.createStyleFunction=Cr;ol.Geolocation=ko;ol.GeolocationProperty=Rr;ol.Graticule=dn;ol.Image=_n;ol.ImageBase=fn;ol.ImageCanvas=gn;ol.ImageState=Ni;ol.ImageTile=Sn;ol.Kinetic=Rn;ol.LayerType=In;ol.Map=Zu;ol.MapBrowserEvent=Ln;ol.MapBrowserEventHandler=gs;ol.MapBrowserEventType=On;ol.MapBrowserPointerEvent=Pn;ol.MapEvent=wn;ol.MapEventType=ys;ol.MapProperty=vs;ol.Object=w;ol.Object.ObjectEvent=I;ol.Object.getChangeEventType=P;ol.ObjectEventType=l;ol.Observable=C;ol.Observable.unByKey=function(t){if(Array.isArray(t))for(var e=0,i=t.length;e<i;++e)g(t[e]);else g(t)};ol.Overlay=ic;ol.OverlayPositioning=qu;ol.PluggableMap=Ks;ol.Tile=Tn;ol.TileCache=uc;ol.TileQueue=Es;ol.TileRange=uu;ol.TileRange.createOrUpdate=cu;ol.TileState=yn;ol.VectorImageTile=cc;ol.VectorImageTile.defaultLoadFunction=pc;ol.VectorTile=_c;ol.View=Fs;ol.View.createCenterConstraint=Ns;ol.View.createResolutionConstraint=Ds;ol.View.createRotationConstraint=Gs;ol.View.isNoopAnimation=ks;ol.ViewHint=bs;ol.ViewProperty=Ms;ol.WebGLMap=id;ol.array={};ol.array.binarySearch=Ir;ol.array.equals=Ar;ol.array.extend=br;ol.array.find=Fr;ol.array.findIndex=Dr;ol.array.includes=Lr;ol.array.isSorted=Gr;ol.array.linearFindNearest=Or;ol.array.numberSafeCompareFunction=wr;ol.array.remove=Mr;ol.array.reverseSubArray=Pr;ol.array.stableSort=Nr;ol.asserts={};ol.asserts.assert=A;ol.centerconstraint={};ol.centerconstraint.createExtent=Ss;ol.centerconstraint.none=Cs;ol.color={};ol.color.asArray=Je;ol.color.asString=He;ol.color.fromString=qe;ol.color.normalize=Qe;ol.color.toString=$e;ol.colorlike={};ol.colorlike.asColorLike=ti;ol.colorlike.isColorLike=ei;ol.control={};ol.control.Attribution=Qs;ol.control.Attribution.render=$s;ol.control.Control=Zs;ol.control.FullScreen=yc;ol.control.MousePosition=nd;ol.control.MousePosition.render=sd;ol.control.OverviewMap=xc;ol.control.OverviewMap.render=Tc;ol.control.Rotate=ta;ol.control.Rotate.render=ea;ol.control.ScaleLine=Ic;ol.control.ScaleLine.Units=Cc;ol.control.ScaleLine.render=wc;ol.control.Zoom=ia;ol.control.ZoomSlider=Pc;ol.control.ZoomSlider.render=bc;ol.control.ZoomToExtent=Mc;ol.control.util={};ol.control.util.defaults=ra;ol.coordinate={};ol.coordinate.add=Yo;ol.coordinate.closestOnCircle=Bo;ol.coordinate.closestOnSegment=Vo;ol.coordinate.createStringXY=function(e){return function(t){return Qo(t,e)}};ol.coordinate.degreesToStringHDMS=Xo;ol.coordinate.distance=qo;ol.coordinate.equals=Wo;ol.coordinate.format=zo;ol.coordinate.rotate=Ho;ol.coordinate.scale=Ko;ol.coordinate.squaredDistance=Zo;ol.coordinate.squaredDistanceToSegment=Jo;ol.coordinate.toStringHDMS=function(t,e){return t?Xo("NS",t[1],e)+" "+Xo("EW",t[0],e):""};ol.coordinate.toStringXY=Qo;ol.css={};ol.css.CLASS_COLLAPSED=Yi;ol.css.CLASS_CONTROL=Ui;ol.css.CLASS_HIDDEN=Di;ol.css.CLASS_SELECTABLE=Gi;ol.css.CLASS_UNSELECTABLE=ki;ol.css.CLASS_UNSUPPORTED=ji;ol.css.getFontFamilies=Bi;ol.dom={};ol.dom.createCanvasContext2D=ii;ol.dom.outerHeight=oi;ol.dom.outerWidth=ri;ol.dom.removeChildren=ai;ol.dom.removeNode=si;ol.dom.replaceNode=ni;ol.easing={};ol.easing.easeIn=vn;ol.easing.easeOut=mn;ol.easing.inAndOut=En;ol.easing.linear=xn;ol.easing.upAndDown=function(t){return t<.5?En(2*t):1-En(2*(t-.5))};ol.events={};ol.events.Event=m;ol.events.Event.preventDefault=function(t){t.preventDefault()};ol.events.Event.stopPropagation=E;ol.events.EventType=R;ol.events.KeyCode=$a;ol.events.Target=x;ol.events.bindListener=h;ol.events.condition={};ol.events.condition.altKeyOnly=fa;ol.events.condition.altShiftKeysOnly=_a;ol.events.condition.always=ya;ol.events.condition.click=function(t){return t.type==On.CLICK};ol.events.condition.doubleClick=function(t){return t.type==On.DBLCLICK};ol.events.condition.focus=ga;ol.events.condition.mouseActionButton=va;ol.events.condition.mouseOnly=Ra;ol.events.condition.never=ma;ol.events.condition.noModifierKeys=Ta;ol.events.condition.platformModifierKeyOnly=function(t){var e=t.originalEvent;return!e.altKey&&(Li?e.metaKey:e.ctrlKey)&&!e.shiftKey};ol.events.condition.pointerMove=Ea;ol.events.condition.primaryAction=Ia;ol.events.condition.shiftKeyOnly=Sa;ol.events.condition.singleClick=xa;ol.events.condition.targetNotEditable=Ca;ol.events.findListener=u;ol.events.getListeners=c;ol.events.listen=S;ol.events.listenOnce=n;ol.events.unlisten=d;ol.events.unlistenAll=f;ol.events.unlistenByKey=g;ol.extent={};ol.extent.Corner=N;ol.extent.Relationship=D;ol.extent.applyTransform=Et;ol.extent.boundingExtent=G;ol.extent.buffer=k;ol.extent.clone=j;ol.extent.closestSquaredDistanceXY=U;ol.extent.containsCoordinate=Y;ol.extent.containsExtent=Q;ol.extent.containsXY=B;ol.extent.coordinateRelationship=V;ol.extent.createEmpty=X;ol.extent.createOrUpdate=z;ol.extent.createOrUpdateEmpty=W;ol.extent.createOrUpdateFromCoordinate=H;ol.extent.createOrUpdateFromCoordinates=K;ol.extent.createOrUpdateFromFlatCoordinates=Z;ol.extent.createOrUpdateFromRings=function(t,e){return it(W(e),t)};ol.extent.equals=$;ol.extent.extend=q;ol.extent.extendCoordinate=J;ol.extent.extendCoordinates=tt;ol.extent.extendFlatCoordinates=et;ol.extent.extendRings=it;ol.extent.extendXY=rt;ol.extent.forEachCorner=ot;ol.extent.getArea=nt;ol.extent.getBottomLeft=st;ol.extent.getBottomRight=at;ol.extent.getCenter=lt;ol.extent.getCorner=ht;ol.extent.getEnlargedArea=function(t,e){var i=Math.min(t[0],e[0]),r=Math.min(t[1],e[1]);return(Math.max(t[2],e[2])-i)*(Math.max(t[3],e[3])-r)};ol.extent.getForViewAndSize=ut;ol.extent.getHeight=ct;ol.extent.getIntersection=pt;ol.extent.getIntersectionArea=function(t,e){return nt(pt(t,e))};ol.extent.getMargin=function(t){return _t(t)+ct(t)};ol.extent.getSize=function(t){return[t[2]-t[0],t[3]-t[1]]};ol.extent.getTopLeft=dt;ol.extent.getTopRight=ft;ol.extent.getWidth=_t;ol.extent.intersects=Rt;ol.extent.intersectsSegment=mt;ol.extent.isEmpty=gt;ol.extent.returnOrUpdate=yt;ol.extent.scaleFromCenter=vt;ol.featureloader={};ol.featureloader.loadFeaturesXhr=Al;ol.featureloader.xhr=Nl;ol.format={};ol.format.EsriJSON=dd;ol.format.Feature=ad;ol.format.Feature.transformWithOptions=ld;ol.format.FormatType=Fl;ol.format.GML=uf;ol.format.GML2=df;ol.format.GML3=hf;ol.format.GMLBase=zd;ol.format.GMLBase.GMLNS=Vd;ol.format.GPX=mf;ol.format.GeoJSON=qf;ol.format.IGC=l_;ol.format.JSONFeature=hd;ol.format.KML=k_;ol.format.KML.getDefaultFillStyle=function(){return P_};ol.format.KML.getDefaultImageStyle=function(){return M_};ol.format.KML.getDefaultStrokeStyle=function(){return A_};ol.format.KML.getDefaultStyle=function(){return D_};ol.format.KML.getDefaultStyleArray=function(){return G_};ol.format.KML.getDefaultTextStyle=function(){return N_};ol.format.KML.readFlatCoordinates=Y_;ol.format.MVT=Ay;ol.format.OSMXML=By;ol.format.OWS=qy;ol.format.Polyline=cv;ol.format.Polyline.decodeDeltas=dv;ol.format.Polyline.decodeFloats=_v;ol.format.Polyline.decodeSignedIntegers=yv;ol.format.Polyline.decodeUnsignedIntegers=mv;ol.format.Polyline.encodeDeltas=pv;ol.format.Polyline.encodeFloats=fv;ol.format.Polyline.encodeSignedIntegers=gv;ol.format.Polyline.encodeUnsignedInteger=Ev;ol.format.Polyline.encodeUnsignedIntegers=vv;ol.format.TextFeature=$f;ol.format.TopoJSON=xv;ol.format.WFS=lm;ol.format.WFS.writeFilter=function(t){var e=Ed(nm,"Filter");fm(e,t,[]);return e};ol.format.WKT=Nm;ol.format.WMSCapabilities=Xm;ol.format.WMSGetFeatureInfo=uE;ol.format.WMTSCapabilities=fE;ol.format.XLink={};ol.format.XLink.readHref=Wy;ol.format.XML=Hy;ol.format.XMLFeature=Bd;ol.format.filter={};ol.format.filter.And=Pv;ol.format.filter.Bbox=bv;ol.format.filter.Comparison=Av;ol.format.filter.ComparisonBinary=Dv;ol.format.filter.Contains=Fv;ol.format.filter.During=Nv;ol.format.filter.EqualTo=Gv;ol.format.filter.Filter=Lv;ol.format.filter.GreaterThan=kv;ol.format.filter.GreaterThanOrEqualTo=jv;ol.format.filter.Intersects=Uv;ol.format.filter.IsBetween=Yv;ol.format.filter.IsLike=Bv;ol.format.filter.IsNull=Vv;ol.format.filter.LessThan=Xv;ol.format.filter.LessThanOrEqualTo=zv;ol.format.filter.LogicalNary=Ov;ol.format.filter.Not=Wv;ol.format.filter.NotEqualTo=Hv;ol.format.filter.Or=Kv;ol.format.filter.Spatial=Mv;ol.format.filter.Within=Zv;ol.format.filter.and=qv;ol.format.filter.bbox=Jv;ol.format.filter.between=function(t,e,i){return new Yv(t,e,i)};ol.format.filter.contains=function(t,e,i){return new Fv(t,e,i)};ol.format.filter.during=function(t,e,i){return new Nv(t,e,i)};ol.format.filter.equalTo=function(t,e,i){return new Gv(t,e,i)};ol.format.filter.greaterThan=function(t,e){return new kv(t,e)};ol.format.filter.greaterThanOrEqualTo=function(t,e){return new jv(t,e)};ol.format.filter.intersects=function(t,e,i){return new Uv(t,e,i)};ol.format.filter.isNull=function(t){return new Vv(t)};ol.format.filter.lessThan=function(t,e){return new Xv(t,e)};ol.format.filter.lessThanOrEqualTo=function(t,e){return new zv(t,e)};ol.format.filter.like=function(t,e,i,r,o,n){return new Bv(t,e,i,r,o,n)};ol.format.filter.not=function(t){return new Wv(t)};ol.format.filter.notEqualTo=function(t,e,i){return new Hv(t,e,i)};ol.format.filter.or=function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Kv,e))};ol.format.filter.within=function(t,e,i){return new Zv(t,e,i)};ol.format.xsd={};ol.format.xsd.readBoolean=Wd;ol.format.xsd.readBooleanString=Hd;ol.format.xsd.readDateTime=Kd;ol.format.xsd.readDecimal=Zd;ol.format.xsd.readDecimalString=qd;ol.format.xsd.readNonNegativeInteger=Jd;ol.format.xsd.readNonNegativeIntegerString=Qd;ol.format.xsd.readString=$d;ol.format.xsd.writeBooleanTextNode=tf;ol.format.xsd.writeCDATASection=ef;ol.format.xsd.writeDateTimeTextNode=rf;ol.format.xsd.writeDecimalTextNode=of;ol.format.xsd.writeNonNegativeIntegerTextNode=nf;ol.format.xsd.writeStringTextNode=sf;ol.functions={};ol.functions.FALSE=v;ol.functions.TRUE=y;ol.functions.VOID=L;ol.geom={};ol.geom.Circle=Rl;ol.geom.Geometry=Xe;ol.geom.GeometryCollection=Kf;ol.geom.GeometryLayout=kr;ol.geom.GeometryType=kt;ol.geom.LineString=on;ol.geom.LinearRing=po;ol.geom.MultiLineString=Il;ol.geom.MultiPoint=wl;ol.geom.MultiPolygon=Ol;ol.geom.Point=fo;ol.geom.Polygon=Fo;ol.geom.Polygon.circular=Ao;ol.geom.Polygon.fromCircle=Do;ol.geom.Polygon.fromExtent=No;ol.geom.Polygon.makeRegular=Go;ol.geom.SimpleGeometry=jr;ol.geom.SimpleGeometry.getStrideForLayout=Ur;ol.geom.SimpleGeometry.transformGeom2D=Yr;ol.geom.flat={};ol.geom.flat.area={};ol.geom.flat.area.linearRing=Br;ol.geom.flat.area.linearRings=Vr;ol.geom.flat.area.linearRingss=Xr;ol.geom.flat.center={};ol.geom.flat.center.linearRingss=Ll;ol.geom.flat.closest={};ol.geom.flat.closest.arrayMaxSquaredDelta=Hr;ol.geom.flat.closest.assignClosestArrayPoint=qr;ol.geom.flat.closest.assignClosestMultiArrayPoint=Jr;ol.geom.flat.closest.assignClosestPoint=Zr;ol.geom.flat.closest.maxSquaredDelta=Wr;ol.geom.flat.closest.multiArrayMaxSquaredDelta=Kr;ol.geom.flat.contains={};ol.geom.flat.contains.linearRingContainsExtent=_o;ol.geom.flat.contains.linearRingContainsXY=go;ol.geom.flat.contains.linearRingsContainsXY=yo;ol.geom.flat.contains.linearRingssContainsXY=vo;ol.geom.flat.deflate={};ol.geom.flat.deflate.deflateCoordinate=Qr;ol.geom.flat.deflate.deflateCoordinates=$r;ol.geom.flat.deflate.deflateCoordinatesArray=to;ol.geom.flat.deflate.deflateMultiCoordinatesArray=eo;ol.geom.flat.flip={};ol.geom.flat.flip.flipXY=uv;ol.geom.flat.geodesic={};ol.geom.flat.geodesic.greatCircleArc=function(l,t,h,u,e,i){var r=ye("EPSG:4326"),c=Math.cos(Nt(t)),p=Math.sin(Nt(t)),d=Math.cos(Nt(u)),f=Math.sin(Nt(u)),_=Math.cos(Nt(h-l)),g=Math.sin(Nt(h-l)),y=p*f+c*d*_;return nn(function(t){if(1<=y)return[h,u];var e=t*Math.acos(y),i=Math.cos(e),r=Math.sin(e),o=g*d,n=c*f-p*d*_,s=Math.atan2(o,n),a=Math.asin(p*i+c*r*Math.cos(s));return[At(Nt(l)+Math.atan2(Math.sin(s)*r*c,i-p*Math.sin(a))),At(a)]},Ie(r,e),i)};ol.geom.flat.geodesic.meridian=sn;ol.geom.flat.geodesic.parallel=an;ol.geom.flat.inflate={};ol.geom.flat.inflate.inflateCoordinates=io;ol.geom.flat.inflate.inflateCoordinatesArray=ro;ol.geom.flat.inflate.inflateMultiCoordinatesArray=oo;ol.geom.flat.interiorpoint={};ol.geom.flat.interiorpoint.getInteriorPointOfArray=mo;ol.geom.flat.interiorpoint.getInteriorPointsOfMultiArray=Eo;ol.geom.flat.interpolate={};ol.geom.flat.interpolate.interpolatePoint=$o;ol.geom.flat.interpolate.lineStringCoordinateAtM=tn;ol.geom.flat.interpolate.lineStringsCoordinateAtM=en;ol.geom.flat.intersectsextent={};ol.geom.flat.intersectsextent.intersectsLineString=To;ol.geom.flat.intersectsextent.intersectsLineStringArray=So;ol.geom.flat.intersectsextent.intersectsLinearRing=Co;ol.geom.flat.intersectsextent.intersectsLinearRingArray=Ro;ol.geom.flat.intersectsextent.intersectsLinearRingMultiArray=Io;ol.geom.flat.length={};ol.geom.flat.length.lineStringLength=rn;ol.geom.flat.length.linearRingLength=function(t,e,i,r){var o=rn(t,e,i,r),n=t[i-r]-t[e],s=t[i-r+1]-t[e+1];return o+=Math.sqrt(n*n+s*s)};ol.geom.flat.orient={};ol.geom.flat.orient.linearRingIsClockwise=Lo;ol.geom.flat.orient.linearRingIsOriented=Oo;ol.geom.flat.orient.linearRingsAreOriented=Po;ol.geom.flat.orient.orientLinearRings=bo;ol.geom.flat.orient.orientLinearRingsArray=Mo;ol.geom.flat.reverse={};ol.geom.flat.reverse.coordinates=wo;ol.geom.flat.segments={};ol.geom.flat.segments.forEach=xo;ol.geom.flat.simplify={};ol.geom.flat.simplify.douglasPeucker=no;ol.geom.flat.simplify.douglasPeuckerArray=so;ol.geom.flat.simplify.douglasPeuckerMultiArray=function(t,e,i,r,o,n,s,a){for(var l=0,h=i.length;l<h;++l){var u=i[l],c=[];s=so(t,e,u,r,o,n,s,c);a.push(c);e=u[u.length-1]}return s};ol.geom.flat.simplify.quantize=ho;ol.geom.flat.simplify.quantizeArray=uo;ol.geom.flat.simplify.quantizeMultiArray=co;ol.geom.flat.simplify.radialDistance=ao;ol.geom.flat.simplify.simplifyLineString=function(t,e,i,r,o,n,s){var a=void 0!==s?s:[];if(!n){i=ao(t,e,i,r,o,a,0);t=a;e=0;r=2}a.length=no(t,e,i,r,o,a,0);return a};ol.geom.flat.simplify.snap=lo;ol.geom.flat.straightchunk={};ol.geom.flat.straightchunk.matchingChunk=Ou;ol.geom.flat.textpath={};ol.geom.flat.textpath.drawTextOnPath=_u;ol.geom.flat.topology={};ol.geom.flat.topology.lineStringIsClosed=hp;ol.geom.flat.transform={};ol.geom.flat.transform.rotate=xt;ol.geom.flat.transform.scale=Tt;ol.geom.flat.transform.transform2D=It;ol.geom.flat.transform.translate=wt;ol.has={};ol.has.CANVAS_LINE_DASH=Pi;ol.has.DEVICE_PIXEL_RATIO=Oi;ol.has.FIREFOX=Ri;ol.has.GEOLOCATION=bi;ol.has.MAC=Li;ol.has.MSPOINTER=Ai;ol.has.POINTER=Fi;ol.has.SAFARI=Ii;ol.has.TOUCH=Mi;ol.has.WEBKIT=wi;ol.interaction={};ol.interaction.DoubleClickZoom=pa;ol.interaction.DragAndDrop=vl;ol.interaction.DragBox=Wa;ol.interaction.DragPan=Na;ol.interaction.DragRotate=ja;ol.interaction.DragRotateAndZoom=xl;ol.interaction.DragZoom=Ja;ol.interaction.Draw=hh;ol.interaction.Draw.createBox=function(){return function(t,e){var i=G(t),r=[[st(i),at(i),ft(i),dt(i),st(i)]],o=e;o?o.setCoordinates(r):o=new Fo(r);return o}};ol.interaction.Draw.createRegularPolygon=function(h,u){return function(t,e){var i=t[0],r=t[1],o=Math.sqrt(Zo(i,r)),n=e||Do(new Rl(i),h),s=u;if(!u){var a=r[0]-i[0],l=r[1]-i[1];s=Math.atan(l/a)-(a<0?Math.PI:0)}Go(n,i,o,s);return n}};ol.interaction.Draw.handleEvent=uh;ol.interaction.Extent=_h;ol.interaction.Interaction=na;ol.interaction.Interaction.pan=sa;ol.interaction.Interaction.rotate=aa;ol.interaction.Interaction.rotateWithoutConstraints=la;ol.interaction.Interaction.zoom=ha;ol.interaction.Interaction.zoomByDelta=ua;ol.interaction.Interaction.zoomWithoutConstraints=ca;ol.interaction.KeyboardPan=tl;ol.interaction.KeyboardZoom=il;ol.interaction.Modify=Ih;ol.interaction.Modify.ModifyEvent=Rh;ol.interaction.MouseWheelZoom=sl;ol.interaction.MouseWheelZoom.Mode=nl;ol.interaction.PinchRotate=ll;ol.interaction.PinchZoom=pl;ol.interaction.Pointer=ba;ol.interaction.Pointer.centroid=Ma;ol.interaction.Pointer.handleEvent=Fa;ol.interaction.Property=oa;ol.interaction.Select=Dh;ol.interaction.Snap=kh;ol.interaction.Snap.handleEvent=jh;ol.interaction.Translate=Vh;ol.interaction.Translate.TranslateEvent=Bh;ol.interaction.defaults=Kh;ol.layer={};ol.layer.Base=Us;ol.layer.Group=Vs;ol.layer.Heatmap=PE;ol.layer.Image=bE;ol.layer.Layer=qs;ol.layer.Layer.visibleAtResolution=Js;ol.layer.Property=js;ol.layer.Tile=FE;ol.layer.TileProperty=ME;ol.layer.Vector=Ml;ol.layer.Vector.RenderType={IMAGE:"image",VECTOR:"vector"};ol.layer.VectorRenderType=Pl;ol.layer.VectorTile=AE;ol.layer.VectorTile.RenderType={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"};ol.layer.VectorTileRenderType=zu;ol.loadingstrategy={};ol.loadingstrategy.all=Dl;ol.loadingstrategy.bbox=function(t,e){return[t]};ol.loadingstrategy.tile=function(s){return function(t,e){var i=s.getZForResolution(e),r=s.getTileRangeForExtentAndZ(t,i),o=[],n=[i,0,0];for(n[1]=r.minX;n[1]<=r.maxX;++n[1])for(n[2]=r.minY;n[2]<=r.maxY;++n[2])o.push(s.getTileCoordExtent(n));return o}};ol.math={};ol.math.clamp=Lt;ol.math.cosh=Ot;ol.math.lerp=Gt;ol.math.modulo=Dt;ol.math.roundUpToPowerOfTwo=Pt;ol.math.solveLinearSystem=Ft;ol.math.squaredDistance=Mt;ol.math.squaredSegmentDistance=bt;ol.math.toDegrees=At;ol.math.toRadians=Nt;ol.net={};ol.net.jsonp=WE;ol.obj={};ol.obj.assign=T;ol.obj.clear=_;ol.obj.getValues=s;ol.obj.isEmpty=Ct;ol.pointer={};ol.pointer.EventSource=Mn;ol.pointer.EventType=bn;ol.pointer.MouseSource=Un;ol.pointer.MouseSource.POINTER_ID=Fn;ol.pointer.MouseSource.POINTER_TYPE=An;ol.pointer.MsSource=Jn;ol.pointer.NativeSource=ss;ol.pointer.PointerEvent=ls;ol.pointer.PointerEventHandler=_s;ol.pointer.TouchSource=ds;ol.proj={};ol.proj.Projection=Wt;ol.proj.Units=Xt;ol.proj.Units.METERS_PER_UNIT=zt;ol.proj.addCommon=Oe;ol.proj.addCoordinateTransforms=Se;ol.proj.addEquivalentProjections=me;ol.proj.addEquivalentTransforms=Ee;ol.proj.addProjection=_e;ol.proj.addProjections=ge;ol.proj.clearAllProjections=function(){se();ue()};ol.proj.cloneTransform=de;ol.proj.createProjection=xe;ol.proj.createTransformFromCoordinateTransform=Te;ol.proj.epsg3857={};ol.proj.epsg3857.EXTENT=Zt;ol.proj.epsg3857.HALF_SIZE=Kt;ol.proj.epsg3857.PROJECTIONS=Qt;ol.proj.epsg3857.RADIUS=Ht;ol.proj.epsg3857.WORLD_EXTENT=qt;ol.proj.epsg3857.fromEPSG4326=$t;ol.proj.epsg3857.toEPSG4326=te;ol.proj.epsg4326={};ol.proj.epsg4326.EXTENT=ee;ol.proj.epsg4326.METERS_PER_UNIT=ie;ol.proj.epsg4326.PROJECTIONS=oe;ol.proj.epsg4326.RADIUS=6378137;ol.proj.equivalent=Ce;ol.proj.fromLonLat=function(t,e){return we(t,"EPSG:4326",void 0!==e?e:"EPSG:3857")};ol.proj.get=ye;ol.proj.getPointResolution=ve;ol.proj.getTransform=Ie;ol.proj.getTransformFromProjections=Re;ol.proj.identityTransform=fe;ol.proj.proj4={};ol.proj.proj4.register=function(t){var e,i,r=Object.keys(t.defs),o=r.length;for(e=0;e<o;++e){var n=r[e];if(!ye(n)){var s=t.defs(n);_e(new Wt({code:n,axisOrientation:s.axis,metersPerUnit:s.to_meter,units:s.units}))}}for(e=0;e<o;++e){var a=r[e],l=ye(a);for(i=0;i<o;++i){var h=r[i],u=ye(h);if(!pe(a,h))if(t.defs[a]===t.defs[h])me([l,u]);else{var c=t(a,h);Se(l,u,c.forward,c.inverse)}}}};ol.proj.projections={};ol.proj.projections.add=le;ol.proj.projections.clear=se;ol.proj.projections.get=ae;ol.proj.toLonLat=function(t,e){var i=we(t,void 0!==e?e:"EPSG:3857","EPSG:4326"),r=i[0];(r<-180||180<r)&&(i[0]=Dt(r+180,360)-180);return i};ol.proj.transform=we;ol.proj.transformExtent=Le;ol.proj.transformWithProjections=function(t,e,i){return Re(e,i)(t)};ol.proj.transforms={};ol.proj.transforms.add=ce;ol.proj.transforms.clear=ue;ol.proj.transforms.get=pe;ol.proj.transforms.remove=function(t,e){var i=t.getCode(),r=e.getCode(),o=he[i][r];delete he[i][r];Ct(he[i])&&delete he[i];return o};ol.render={};ol.render.Box=Va;ol.render.Event=Zh;ol.render.EventType=ln;ol.render.Feature=Fy;ol.render.ReplayGroup=du;ol.render.ReplayType=fu;ol.render.VectorContext=qh;ol.render.canvas={};ol.render.canvas.ImageReplay=Iu;ol.render.canvas.Immediate=Jh;ol.render.canvas.Instruction=gu;ol.render.canvas.Instruction.beginPathInstruction=mu;ol.render.canvas.Instruction.closePathInstruction=Eu;ol.render.canvas.Instruction.fillInstruction=yu;ol.render.canvas.Instruction.strokeInstruction=vu;ol.render.canvas.LineStringReplay=wu;ol.render.canvas.PolygonReplay=Lu;ol.render.canvas.Replay=Ru;ol.render.canvas.ReplayGroup=Fu;ol.render.canvas.ReplayGroup.getCircleArray=Du;ol.render.canvas.ReplayGroup.replayDeclutter=Gu;ol.render.canvas.TextReplay=Pu;ol.render.canvas.TextReplay.measureTextWidths=bu;ol.render.canvas.checkFont=rr;ol.render.canvas.checkedFonts=tr;ol.render.canvas.defaultFillStyle=zi;ol.render.canvas.defaultFont=Xi;ol.render.canvas.defaultLineCap=Wi;ol.render.canvas.defaultLineDash=Hi;ol.render.canvas.defaultLineDashOffset=0;ol.render.canvas.defaultLineJoin=Ki;ol.render.canvas.defaultLineWidth=1;ol.render.canvas.defaultMiterLimit=10;ol.render.canvas.defaultPadding=Qi;ol.render.canvas.defaultStrokeStyle=Zi;ol.render.canvas.defaultTextAlign=qi;ol.render.canvas.defaultTextBaseline=Ji;ol.render.canvas.drawImage=cr;ol.render.canvas.labelCache=$i;ol.render.canvas.measureTextHeight=ar;ol.render.canvas.measureTextWidth=lr;ol.render.canvas.resetTransform=ur;ol.render.canvas.rotateAtOffset=hr;ol.render.canvas.textHeights=ir;ol.render.replay={};ol.render.replay.ORDER=xu;ol.render.replay.TEXT_ALIGN=Tu;ol.render.toContext=function(t,e){var i=t.canvas,r=e||{},o=r.pixelRatio||Oi,n=r.size;if(n){i.width=n[0]*o;i.height=n[1]*o;i.style.width=n[0]+"px";i.style.height=n[1]+"px"}var s=[0,0,i.width,i.height],a=ke([1,0,0,1,0,0],o,o);return new Jh(t,o,s,a,0)};ol.render.webgl={};ol.render.webgl.CircleReplay=Qc;ol.render.webgl.DEFAULT_FILLSTYLE=Vc;ol.render.webgl.DEFAULT_FONT=Bc;ol.render.webgl.DEFAULT_LINECAP=Xc;ol.render.webgl.DEFAULT_LINEDASH=zc;ol.render.webgl.DEFAULT_LINEDASHOFFSET=0;ol.render.webgl.DEFAULT_LINEJOIN=Wc;ol.render.webgl.DEFAULT_LINEWIDTH=1;ol.render.webgl.DEFAULT_MITERLIMIT=10;ol.render.webgl.DEFAULT_STROKESTYLE=Hc;ol.render.webgl.DEFAULT_TEXTALIGN=.5;ol.render.webgl.DEFAULT_TEXTBASELINE=.5;ol.render.webgl.EPSILON=Kc;ol.render.webgl.ImageReplay=lp;ol.render.webgl.Immediate=Fp;ol.render.webgl.LineStringReplay=xp;ol.render.webgl.PolygonReplay=Ip;ol.render.webgl.Replay=Yc;ol.render.webgl.ReplayGroup=Mp;ol.render.webgl.TextReplay=Op;ol.render.webgl.TextureReplay=ap;ol.render.webgl.circlereplay={};ol.render.webgl.circlereplay.defaultshader={};ol.render.webgl.circlereplay.defaultshader.Locations=kc;ol.render.webgl.circlereplay.defaultshader.fragment=Dc;ol.render.webgl.circlereplay.defaultshader.vertex=Gc;ol.render.webgl.linestringreplay={};ol.render.webgl.linestringreplay.defaultshader={};ol.render.webgl.linestringreplay.defaultshader.Locations=pp;ol.render.webgl.linestringreplay.defaultshader.fragment=up;ol.render.webgl.linestringreplay.defaultshader.vertex=cp;ol.render.webgl.polygonreplay={};ol.render.webgl.polygonreplay.defaultshader={};ol.render.webgl.polygonreplay.defaultshader.Locations=Cp;ol.render.webgl.polygonreplay.defaultshader.fragment=Tp;ol.render.webgl.polygonreplay.defaultshader.vertex=Sp;ol.render.webgl.texturereplay={};ol.render.webgl.texturereplay.defaultshader={};ol.render.webgl.texturereplay.defaultshader.Locations=ep;ol.render.webgl.texturereplay.defaultshader.fragment=$c;ol.render.webgl.texturereplay.defaultshader.vertex=tp;ol.render.webgl.triangleIsCounterClockwise=Zc;ol.renderer={};ol.renderer.Layer=su;ol.renderer.Map=eu;ol.renderer.Map.sortByZIndex=ru;ol.renderer.canvas={};ol.renderer.canvas.ImageLayer=hu;ol.renderer.canvas.IntermediateCanvas=lu;ol.renderer.canvas.Layer=au;ol.renderer.canvas.Map=nu;ol.renderer.canvas.Map.layerRendererConstructors=ou;ol.renderer.canvas.TileLayer=pu;ol.renderer.canvas.VectorLayer=Xu;ol.renderer.canvas.VectorTileLayer=Ku;ol.renderer.vector={};ol.renderer.vector.defaultOrder=Uu;ol.renderer.vector.getSquaredTolerance=Yu;ol.renderer.vector.getTolerance=Bu;ol.renderer.vector.renderFeature=Vu;ol.renderer.webgl={};ol.renderer.webgl.ImageLayer=kp;ol.renderer.webgl.Layer=Gp;ol.renderer.webgl.Map=jp;ol.renderer.webgl.TileLayer=td;ol.renderer.webgl.VectorLayer=ed;ol.renderer.webgl.defaultmapshader={};ol.renderer.webgl.defaultmapshader.Locations=Dp;ol.renderer.webgl.defaultmapshader.fragment=Ap;ol.renderer.webgl.defaultmapshader.vertex=Np;ol.renderer.webgl.tilelayershader={};ol.renderer.webgl.tilelayershader.Locations=$p;ol.renderer.webgl.tilelayershader.fragment=Jp;ol.renderer.webgl.tilelayershader.vertex=Qp;ol.reproj={};ol.reproj.Image=jE;ol.reproj.Tile=UE;ol.reproj.Triangulation=kE;ol.reproj.calculateSourceResolution=NE;ol.reproj.common={};ol.reproj.common.ENABLE_RASTER_REPROJECTION=!0;ol.reproj.common.ERROR_THRESHOLD=.5;ol.reproj.render=GE;ol.resolutionconstraint={};ol.resolutionconstraint.createSnapToPower=Is;ol.resolutionconstraint.createSnapToResolutions=Rs;ol.rotationconstraint={};ol.rotationconstraint.createSnapToN=Os;ol.rotationconstraint.createSnapToZero=Ps;ol.rotationconstraint.disable=ws;ol.rotationconstraint.none=Ls;ol.size={};ol.size.buffer=Xs;ol.size.hasArea=zs;ol.size.scale=Ws;ol.size.toSize=Hs;ol.source={};ol.source.BingMaps=JE;ol.source.CartoDB=$E;ol.source.Cluster=tx;ol.source.Image=nx;ol.source.Image.defaultImageLoadFunction=sx;ol.source.ImageArcGISRest=lx;ol.source.ImageCanvas=hx;ol.source.ImageMapGuide=ux;ol.source.ImageStatic=cx;ol.source.ImageWMS=_x;ol.source.OSM=yx;ol.source.OSM.ATTRIBUTION=gx;ol.source.Raster=Px;ol.source.Source=Gl;ol.source.Stamen=Gx;ol.source.State=Ys;ol.source.Tile=Zp;ol.source.Tile.TileSourceEvent=qp;ol.source.TileArcGISRest=kx;ol.source.TileDebug=Ux;ol.source.TileEventType=HE;ol.source.TileImage=ZE;ol.source.TileJSON=Yx;ol.source.TileWMS=Bx;ol.source.UTFGrid=Xx;ol.source.UTFGrid.CustomTile=Vx;ol.source.UrlTile=KE;ol.source.Vector=oh;ol.source.Vector.VectorSourceEvent=rh;ol.source.VectorEventType=kl;ol.source.VectorTile=zx;ol.source.WMSServerType=dx;ol.source.WMTS=Zx;ol.source.WMTS.optionsFromCapabilities=function(t,s){var e=Fr(t.Contents.Layer,function(t,e,i){return t.Identifier==s.layer});if(null===e)return null;var i,a=t.Contents.TileMatrixSet;(i=1<e.TileMatrixSetLink.length?Dr(e.TileMatrixSetLink,"projection"in s?function(e,t,i){var r=Fr(a,function(t){return t.Identifier==e.TileMatrixSet}).SupportedCRS,o=ye(r.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ye(r),n=ye(s.projection);return o&&n?Ce(o,n):r==s.projection}:function(t,e,i){return t.TileMatrixSet==s.matrixSet}):0)<0&&(i=0);var r=e.TileMatrixSetLink[i].TileMatrixSet,o=e.TileMatrixSetLink[i].TileMatrixSetLimits,n=e.Format[0];"format"in s&&(n=s.format);(i=Dr(e.Style,function(t,e,i){return"style"in s?t.Title==s.style:t.isDefault}))<0&&(i=0);var l=e.Style[i].Identifier,h={};"Dimension"in e&&e.Dimension.forEach(function(t,e,i){var r=t.Identifier,o=t.Default;void 0===o&&(o=t.Value[0]);h[r]=o});var u,c=Fr(t.Contents.TileMatrixSet,function(t,e,i){return t.Identifier==r}),p=c.SupportedCRS;p&&(u=ye(p.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ye(p));if("projection"in s){var d=ye(s.projection);d&&(u&&!Ce(d,u)||(u=d))}var f,_,g=e.WGS84BoundingBox;if(void 0!==g){var y=ye("EPSG:4326").getExtent();_=g[0]==y[0]&&g[2]==y[2];f=Le(g,"EPSG:4326",u);var v=u.getExtent();v&&(Q(v,f)||(f=void 0))}var m=Kx(c,f,o),E=[],x=s.requestEncoding;x=void 0!==x?x:"";if("OperationsMetadata"in t&&"GetTile"in t.OperationsMetadata)for(var T=t.OperationsMetadata.GetTile.DCP.HTTP.Get,S=0,C=T.length;S<C;++S)if(T[S].Constraint){var R=Fr(T[S].Constraint,function(t){return"GetEncoding"==t.name}).AllowedValues.Value;""===x&&(x=R[0]);if(x!==Wx.KVP)break;Lr(R,Wx.KVP)&&E.push(T[S].href)}else if(T[S].href){x=Wx.KVP;E.push(T[S].href)}if(0===E.length){x=Wx.REST;e.ResourceURL.forEach(function(t){if("tile"===t.resourceType){n=t.format;E.push(t.template)}})}return{urls:E,layer:s.layer,matrixSet:r,format:n,projection:u,requestEncoding:x,tileGrid:m,style:l,dimensions:h,wrapX:_,crossOrigin:s.crossOrigin}};ol.source.WMTSRequestEncoding=Wx;ol.source.XYZ=QE;ol.source.Zoomify=tT;ol.source.Zoomify.CustomTile=$x;ol.source.common={};ol.source.common.DEFAULT_WMS_VERSION=px;ol.sphere={};ol.sphere.DEFAULT_RADIUS=jt;ol.sphere.getArea=function t(e,i){var r=i||{},o=r.radius||jt,n=r.projection||"EPSG:3857",s=e.getType();s!==kt.GEOMETRY_COLLECTION&&(e=e.clone().transform(n,"EPSG:4326"));var a,l,h,u,c,p,d=0;switch(s){case kt.POINT:case kt.MULTI_POINT:case kt.LINE_STRING:case kt.MULTI_LINE_STRING:case kt.LINEAR_RING:break;case kt.POLYGON:a=e.getCoordinates();d=Math.abs(Bt(a[0],o));for(h=1,u=a.length;h<u;++h)d-=Math.abs(Bt(a[h],o));break;case kt.MULTI_POLYGON:for(h=0,u=(a=e.getCoordinates()).length;h<u;++h){l=a[h];d+=Math.abs(Bt(l[0],o));for(c=1,p=l.length;c<p;++c)d-=Math.abs(Bt(l[c],o))}break;case kt.GEOMETRY_COLLECTION:var f=e.getGeometries();for(h=0,u=f.length;h<u;++h)d+=t(f[h],i);break;default:throw new Error("Unsupported geometry type: "+s)}return d};ol.sphere.getDistance=Ut;ol.sphere.getLength=function t(e,i){var r=i||{},o=r.radius||jt,n=r.projection||"EPSG:3857",s=e.getType();s!==kt.GEOMETRY_COLLECTION&&(e=e.clone().transform(n,"EPSG:4326"));var a,l,h,u,c,p,d=0;switch(s){case kt.POINT:case kt.MULTI_POINT:break;case kt.LINE_STRING:case kt.LINEAR_RING:d=Yt(a=e.getCoordinates(),o);break;case kt.MULTI_LINE_STRING:case kt.POLYGON:for(h=0,u=(a=e.getCoordinates()).length;h<u;++h)d+=Yt(a[h],o);break;case kt.MULTI_POLYGON:for(h=0,u=(a=e.getCoordinates()).length;h<u;++h)for(c=0,p=(l=a[h]).length;c<p;++c)d+=Yt(l[c],o);break;case kt.GEOMETRY_COLLECTION:var f=e.getGeometries();for(h=0,u=f.length;h<u;++h)d+=t(f[h],i);break;default:throw new Error("Unsupported geometry type: "+s)}return d};ol.sphere.offset=Vt;ol.string={};ol.string.compareVersions=Uo;ol.string.padNumber=jo;ol.structs={};ol.structs.LRUCache=Vi;ol.structs.LinkedList=Rp;ol.structs.PriorityQueue=ms;ol.structs.PriorityQueue.DROP=1/0;ol.structs.RBush=ih;ol.style={};ol.style.Atlas=wp;ol.style.AtlasManager=Lp;ol.style.Circle=fr;ol.style.Fill=_r;ol.style.Icon=E_;ol.style.IconAnchorUnits=h_;ol.style.IconImage=u_;ol.style.IconImage.get=c_;ol.style.IconImageCache=Qh;ol.style.IconImageCache.shared=tu;ol.style.IconOrigin=m_;ol.style.Image=pr;ol.style.RegularShape=dr;ol.style.Stroke=gr;ol.style.Style=yr;ol.style.Style.createDefaultStyle=Er;ol.style.Style.createEditingStyle=xr;ol.style.Style.toFunction=vr;ol.style.Text=un;ol.style.TextPlacement=hn;ol.tilecoord={};ol.tilecoord.createOrUpdate=rc;ol.tilecoord.fromKey=sc;ol.tilecoord.getKey=nc;ol.tilecoord.getKeyZXY=oc;ol.tilecoord.hash=ac;ol.tilecoord.quadKey=lc;ol.tilecoord.withinExtentAndZ=hc;ol.tilegrid={};ol.tilegrid.TileGrid=Yp;ol.tilegrid.WMTS=Hx;ol.tilegrid.WMTS.createFromCapabilitiesMatrixSet=Kx;ol.tilegrid.common={};ol.tilegrid.common.DEFAULT_MAX_ZOOM=xs;ol.tilegrid.common.DEFAULT_TILE_SIZE=Ts;ol.tilegrid.createForExtent=Xp;ol.tilegrid.createForProjection=Hp;ol.tilegrid.createXYZ=zp;ol.tilegrid.extentFromProjection=Kp;ol.tilegrid.getForProjection=Bp;ol.tilegrid.wrapX=Vp;ol.tileurlfunction={};ol.tileurlfunction.createFromTemplate=YE;ol.tileurlfunction.createFromTemplates=BE;ol.tileurlfunction.createFromTileUrlFunctions=VE;ol.tileurlfunction.expandUrl=zE;ol.tileurlfunction.nullTileUrlFunction=XE;ol.transform={};ol.transform.apply=De;ol.transform.compose=Ue;ol.transform.create=be;ol.transform.determinant=Be;ol.transform.invert=Ye;ol.transform.multiply=Fe;ol.transform.reset=Me;ol.transform.rotate=Ge;ol.transform.scale=ke;ol.transform.set=Ae;ol.transform.setFromArray=Ne;ol.transform.translate=je;ol.uri={};ol.uri.appendParams=ax;ol.util={};ol.util.VERSION=t;ol.util.getUid=St;ol.util.inherits=function(t,e){t.prototype=Object.create(e.prototype);t.prototype.constructor=t};ol.vec={};ol.vec.mat4={};ol.vec.mat4.create=jc;ol.vec.mat4.fromTransform=Uc;ol.webgl={};ol.webgl.ARRAY_BUFFER=li;ol.webgl.BLEND=3042;ol.webgl.Buffer=Jc;ol.webgl.CLAMP_TO_EDGE=_i;ol.webgl.COLOR_ATTACHMENT0=36064;ol.webgl.COLOR_BUFFER_BIT=16384;ol.webgl.COMPILE_STATUS=35713;ol.webgl.CULL_FACE=2884;ol.webgl.Context=rp;ol.webgl.Context.createEmptyTexture=np;ol.webgl.Context.createTexture=sp;ol.webgl.ContextEventType=ip;ol.webgl.DEBUG=!0;ol.webgl.DEPTH_TEST=2929;ol.webgl.DYNAMIC_DRAW=35048;ol.webgl.ELEMENT_ARRAY_BUFFER=34963;ol.webgl.FLOAT=hi;ol.webgl.FRAGMENT_SHADER=35632;ol.webgl.FRAMEBUFFER=gi;ol.webgl.Fragment=Ac;ol.webgl.LINEAR=ci;ol.webgl.LINK_STATUS=35714;ol.webgl.ONE=1;ol.webgl.ONE_MINUS_SRC_ALPHA=771;ol.webgl.RGBA=ui;ol.webgl.SCISSOR_TEST=3089;ol.webgl.SRC_ALPHA=770;ol.webgl.STATIC_DRAW=35044;ol.webgl.STENCIL_TEST=2960;ol.webgl.STREAM_DRAW=35040;ol.webgl.Shader=Fc;ol.webgl.TEXTURE0=33984;ol.webgl.TEXTURE_2D=fi;ol.webgl.TEXTURE_MAG_FILTER=10240;ol.webgl.TEXTURE_MIN_FILTER=10241;ol.webgl.TEXTURE_WRAP_S=pi;ol.webgl.TEXTURE_WRAP_T=di;ol.webgl.TRIANGLES=4;ol.webgl.TRIANGLE_STRIP=5;ol.webgl.UNSIGNED_BYTE=5121;ol.webgl.UNSIGNED_INT=5125;ol.webgl.UNSIGNED_SHORT=5123;ol.webgl.VERTEX_SHADER=35633;ol.webgl.Vertex=Nc;ol.webgl.getContext=vi;ol.xml={};ol.xml.DOCUMENT=vd;ol.xml.OBJECT_PROPERTY_NODE_FACTORY=Nd;ol.xml.XML_SCHEMA_INSTANCE_URI=md;ol.xml.createElementNS=Ed;ol.xml.getAllTextContent=xd;ol.xml.getAllTextContent_=Td;ol.xml.getAttributeNS=Rd;ol.xml.isDocument=Sd;ol.xml.isNode=Cd;ol.xml.makeArrayExtender=wd;ol.xml.makeArrayPusher=Ld;ol.xml.makeArraySerializer=Fd;ol.xml.makeChildAppender=Md;ol.xml.makeObjectPropertyPusher=Pd;ol.xml.makeObjectPropertySetter=bd;ol.xml.makeReplacer=Od;ol.xml.makeSequence=Dd;ol.xml.makeSimpleNodeFactory=Ad;ol.xml.makeStructureNS=Gd;ol.xml.parse=Id;ol.xml.parseNode=kd;ol.xml.pushParseAndPop=jd;ol.xml.pushSerializeAndPop=Yd;ol.xml.serialize=Ud}();
//# sourceMappingURL=ol.js.map
var olcs_unused_var=function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=24)}([function(e,t){e.exports=ol.proj},function(e,t){e.exports=ol.Observable},function(e,t){e.exports=ol.source.Vector},function(e,t){e.exports=ol.layer.Layer},function(e,t){e.exports=ol.layer.Group},function(e,t){e.exports=ol.layer.Vector},function(e,t){e.exports=ol.layer.Image},function(e,t){e.exports=ol.source.Cluster},function(e,t){e.exports=ol.geom.Geometry},function(e,t){e.exports=ol.extent},function(e,t){e.exports=ol.dom},function(e,t){e.exports=ol.geom.Point},function(e,t){e.exports=ol.easing},function(e,t){e.exports=ol.layer.Tile},function(e,t){e.exports=ol.source.ImageStatic},function(e,t){e.exports=ol.source.ImageWMS},function(e,t){e.exports=ol.source.TileImage},function(e,t){e.exports=ol.source.TileWMS},function(e,t){e.exports=ol.source.Image},function(e,t){e.exports=ol.style.Icon},function(e,t){e.exports=ol.geom.Polygon},function(e,t){e.exports=ol.events},function(e,t){e.exports=ol.geom.SimpleGeometry},function(e,t){e.exports=ol.Overlay},function(e,t,i){"use strict";i.r(t);i(11);var r=i(0),n={};function o(e,t,i){return e.on(t,i)}n.obj=function(e){return e},n.supportsImageRenderingPixelatedResult_=void 0,n.imageRenderingValueResult_=void 0,n.supportsImageRenderingPixelated=function(){if(void 0===n.supportsImageRenderingPixelatedResult_){var e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges; image-rendering: pixelated;");var t=e.style.imageRendering;n.supportsImageRenderingPixelatedResult_=!!t,n.supportsImageRenderingPixelatedResult_&&(n.imageRenderingValueResult_=t)}return n.supportsImageRenderingPixelatedResult_},n.imageRenderingValue=function(){return n.supportsImageRenderingPixelated(),n.imageRenderingValueResult_||""},n.getSourceProjection=function(e){return e.get("olcs.projection")||e.getProjection()};var a=0;function s(e){return e.olcs_uid||(e.olcs_uid=++a)}var u=n,l=i(12),c=i(13),h=i.n(c),p=i(6),m=i.n(p),d=i(14),f=i.n(d),y=i(15),v=i.n(y),g=i(16),C=i.n(g),_=i(17),w=i.n(_),b=i(18);var S=function(){function e(t,i,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.source_=i,this.projection_=null,this.fallbackProj_=r||null,this.ready_=!1,this.tilingScheme_=null,this.rectangle_=null,this.map_=t;var o=this.source_.get("olcs.proxy");o&&("function"==typeof o?this.proxy_={getURL:o}:"string"==typeof o&&(this.proxy_=new Cesium.DefaultProxy(o))),this.errorEvent_=new Cesium.Event,this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.source_.on("change",function(e){n.handleSourceChanged_()}),this.handleSourceChanged_()}return e.prototype.handleSourceChanged_=function(e){if(!this.ready_&&"ready"==this.source_.getState()){if(this.projection_=u.getSourceProjection(this.source_)||this.fallbackProj_,this.projection_==r.get("EPSG:4326"))this.tilingScheme_=new Cesium.GeographicTilingScheme;else{if(this.projection_!=r.get("EPSG:3857"))return;this.tilingScheme_=new Cesium.WebMercatorTilingScheme}this.rectangle_=this.tilingScheme_.rectangle,this.ready_=!0}},e.prototype.getTileCredits=function(e,t,i){var r=this.map_.getView().calculateExtent(this.map_.getSize()),n={viewState:{zoom:this.tilingScheme_ instanceof Cesium.GeographicTilingScheme?i+1:i},extent:r},o=this.source_.getAttributions();if(!o)return[];var a=o(n);return Array.isArray(a)||(a=[a]),a.map(function(e){return new Cesium.Credit(e,!0)})},e.prototype.requestImage=function(e,t,i){var r=this.source_.getTileUrlFunction();if(r&&this.projection_){var n=this.tilingScheme_ instanceof Cesium.GeographicTilingScheme?i+1:i,o=-t-1,a=r.call(this.source_,[n,e,o],1,this.projection_);return this.proxy_&&(a=this.proxy_.getURL(a)),a?Cesium.ImageryProvider.loadImage(this,a):this.emptyCanvas_}return this.emptyCanvas_},e}();Object.defineProperties(S.prototype,{ready:{get:function(){return this.ready_}},rectangle:{get:function(){return this.rectangle_}},tileWidth:{get:function(){var e=this.source_.getTileGrid();return e?Array.isArray(e.getTileSize(0))?e.getTileSize(0)[0]:e.getTileSize(0):256}},tileHeight:{get:function(){var e=this.source_.getTileGrid();return e?Array.isArray(e.getTileSize(0))?e.getTileSize(0)[1]:e.getTileSize(0):256}},maximumLevel:{get:function(){var e=this.source_.getTileGrid();return e?e.getMaxZoom():18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this.tilingScheme_}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this.errorEvent_}},proxy:{get:function(){return this.proxy_}},hasAlphaChannel:{get:function(){return!0}},pickFeatures:{get:function(){}}});var P=S,T={computePixelSizeAtCoordinate:function(e,t){var i=e.camera,r=e.canvas,n=i.frustum,o=Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(i.position,t,new Cesium.Cartesian3)),a=new Cesium.Cartesian2;return n.getPixelDimensions(r.clientWidth,r.clientHeight,o,a)},computeBoundingBoxAtTarget:function(e,t,i){var r=T.computePixelSizeAtCoordinate(e,t),n=Cesium.Transforms.eastNorthUpToFixedFrame(t),o=Cesium.Matrix4.multiplyByPoint(n,new Cesium.Cartesian3(-r.x*i,-r.y*i,0),new Cesium.Cartesian3),a=Cesium.Matrix4.multiplyByPoint(n,new Cesium.Cartesian3(r.x*i,r.y*i,0),new Cesium.Cartesian3);return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray([o,a])},applyHeightOffsetToGeometry:function(e,t){e.applyTransform(function(e,i,r){if(void 0!==r&&r>=3)for(var n=0;n<i.length;n+=r)i[n+2]=i[n+2]+t;return i})},createMatrixAtCoordinates:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Cesium.Cartesian3.ZERO,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Cesium.Cartesian3(1,1,1),n=T.ol4326CoordinateToCesiumCartesian(e),o=Cesium.Transforms.eastNorthUpToFixedFrame(n),a=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-t),s=Cesium.Matrix4.fromTranslationQuaternionRotationScale(i,a,r);return Cesium.Matrix4.multiply(o,s,new Cesium.Matrix4)},rotateAroundAxis:function(e,t,i,r,n){var o=Cesium.Math.clamp,a=Cesium.defaultValue,s=n||{},u=a(s.duration,500),c=a(s.easing,l.linear),h=s.callback,p=0,m=new Cesium.Matrix4,d=Date.now();window.requestAnimationFrame(function n(){var a=Date.now(),s=c(o((a-d)/u,0,1));e.transform.clone(m);var l=(s-p)*t;p=s,e.lookAtTransform(r),e.rotate(i,l),e.lookAtTransform(m),s<1?window.requestAnimationFrame(n):h&&h()})},setHeadingUsingBottomCenter:function(e,t,i,r){var n=e.camera,o=T.computeAngleToZenith(e,i),a=n.right,s=Cesium.Quaternion.fromAxisAngle(a,o),u=Cesium.Matrix3.fromQuaternion(s),l=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(n.position,i,l);var c=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(u,l,c),Cesium.Cartesian3.add(c,i,c);var h=Cesium.Matrix4.fromTranslation(c);(0,T.rotateAroundAxis)(n,t,c,h,r)},pickOnTerrainOrEllipsoid:function(e,t){var i=e.camera.getPickRay(t);return e.globe.pick(i,e)||e.camera.pickEllipsoid(t)},pickBottomPoint:function(e){var t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight);return T.pickOnTerrainOrEllipsoid(e,i)},pickCenterPoint:function(e){var t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return T.pickOnTerrainOrEllipsoid(e,i)},computeSignedTiltAngleOnGlobe:function(e){var t=e.camera,i=new Cesium.Ray(t.position,t.direction),r=e.globe.pick(i,e);if(!r){var n=Cesium.Ellipsoid.WGS84,o=Cesium.IntersectionTests.rayEllipsoid(i,n);o&&(r=Cesium.Ray.getPoint(i,o.start))}if(r){var a=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(r,a);var s=(0,T.signedAngleBetween)(t.direction,a,t.right)-Math.PI;return Cesium.Math.convertLongitudeRange(s)}},bottomFovRay:function(e){var t=e.camera,i=t.frustum.fovy/2,r=t.direction,n=Cesium.Quaternion.fromAxisAngle(t.right,i),o=Cesium.Matrix3.fromQuaternion(n),a=new Cesium.Cartesian3;return Cesium.Matrix3.multiplyByVector(o,r,a),new Cesium.Ray(t.position,a)},signedAngleBetween:function(e,t,i){var r=new Cesium.Cartesian3,n=new Cesium.Cartesian3,o=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(e,r),Cesium.Cartesian3.normalize(t,n),Cesium.Cartesian3.cross(r,n,o);var a=Cesium.Cartesian3.dot(r,n),s=Cesium.Cartesian3.magnitude(o),u=Cesium.Cartesian3.dot(i,o),l=Math.atan2(s,a);return u>=0?l:-l},computeAngleToZenith:function(e,t){var i=e.camera,r=i.frustum.fovy/2,n=T.bottomFovRay(e),o=Cesium.Cartesian3.clone(n.direction);Cesium.Cartesian3.negate(o,o);var a=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(t,a);var s=new Cesium.Cartesian3;return Cesium.Cartesian3.negate(i.right,s),T.signedAngleBetween(a,o,s)+r},extentToRectangle:function(e,t){if(e&&t){var i=r.transformExtent(e,t,"EPSG:4326");return Cesium.Rectangle.fromDegrees(i[0],i[1],i[2],i[3])}return null},tileLayerToImageryLayer:function(e,t,i){if(!(t instanceof h.a||t instanceof m.a))return null;var r=null,n=t.getSource();if(n instanceof v.a&&n.getUrl()&&n.getImageLoadFunction()===b.defaultImageLoadFunction){var o={"olcs.proxy":n.get("olcs.proxy"),"olcs.extent":n.get("olcs.extent"),"olcs.projection":n.get("olcs.projection"),"olcs.imagesource":n};(n=new w.a({url:n.getUrl(),attributions:n.getAttributions(),projection:n.getProjection(),params:n.getParams()})).setProperties(o)}if(n instanceof C.a){var a=u.getSourceProjection(n);if(a||(a=i),!T.isCesiumProjection(a))return null;r=new P(e,n,i)}else{if(!(n instanceof f.a))return null;var s=u.getSourceProjection(n);if(s||(s=i),!T.isCesiumProjection(s))return null;r=new Cesium.SingleTileImageryProvider({url:n.getUrl(),rectangle:new Cesium.Rectangle.fromDegrees(n.getImageExtent()[0],n.getImageExtent()[1],n.getImageExtent()[2],n.getImageExtent()[3])})}var l={},c=t.get("olcs.extent")||t.getExtent();return c&&(l.rectangle=T.extentToRectangle(c,i)),new Cesium.ImageryLayer(r,l)},updateCesiumLayerProperties:function(e,t){var i=1,r=!0;[e.layer].concat(e.parents).forEach(function(e){var t=e.getOpacity();void 0!==t&&(i*=t);var n=e.getVisible();void 0!==n&&(r&=n)}),t.alpha=i,t.show=r},ol4326CoordinateToCesiumCartesian:function(e){var t=e;return t.length>2?Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]):Cesium.Cartesian3.fromDegrees(t[0],t[1])},ol4326CoordinateArrayToCsCartesians:function(e){for(var t=T.ol4326CoordinateToCesiumCartesian,i=[],r=0;r<e.length;++r)i.push(t(e[r]));return i},olGeometryCloneTo4326:function(e,t){var i=r.get("EPSG:4326"),n=r.get(t);if(n!==i){var o=e.getProperties();(e=e.clone()).transform(n,i),e.setProperties(o)}return e},convertColorToCesium:function(e){return e=e||"black",Array.isArray(e)?new Cesium.Color(Cesium.Color.byteToFloat(e[0]),Cesium.Color.byteToFloat(e[1]),Cesium.Color.byteToFloat(e[2]),e[3]):"string"==typeof e?Cesium.Color.fromCssColorString(e):void 0},convertUrlToCesium:function(e){var t="",i=/\{(\d|[a-z])-(\d|[a-z])\}/,r=i.exec(e);if(r){e=e.replace(i,"{s}");var n=r[1].charCodeAt(0),o=r[2].charCodeAt(0),a=void 0;for(a=n;a<=o;++a)t+=String.fromCharCode(a)}return{url:e,subdomains:t}},resetToNorthZenith:function(e,t){return new Promise(function(i,r){var n=t.camera,o=T.pickBottomPoint(t);if(o){var a=e.getView().getRotation();if(void 0!==a){var s=T.computeAngleToZenith(t,o);T.setHeadingUsingBottomCenter(t,a,o);var u=Cesium.Matrix4.fromTranslation(o),l=n.right,c={callback:function(){var t=e.getView();T.normalizeView(t),i()}};T.rotateAroundAxis(n,-s,l,u,c)}else r("The view is not initialized")}else r("Could not get bottom pivot")})},rotateAroundBottomCenter:function(e,t){return new Promise(function(i,r){var n=e.camera,o=T.pickBottomPoint(e);if(o){var a={callback:i},s=Cesium.Matrix4.fromTranslation(o),u=n.right;(0,T.rotateAroundAxis)(n,-t,u,s,a)}else r("could not get bottom pivot")})},normalizeView:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.getResolution();e.setRotation(t),e.setResolution(e.constrainResolution(i))},isCesiumProjection:function(e){var t=e===r.get("EPSG:3857"),i=e===r.get("EPSG:4326");return t||i}},L=T;var O=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ol3d=t,this.scene_=t.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}return e.prototype.enable=function(){this.scene_.requestRenderMode=!0;var e=this.repaintEventNames_,t=Array.isArray(e),i=0;for(e=t?e:e[Symbol.iterator]();;){var r;if(t){if(i>=e.length)break;r=e[i++]}else{if((i=e.next()).done)break;r=i.value}var n=r;this.canvas_.addEventListener(n,this._boundNotifyRepaintRequired,!1)}window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)},e.prototype.disable=function(){var e=this.repaintEventNames_,t=Array.isArray(e),i=0;for(e=t?e:e[Symbol.iterator]();;){var r;if(t){if(i>=e.length)break;r=e[i++]}else{if((i=e.next()).done)break;r=i.value}var n=r;this.canvas_.removeEventListener(n,this._boundNotifyRepaintRequired,!1)}window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1},e.prototype.restartRenderLoop=function(){this.notifyRepaintRequired()},e.prototype.notifyRepaintRequired=function(){this.scene_.requestRender()},e}(),R=i(1);function E(e){return 180*e/Math.PI}function x(e){return e*Math.PI/180}var A=function(){function e(t,i){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene_=t,this.cam_=t.camera,this.map_=i,this.view_=null,this.viewListenKey_=null,this.toLonLat_=e.identityProjection,this.fromLonLat_=e.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",function(e){r.setView_(r.map_.getView())}),this.setView_(this.map_.getView())}return e.identityProjection=function(e,t,i){var r=i||e.length;if(t)for(var n=0;n<r;++n)t[n]=e[n];return e},e.prototype.setView_=function(t){var i=this;if(this.view_&&(Object(R.unByKey)(this.viewListenKey_),this.viewListenKey_=null),this.view_=t,t){var n=r.getTransform(t.getProjection(),"EPSG:4326"),o=r.getTransform("EPSG:4326",t.getProjection());this.toLonLat_=n,this.fromLonLat_=o,this.viewListenKey_=t.on("propertychange",function(e){return i.handleViewEvent_(e)}),this.readFromView()}else this.toLonLat_=e.identityProjection,this.fromLonLat_=e.identityProjection},e.prototype.handleViewEvent_=function(e){this.viewUpdateInProgress_||this.readFromView()},e.prototype.setHeading=function(e){this.view_&&this.view_.setRotation(e)},e.prototype.getHeading=function(){if(this.view_)return this.view_.getRotation()||0},e.prototype.setTilt=function(e){this.tilt_=e,this.updateCamera_()},e.prototype.getTilt=function(){return this.tilt_},e.prototype.setDistance=function(e){this.distance_=e,this.updateCamera_(),this.updateView()},e.prototype.getDistance=function(){return this.distance_},e.prototype.setCenter=function(e){this.view_&&this.view_.setCenter(e)},e.prototype.getCenter=function(){if(this.view_)return this.view_.getCenter()},e.prototype.setPosition=function(e){if(this.toLonLat_){var t=this.toLonLat_(e),i=new Cesium.Cartographic(x(t[0]),x(t[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}),this.updateView()}},e.prototype.getPosition=function(){if(this.fromLonLat_){var e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position),t=this.fromLonLat_([E(e.longitude),E(e.latitude)]);return t}},e.prototype.setAltitude=function(e){var t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);t.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),this.updateView()},e.prototype.getAltitude=function(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height},e.prototype.updateCamera_=function(){if(this.view_&&this.toLonLat_){var e=this.view_.getCenter();if(e){var t=this.toLonLat_(e),i=new Cesium.Cartographic(x(t[0]),x(t[1]));if(this.scene_.globe){var r=this.scene_.globe.getHeight(i);i.height=r||0}var n=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),o={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:n,orientation:o}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}}},e.prototype.readFromView=function(){if(this.view_&&this.toLonLat_){var e=this.view_.getCenter();if(void 0!==e&&null!==e){var t=this.toLonLat_(e),i=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(i||0,x(t[1])),this.updateCamera_()}}},e.prototype.updateView=function(){if(this.view_&&this.fromLonLat_){this.viewUpdateInProgress_=!0;var e=Cesium.Ellipsoid.WGS84,t=this.scene_,i=L.pickCenterPoint(t),r=i;if(!r){var n=t.globe,o=this.cam_.positionCartographic.clone(),a=n.getHeight(o);o.height=a||0,r=Cesium.Ellipsoid.WGS84.cartographicToCartesian(o)}this.distance_=Cesium.Cartesian3.distance(r,this.cam_.position);var s=e.cartesianToCartographic(r);if(this.view_.setCenter(this.fromLonLat_([E(s.longitude),E(s.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,s?s.latitude:0)),i){var u=this.cam_.position,l=new Cesium.Cartesian3;e.geocentricSurfaceNormal(i,l);var c=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(u,i,c),Cesium.Cartesian3.normalize(c,c);var h=this.cam_.up,p=this.cam_.right,m=new Cesium.Cartesian3(-i.y,i.x,0),d=Cesium.Cartesian3.angleBetween(p,m),f=Cesium.Cartesian3.cross(i,h,new Cesium.Cartesian3).z;this.view_.setRotation(f<0?d:-d);var y=Math.acos(Cesium.Cartesian3.dot(l,c));this.tilt_=isNaN(y)?0:y}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}},e.prototype.checkCameraChange=function(e){var t=this.lastCameraViewMatrix_,i=this.cam_.viewMatrix;t&&Cesium.Matrix4.equalsEpsilon(t,i,1e-5)||(this.lastCameraViewMatrix_=i.clone(),!0!==e&&this.updateView())},e.prototype.calcDistanceForResolution=function(e,t){var i=this.scene_.canvas,r=this.cam_.frustum.fovy,n=this.view_.getProjection().getMetersPerUnit();return e*i.clientHeight*n*Math.cos(Math.abs(t))/2/Math.tan(r/2)},e.prototype.calcResolutionForDistance=function(e,t){var i=this.scene_.canvas,r=this.cam_.frustum.fovy,n=this.view_.getProjection().getMetersPerUnit();return 2*e*Math.tan(r/2)/n/Math.cos(Math.abs(t))/i.clientHeight},e}(),G=i(4),M=i.n(G);var F=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=t,this.view=t.getView(),this.scene=i,this.olLayers=t.getLayerGroup().getLayers(),this.mapLayerGroup=t.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}return e.prototype.synchronize=function(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)},e.prototype.orderLayers=function(){},e.prototype.addLayers_=function(e){for(var t=this,i=[{layer:e,parents:[]}],r=function(){var e=i.splice(0,1)[0],r=e.layer,n=s(r).toString();t.olLayerListenKeys[n]=[];var a=null;if(r instanceof M.a)t.listenForGroupChanges_(r),r!==t.mapLayerGroup&&(a=t.createSingleLayerCounterparts(e)),a||r.getLayers().forEach(function(n){if(n){var o={layer:n,parents:r===t.mapLayerGroup?[]:[e.layer].concat(e.parents)};i.push(o)}});else if(!(a=t.createSingleLayerCounterparts(e))){var u=n,l=e;t.olLayerListenKeys[n].push(o(l.layer,"change",function e(i){var r=t.createSingleLayerCounterparts(l);r&&(l.layer.un("change",e),t.addCesiumObjects_(r,u,l.layer),t.orderLayers())}))}a&&t.addCesiumObjects_(a,n,r)};i.length>0;)r();this.orderLayers()},e.prototype.addCesiumObjects_=function(e,t,i){var r=this;this.layerMap[t]=e,this.olLayerListenKeys[t].push(o(i,"change:zIndex",function(){return r.orderLayers()})),e.forEach(function(e){r.addCesiumObject(e)})},e.prototype.removeAndDestroySingleLayer_=function(e){var t=this,i=s(e).toString(),r=this.layerMap[i];return r&&(r.forEach(function(e){t.removeSingleCesiumObject(e,!1),t.destroyCesiumObject(e)}),this.olLayerListenKeys[i].forEach(R.unByKey),delete this.olLayerListenKeys[i]),delete this.layerMap[i],!!r},e.prototype.unlistenSingleGroup_=function(e){if(e!==this.mapLayerGroup){var t=s(e).toString();this.olGroupListenKeys_[t].forEach(function(e){Object(R.unByKey)(e)}),delete this.olGroupListenKeys_[t],delete this.layerMap[t]}},e.prototype.removeLayer_=function(e){var t=this;e&&function(){for(var i=[e];i.length>0;){var r=i.splice(0,1)[0],n=t.removeAndDestroySingleLayer_(r);r instanceof M.a&&(t.unlistenSingleGroup_(r),n||r.getLayers().forEach(function(e){i.push(e)}))}}()},e.prototype.listenForGroupChanges_=function(e){var t=s(e).toString(),i=[];this.olGroupListenKeys_[t]=i;var r=[],n=function(){var t=this,n=e.getLayers();n&&(r=[n.on("add",function(e){t.addLayers_(e.element)}),n.on("remove",function(e){t.removeLayer_(e.element)})],i.push.apply(i,r))}.bind(this);n(),i.push(e.on("change:layers",function(e){r.forEach(function(e){var t=i.indexOf(e);t>=0&&i.splice(t,1),Object(R.unByKey)(e)}),n()}))},e.prototype.destroyAll=function(){this.removeAllCesiumObjects(!0);var e=void 0;for(e in this.olGroupListenKeys_){this.olGroupListenKeys_[e].forEach(R.unByKey)}for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(R.unByKey);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}},e.prototype.addCesiumObject=function(e){},e.prototype.destroyCesiumObject=function(e){},e.prototype.removeSingleCesiumObject=function(e,t){},e.prototype.removeAllCesiumObjects=function(e){},e.prototype.createSingleLayerCounterparts=function(e){},e}();var j=function(e){function t(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,r));return n.cesiumLayers_=r.imageryLayers,n.ourLayers_=new Cesium.ImageryLayerCollection,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.addCesiumObject=function(e){this.cesiumLayers_.add(e),this.ourLayers_.add(e)},t.prototype.destroyCesiumObject=function(e){e.destroy()},t.prototype.removeSingleCesiumObject=function(e,t){this.cesiumLayers_.remove(e,t),this.ourLayers_.remove(e,!1)},t.prototype.removeAllCesiumObjects=function(e){for(var t=0;t<this.ourLayers_.length;++t)this.cesiumLayers_.remove(this.ourLayers_.get(t),e);this.ourLayers_.removeAll(!1)},t.prototype.convertLayerToCesiumImageries=function(e,t){var i=L.tileLayerToImageryLayer(this.map,e,t);return i?[i]:null},t.prototype.createSingleLayerCounterparts=function(e){var t=this,i=e.layer,r=s(i).toString(),n=this.view.getProjection(),o=this.convertLayerToCesiumImageries(i,n);if(o){var a,u=[];[e.layer].concat(e.parents).forEach(function(t){u.push(t.on(["change:opacity","change:visible"],function(){for(var t=0;t<o.length;++t)L.updateCesiumLayerProperties(e,o[t])}))});for(var l=0;l<o.length;++l)L.updateCesiumLayerProperties(e,o[l]);u.push(i.on("change:extent",function(e){for(var r=0;r<o.length;++r)t.cesiumLayers_.remove(o[r],!0),t.ourLayers_.remove(o[r],!1);delete t.layerMap[s(i)],t.synchronize()})),u.push(i.on("change",function(e){for(var i=0;i<o.length;++i){var r=t.cesiumLayers_.indexOf(o[i]);r>=0&&(t.cesiumLayers_.remove(o[i],!1),t.cesiumLayers_.add(o[i],r))}})),(a=this.olLayerListenKeys[r]).push.apply(a,u)}return Array.isArray(o)?o:null},t.prototype.orderLayers=function(){for(var e=this,t=[],i={},r=[this.mapLayerGroup];r.length>0;){var n=r.splice(0,1)[0];if(t.push(n),i[s(n)]=n.getZIndex(),n instanceof M.a){var o=n.getLayers();o&&r.unshift.apply(r,o.getArray())}}!function(e,t){for(var i=e.length,r=Array(e.length),n=0;n<i;n++)r[n]={index:n,value:e[n]};r.sort(function(e,i){return t(e.value,i.value)||e.index-i.index});for(var o=0;o<e.length;o++)e[o]=r[o].value}(t,function(e,t){return i[s(e)]-i[s(t)]}),t.forEach(function(t){var i=s(t).toString(),r=e.layerMap[i];r&&r.forEach(function(t){e.raiseToTop(t)})})},t.prototype.raiseToTop=function(e){this.cesiumLayers_.raiseToTop(e)},t}(F),I=i(2),k=i.n(I),V=i(3),N=i.n(V),D=i(7),z=i.n(D),B=i(5),K=i.n(B),H=i(8),U=i.n(H),W=i(19),q=i.n(W),Z=i(20),Q=i(21),Y=i(9),X=i(22),J=i.n(X);var $=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=new Cesium.BillboardCollection({scene:i}),n=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:t,billboards:r,featureToCesiumMap:{},primitives:n},this.rootCollection_.add(r),this.rootCollection_.add(n)}return e.prototype.destroy=function(){this.olListenKeys.forEach(R.unByKey),this.olListenKeys.length=0},e.prototype.getRootPrimitive=function(){return this.rootCollection_},e}();var ee=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this)}return e.prototype.onRemoveOrClearFeature_=function(e){var t=e.target,i=u.obj(t).olcs_cancellers;if(i){var r=e.feature;if(r){var n=s(r),o=i[n];o&&(o(),delete i[n])}else{for(var a in i)i.hasOwnProperty(a)&&i[a]();u.obj(t).olcs_cancellers={}}}},e.prototype.setReferenceForPicking=function(e,t,i){i.olLayer=e,i.olFeature=t},e.prototype.createColoredPrimitive=function(e,t,i,r,n,o){var a={flat:!0,renderState:{depthTest:{enabled:!0}}};void 0!==o&&(a.renderState||(a.renderState={}),a.renderState.lineWidth=o);var s=function(e,t){return new Cesium.GeometryInstance({geometry:e,attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(t)}})}(r,n),u=void 0;if(this.getHeightReference(e,t,i)===Cesium.HeightReference.CLAMP_TO_GROUND){var l=s.geometry.constructor;if(l&&!l.createShadowVolume)return null;u=new Cesium.GroundPrimitive({geometryInstances:s})}else{var c=new Cesium.PerInstanceColorAppearance(a);u=new Cesium.Primitive({geometryInstances:s,appearance:c})}return this.setReferenceForPicking(e,t,u),u},e.prototype.extractColorFromOlStyle=function(e,t){var i=e.getFill()?e.getFill().getColor():null,r=e.getStroke()?e.getStroke().getColor():null,n="black";return r&&t?n=r:i&&(n=i),L.convertColorToCesium(n)},e.prototype.extractLineWidthFromOlStyle=function(e){var t=e.getStroke()?e.getStroke().getWidth():void 0;return void 0!==t?t:1},e.prototype.wrapFillAndOutlineGeometries=function(e,t,i,r,n,o){var a=this.extractColorFromOlStyle(o,!1),s=this.extractColorFromOlStyle(o,!0),u=new Cesium.PrimitiveCollection;if(o.getFill()){var l=this.createColoredPrimitive(e,t,i,r,a);u.add(l)}if(o.getStroke()&&n){var c=this.extractLineWidthFromOlStyle(o),h=this.createColoredPrimitive(e,t,i,n,s,c);h&&u.add(h)}return u},e.prototype.addTextStyle=function(e,t,i,r,n){var o=void 0;if(n instanceof Cesium.PrimitiveCollection?o=n:(o=new Cesium.PrimitiveCollection).add(n),!r.getText())return o;var a=r.getText(),s=this.olGeometry4326TextPartToCesium(e,t,i,a);return s&&o.add(s),o},e.prototype.csAddBillboard=function(e,t,i,r,n,o){var a=e.add(t);return this.setReferenceForPicking(i,r,a),a},e.prototype.olCircleGeometryToCesium=function(e,t,i,r,n){var o=this,a=(i=L.olGeometryCloneTo4326(i,r)).getCenter(),s=3==a.length?a[2]:0,u=a.slice();u[0]+=i.getRadius(),a=L.ol4326CoordinateToCesiumCartesian(a),u=L.ol4326CoordinateToCesiumCartesian(u);var l=Cesium.Cartesian3.distance(a,u),c=new Cesium.CircleGeometry({center:a,radius:l,height:s}),h=void 0,p=void 0;if(this.getHeightReference(e,t,i)===Cesium.HeightReference.CLAMP_TO_GROUND){var m=this.extractLineWidthFromOlStyle(n);if(m){var d=Object(Z.circular)(i.getCenter(),l),f=L.ol4326CoordinateArrayToCsCartesians(d.getLinearRing(0).getCoordinates());if(Cesium.GroundPolylinePrimitive.isSupported(this.scene))(h=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:f,width:m})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),classificationType:Cesium.ClassificationType.TERRAIN})).readyPromise.then(function(){o.setReferenceForPicking(e,t,h._primitive)});else{var y=this.extractColorFromOlStyle(n,!0);h=this.createStackedGroundCorridors(e,t,m,y,f)}}}else p=new Cesium.CircleOutlineGeometry({center:a,radius:l,extrudedHeight:s,height:s});var v=this.wrapFillAndOutlineGeometries(e,t,i,c,p,n);return h&&v.add(h),this.addTextStyle(e,t,i,n,v)},e.prototype.createStackedGroundCorridors=function(e,t,i,r,n){Array.isArray(n[0])||(n=[n]),i=Math.max(3,i);for(var o=[],a=0,s=[1e3,4e3,16e3,64e3,254e3,1e6,1e7],u=0;u<s.length;u++){var l=s[u],c={width:i*=2.14,vertexFormat:Cesium.VertexFormat.POSITION_ONLY},h=n,p=Array.isArray(h),m=0;for(h=p?h:h[Symbol.iterator]();;){var d;if(p){if(m>=h.length)break;d=h[m++]}else{if((m=h.next()).done)break;d=m.value}var f=d;c.positions=f,o.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(c),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(r),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a,l-1)}}))}a=l}return new Cesium.GroundPrimitive({geometryInstances:o})},e.prototype.olLineStringGeometryToCesium=function(e,t,i,r,n){var o=this;i=L.olGeometryCloneTo4326(i,r);var a=L.ol4326CoordinateArrayToCsCartesians(i.getCoordinates()),s=this.extractLineWidthFromOlStyle(n),u=void 0,l=this.getHeightReference(e,t,i);if(l!==Cesium.HeightReference.CLAMP_TO_GROUND||Cesium.GroundPolylinePrimitive.isSupported(this.scene)){var c=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),h={positions:a,width:s},p={appearance:c};if(l===Cesium.HeightReference.CLAMP_TO_GROUND){var m=new Cesium.GroundPolylineGeometry(h);p.geometryInstances=new Cesium.GeometryInstance({geometry:m}),(u=new Cesium.GroundPolylinePrimitive(p)).readyPromise.then(function(){o.setReferenceForPicking(e,t,u._primitive)})}else{h.vertexFormat=c.vertexFormat;var d=new Cesium.PolylineGeometry(h);p.geometryInstances=new Cesium.GeometryInstance({geometry:d}),u=new Cesium.Primitive(p)}}else{var f=this.extractColorFromOlStyle(n,!0);u=this.createStackedGroundCorridors(e,t,s,f,a)}return this.setReferenceForPicking(e,t,u),this.addTextStyle(e,t,i,n,u)},e.prototype.olPolygonGeometryToCesium=function(e,t,i,r,n){var o=this;i=L.olGeometryCloneTo4326(i,r);var a=this.getHeightReference(e,t,i),s=void 0,u=void 0,l=void 0;if(5==i.getCoordinates()[0].length&&"rectangle"===t.getGeometry().get("olcs.polygon_kind")){var c=i.getCoordinates()[0],h=Y.boundingExtent(c),p=Cesium.Rectangle.fromDegrees(h[0],h[1],h[2],h[3]),m=0;if(3==c[0].length)for(var d=0;d<c.length;d++)m=Math.max(m,c[d][2]);s=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:p,height:m}),u=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:p,height:m})}else{for(var f=i.getLinearRings(),y={},v=y,g=0;g<f.length;++g){var C=f[g].getCoordinates(),_=L.ol4326CoordinateArrayToCsCartesians(C);0==g?y.positions=_:(y.holes||(y.holes=[]),y.holes.push({positions:_}))}if(s=new Cesium.PolygonGeometry({polygonHierarchy:v,perPositionHeight:!0}),a===Cesium.HeightReference.CLAMP_TO_GROUND){var w=this.extractLineWidthFromOlStyle(n);if(w>0){var b=[y.positions];if(y.holes)for(var S=0;S<y.holes.length;++S)b.push(y.holes[S].positions);if(Cesium.GroundPolylinePrimitive.isSupported(this.scene)){var P=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),T=[],O=b,R=Array.isArray(O),E=0;for(O=R?O:O[Symbol.iterator]();;){var x;if(R){if(E>=O.length)break;x=O[E++]}else{if((E=O.next()).done)break;x=E.value}var A=x,G=new Cesium.GroundPolylineGeometry({positions:A,width:w});T.push(new Cesium.GeometryInstance({geometry:G}))}var M={appearance:P,geometryInstances:T};(l=new Cesium.GroundPolylinePrimitive(M)).readyPromise.then(function(){o.setReferenceForPicking(e,t,l._primitive)})}else{var F=this.extractColorFromOlStyle(n,!0);l=this.createStackedGroundCorridors(e,t,w,F,b)}}}else u=new Cesium.PolygonOutlineGeometry({polygonHierarchy:y,perPositionHeight:!0})}var j=this.wrapFillAndOutlineGeometries(e,t,i,s,u,n);return l&&j.add(l),this.addTextStyle(e,t,i,n,j)},e.prototype.getHeightReference=function(e,t,i){var r=i.get("altitudeMode");void 0===r&&(r=t.get("altitudeMode")),void 0===r&&(r=e.get("altitudeMode"));var n=Cesium.HeightReference.NONE;return"clampToGround"===r?n=Cesium.HeightReference.CLAMP_TO_GROUND:"relativeToGround"===r&&(n=Cesium.HeightReference.RELATIVE_TO_GROUND),n},e.prototype.createBillboardFromImage=function(e,t,i,r,n,o,a,l){o instanceof q.a&&o.load();var c=o.getImage(1),h=function(){if(c&&(c instanceof HTMLCanvasElement||c instanceof Image||c instanceof HTMLImageElement)){var r=i.getCoordinates(),s=L.ol4326CoordinateToCesiumCartesian(r),u=void 0,h=o.getOpacity();void 0!==h&&(u=new Cesium.Color(1,1,1,h));var p=this.getHeightReference(e,t,i),m={image:c,color:u,scale:o.getScale(),heightReference:p,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,position:s},d=this.csAddBillboard(a,m,e,t,i,n);l&&l(d)}}.bind(this);if(c instanceof Image&&!function(e){return""!=e.src&&0!=e.naturalHeight&&0!=e.naturalWidth&&e.complete}(c)){var p=!1,m=e.getSource();m.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);var d=u.obj(m).olcs_cancellers;d||(d=u.obj(m).olcs_cancellers={});var f=s(t);d[f]&&d[f](),d[f]=function(){p=!0};Q.listenOnce(c,"load",function(){a.isDestroyed()||p||h()})}else h()},e.prototype.olPointGeometryToCesium=function(e,t,i,r,n,o,a){i=L.olGeometryCloneTo4326(i,r);var s=null,u=n.getImage();if(u){var l=i.get("olcs_model")||t.get("olcs_model");if(l){var c=l(),h=Object.assign({},{scene:this.scene},c.cesiumOptions),p=Cesium.Model.fromGltf(h);(s=new Cesium.PrimitiveCollection).add(p),c.debugModelMatrix&&s.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:c.debugModelMatrix}))}else this.createBillboardFromImage(e,t,i,r,n,u,o,a)}return n.getText()?this.addTextStyle(e,t,i,n,s||new Cesium.Primitive):s},e.prototype.olMultiGeometryToCesium=function(e,t,i,r,n,o,a){var s=this,u=function(i,o){var a=new Cesium.PrimitiveCollection;return i.forEach(function(i){a.add(o(e,t,i,r,n))}),a},l=void 0;switch(i.getType()){case"MultiPoint":if(l=(i=i).getPoints(),n.getText()){var c=new Cesium.PrimitiveCollection;return l.forEach(function(i){var u=s.olPointGeometryToCesium(e,t,i,r,n,o,a);u&&c.add(u)}),c}return l.forEach(function(i){s.olPointGeometryToCesium(e,t,i,r,n,o,a)}),null;case"MultiLineString":return u(l=(i=i).getLineStrings(),this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return u(l=(i=i).getPolygons(),this.olPolygonGeometryToCesium.bind(this))}},e.prototype.olGeometry4326TextPartToCesium=function(e,t,i,r){var n=r.getText();if(!n)return null;var o=new Cesium.LabelCollection({scene:this.scene}),a=Y.getCenter(i.getExtent());if(i instanceof J.a){var s=i.getFirstCoordinate();a[2]=3==s.length?s[2]:0}var u={};u.position=L.ol4326CoordinateToCesiumCartesian(a),u.text=n,u.heightReference=this.getHeightReference(e,t,i);var l=r.getOffsetX(),c=r.getOffsetY();if(0!=l&&0!=c){var h=new Cesium.Cartesian2(l,c);u.pixelOffset=h}u.font=r.getFont()||"10px sans-serif";var p=void 0;r.getFill()&&(u.fillColor=this.extractColorFromOlStyle(r,!1),p=Cesium.LabelStyle.FILL),r.getStroke()&&(u.outlineWidth=this.extractLineWidthFromOlStyle(r),u.outlineColor=this.extractColorFromOlStyle(r,!0),p=Cesium.LabelStyle.OUTLINE),r.getFill()&&r.getStroke()&&(p=Cesium.LabelStyle.FILL_AND_OUTLINE),u.style=p;var m=void 0;switch(r.getTextAlign()){case"left":m=Cesium.HorizontalOrigin.LEFT;break;case"right":m=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:m=Cesium.HorizontalOrigin.CENTER}if(u.horizontalOrigin=m,r.getTextBaseline()){var d=void 0;switch(r.getTextBaseline()){case"top":d=Cesium.VerticalOrigin.TOP;break;case"middle":d=Cesium.VerticalOrigin.CENTER;break;case"bottom":d=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":d=Cesium.VerticalOrigin.TOP;break;case"hanging":d=Cesium.VerticalOrigin.BOTTOM}u.verticalOrigin=d}var f=o.add(u);return this.setReferenceForPicking(e,t,f),o},e.prototype.olStyleToCesium=function(e,t,i){var r=t.getFill(),n=t.getStroke();if(i&&!n||!i&&!r)return null;var o=i?n.getColor():r.getColor();return o=L.convertColorToCesium(o),i&&n.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:o,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:o})},e.prototype.computePlainStyle=function(e,t,i,r){var n=t.getStyleFunction(),o=null;return n&&(o=n(t,r)),!o&&i&&(o=i(t,r)),o?Array.isArray(o)?o:[o]:null},e.prototype.getGeometryFromFeature=function(e,t,i){if(i)return i;var r=e.get("olcs.3d_geometry");if(r&&r instanceof U.a)return r;if(t){var n=t.getGeometryFunction()(e);if(n instanceof U.a)return n}return e.getGeometry()},e.prototype.olFeatureToCesium=function(e,t,i,r,n){var o=this,a=this.getGeometryFromFeature(t,i,n);if(!a)return null;var u=r.projection,l=function(e){var i=r.featureToCesiumMap[s(t)];i instanceof Array?i.push(e):r.featureToCesiumMap[s(t)]=[e]};switch(a.getType()){case"GeometryCollection":var c=new Cesium.PrimitiveCollection;return a.getGeometries().forEach(function(n){if(n){var a=o.olFeatureToCesium(e,t,i,r,n);a&&c.add(a)}}),c;case"Point":a=a;var h=r.billboards,p=this.olPointGeometryToCesium(e,t,a,u,i,h,l);return p||null;case"Circle":return a=a,this.olCircleGeometryToCesium(e,t,a,u,i);case"LineString":return a=a,this.olLineStringGeometryToCesium(e,t,a,u,i);case"Polygon":return a=a,this.olPolygonGeometryToCesium(e,t,a,u,i);case"MultiPoint":case"MultiLineString":case"MultiPolygon":var m=this.olMultiGeometryToCesium(e,t,a,u,i,r.billboards,l);return m||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error("Ol geom type not handled : "+a.getType())}},e.prototype.olVectorLayerToCesium=function(e,t,i){var r=t.getProjection(),n=t.getResolution();if(void 0===n||!r)throw new Error("View not ready");var o=e.getSource();o instanceof z.a&&(o=o.getSource());for(var a=o.getFeatures(),u=new $(r,this.scene),l=u.context,c=0;c<a.length;++c){var h=a[c];if(h){var p=e.getStyleFunction(),m=this.computePlainStyle(e,h,p,n);if(m&&m.length){for(var d=null,f=0;f<m.length;f++){var y=this.olFeatureToCesium(e,h,m[f],l);if(y)if(d){if(y)for(var v=0,g=void 0;g=y.get(v);)d.add(g),v++}else d=y}d&&(i[s(h)]=d,u.getRootPrimitive().add(d))}}}return u},e.prototype.convert=function(e,t,i,r){var n=t.getProjection(),o=t.getResolution();if(void 0==o||!n)return null;var a=e.getStyleFunction(),s=this.computePlainStyle(e,i,a,o);if(!s.length)return null;r.projection=n;for(var u=null,l=0;l<s.length;l++){var c=this.olFeatureToCesium(e,i,s[l],r);if(u){if(c)for(var h=0,p=void 0;p=c.get(h);)u.add(p),h++}else u=c}return u},e}();var te=function(e){function t(i,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,r));return o.converter=n||new ee(r),o.csAllPrimitives_=new Cesium.PrimitiveCollection,r.primitives.add(o.csAllPrimitives_),o.csAllPrimitives_.destroyPrimitives=!1,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.addCesiumObject=function(e){e.getRootPrimitive().counterpart=e,this.csAllPrimitives_.add(e.getRootPrimitive())},t.prototype.destroyCesiumObject=function(e){e.getRootPrimitive().destroy()},t.prototype.removeSingleCesiumObject=function(e,t){e.destroy(),this.csAllPrimitives_.destroyPrimitives=t,this.csAllPrimitives_.remove(e.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1},t.prototype.removeAllCesiumObjects=function(e){if(this.csAllPrimitives_.destroyPrimitives=e,e)for(var t=0;t<this.csAllPrimitives_.length;++t)this.csAllPrimitives_.get(t).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1},t.prototype.updateLayerVisibility=function(e,t){var i=!0;[e.layer].concat(e.parents).forEach(function(e){var t=e.getVisible();void 0!==t?i&=t:i=!1}),t.show=i},t.prototype.createSingleLayerCounterparts=function(e){var t=this,i=e.layer;if(!(i instanceof K.a))return null;var r=i.getSource();if(r instanceof z.a&&(r=r.getSource()),!r)return null;var n=this.view,a={},u=this.converter.olVectorLayerToCesium(i,n,a),l=u.getRootPrimitive(),c=u.olListenKeys;[e.layer].concat(e.parents).forEach(function(i){c.push(o(i,"change:visible",function(){t.updateLayerVisibility(e,l)}))}),this.updateLayerVisibility(e,l);var h=function(e){var t=u.context,r=this.converter.convert(i,n,e,t);r&&(a[s(e)]=r,l.add(r))}.bind(this),p=function(e){var t=s(e),i=u.context,r=i.featureToCesiumMap[t];r&&(delete i.featureToCesiumMap[t],r.forEach(function(e){e instanceof Cesium.Billboard&&i.billboards.remove(e)}));var n=a[t];delete a[t],n&&l.remove(n)}.bind(this);return c.push(o(r,"addfeature",function(e){h(e.feature)})),c.push(o(r,"removefeature",function(e){p(e.feature)})),c.push(o(r,"changefeature",function(e){var t=e.feature;p(t),h(t)})),u?[u]:null},t}(F),ie=i(23),re=i.n(ie),ne=i(10);var oe=function(e){function t(i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=i.parent,n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r.getOptions()));n.scenePostRenderListenerRemover_=null,n.scene_=i.scene,n.synchronizer_=i.synchronizer,n.parent_=r,n.positionWGS84_=void 0,n.observer_=new MutationObserver(n.handleElementChanged.bind(n)),n.attributeObserver_=[],n.listenerKeys_=[];var o=function(e){return n.setPropertyFromEvent_(e)};return n.listenerKeys_.push(n.parent_.on("change:position",o)),n.listenerKeys_.push(n.parent_.on("change:element",o)),n.listenerKeys_.push(n.parent_.on("change:offset",o)),n.listenerKeys_.push(n.parent_.on("change:position",o)),n.listenerKeys_.push(n.parent_.on("change:positioning",o)),n.setProperties(n.parent_.getProperties()),n.handleMapChanged(),n.handleElementChanged(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.observeTarget_=function(e){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(function(e){e.disconnect()}),this.attributeObserver_.length=0;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType){var r=new MutationObserver(this.handleElementChanged.bind(this));r.observe(i,{attributes:!0,subtree:!0}),this.attributeObserver_.push(r)}}}},t.prototype.setPropertyFromEvent_=function(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))},t.prototype.getScene=function(){return this.scene_},t.prototype.handleMapChanged=function(){this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),ne.removeNode(this.element)),this.scenePostRenderListenerRemover_=null;var e=this.getScene();if(e){this.scenePostRenderListenerRemover_=e.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();var t=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element)}},t.prototype.handlePositionChanged=function(){var e=this.getPosition();if(e){var t=this.parent_.getMap().getView().getProjection();this.positionWGS84_=r.transform(e,t,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()},t.prototype.handleElementChanged=function(){function e(t,i){var r=t.cloneNode();i&&i.appendChild(r),t.nodeType!=Node.TEXT_NODE&&r.addEventListener("click",function(e){t.dispatchEvent(new MouseEvent("click",e)),e.stopPropagation()});for(var n=t.childNodes,o=0;o<n.length;o++)n[o]&&e(n[o],r);return r}ne.removeChildren(this.element);var t=this.getElement();if(t&&t.parentNode&&t.parentNode.childNodes){var i=t.parentNode.childNodes,r=Array.isArray(i),n=0;for(i=r?i:i[Symbol.iterator]();;){var o;if(r){if(n>=i.length)break;o=i[n++]}else{if((n=i.next()).done)break;o=n.value}var a=e(o,null);this.element.appendChild(a)}}t.parentNode&&this.observeTarget_(t.parentNode)},t.prototype.updatePixelPosition=function(){var e=this.positionWGS84_;if(this.scene_&&e){var t=void 0;t=2===e.length?Cesium.Cartesian3.fromDegreesArray(e)[0]:Cesium.Cartesian3.fromDegreesArrayHeights(e)[0];var i=this.scene_.camera,r=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(new Cesium.Occluder(r,i.position).isPointVisible(t))if(1===i.frustum.computeCullingVolume(i.position,i.direction,i.up).computeVisibility(new Cesium.BoundingSphere(t))){this.setVisible(!0);var n=this.scene_.cartesianToCanvasCoordinates(t),o=[n.x,n.y],a=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(o,a)}else this.setVisible(!1);else this.setVisible(!1)}else this.setVisible(!1)},t.prototype.destroy=function(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),Object(R.unByKey)(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null},t}(re.a);var ae=function(){function e(t,i){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map=t,this.overlays_=this.map.getOverlays(),this.scene=i,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach(function(e){r.overlayContainerStopEvent_.addEventListener(e,function(e){return e.stopPropagation()})}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}return e.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},e.prototype.getOverlayContainer=function(){return this.overlayContainer_},e.prototype.synchronize=function(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))},e.prototype.addOverlayFromEvent_=function(e){var t=e.element;this.addOverlay(t)},e.prototype.addOverlays=function(){var e=this;this.overlays_.forEach(function(t){e.addOverlay()})},e.prototype.addOverlay=function(e){if(e){var t=new oe({scene:this.scene,synchronizer:this,parent:e}),i=s(e).toString();this.overlayMap_[i]=t}},e.prototype.removeOverlayFromEvent_=function(e){var t=e.element;this.removeOverlay(t)},e.prototype.removeOverlay=function(e){var t=s(e).toString(),i=this.overlayMap_[t];i&&(i.destroy(),delete this.overlayMap_[t])},e.prototype.destroyAll=function(){var e=this;Object.keys(this.overlayMap_).forEach(function(t){e.overlayMap_[t].destroy(),delete e.overlayMap_[t]})},e}();var se=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.autoRenderLoop_=null,this.map_=t.map,this.time_=t.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=r.getTransform(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;var i="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");var n=document.createAttribute("style");n.value=i+"visibility:hidden;",this.container_.setAttributeNode(n);var o=t.target||null;if(o)"string"==typeof o&&(o=document.getElementById(o)),o.appendChild(this.container_);else{var a=this.map_.getViewport().querySelector(".ol-overlaycontainer");a&&a.parentNode&&a.parentNode.insertBefore(this.container_,a)}if(this.isOverMap_=!o,this.isOverMap_&&t.stopOpenLayersEventsPropagation)for(var s=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"],l=0,c=s.length;l<c;++l)this.container_.addEventListener(s[l],function(e){return e.stopPropagation()});this.canvas_=document.createElement("CANVAS");var h=document.createAttribute("style");h.value=i,this.canvas_.setAttributeNode(h),u.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=u.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;var p=void 0!==t.sceneOptions?t.sceneOptions:{};p.canvas=this.canvas_,p.scene3DOnly=!0,this.scene_=new Cesium.Scene(p);var m=this.scene_.screenSpaceCameraController;m.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),m.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),m.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new A(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;var d=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(d,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});var f=t.createSynchronizers?t.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new j(this.map_,this.scene_),new te(this.map_,this.scene_),new ae(this.map_,this.scene_)];this.handleResize_();for(var y=f.length-1;y>=0;--y)f[y].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,(new Cesium.EventHelper).add(this.scene_.postRender,e.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}return e.prototype.render_=function(){void 0!==this.renderId_&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),!this.enabled_&&!this.warmingUp_||this.blockCesiumRendering_||(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))},e.prototype.onAnimationFrame_=function(e){this.renderId_=void 0;var t=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<t)this.render_();else{this.lastFrameTime_=e;var i=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(i),this.entityView_){var r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(i,this.boundingSphereScratch_))}this.scene_.render(i),this.camera_.checkCameraChange(),this.render_()}},e.prototype.updateTrackedEntity_=function(){if(this.needTrackedEntityUpdate_){var e=this.trackedEntity_,t=this.scene_,i=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(i!==Cesium.BoundingSphereState.PENDING){t.screenSpaceCameraController.enableTilt=!1;var r=i!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;r&&(r.radius=1),this.entityView_=new Cesium.EntityView(e,t,t.mapProjection.ellipsoid),this.entityView_.update(this.time_(),r),this.needTrackedEntityUpdate_=!1}}},e.prototype.handleResize_=function(){var e=this.canvas_.clientWidth,t=this.canvas_.clientHeight;if(!(0===e|0===t)&&(e!==this.canvasClientWidth_||t!==this.canvasClientHeight_||this.resolutionScaleChanged_)){var i=this.resolutionScale_;u.supportsImageRenderingPixelated()||(i*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=t,e*=i,t*=i,this.canvas_.width=e,this.canvas_.height=t,this.scene_.camera.frustum.aspectRatio=e/t}},e.prototype.getCamera=function(){return this.camera_},e.prototype.getOlMap=function(){return this.map_},e.prototype.getOlView=function(){var e=this.map_.getView();return e},e.prototype.getCesiumScene=function(){return this.scene_},e.prototype.getDataSources=function(){return this.dataSourceCollection_},e.prototype.getDataSourceDisplay=function(){return this.dataSourceDisplay_},e.prototype.getEnabled=function(){return this.enabled_},e.prototype.setEnabled=function(e){var t=this;if(this.enabled_!==e){this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden";var i=void 0;if(this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){(i=this.map_.getInteractions()).forEach(function(e,i,r){t.pausedInteractions_.push(e)}),i.clear();var r=this.map_.getLayerGroup();r.getVisible()&&(this.hiddenRootGroup_=r,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay"),this.map_.getOverlayContainerStopEvent().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(i=this.map_.getInteractions(),this.pausedInteractions_.forEach(function(e){i.push(e)}),this.pausedInteractions_.length=0,this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.map_.getOverlayContainerStopEvent().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()}},e.prototype.warmUp=function(e,t){var i=this;if(!this.enabled_){this.throwOnUnitializedMap_(),this.camera_.readFromView();var r=this.globe_.ellipsoid,n=this.scene_.camera,o=r.cartesianToCartographic(n.position);o.height<e&&(o.height=e,n.position=r.cartographicToCartesian(o)),this.warmingUp_=!0,this.render_(),setTimeout(function(){i.warmingUp_=!1},t)}},e.prototype.setBlockCesiumRendering=function(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())},e.prototype.enableAutoRenderLoop=function(){this.autoRenderLoop_||(this.autoRenderLoop_=new O(this))},e.prototype.getAutoRenderLoop=function(){return this.autoRenderLoop_},e.prototype.setResolutionScale=function(e){(e=Math.max(0,e))!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())},e.prototype.setTargetFrameRate=function(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())},e.prototype.throwOnUnitializedMap_=function(){var e=this.map_.getView(),t=e.getCenter();if(!e.isDef()||isNaN(t[0])||isNaN(t[1]))throw new Error("The OpenLayers map is not properly initialized: "+t+" / "+e.getResolution())},e}();Object.defineProperties(se.prototype,{trackedFeature:{get:function(){return this.trackedFeature_},set:function(e){if(this.trackedFeature_!==e){var t=this.scene_;if(!e||!e.getGeometry())return this.needTrackedEntityUpdate_=!1,t.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,void t.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;var i=this.to4326Transform_,r={position:new Cesium.CallbackProperty(function(t,r){return n=e.getGeometry(),o=n.getCoordinates(),a=i(o,void 0,o.length),L.ol4326CoordinateToCesiumCartesian(a);var n,o,a},!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}});var ue=se;var le=function(e){function t(i,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,r));return o.dataSources_=n,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.createSingleLayerCounterparts=function(e){var t=void 0,i=e.layer,r=i.getCesiumDataSource;if(r&&(t=r(this.scene)),!t){var n=i.id,o=i.url;if(!(i instanceof N.a)||!n||!/^KML/.test(n)||!o||/:\/\/public\./.test(o))return null;var a=o,u=""+(i.getSource().get("rawData")||"");u&&(a=(new DOMParser).parseFromString(u,"text/xml")),t=Cesium.KmlDataSource.load(a,{camera:this.scene.camera,canvas:this.scene.canvas,clampToGround:!0})}var l=this;return t.then(function(e){var t;e.show=i.getVisible();var r=s(i).toString(),n=[];n.push(i.on("change:visible",function(t){e.show=t.target.getVisible()})),(t=l.olLayerListenKeys[r]).push.apply(t,n),i instanceof K.a&&i.getSource().getFeatures().forEach(function(t){if(e.entities.getById){var r=e.entities.getById(t.getId());r&&(r.olFeature=t,r.olLayer=i)}})}),[t]},t.prototype.addCesiumObject=function(e){this.dataSources_.add(e)},t.prototype.destroyCesiumObject=function(e){var t=this;e.then(function(e){t.dataSources_.remove(e,!0)})},t.prototype.removeSingleCesiumObject=function(e,t){var i=this;e.then(function(e){i.dataSources_.remove(e,t)})},t.prototype.removeAllCesiumObjects=function(e){this.dataSources_.removeAll(e)},t}(F);var ce=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.convertLayerToCesiumImageries=function(e,t){if(e instanceof N.a&&e.getSource()instanceof k.a)return null;var i,r=e.getCesiumImageryProvider;return r&&(i=r())?(Array.isArray(i)?i:[i]).map(function(e){return new Cesium.ImageryLayer(e)}):null},t}(j);var he=function(e){function t(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,i,r));return n.primitives_=new Cesium.PrimitiveCollection,r.primitives.add(n.primitives_),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.createSingleLayerCounterparts=function(e){var t=void 0,i=e.layer,r=i.getCesiumTileset3d;if(r&&(t=r(this.scene)),!t)return null;if(t){var n;t.show=i.getVisible();var o=s(i).toString(),a=[];a.push(i.on(["change:visible"],function(e){t.show=i.getVisible()})),(n=this.olLayerListenKeys[o]).push.apply(n,a)}return[t]},t.prototype.addCesiumObject=function(e){this.primitives_.contains(e)||this.primitives_.add(e)},t.prototype.destroyCesiumObject=function(e){this.primitives_.contains(e)&&this.primitives_.remove(e)},t.prototype.removeSingleCesiumObject=function(e,t){this.primitives_.contains(e)&&this.primitives_.remove(e)},t.prototype.removeAllCesiumObjects=function(e){this.primitives_.removeAll()},t}(F);var pe=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.createSingleLayerCounterparts=function(t){var i=t.layer,r=i.id,n=i.url;return/^KML/.test(r)&&n&&!/:\/\/public\./.test(n)?null:e.prototype.createSingleLayerCounterparts.call(this,t)},t}(te),me=(t.default=ue,window.olcs={});me.OLCesium=ue,me.AbstractSynchronizer=F,me.RasterSynchronizer=j,me.VectorSynchronizer=te,me.core=L,me.GaKmlSynchronizer=le,me.GaRasterSynchronizer=ce,me.GaTileset3dSynchronizer=he,me.GaVectorSynchronizer=pe}]);
//# sourceMappingURL=olcesium.js.map